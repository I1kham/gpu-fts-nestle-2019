<html>
<head>
	<title>PROGRAMMING MENU</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link href="style.css" rel="stylesheet" type="text/css">
</head>

<body onLoad="rheaBootstrap()">
<div class="wrapper1024x600">
	<div id="pagePleaseWait">
		<div id="pagePleaseWait_header_left"></div>
		<div id="pagePleaseWait_header_right"></div>
		<div class="clear"></div>
		
		<div class="page">
			<div id="pagePleaseWait_wait" style="position:absolute; top:150px; left:462px"><img draggable='false' src="img/animationRound.gif"></div>
			
			<div id="pagePleaseWait_freeText" style="position:absolute; top:40px; left:10px; width:984px; height:500px; background-color:rgba(40,40,40,0.7); color:#fff; display:none; padding:10px; border:solid 1px #fff; border-radius:10px;">aa</div>
			<div id="pagePleaseWait_freeBtn1" style="position:absolute; top:400px; left:20px; display:none">
				<div id="bntFree1" class="UIButton bigButton3x4"><p id="bntFree1Text">testo bottone 1</p></div>
			</div>
			<div id="pagePleaseWait_freeBtn2" style="position:absolute; top:400px; left:680px; display:none">
				<div id="bntFree2" class="UIButton bigButton3x4"><p id="bntFree2Text">testo bottone 2 bottone 2</p></div>
			</div>
		</div>
	</div>
			
	<!-- page Main menu -->
	<div class="header">
		<div id="divHeaderC" class="header_C"></div>
		<div class="header_R colorGrey">
			<div id="divHeaderR_data" style="float:left; margin-right:10px"></div>
			<div id="divHeaderR_ora" style="float:left;"></div>
			<div class="clear"></div>
		</div>
		<div class="clear"></div>
	</div>		

	<div id="divPage" class="page">
		<!--- page Main Menu -->
		<div id="pageMainMenu" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' cellspacing='0' cellpadding='0' width='99%' align='center'>
					<tr valign="middle">
						<td width="33%" align="center"><div class="UIButton bigButton3x4 " data-caption="MAINTENANCE" data-onclick="pageMaintenance_show()"></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="CLEANING" data-onclick="pageCleaning_show()"></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4 UIdisabled" data-caption="DATA AUDIT" data-onclick=""></div></td>
					</tr>
					<tr valign="middle">
						<td width="33%" align="center"><div class="UIButton bigButton3x4 UIdisabled" data-caption="SELECTIONS<br>(max 48)"></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4 UIdisabled" data-caption="CALIBRATION"></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4 UIdisabled" data-caption="DEVICES"></div></td>
					</tr>
					<tr valign="middle">
						<td width="33%" align="center"><div class="UIButton bigButton3x4 UIdisabled" data-caption="TEMPERATURE"></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4 UIdisabled" data-caption="PRODUCT<br>QUANTITY"></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4 UIdisabled" data-caption="PAYMENT<br>SYSTEMS"></div></td>
					</tr>
					<tr valign="middle">
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="MISCELLANEOUS" data-onclick="pageMiscellaneous_show()"></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4 UIdisabled" data-caption="CLOCK"></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4 UIdisabled" data-caption="CAPPUCCINATORE"></div></td>
					</tr>
					<tr valign="middle">
						<td width="33%" align="center"><div class="UIButton bigButton3x4 UIdisabled" data-caption="ACCOUNT"></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="TEST DA3 COMPARE" data-onclick="da3.compare()"></td>
						<td></td>
					</tr>					
				</table>
			</div>
		</div>
		
		<!-- page Maintenance -->
		<div id="pageMaintenance" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' class='elenco'>
					<tr>
						<td class='description'>Machine Voltage</td>
						<td>todo...</td>
					</tr>
					
					<tr>
						<td>Activate H20 Filer Reset</td>
						<td><div class="UIOption" data-option="1|YES|0|NO" data-da3="7090"></div></td>
					</tr>
					
					<tr>
						<td>Water filter decounter</td>
						<td><div class="UINumber" data-numfigures="5" data-da3="7334" data-max="60000"></div></td>
					</tr>
					<tr>
						<td>Decounter coffee brewer</td>
						<td><div class="UINumber" data-numfigures="4" data-da3="7336" data-max="1000"></div></td>
					</tr>
					
					<tr>
						<td>Decounter coffee ground</td>
						<td><div class="UINumber" data-numfigures="4" data-da3="7338" data-max="1000"></div></td>
					</tr>
					
					<tr>
						<td>OUT of service (last 20 OFF)</td>
						<td>todo...</td>
					</tr>						
				</table>
			</div>
		</div>
		
		<!-- page Cleaning -->
		<div id="pageCleaning" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' cellspacing='0' cellpadding='0' width='99%' align='center'>
					<tr valign="middle">
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="START RINSING<br>(MIXER + BREWER)" data-onclick="pageCleaning_action(160)"></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="START RINSING<br>MIXER / BREWER 1" data-onclick="pageCleaning_action(1)"></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="START CLEANING HC" data-onclick="pageCleaning_action(8)"></div></td>
					</tr>
					<tr valign="middle">
						<td></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="START RINSING<br>MIXER / BREWER 2" data-onclick="pageCleaning_action(2)"></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="START RINSING<br>MILK MODULE" data-onclick="pageCleaning_action(5)"></div></td>
					</tr>
					<tr valign="middle">
						<td></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="START RINSING<br>MIXER / BREWER 3" data-onclick="pageCleaning_action(3)"></div></td>
						</td>
					</tr>
					<tr valign="middle">
						<td></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="START RINSING<br>MIXER / BREWER 4" data-onclick="pageCleaning_action(4)"></div></td>
						</td>
					</tr>					
				</table>
			</div>
		</div>
	
		<!-- page pageMiscellaneous -->
		<div id="pageMiscellaneous" class="UIWindow">
			<div class="UIWindowContent">
				<div class="UIButton bigButton3x4" data-caption="OLD PROG MENU<br>(legacy)" data-onclick="pageMiscellaneous_oldProgMenu()"></div>
			</div>
		</div>	
		
	</div> <!-- divPage -->

	<div id="divFooter" class="footer">
		<div id="footer_L">
			<div id="bntBack" class="UIButton" data-caption="&nbsp;BACK&nbsp;" data-onclick="btnBack_onClick()"></div>
		</div>
		<div id="footer_C">
		</div>
		<div id="footer_R"></div>
		<div class="clear"></div>
	</div>
		
			
	
</div> <!-- wrapper -->


<script src="js/DA3.js"></script>
<script src="js/UI.js"></script>
<script src="js/Task.js"></script>
<script id="rheaBootstrapTag" src="js/rheaBootstrap.js" data-ses-clear="1"></script>
<script language="javascript">
var da3 = null;
var ui = null;
var voidTask = new TaskVoid();
var currentTask = voidTask;
var currentPageID="";
var timeNowMSec = 0;

function onRheaBootstrapFinished()
{
	document.getElementById("pagePleaseWait_freeBtn1").addEventListener("mousedown", function(ev) { currentTask.onFreeBtn1Clicked(ev); } , true);
	document.getElementById("pagePleaseWait_freeBtn2").addEventListener("mousedown", function(ev) { currentTask.onFreeBtn2Clicked(ev); } , true);
		
	
	rhea.onEvent_cpuStatus = function(statusID, statusStr) 			{ currentTask.onEvent_cpuStatus(statusID, statusStr); }
	rhea.onEvent_cpuMessage = function(msg, importanceLevel)	 	{ currentTask.onEvent_cpuMessage(msg, importanceLevel); }
	dataOra_setup();
	
	ui = new UI ("divPage");
	ui.setupStandaloneButton("bntBack");
	
	//di default mostro la pagina pageMainMenu. Se però in GET c'è specificata un'altra pagina..
	switch (rheaGetURLParamOrDefault("page", "pageMainMenu"))
	{
		case "pageMainMenu": pageMainMenu_show(); break;
		case "pageCleaning": pageCleaning_show(); break;
		case "pageCleaningSanitario": pageCleaning_show(); pageCleaning_startLavSanitario(0); break;
		case "pageMaintenance": pageMaintenance_show(); break;
		case "pageMiscellaneous": pageMiscellaneous_show(); break;
	}
	
	pleaseWait_show();
	pleaseWait_setTextLeft("loading da3");
	da3 = new DA3();
	da3.load();
	
	setInterval (function() { timeNowMSec+=1000; currentTask.onTimer(timeNowMSec); }, 1000)
}

function header_setText(s)				{ rheaSetDivHTMLByName("divHeaderC", s) }
function showPage(pageID)				{ currentPageID=pageID; ui.getWindowByID(currentPageID).loadFromDA3(da3); ui.hideAllExcept(currentPageID); }
function btnBack_show() 				{ rheaSetDisplayMode(rheaGetElemByID("bntBack"), "table"); }
function btnBack_hide() 				{ rheaHideElem(rheaGetElemByID("bntBack")); }
async function btnBack_onClick()				
{ 
	ui.getWindowByID(currentPageID).saveToDA3(da3); 
	var blockList = da3.compare();
	
	var nBlocchi = blockList.length;
	if (nBlocchi > 0)
	{
		//ci sono dei blocchi da3 che sono stati modificati
		pleaseWait_show();
		
		var msgToUser = "Saving datafile, please wait...<br>";
		pleaseWait_btn1_setText(msgToUser);
		pleaseWait_freeText_show();
		for (var i=0; i<nBlocchi; i++)
		{
			var blockNum = blockList[i];
			var uno_di = i+1;
			msgToUser += uno_di +"/" +nBlocchi +"&nbsp;&nbsp;&nbsp;block " +blockNum +"... ";
			
			pleaseWait_freeText_setText(msgToUser);
			let result = await da3.storeBlock(uno_di, nBlocchi, blockNum);
			msgToUser += result +"<br>";
			pleaseWait_freeText_setText(msgToUser);
		}
		
		pleaseWait_hide();
	}
	
	pageMainMenu_show(); 
}

/***************************************************************************
 *
 * please wait
 *
 */
function pleaseWait_show()				
{ 
	pleaseWait_setTextLeft(""); 
	pleaseWait_setTextRight(""); 
	pleaseWait_freeText_setText("");
	
	pleaseWait_btn1_hide();
	pleaseWait_btn2_hide();
	pleaseWait_freeText_hide();
	
	pleaseWait_wait_show();
	rheaShowElem(rheaGetElemByID("pagePleaseWait")); 
}
function pleaseWait_hide()				{ rheaHideElem(rheaGetElemByID("pagePleaseWait")); }
function pleaseWait_setTextLeft(s)		{ rheaSetDivHTMLByName("pagePleaseWait_header_left", s); }
function pleaseWait_setTextRight(s)		{ rheaSetDivHTMLByName("pagePleaseWait_header_right", s); }

function pleaseWait_wait_show()			{ rheaShowElem(rheaGetElemByID("pagePleaseWait_wait")); }
function pleaseWait_wait_hide()			{ rheaHideElem(rheaGetElemByID("pagePleaseWait_wait")); }

function pleaseWait_freeText_show()		{ rheaShowElem(rheaGetElemByID("pagePleaseWait_freeText")); }
function pleaseWait_freeText_hide()		{ rheaHideElem(rheaGetElemByID("pagePleaseWait_freeText")); }
function pleaseWait_freeText_setText(s)	{ rheaSetDivHTMLByName("pagePleaseWait_freeText", s); }

function pleaseWait_btn1_show()			{ rheaShowElem(rheaGetElemByID("pagePleaseWait_freeBtn1")); }
function pleaseWait_btn1_hide()			{ rheaHideElem(rheaGetElemByID("pagePleaseWait_freeBtn1")); }
function pleaseWait_btn1_setText(s)		{ rheaSetDivHTMLByName("bntFree1Text", s); }


function pleaseWait_btn2_show()			{ rheaShowElem(rheaGetElemByID("pagePleaseWait_freeBtn2")); }
function pleaseWait_btn2_hide()			{ rheaHideElem(rheaGetElemByID("pagePleaseWait_freeBtn2")); }
function pleaseWait_btn2_setText(s)		{ rheaSetDivHTMLByName("bntFree2Text", s); }


/***************************************************************************
 *
 * data & ora
 *
 */
var dataora_hh = 0;
var dataora_min = 0;
var dataora_sec = 0;
function dataOra_setup ()
{
	var d = new Date();
	var dataora_sec = parseInt(d.getSeconds());
	var dataora_min = parseInt(d.getMinutes());
	var dataora_hh = parseInt(d.getHours());
  
	var mm = (d.getUTCMonth() + 1).toString(); if (mm.length<2) mm="0"+mm;
	var gg = d.getUTCDate().toString(); if (gg.length<2) gg="0"+gg;
	var aaaa = d.getUTCFullYear();  
	rheaSetDivHTMLByName("divHeaderR_data", aaaa +"/" +mm +"/" +gg);
	

	setInterval (function() 
					{ 
						dataora_sec++;
						if (dataora_sec >= 60)
						{
							dataora_sec = 0;
							dataora_min++;
							if (dataora_min >= 60)
							{
								dataora_min = 0;
								dataora_hh++;
							}
						}
						
						var hh = dataora_hh.toString();		if (hh.length<2) hh = "0"+hh;
						var mm = dataora_min.toString();	if (mm.length<2) mm = "0"+mm;
						var sep = ":";
						if (dataora_sec % 2 == 0)
							sep = "&nbsp;"
						rheaSetDivHTMLByName("divHeaderR_ora", hh +sep +mm);
					}, 
					1000);
}


/***************************************************************************
 *
 * pageMainMenu
 *
 */
function pageMainMenu_show()
{
	showPage("pageMainMenu");
	header_setText("<div style='margin-left:140px'><center><img draggable='false' src='img/iconHome.png'> Programming Menu</center></div>");
	btnBack_hide();
}


/***************************************************************************
 *
 * pageMaintenance
 *
 */
function pageMaintenance_show()
{
	showPage('pageMaintenance');
	header_setText("MAINTENANCE");
	btnBack_show();
}



/***************************************************************************
 *
 * pageCleaning
 *
 */
function pageCleaning_show()
{
	showPage("pageCleaning");
	header_setText("CLEANING");
	btnBack_show();
	rhea.requestGPUEvent(RHEA_EVENT_CPU_STATUS);
}

function pageCleaning_action (what)
{
	pleaseWait_show();
	
	if (what == 8)
		pageCleaning_startLavSanitario(1);
	else
	{
		currentTask = new TaskCleaning(0);
		rhea.requestGPUCleaning(parseInt(what));
	}
}
	
function pageCleaning_startLavSanitario (bSendRequestToGPU)
{
	pleaseWait_show();
	currentTask = new TaskCleaning(1);
	if (bSendRequestToGPU)
		rhea.requestGPUCleaning(parseInt(8));
}

function pageCleaning_onFinished()
{
	pleaseWait_hide();
	currentTask = voidTask;
}

	
	
/***************************************************************************
 *
 * pageMiscellaneous
 *
 */
 function pageMiscellaneous_show()
{
	showPage("pageMiscellaneous");
	header_setText("MISCELLANEOUS");
	
	loadFromDA3
	btnBack_show();
}

function pageMiscellaneous_oldProgMenu()
{
	window.location = "gotoLegacyMenu.html";
}

</script>

</html>
