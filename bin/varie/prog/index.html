<html>
<head>
	<title>PROGRAMMING MENU</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link href="style.css" rel="stylesheet" type="text/css">
</head>

<body onLoad="rheaBootstrap()">
<div class="wrapper1024x600">
	<div id="pagePleaseWait">
		<div id="pagePleaseWait_header_left"></div>
		<div id="pagePleaseWait_header_right"></div>
		<div class="clear"></div>
		
		<div class="page">
			<div id="pagePleaseWait_wait" style="position:absolute; top:150px; left:462px"><img draggable='false' src="img/animationRound.gif"></div>
			
			<div id="pagePleaseWait_freeText" style="position:absolute; top:40px; left:10px; width:984px; height:500px; background-color:rgba(40,40,40,0.7); color:#fff; display:none; padding:10px; border:solid 1px #fff; border-radius:10px;">aa</div>
			
			<div id="pagePleaseWait_calibration" style="position:absolute; top:40px; left:10px; width:984px; height:500px; background-color:rgba(40,40,40,0.7); color:#fff; display:none; padding:10px; border:solid 1px #fff; border-radius:10px;">
				<div id="pagePleaseWait_calibration_text">prova microfono</div>
				<div class="UINumber" id="pagePleaseWait_calibration_num" data-numfigures="5" data-decimal="1" data-max="99999" data-um="gr"></div>
			</div>
			
			<div id="pagePleaseWait_freeBtn1" style="position:absolute; top:400px; left:20px; display:none">
				<div id="bntFree1" class="UIButton bigButton3x4"><p id="bntFree1Text">testo bottone 1</p></div>
			</div>
			<div id="pagePleaseWait_freeBtn2" style="position:absolute; top:400px; left:680px; display:none">
				<div id="bntFree2" class="UIButton bigButton3x4"><p id="bntFree2Text">testo bottone 2 bottone 2</p></div>
			</div>
			
		</div>
	</div>
			
	<!-- page Main menu -->
	<div class="header">
		<div id="divHeaderC" class="header_C"></div>
		<div class="header_R colorGrey">
			<div id="divHeaderR_data" style="float:left; margin-right:10px"></div>
			<div id="divHeaderR_ora" style="float:left;"></div>
			<div class="clear"></div>
		</div>
		<div class="clear"></div>
	</div>		

	<div id="divPage" class="page">
		<!--- page Main Menu -->
		<div id="pageMainMenu" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' cellspacing='0' cellpadding='0' width='99%' align='center'>
					<tr valign="middle">
						<td width="33%" align="center"><div class="UIButton bigButton3x4 " data-caption="MAINTENANCE" data-onclick="pageMaintenance_show()"></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="CLEANING/<br>RINSING" data-onclick="pageCleaning_show()"></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4 UIdisabled" data-caption="DATA AUDIT" data-onclick=""></div></td>
					</tr>
					<tr valign="middle">
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="SELECTIONS<br>(max 48)" data-onclick="pageSelections_show()"></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="CALIBRATION" data-onclick="pageCalibration_show()"></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4 UIdisabled" data-caption="DEVICES"></div></td>
					</tr>
					<tr valign="middle">
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="TEMPERATURE" data-onclick="pageTemperature_show()"></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="PRODUCT<br>QUANTITY" data-onclick="pageProductQty_show()"></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4 UIdisabled" data-caption="PAYMENT<br>SYSTEMS"></div></td>
					</tr>
					<tr valign="middle">
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="MISCELLANEOUS" data-onclick="pageMiscellaneous_show()"></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="CLOCK" data-onclick="pageClock_show()"></div></td>
						<td width="33%" align="center"><div id="pageMainMenu_btnMilker" class="UIButton bigButton3x4 UIdisabled" data-caption="MILKER" data-onclick="pageMilker_show()"></div></td>
					</tr>
					<tr valign="middle">
						<td width="33%" align="center"><div class="UIButton bigButton3x4 UIdisabled" data-caption="ACCOUNT"></div></td>
						<td></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="OLD PROG MENU<br>(legacy)" data-onclick="pageMiscellaneous_oldProgMenu()"></div></td>
					</tr>
				</table>
			</div>
		</div><!--- page Main Menu -->
		
		<!-- page Maintenance -->
		<div id="pageMaintenance" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' class='elenco'>
					<!--<tr><td class='description'>Machine Voltage</td><td>todo...</td></tr>-->
					
					<tr>
						<td>ACTIVATE H<sub>2</sub>0 FILTER RESET</td>
						<td colspan="2"><div class="UIOption" data-option="1|YES|0|NO" data-da3="7090"></div></td>
					</tr>
					
					<tr>
						<td>
							WATER FILTER DECOUNTER<br>
							<div style="float:left; margin-right:10px">current value:</div>
							<div id="pageMaintenance_11" style="float:left" class="bigCaption15">00000</div>
							<div class="clear"></div>
						</td>
						<td><div class="UINumber" id="pageMaintenance_11_cap" data-numfigures="5" data-da3="7394" data-max="60000"></div></td>
						<td><div class='UIButton bigButton60' data-caption='RESET' data-onclick="pageMaintenance_resetDec(11)"></div></div></td>
					</tr>
					<tr>
						<td>
							DECOUNTER COFFEE BREWER<br>
							<div style="float:left; margin-right:10px">current value:</div>
							<div id="pageMaintenance_12" style="float:left" class="bigCaption15">0000</div>
							<div class="clear"></div>
						</td>
						<td><div class="UINumber" id="pageMaintenance_12_cap" data-numfigures="4" data-da3="7396" data-max="1000"></div></td>
						<td><div class='UIButton bigButton60' data-caption='RESET' data-onclick="pageMaintenance_resetDec(12)"></div></div></td>
					</tr>
					<tr>
						<td>
							DECOUNTER COFFEE GROUND<br>
							<div style="float:left; margin-right:10px">current value:</div>
							<div id="pageMaintenance_13" style="float:left" class="bigCaption15">0000</div>
							<div class="clear"></div>
						</td>
						<td><div class="UINumber" id="pageMaintenance_13_cap" data-numfigures="4" data-da3="7398" data-max="1000"></div></td>
						<td><div class='UIButton bigButton60' data-caption='RESET' data-onclick="pageMaintenance_resetDec(13)"></div></div></td>
					</tr>
					
					<!--<tr><td>OUT of service (last 20 OFF)</td><td>todo...</td></tr>-->
				</table>
			</div>
		</div><!-- page Maintenance -->
		
		<!-- page Cleaning -->
		<div id="pageCleaning" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' cellspacing='0' cellpadding='0' width='99%' align='center'>
					<tr valign="middle">
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="START RINSING" data-onclick="pageCleaning_action(160)"></div></td>
						<td width="33%" align="center"><div id="pageCleaning_btnClean1" class="UIButton bigButton3x4" data-caption="START RINSING<br>BREWER" data-onclick="pageCleaning_action(1)"></div></td>
						<td width="33%" align="center"><div id="pageCleaning_btnCleanHC" class="UIButton bigButton3x4" data-caption="START RINSING HC" data-onclick="pageCleaning_action(8)"></div></td>
					</tr>
					<tr valign="middle">
						<td></td>
						<td width="33%" align="center"><div id="pageCleaning_btnClean2" class="UIButton bigButton3x4" data-caption="START RINSING<br>MIXER 1" data-onclick="pageCleaning_action(2)"></div></td>
						<td></td>
					</tr>
					<tr valign="middle">
						<td></td>
						<td width="33%" align="center"><div id="pageCleaning_btnClean3" class="UIButton bigButton3x4" data-caption="START RINSING<br>MIXER 2" data-onclick="pageCleaning_action(3)"></div></td>
						</td>
					</tr>
					<tr valign="middle">
						<td></td>
						<td width="33%" align="center"><div id="pageCleaning_btnClean4" class="UIButton bigButton3x4" data-caption="START RINSING<br>MIXER 3" data-onclick="pageCleaning_action(4)"></div></td>
						<td width="33%" align="center"><div id="pageCleaning_btnCleanMilker" class="UIButton bigButton3x4 UIdisabled" data-caption="START RINSING<br>MILK MODULE" data-onclick="pageCleaning_action(5)"></div></td>
					</tr>					
				</table>
			</div>
		</div>
	
		<!-- page pageMiscellaneous -->
		<div id="pageMiscellaneous" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' class='elenco'>
					<tr>
						<td>MACHINE CODE A</td>
						<td><div class="UINumber" data-numfigures="5" data-max="99999" data-da3="7052" data-da3bit="16"></div></td>
					</tr>
					<tr>
						<td>MACHINE CODE B</td>
						<td><div class="UINumber" data-numfigures="5" data-max="99999" data-da3="7054" data-da3bit="16"></div></td>
					</tr>
					<tr>
						<td>MESSAGE NUMBER</td>
						<td><div class="UINumber" data-numfigures="1" data-max="7" data-da3="7056" data-da3bit="8"></div></td>
					</tr>					
					<tr>
						<td>FAN TIME</td>
						<td><div class="UINumber" data-numfigures="3" data-max="180" data-da3="7062" data-da3bit="8" data-um="min"></div></td>
					</tr>
					<tr>
						<td>BEEP TIME</td>
						<td><div class="UINumber" data-numfigures="2" data-decimal='1' data-max="13" data-da3="7064" data-da3bit="8" data-um="sec"></div></td>
					</tr>
				</table>
			</div>
		</div>	<!-- page pageMiscellaneous -->
		
		<!-- page pageClock -->
		<div id="pageClock" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' class='elenco'>
					<tr style="border:0">
						<td>SUMMER TIME</td>
						<td><div class="UIOption" data-option="1|YES|0|NO" data-da3="7080"></div></td>
					</tr>
				</table>
					
				<br>
				<table border='0' width='100%'>
					<tr valign='middle'>
						<td style="width:210px"><b>VIEW SETTINGS FOR</b></td>
						<td><div class='UIOptionSmall' id='pageClock_selector' data-option='0|HAPPY HOUR|1|ENERGY SAVING' data-onclick='pageClock_onSelector()'></div></td>
					</tr>
				</table>

				<br>
				<div id="pageClock_happyHour" style="display:none">
					<table border='0' class='elenco'>
						<tr style="height:50px; vertical-align:bottom">
							<th style="width:232px; text-align:left">HAPPY HOUR</th>
							<th>START</th>
							<th>END</th>
						</tr>
						<tr>
							<td>HAPPY HOUR 1</td>
							<td align="center"><div class="UITime24" data-da3="7424"></div></td>
							<td align="center"><div class="UITime24" data-da3="7426"></div></td>
						</tr>
						<tr>
							<td>HAPPY HOUR 2</td>
							<td align="center"><div class="UITime24" data-da3="7428"></div></td>
							<td align="center"><div class="UITime24" data-da3="7430"></div></td>
						</tr>
						<tr style="border:0">
							<td>HAPPY HOUR 3</td>
							<td align="center"><div class="UITime24" data-da3="7432"></div></td>
							<td align="center"><div class="UITime24" data-da3="7434"></div></td>
						</tr>
					</table>
				</div>
				
				<div id="pageClock_energySave">
					<table border='0' class='elenco'>
						<tr style="height:50px; vertical-align:bottom">
							<th style="width:232px; text-align:left">ENERGY SAVING</th>
							<th>SWITCH ON</th>
							<th>SWITCH OFF</th>
						</tr>				
						<tr><td>MONDAY</td><td align="center"><div class="UITime24" 	data-da3="7436"></div></td><td align="center"><div class="UITime24" data-da3="7438"></div></td></tr>					
						<tr><td>TUESDAY</td><td align="center"><div class="UITime24" 	data-da3="7440"></div></td><td align="center"><div class="UITime24" data-da3="7442"></div></td></tr>					
						<tr><td>WEDNESDAY</td><td align="center"><div class="UITime24" 	data-da3="7444"></div></td><td align="center"><div class="UITime24" data-da3="7446"></div></td></tr>					
						<tr><td>THURSDAY</td><td align="center"><div class="UITime24" 	data-da3="7448"></div></td><td align="center"><div class="UITime24" data-da3="7450"></div></td></tr>					
						<tr><td>FRIDAY</td><td align="center"><div class="UITime24" 	data-da3="7452"></div></td><td align="center"><div class="UITime24" data-da3="7454"></div></td></tr>					
						<tr><td>SATURDAY</td><td align="center"><div class="UITime24" 	data-da3="7456"></div></td><td align="center"><div class="UITime24" data-da3="7458"></div></td></tr>					
						<tr><td>SUNDAY</td><td align="center"><div class="UITime24" 	data-da3="7460"></div></td><td align="center"><div class="UITime24" data-da3="7462"></div></td></tr>					
					</table>
				</div>
			</div>
		</div>	<!-- page pageClock -->
		
		<!-- page productQty -->
		<div id="pageProductQty" class="UIWindow">
			<div class="UIWindowContent" id="pageProductQty_content">
				<!-- il contenuto di questa pagina lo credo dinamicamente perchè dipende da INSTANT o ESPRESSO (vedi pageProductQty_build) -->
			</div>
		</div><!-- page productQty -->
		
		
		<!-- page Milker -->
		<div id="pageMilker" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' class='elenco'>
					<tr>
						<td>STEAM TEMPERATURE<br><span class="tip">max 140</span></td>
						<td><div class="UINumber" data-numfigures="3" data-max="140" data-da3="7618" data-da3bit="8"></div></td>
					</tr>
					<tr>
						<td>RINSING PERIOD<br><span class="tip">max 900</span></td></td>
						<td><div class="UINumber" data-numfigures="3" data-da3="7620" data-da3bit="16" data-max="900" data-um="min."></div></td>
					</tr>
					<tr>
						<td>ENABLE RINSING</td>
						<td><div class="UIOption" data-option="1|YES|0|NO" data-da3="7622"></div></td>
					</tr>
					<tr>
						<td>RINSE DELAY<br><span class="tip">max 10.0</span></td></td>
						<td><div class="UINumber" data-numfigures="3" data-decimal='1' data-da3="7624"  data-da3bit="16" data-max="100" data-um="sec."></div></td>
					</tr>
					<tr>
						<td>ENABLE MILK SENSOR</td>
						<td><div class="UIOption" data-option="0|0|1|1|2|2|3|3" data-da3="7626"></div></td>
					</tr>
					<tr>
						<td>SHOW MILKER-RINSING<br>BUTTON AT STARTUP</td>
						<td><div class="UIOption" data-option="1|YES|0|NO" data-da3="7628"></div></td>
					</tr>
				</table>
			</div>
		</div><!-- page Milker -->
		
		
		<!-- pageSelections -->
		<div id="pageSelections" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' width='100%'>
					<tr valign='middle'>
						<td style="width:140px"><b>SELECTIONS:</b></td>
						<td><div class='UIOptionSmall' id='pageSelections_selector' data-option='1|1-12|2|13-24|3|25-36|4|37-48' data-onclick='pageSelections_onSelector()'></div></td>
					</tr>
				</table>		
			
				<div id="pageSelections_c2">
					<!-- il contenuto di questa pagina lo credo dinamicamente (vedi pageSelections_build) -->
				</div>
			</div>
		</div><!-- pageSelections -->
		
		<!-- pageSingleSelection -->
		<div id="pageSingleSelection" class="UIWindow">
			<div class="UIWindowContent">
				
				<div id="pageSingleSelection_selectorAtTop"></div>
				
				<br>
				<div id="pageSingleSelection_pageG">
					<table border='0' class='elenco'>
						<tr>
							<td>STATUS</td>
							<td><div id='pageSingleSelection_status' class="UIOption" data-option="0|SELECTION|1|INHIBITED|2|PRESELECTION" data-da3="100" data-onclick='pageSingleSelection_onStatus()'></div></td>
						</tr>
					</table>
					<div id="pageSingleSelection_pageSel">
						<table border='0' class='elenco'>
							<tr>
								<td>PRICE 1</td></td>
								<td><div id='pageSingleSelection_prc1' class="UINumber" data-numfigures="5" data-decimal='0' data-max="65535"></div></td>
							</tr>
							<tr>
								<td>PRICE 2<br><span class="tip">happy price</span></td></td>
								<td><div id='pageSingleSelection_prc2' class="UINumber" data-numfigures="5" data-decimal='0' data-max="65535"></div></td>
							</tr>
							<tr>
								<td>PROGRAMMING</td>
								<td><div class="UIOption" id='pageSingleSelection_programming' data-option="1|PARTIAL|0|TOTAL" data-da3="101" data-onclick="pageSingleSelection_onProgramming()"></div></td>
							</tr>							
							<tr>
								<td>JUG<br><span class="tip">num repetitions</span></td></td>
								<td><div class="UINumber" data-numfigures="1" data-max="6" data-da3="177" data-da3bit='8'></div></td>
							</tr>
							<tr>
								<td>SCALING FACTOR<br><span class="tip">num repetitions</span></td></td>
								<td><div class='UINumber' data-numfigures='3' data-da3='180' data-da3bit='8' data-min='80' data-max='120' data-um='%'></div></td>
							</tr>						
						</table>
					</div>
				</div> <!--pageSingleSelection_pagegs-->
				
				<div id="pageSingleSelection_pageE"></div>
				<div id="pageSingleSelection_pageP"></div>
				<div id="pageSingleSelection_pageW"></div>
				<div id="pageSingleSelection_pageM"></div>
				
			</div>
		</div><!-- pageSingleSelection -->
		
		
		
		<!-- pageTemperature -->
		<div id="pageTemperature" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' class='elenco'>
					<tr>
						<td>BOILER</td>
						<td><div class="UINumber" data-numfigures="2" data-decimal='0' data-max="92" data-da3="7032" data-da3bit='8'></div></td>
					</tr>
				</table>
			</div>
		</div>
		<!-- pageTemperature -->
		
		
		<!-- pageCalibration -->
		<div id="pageCalibration" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' class='elenco'>
					<tr id="pageCalibration_rowGrinder1">
						<td>GRINDER 1</td>
						<td><div id="pageCalibration_m11" class="bigCaption15"></div></td>
						<td><div class='UIButton bigButton60' data-caption='RESET' data-onclick="pageCalibration_reset(11)"></div></div></td>
						<td><div class='UIButton bigButton60' data-caption='CALIBRATE' data-onclick="pageCalibration_start(11)"></div></div></td>
					</tr>
					<tr id="pageCalibration_rowGrinder2">
						<td>GRINDER 2</td>
						<td><div id="pageCalibration_m12" class="bigCaption15"></div></td>
						<td><div class='UIButton bigButton60' data-caption='RESET' data-onclick="pageCalibration_reset(12)"></div></div></td>
						<td><div class='UIButton bigButton60' data-caption='CALIBRATE' data-onclick="pageCalibration_start(12)"></div></div></td>
					</tr>
					
					<tr id="pageCalibration_rowMotor1">
						<td style="width:150px">MOTOR 1</td>
						<td style="width:274px"><div id="pageCalibration_m1" class="bigCaption15"></div></td>
						<td style="width:300px"><div class='UIButton bigButton60' data-caption='RESET' data-onclick="pageCalibration_reset(1)"></div></div></td>
						<td style="width:300px"><div class='UIButton bigButton60' data-caption='CALIBRATE' data-onclick="pageCalibration_start(1)"></div></div></td>
					</tr>
					
					<tr>
						<td>MOTOR 2</td>
						<td><div id="pageCalibration_m2" class="bigCaption15"></div></td>
						<td><div class='UIButton bigButton60' data-caption='RESET' data-onclick="pageCalibration_reset(2)"></div></div></td>
						<td><div class='UIButton bigButton60' data-caption='CALIBRATE' data-onclick="pageCalibration_start(2)"></div></div></td>
					</tr>

					<tr>
						<td>MOTOR 3</td>
						<td><div id="pageCalibration_m3" class="bigCaption15"></div></td>
						<td><div class='UIButton bigButton60' data-caption='RESET' data-onclick="pageCalibration_reset(3)"></div></div></td>
						<td><div class='UIButton bigButton60' data-caption='CALIBRATE' data-onclick="pageCalibration_start(3)"></div></div></td>
					</tr>
					
					<tr>
						<td>MOTOR 4</td>
						<td><div id="pageCalibration_m4" class="bigCaption15"></div></td>
						<td><div class='UIButton bigButton60' data-caption='RESET' data-onclick="pageCalibration_reset(4)"></div></div></td>
						<td><div class='UIButton bigButton60' data-caption='CALIBRATE' data-onclick="pageCalibration_start(4)"></div></div></td>
					</tr>

					<tr>
						<td>MOTOR 5</td>
						<td><div id="pageCalibration_m5" class="bigCaption15"></div></td>
						<td><div class='UIButton bigButton60' data-caption='RESET' data-onclick="pageCalibration_reset(5)"></div></div></td>
						<td><div class='UIButton bigButton60' data-caption='CALIBRATE' data-onclick="pageCalibration_start(5)"></div></div></td>
					</tr>

					<tr>
						<td>MOTOR 6</td>
						<td><div id="pageCalibration_m6" class="bigCaption15"></div></td>
						<td><div class='UIButton bigButton60' data-caption='RESET' data-onclick="pageCalibration_reset(6)"></div></div></td>
						<td><div class='UIButton bigButton60' data-caption='CALIBRATE' data-onclick="pageCalibration_start(6)"></div></div></td>
					</tr>
				</table>
			</div>
		</div>
		<!-- pageCalibration -->
		
	</div> <!-- divPage -->

	<div id="divFooter" class="footer">
		<div id="footer_L">
			<div style="float:left; margin-right:10px"><div id="bntBack" class="UIButton" data-caption="&nbsp&nbsp&nbsp&nbsp;BACK&nbsp;&nbsp&nbsp&nbsp" data-onclick="btnBack_onClick(0)"></div></div>
			<div style="float:left"><div id="bntSave" class="UIButton" data-caption="&nbsp&nbsp&nbsp&nbsp;S&nbsp&nbspA&nbsp&nbspV&nbsp&nbspE&nbsp;&nbsp&nbsp&nbsp" data-onclick="btnBack_onClick(1)"></div></div>
			<div class="clear"></div>
		</div>
		<div id="footer_C">
		</div>
		<div id="footer_R"></div>
		<div class="clear"></div>
	</div>
		
			
	
</div> <!-- wrapper -->


<script src="js/DA3.js"></script>
<script src="js/GUIInfo.js"></script>
<script src="js/UI.js"></script>
<script src="js/UINumberArrow.js"></script>
<script src="js/UIButtonSel.js"></script>
<script src="js/UITime24.js"></script>
<script src="js/Task.js"></script>
<script id="rheaBootstrapTag" src="js/rheaBootstrap.js" data-ses-clear="1"></script>
<script language="javascript">
var da3 = null;
var guiInfo = null;
var ui = null;
var voidTask = new TaskVoid();
var taskCalibMotor = new TaskCalibMotor();
var currentTask = voidTask;
var currentPageID="";
var timeNowMSec = 0;
var uiStandAloneNum = null;

function onRheaBootstrapFinished()
{
	document.getElementById("pagePleaseWait_freeBtn1").addEventListener("mousedown", function(ev) { currentTask.onFreeBtn1Clicked(ev); } , true);
	document.getElementById("pagePleaseWait_freeBtn2").addEventListener("mousedown", function(ev) { currentTask.onFreeBtn2Clicked(ev); } , true);
		
	
	rhea.onEvent_cpuStatus = function(statusID, statusStr) 			{ currentTask.onEvent_cpuStatus(statusID, statusStr); }
	rhea.onEvent_cpuMessage = function(msg, importanceLevel)	 	{ currentTask.onEvent_cpuMessage(msg, importanceLevel); }
	dataOra_setup();
	
	ui = new UI ("divPage");
	ui.setupStandaloneButton("bntBack");
	ui.setupStandaloneButton("bntSave");
	uiStandAloneNum = ui.setupStandaloneNumber("pagePleaseWait_calibration_num");
	
	//di default mostro la pagina pageMainMenu. Se però in GET c'è specificata un'altra pagina..
	switch (rheaGetURLParamOrDefault("page", "pageMainMenu"))
	{
		case "pageMainMenu": pageMainMenu_show(); break;
		case "pageCleaning": pageCleaning_show(); break;
		case "pageCleaningSanitario": pageCleaning_show(); pageCleaning_startLavSanitario(0); break;
		case "pageMaintenance": pageMaintenance_show(); break;
		case "pageMiscellaneous": pageMiscellaneous_show(); break;
		case "pageProductQty": pageProductQty_show(); break;
		case "pageMilker": pageMilker_show(); break;
		case "pageSelections": pageSelections_show(); break;
	}
	
	pleaseWait_show();
	pleaseWait_setTextLeft("loading da3");

	//richiedo machine type & model
	rhea.ajax ("getMachineTypeAndModel", "").then( function(result)
	{
		var obj = JSON.parse(result);
		
		//carico il da3
		da3 = new DA3(obj.mType, obj.mModel, obj.isInduzione);
		da3.load();
	})
	.catch( function(result)
	{
		pleaseWait_hide();
	});	
}

//***************** chiamata al termine del caricamento del da3
function onDA3Loaded()
{
	console.log ("onDA3Loaded:: num macine[" +da3.getNumMacine() +"]");
	guiInfo = new GUIInfo();
	guiInfo.load();
}

//***************** chiamata al termine delle gui info
function onGUIInfoLoaded()
{
	pageProductQty_build();
	pageSelections_build();
	pageSingleSelection_build();
	pleaseWait_hide();

	//abilito il menu milker se macchine==espresso
	if (da3.isEspresso())
	{
		rheaRemoveClassToElem(rheaGetElemByID("pageMainMenu_btnMilker"), "UIdisabled");
		rheaRemoveClassToElem(rheaGetElemByID("pageCleaning_btnCleanMilker"), "UIdisabled");
	}
	
	setInterval (function() { timeNowMSec+=1000; currentTask.onTimer(timeNowMSec); }, 1000)
}


function header_setText(s)				{ rheaSetDivHTMLByName("divHeaderC", s) }

function showPage(pageID)				{ return showPageEx(pageID,0); }
function showPageEx(pageID, da3Offset)	
{ 
	currentPageID=pageID; 
	var win=ui.getWindowByID(currentPageID); 
	var ret=win.firstTimeShow; 
	ui.hideAllExcept(currentPageID); 
	win.loadFromDA3(da3, da3Offset);
	rhea.requestGPUEvent(RHEA_EVENT_CPU_STATUS); 
	return ret;
}
function btnBack_show() 				{ rheaSetDisplayMode(rheaGetElemByID("bntBack"), "table"); rheaSetDisplayMode(rheaGetElemByID("bntSave"), "table"); }
function btnBack_hide() 				{ rheaHideElem(rheaGetElemByID("bntBack")); rheaHideElem(rheaGetElemByID("bntSave")); }
function btnBack_onClick(bSave)				
{ 
	if (bSave == 0)
		backToMainMenu();
	else
		save( function() { backToMainMenu();} );
}


var backTo="";
function backToMainMenu()
{
	pleaseWait_hide();
	
	var where = backTo;
	backTo="";
	switch (where)
	{
	default:				pageMainMenu_show(); break;
	case "pageSelections":	pageSelections_show(); break;
	}
}

var save_fnToCallWhenFinished = "";
function save (fnToCallWhenFinished)
{
	save_fnToCallWhenFinished = fnToCallWhenFinished;
	
	ui.getWindowByID(currentPageID).saveToDA3(da3); 
	var blockList = da3.compare();
	var nBlocchi = blockList.length;
	if (nBlocchi > 0)
	{
		//ci sono dei blocchi da3 che sono stati modificati
		pleaseWait_show();
		pleaseWait_freeText_setText("Saving datafile, please wait...<br>");
		pleaseWait_freeText_show();
		storeDA3Block_step (1, nBlocchi, blockList);
	}
	else
		onSaveFinished();
}

function onSaveFinished() { save_fnToCallWhenFinished.call(); }

function storeDA3Block_step (uno_di, nBlocchi, blockList)
{
	var blockNum = blockList[uno_di-1];
	pleaseWait_freeText_appendText (uno_di +"/" +nBlocchi +"&nbsp;&nbsp;&nbsp;block " +blockNum +"... ");
			
	da3.storeBlock (uno_di, nBlocchi, blockNum).then (function(result)
	{
		pleaseWait_freeText_appendText (result +"<br>");
		da3.copyBlockToOriginal(blockNum);
		
		if (uno_di >= nBlocchi)
		{
			setTimeout ( function() { onSaveFinished(); }, 100);
			return;
		}
		
		uno_di++;
		setTimeout ( function() { storeDA3Block_step (uno_di, nBlocchi, blockList); }, 100);
	});
}

function helper_intToFixedOnePointDecimale(v)
{
	if (v > 0)
	{
		if (v<10)
			v = "0." +v;
		else
		{
			v = v.toString();
			v = v.substr(0, v.length-1) +"." +v.substr(v.length-1);
		}
	}
	return v;
}

/***************************************************************************
 *
 * please wait
 *
 */
function pleaseWait_show()				
{ 
	pleaseWait_setTextLeft(""); 
	pleaseWait_setTextRight(""); 
	pleaseWait_freeText_setText("");
	
	pleaseWait_btn1_hide();
	pleaseWait_btn2_hide();
	pleaseWait_freeText_hide();
	
	pleaseWait_wait_show();
	rheaShowElem(rheaGetElemByID("pagePleaseWait")); 
}
function pleaseWait_hide()				{ rheaHideElem(rheaGetElemByID("pagePleaseWait")); }
function pleaseWait_setTextLeft(s)		{ rheaSetDivHTMLByName("pagePleaseWait_header_left", s); }
function pleaseWait_setTextRight(s)		{ rheaSetDivHTMLByName("pagePleaseWait_header_right", s); }

function pleaseWait_wait_show()			{ rheaShowElem(rheaGetElemByID("pagePleaseWait_wait")); }
function pleaseWait_wait_hide()			{ rheaHideElem(rheaGetElemByID("pagePleaseWait_wait")); }

function pleaseWait_freeText_show()			{ rheaShowElem(rheaGetElemByID("pagePleaseWait_freeText")); }
function pleaseWait_freeText_hide()			{ rheaHideElem(rheaGetElemByID("pagePleaseWait_freeText")); }
function pleaseWait_freeText_setText(s)		{ rheaSetDivHTMLByName("pagePleaseWait_freeText", s); }
function pleaseWait_freeText_appendText(s)	{ var d=rheaGetElemByID("pagePleaseWait_freeText"); d.innerHTML += s; }

function pleaseWait_btn1_show()			{ rheaShowElem(rheaGetElemByID("pagePleaseWait_freeBtn1")); }
function pleaseWait_btn1_hide()			{ rheaHideElem(rheaGetElemByID("pagePleaseWait_freeBtn1")); }
function pleaseWait_btn1_setText(s)		{ rheaSetDivHTMLByName("bntFree1Text", s); }


function pleaseWait_btn2_show()			{ rheaShowElem(rheaGetElemByID("pagePleaseWait_freeBtn2")); }
function pleaseWait_btn2_hide()			{ rheaHideElem(rheaGetElemByID("pagePleaseWait_freeBtn2")); }
function pleaseWait_btn2_setText(s)		{ rheaSetDivHTMLByName("bntFree2Text", s); }

function pleaseWait_calibration_show()					{ pleaseWait_calibration_num_hide(); rheaShowElem(rheaGetElemByID("pagePleaseWait_calibration")); }
function pleaseWait_calibration_hide()					{ pleaseWait_calibration_num_hide(); rheaHideElem(rheaGetElemByID("pagePleaseWait_calibration")); }
function pleaseWait_calibration_num_show()				{ rheaShowElem(rheaGetElemByID("pagePleaseWait_calibration_num")); }
function pleaseWait_calibration_num_hide()				{ rheaHideElem(rheaGetElemByID("pagePleaseWait_calibration_num")); }
function pleaseWait_calibration_num_setValue (v)		{ uiStandAloneNum.setValue(parseInt(v)); }
function pleaseWait_calibration_num_getValue()			{ return uiStandAloneNum.getValue(); }
function pleaseWait_calibration_setText(s)				{ rheaSetDivHTMLByName("pagePleaseWait_calibration_text", s); }

/***************************************************************************
 *
 * data & ora
 *
 */
var dataora_hh = 0;
var dataora_min = 0;
var dataora_sec = 0;
function dataOra_setup ()
{
	var d = new Date();
	var dataora_sec = parseInt(d.getSeconds());
	var dataora_min = parseInt(d.getMinutes());
	var dataora_hh = parseInt(d.getHours());
  
	var mm = (d.getUTCMonth() + 1).toString(); if (mm.length<2) mm="0"+mm;
	var gg = d.getUTCDate().toString(); if (gg.length<2) gg="0"+gg;
	var aaaa = d.getUTCFullYear();  
	rheaSetDivHTMLByName("divHeaderR_data", aaaa +"/" +mm +"/" +gg);
	

	setInterval (function() 
					{ 
						dataora_sec++;
						if (dataora_sec >= 60)
						{
							dataora_sec = 0;
							dataora_min++;
							if (dataora_min >= 60)
							{
								dataora_min = 0;
								dataora_hh++;
							}
						}
						
						var hh = dataora_hh.toString();		if (hh.length<2) hh = "0"+hh;
						var mm = dataora_min.toString();	if (mm.length<2) mm = "0"+mm;
						var sep = ":";
						if (dataora_sec % 2 == 0)
							sep = "&nbsp;"
						rheaSetDivHTMLByName("divHeaderR_ora", hh +sep +mm);
					}, 
					1000);
}


/***************************************************************************
 *
 * pageMainMenu
 *
 */
function pageMainMenu_show()
{
	showPage("pageMainMenu");
	header_setText("<div style='margin-left:140px'><center><img draggable='false' src='img/iconHome.png'> Programming Menu</center></div>");
	btnBack_hide();
}


/***************************************************************************
 *
 * pageMaintenance
 *
 */
function pageMaintenance_show()
{
	if (showPage('pageMaintenance'))
	{
		//è la prima volta che visualizziamo la pagina
		pageMaintenance_getDecountersValues();
	}
		
	header_setText("MAINTENANCE");
	btnBack_show();
}
function pageMaintenance_resetDec(iDecounter)
{
	//per prima cosa devo salvare eventuali modifiche
	save( function(){ pageMaintenance_reset_afterSave(iDecounter); } );
}
function pageMaintenance_reset_afterSave(iDecounter)
{
	var currentCapacityID = "pageMaintenance_" +iDecounter +"_cap";
	var decValue = parseInt(ui.getWindowByID("pageMaintenance").getChildByID(currentCapacityID).getValue());
		
	//invio il comando di set alla SMU
	pleaseWait_show();
	rhea.ajax ("setDecounter", { "d":iDecounter, "v":decValue}).then( function(result)
	{
		//chiedo i decontatori alla SMU
		pageMaintenance_getDecountersValues();
	})
	.catch( function(result)
	{
		pleaseWait_hide();
	});
}

function pageMaintenance_getDecountersValues()
{
	rhea.ajax ("getAllDecounters", "").then( function(result)
	{
		pageMaintenance_updateDecounterCurrentValueFromString(result);
		pleaseWait_hide();
	})
	.catch( function(result)
	{
		pleaseWait_hide();
	});		
}

function pageMaintenance_updateDecounterCurrentValueFromString(s)
{
	var e = s.split(",");
	for (var i=10; i<13; i++)
	{
		var iDecounter = i+1;
		var currentValueID = "pageMaintenance_" +iDecounter;
		var v = e[i];
		
		var len = 4;
		if (i == 10)
			len = 5;
		while (v.length < len)
			v = "0" +v;
		rheaSetDivHTMLByName(currentValueID, v);
	}
}

/***************************************************************************
 *
 * pageCleaning
 *
 */
function pageCleaning_show()
{
	if (showPage("pageCleaning"))
	{
		//è la prima volta che visualizziamo la pagina
		if (da3.isInstant())
		{
			var w = ui.getWindowByID("pageCleaning");
			w.getChildByID("pageCleaning_btnClean1").setCaption ("START CLEANING<br>MIXER 1");
			w.getChildByID("pageCleaning_btnClean2").setCaption ("START CLEANING<br>MIXER 2");
			w.getChildByID("pageCleaning_btnClean3").setCaption ("START CLEANING<br>MIXER 3");
			w.getChildByID("pageCleaning_btnClean4").hide();
			w.getChildByID("pageCleaning_btnCleanHC").hide();
		}
	}
	header_setText("CLEANING");

	btnBack_show();
	rheaHideElem(rheaGetElemByID("bntSave"));
}

function pageCleaning_action (what)
{
	pleaseWait_show();
	
	if (what == 8)
		pageCleaning_startLavSanitario(1);
	else
	{
		currentTask = new TaskCleaning(0);
		rhea.requestGPUCleaning(parseInt(what));
	}
}
	
function pageCleaning_startLavSanitario (bSendRequestToGPU)
{
	pleaseWait_show();
	currentTask = new TaskCleaning(1);
	if (bSendRequestToGPU)
		rhea.requestGPUCleaning(parseInt(8));
}

function pageCleaning_onFinished()
{
	pleaseWait_hide();
	currentTask = voidTask;
}

	
	
/***************************************************************************
 *
 * pageMiscellaneous
 *
 */
 function pageMiscellaneous_show()
{
	showPage("pageMiscellaneous");
	header_setText("MISCELLANEOUS");
	btnBack_show();
}

function pageMiscellaneous_oldProgMenu()
{
	window.location = "gotoLegacyMenu.html";
}




/***************************************************************************
 *
 * pageProductQty
 *
 */
function pageProductQty_show()
{
	if (showPage("pageProductQty"))
	{
		//è la prima volta che visualizziamo la pagina
		pageProductQty_getDecounterValues();
	}
	pageProductQty_showDecounter();
	header_setText("PRODUCT QUANTITY");
	btnBack_show();
	
	//chiedo il valore attuale dei decontatori alla SMU
	pleaseWait_show();
	rhea.ajax ("getAllDecounters", "").then( function(result)
	{
		pageProductQty_updateDecounterCurrentValueFromString(result);
		pleaseWait_hide();
	})
	.catch( function(result)
	{
		pleaseWait_hide();
	});	
}

function pageProductQty_build()
{
	var nProdotti = da3.getNumProdotti();
	var da3Loc_decounter = 7334;
	var da3Loc_warning = da3Loc_decounter +2*nProdotti;
	var da3Loc_enable = da3Loc_warning +2*nProdotti;
	var html = "";
	
	var dataOption = "1|1";
	for (var i=2; i<=nProdotti; i++)
		dataOption += "|" +i +"|" +i;
		
	html = 	"<table border='0' width='100%'><tr valign='middle'>"
			+"	<td style='width:160px'><b>SELECT A<br>DECOUNTER</b></td>"
			+"	<td><div class='UIOptionSmall' id='pageProductQty_decSelector' data-option='" +dataOption +"' data-onclick='pageProductQty_showDecounter()'></div></td>"
			+"</tr></table><br>";
	
	for (var i=0; i<nProdotti; i++)
	{
		var num = (i+1);
		if (i<9) num = "0" +num;
		num = "#" +num;
		
		var pageID = "pageProductQty_page_" +(i+1);
		var currentValueID = "pageProductQty_decCurVal_" +(i+1);
		var currentCapacityID = "pageProductQty_decCurCap_" +(i+1);
		
		var currentDecountValue = "00000";
		
		html +=  "<div id='" +pageID +"' style='display:none'>"
				+"<table border='0' class='elenco'>"
				+"	<tr style='height:70px'>"
				+"		<td style='width:300px'>DECOUNTER #" +(i+1) +"<br>CURRENT VALUE</td>"
				+"		<td style='width:400px'><span id='" +currentValueID +"' class='bigCaption25'>" +currentDecountValue +"</span></td>"
				+"		<td align='center'><div class='UIButton bigButton60' data-caption='RESET' data-onclick='pageProductQty_reset(" +(i+1) +")'></div></td>"
				+"	</tr>"
				+"	<tr><td>CANISTER<br>CAPACITY</td><td colspan='2'><div id='" +currentCapacityID +"' class='UINumber' data-numfigures='5' data-decimal='1' data-da3='" +da3Loc_decounter +"' data-max='99999'></div></td></tr>"
				+"	<tr><td>WARNING AT</td><td colspan='2'><div class='UINumber' data-numfigures='5' data-decimal='1' data-da3='" +da3Loc_warning +"' data-max='99999'></div></td></tr>"
				+"	<tr style='border:0'><td>ENABLE STOP</td><td colspan='2'><div class='UIOption' data-option='1|YES|0|NO' data-da3='" +da3Loc_enable +"'></div></td></tr>"
				+"</table></div>";
		da3Loc_decounter+=2;
		da3Loc_warning+=2;
		da3Loc_enable+=2;
	}
	
	rheaSetDivHTMLByName("pageProductQty_content", html);
}

function pageProductQty_showDecounter()
{
	var opt = ui.getWindowByID("pageProductQty").getChildByID("pageProductQty_decSelector");
	var decSelected = opt.getSelectedOptionValue();
	
	var nProdotti = da3.getNumProdotti();
	for (var i=1; i<=nProdotti; i++)
	{
		var pageID = "pageProductQty_page_" +i;
		if (i == decSelected)
			rheaShowElem(rheaGetElemByID(pageID));
		else
			rheaHideElem(rheaGetElemByID(pageID));
	}
}

function pageProductQty_updateDecounterCurrentValueFromString(s)
{
	var e = s.split(",");
	for (var i=0; i<e.length; i++)
	{
		var iDecounter_1_10 = i+1;
		var currentValueID = "pageProductQty_decCurVal_" +iDecounter_1_10;
		var v = e[i];
		while (v.length < 5)
			v = "0" +v;
		var s = v.substr(0,4) +"." +v.substr(4);
		
		rheaSetDivHTMLByName(currentValueID, s);
	}
}

function pageProductQty_reset (iDecounter_1_10)
{
	//per prima cosa devo salvare eventuali modifiche
	save( function(){ pageProductQty_reset_afterSave(iDecounter_1_10); } );
}
function pageProductQty_reset_afterSave(iDecounter_1_10)
{
	var currentCapacityID = "pageProductQty_decCurCap_" +iDecounter_1_10;
	var decValue = parseInt(ui.getWindowByID("pageProductQty").getChildByID(currentCapacityID).getValue());
		
	//invio il comando di set alla SMU
	pleaseWait_show();
	rhea.ajax ("setDecounter", { "d":iDecounter_1_10, "v":decValue}).then( function(result)
	{
		//chiedo i decontatori alla SMU
		pageProductQty_getDecounterValues();
	})
	.catch( function(result)
	{
		pleaseWait_hide();
	});
}

function pageProductQty_getDecounterValues()
{
	rhea.ajax ("getAllDecounters", "").then( function(result)
	{
		pageProductQty_updateDecounterCurrentValueFromString(result);
		pleaseWait_hide();
	})
	.catch( function(result)
	{
		pleaseWait_hide();
	});		
}



/***************************************************************************
 *
 * pageMilker
 *
 */
function pageMilker_show()
{
	if (showPage("pageMilker"))
	{
		//è la prima volta che visualizziamo la pagina
	}
	header_setText("MILKER");
	btnBack_show();
}



/***************************************************************************
 *
 * pageSelections
 *
 */
function pageSelections_show()
{
	if (showPage("pageSelections"))
	{
		//è la prima volta che visualizziamo la pagina
	}
	header_setText("SELECTIONS");
	btnBack_show();
	pageSelections_onSelector();
}

function pageSelections_build()
{
	var html = "";
	
	var iSel = 1;
	
	for (var page=1; page<=4; page++)
	{
		html += "<div id='pageSelections_page" +page +"' style='display:none'><table border='0'><tr>";
		for (var r=0; r<4; r++)
		{
			for (var c=0; c<3; c++)
			{
				var caption = "SELECTION " +rheaLeftPad(iSel,2,'0');
				html += "<td width='33%' align='center'><div class='UIButtonSel' "
						+"data-caption='" +caption +"' "
						+"data-caption2='" +guiInfo.selInfo[iSel].name +"' "
						+"data-caption3='" +guiInfo.selInfo[iSel].short +"' "
						+"data-onclick='pageSingleSelection_show(" +iSel +")'></div></td>";
				iSel++;
			}
			html += "</tr>";
		}
		html += "</table></div>";
	}
	/*for (var r=0; r<16; r++)
	{
		html += "<tr>";
		for (var c=0; c<3; c++)
		{
			var caption = "SELECTION " +rheaLeftPad(iSel,2,'0');
			html += "<td width='33%' align='center'><div class='UIButtonSel' "
					+"data-caption='" +caption +"' "
					+"data-caption2='" +guiInfo.selInfo[iSel].name +"' "
					+"data-caption3='" +guiInfo.selInfo[iSel].short +"' "
					+"data-onclick='pageSingleSelection_show(" +iSel +")'></div></td>";
			iSel++;
		}
		html += "</tr>";
	}
	html += "</table><div style='height:30px; min-height:30px; overflow:hidden;'>&nbsp;</div>";
	*/
	rheaSetDivHTMLByName("pageSelections_c2", html);
}


function pageSelections_onSelector()
{
	var win = ui.getWindowByID("pageSelections");
	var option = parseInt(win.getChildByID("pageSelections_selector").getSelectedOptionValue());
	for (var page=1; page<=4; page++)
	{
		var elem = rheaGetElemByID("pageSelections_page" +page);
		if (option == page)
			rheaShowElem(elem);
		else
			rheaHideElem(elem);
	}
}

/***************************************************************************
 *
 * pageSingleSelection
 *
 */
function pageSingleSelection_show(iSel)
{
	if (showPageEx("pageSingleSelection", 100 * (iSel-1)))
	{
		//è la prima volta che visualizziamo la pagina
	}
	
	//Setto i prezzi
	var win = ui.getWindowByID("pageSingleSelection");
	var obj = win.getChildByID("pageSingleSelection_prc1");
	obj.da3offset = 0;
	obj.da3Pos = da3.getPriceLocation(1,iSel);
	obj.loadFromDA3(da3);
	
	obj = win.getChildByID("pageSingleSelection_prc2");
	obj.da3offset = 0;
	obj.da3Pos = da3.getPriceLocation(2,iSel);
	obj.loadFromDA3(da3);	
	
	//titolo della finestra
	var title = "SELECTION " +rheaLeftPad(iSel,2,'0') +"&nbsp;-&nbsp;" +guiInfo.selInfo[iSel].name;
	header_setText(title);
	
	backTo = "pageSelections";
	btnBack_show();
	
	rheaSetElemTop(rheaGetElemByID("pageSingleSelection_content"), 0);
	rheaHideElem(rheaGetElemByID("pageSingleSelection_arrowUp"));
	pageSingleSelection_onStatus();
}

var SINGLESEL_NUM_PRODOTTI = 0;
var SINGLESEL_NUM_ACQUE = 0;
function pageSingleSelection_build()
{
	var da3LocProd;
	var da3LocWater;
	var da3LocEVTemperature = 0;
	var WATER_COLONNA_FLOW_TYPE = 0;
	var WATER_COLONNA_FLOW_TITLE = "";
	
	if (da3.isInstant())
	{
		SINGLESEL_NUM_PRODOTTI = 9;
		SINGLESEL_NUM_ACQUE = 5;
		da3LocProd = 102;
		da3ProductLM = da3LocProd +3*SINGLESEL_NUM_PRODOTTI;
		da3LocWater = da3ProductLM +3;
		
		WATER_COLONNA_FLOW_TYPE = 1;
		WATER_COLONNA_FLOW_TITLE = "FLOW";
	}
	else
	{
		SINGLESEL_NUM_PRODOTTI = 7;
		SINGLESEL_NUM_ACQUE = 5;
		da3LocProd = 105;
		da3ProductLM = 129;
		da3LocWater = da3ProductLM +3;

		if (da3.isInduzione())
		{
			WATER_COLONNA_FLOW_TYPE=2;
			WATER_COLONNA_FLOW_TITLE = "EV<br>TEMPERATURE";
			da3LocEVTemperature = 169;
		}
		else
			WATER_COLONNA_FLOW_TITLE = "";
	}

	
	var s = "";
	if (da3.isInstant())
		s = "0|GENERAL SETTINGS|2|PRODUCTS|3|WATERS|4|MIXERS";
	else
		s = "0|GENERAL SETTINGS|1|ESPRESSO|2|PRODUCTS|3|WATERS|4|MIXERS";
	rheaSetDivHTMLByName("pageSingleSelection_selectorAtTop", "<div class='UIOptionSmall' id='pageSingleSelection_selector' data-option='" +s +"' data-onclick='pageSingleSelection_onSelector()'></div>");
	
	var htmlE="";
	if (da3.isEspresso())
	{
		htmlE = "<table border='0' class='elenco'>"
				+"<tr><td>COFFEE SEQUENCE</td><td><div class='UIOption' data-option='0|AFTER|1|BEFORE' data-da3='103' data-da3bit='8'></div></td></tr>"
				+"<tr><td>COFFEE WATER</td><td><div class='UINumber' data-numfigures='3' data-da3='102' data-da3bit='9' data-da3bit9='2,4' data-max='500' data-um='cc'></div></td></tr>"
				+"<tr><td>COFFEE GRINDER</td><td><div class='UINumber' data-numfigures='3' data-decimal='1' data-da3='126' data-da3bit='8' data-max='200' data-um='sec/gr'></div></td></tr>"
				+"<tr><td>PREINFUSION</td><td><div class='UINumber' data-numfigures='2' data-da3='128' data-da3bit='4' data-max='15' data-um='sec'></div></td></tr>"
				+"<tr><td>BREWER PRESSURE</td><td><div class='UINumber' data-numfigures='2' data-da3='104' data-da3bit='4' data-max='10'></div></td></tr>"
				+"<tr><td>TEMPERATURE ESPRESSO</td><td><div class='UINumber' data-numfigures='3' data-da3='168' data-da3bit='8' data-max='110'></div></td></tr>"
				+"<tr><td>GRANULOMETRY</td><td><div class='UIOption' style='font-size:0.9em' data-option='0|DISABLED|1|FINE|2|REFERRING|3|ROUGHLY' data-da3='175' data-da3bit='8'></div></td></tr>"

				+"<tr><td>LATTE MACCHIATO<br>START BREWER</td><td><div class='UINumber' data-numfigures='3' data-decimal='1' data-da3='127' data-da3bit='9' data-da3bit9='1,5' data-max='500' data-um=''></div></td></tr>"
				+"<tr><td>EV FRESH MILK<br>QTY</td><td><div class='UINumber' data-numfigures='3' data-decimal='1' data-da3='162' data-da3bit='9' data-da3bit9='2,4' data-max='500'></div></td></tr>"
				+"<tr><td>EV FRESH MILK<br>DELAY</td><td><div class='UINumber' data-numfigures='3' data-decimal='1' data-da3='163' data-da3bit='9' data-da3bit9='1,5' data-max='500' data-um='sec'></div></td></tr>"
				+"<tr><td>EV AIR FRESH MILK</td><td><div class='UINumber' data-numfigures='3' data-decimal='1' data-da3='165' data-da3bit='9' data-da3bit9='2,4' data-max='500'></div></td></tr>"
				+"<tr><td>EV AIR FRESH MILK<br>DELAY</td><td><div class='UINumber' data-numfigures='3' data-decimal='1' data-da3='166' data-da3bit='9' data-da3bit9='1,5' data-max='500' data-um='sec'></div></td></tr>"

				+"<tr><td>SELECT GRINDER 2</td><td><div class='UIOption' data-option='0|NO|1|YES' data-da3='179' data-da3bit='8'></div></td></tr>"
				+"<tr><td>COFFEE REPEAT</td><td><div class='UIOption' data-option='0|0|1|1|2|2' data-da3='181' data-da3bit='8'></div></td></tr>"
				+"</table>";
	}
	var htmlP = "<table border='0' class='elenco'>"
				+"<tr>"
				+"	<th style='width:184px; text-align:left;'>PRODUCT #</th>"
				+"	<th style='width:290px; text-align:left;'>DOSAGE</th>"
				+"	<th style='width:290px; text-align:left;'>START DELAY</th>"
				+"	<th style='width:260px; text-align:center;'>NUM BREAKS</th>"
				+"</tr>";
	
	for (var i=0; i<SINGLESEL_NUM_PRODOTTI; i++)
	{
		var prodNum;
		prodNum = rheaLeftPad(i+1, 2, '0');
			
		var rowID = "pageSingleSelection_P_" +i;
		var dosageID = "pageSingleSelection_P_d" +i;
		htmlP +="<tr id='" +rowID +"'>"
				+"<td>#" +prodNum +"</td>"
				+"<td align='left'><div id='" +dosageID +"' class='UINumber' data-numfigures='3' data-decimal='1' data-da3='" +da3LocProd +"' data-da3bit='9' data-da3bit9='2,4' data-max='500'></div></td>"
				+"<td align='left'><div class='UINumber' data-numfigures='3' data-decimal='1' data-da3='" +(da3LocProd+1) +"' data-da3bit='9' data-da3bit9='1,5' data-max='500'></div></td>"
				+"<td align='center'><div class='UIOption' data-option='0|0|1|1|2|2' data-da3='" +(da3LocProd+2) +"' data-da3bit='4'></div></td>"
			+"</tr>";
		da3LocProd+= 3;
	}
	
	//product LM
	var rowID = "pageSingleSelection_P_LM";
	var dosageID = "pageSingleSelection_P_dLM";
	htmlP +="<tr id='" +rowID +"'>"
			+"<td>#PRODUCT LM</td>"
			+"<td align='left'><div id='" +dosageID +"' class='UINumber' data-numfigures='3' data-decimal='1' data-da3='" +da3ProductLM +"' data-da3bit='9' data-da3bit9='2,4' data-max='500'></div></td>"
			+"<td align='left'><div class='UINumber' data-numfigures='3' data-decimal='1' data-da3='" +(da3ProductLM+1) +"' data-da3bit='9' data-da3bit9='1,5' data-max='500'></div></td>"
			+"<td align='center'><div class='UIOption' data-option='0|0|1|1|2|2' data-da3='" +(da3ProductLM+2) +"' data-da3bit='4'></div></td>"
		+"</tr>";
	
	htmlP += "<tr><td>TEA BAG</td><td colspan='3'><div class='UIOption' data-option='0|0|1|1|2|2|3|3' data-da3='176' data-da3bit='8'></div></td></tr>"
	htmlP += "</table>";


	//waters & mixers
	var htmlW = "<table border='0' class='elenco'>"
				+"<tr>"
				+"	<th style='width:184px; text-align:left;'>WATER #</th>"
				+"	<th style='width:290px; text-align:left;'>TIME</th>"
				+"	<th style='width:290px; text-align:left;'>START DELAY</th>"
				+"	<th style='width:260px; text-align:center;'>" +WATER_COLONNA_FLOW_TITLE +"</th>"
				+"</tr>";
				
	var htmlM = "<table border='0' class='elenco'>"
				+"<tr>"
				+"	<th style='width:184px; text-align:left;'>MIXER #</th>"
				+"	<th style='width:290px; text-align:left;'>TIME</th>"
				+"	<th style='width:290px; text-align:left;'>START DELAY</th>"
				+"	<th style='width:260px; text-align:center;'>SPEED</th>"
				+"</tr>";		
		for (var i=0; i<SINGLESEL_NUM_ACQUE; i++)
	{
		var prodNum;
		if (i==4)
			prodNum = "LM";
		else 
			prodNum = rheaLeftPad(i+1, 2, '0');
	
		var rowID = "pageSingleSelection_W_" +i;
		var timeID = "pageSingleSelection_W_t" +i;
		htmlW +="<tr id='" +rowID +"'>"
				+"<td>#" +prodNum +"</td>"
				+"<td align='left'><div id='" +timeID +"' class='UINumber' data-numfigures='3' data-decimal='1' data-da3='" +da3LocWater +"' data-da3bit='9' data-da3bit9='2,4' data-max='500' data-um='sec'></div></td>"
				+"<td align='left'><div class='UINumber' data-numfigures='3' data-decimal='1' data-da3='" +(da3LocWater+1) +"' data-da3bit='9' data-da3bit9='1,5' data-max='500' data-um='sec'></div></td>";

				
		//la colonna 3, può essere FLOW, EV-TEMP o vuota, seconda di induzione/bollitore e espresso/instant
		switch (WATER_COLONNA_FLOW_TYPE)
		{
		default:
			htmlW +="<td></td>"; 
			break;
		case 1:
			htmlW += "<td align='center'><div class='UIOption' data-option='0|LOW|1|MED|2|HIGH' data-da3='" +(da3LocWater+2) +"' data-da3bit='4'></div></td>";
			break;
		case 2:
				htmlW += "<td align='center'><div class='UINumber' data-numfigures='2' data-da3='" +da3LocEVTemperature +"' data-da3bit='8' data-max='98' data-um='&deg;C'></div></td></tr>";
				da3LocEVTemperature++;
				break;
		}
		htmlW += "</tr>";
		da3LocWater+= 3;	


		rowID = "pageSingleSelection_M_" +i;
		htmlM +="<tr id='" +rowID +"'>"
				+"<td>#" +prodNum +"</td>"
				+"<td align='left'><div class='UINumber' data-numfigures='3' data-decimal='1' data-da3='" +da3LocWater +"' data-da3bit='9' data-da3bit9='2,4' data-max='500'></div></td>"
				+"<td align='left'><div class='UINumber' data-numfigures='3' data-decimal='1' data-da3='" +(da3LocWater+1) +"' data-da3bit='9' data-da3bit9='1,5' data-max='500'></div></td>"
				+"<td align='center'><div class='UIOption' data-option='1|LOW|2|MED|3|HIGH' data-da3='" +(da3LocWater+2) +"' data-da3bit='4'></div></td>"
			+"</tr>";		
		da3LocWater+= 3;
	}
	htmlW += "</table>";
	htmlM += "</table>";
	
	
	rheaSetDivHTMLByName("pageSingleSelection_pageE", htmlE);
	rheaSetDivHTMLByName("pageSingleSelection_pageP", htmlP);
	rheaSetDivHTMLByName("pageSingleSelection_pageW", htmlW);
	rheaSetDivHTMLByName("pageSingleSelection_pageM", htmlM);
}

function pageSingleSelection_hideIfDosageIsZero (win, dosageID, rowID)
{
	if (parseInt(win.getChildByID(dosageID).getValue()) == 0)
		rheaHideElem(rheaGetElemByID(rowID));
}

function pageSingleSelection_onProgramming()
{
	var win = ui.getWindowByID("pageSingleSelection");
	var partial = parseInt(win.getChildByID("pageSingleSelection_programming").getSelectedOptionValue());
	if (partial == "1")
	{
		for (var i=0; i<SINGLESEL_NUM_PRODOTTI; i++)
			pageSingleSelection_hideIfDosageIsZero (win, "pageSingleSelection_P_d" +i, "pageSingleSelection_P_" +i);
		pageSingleSelection_hideIfDosageIsZero (win, "pageSingleSelection_P_dLM", "pageSingleSelection_P_LM");
		
		for (var i=0; i<SINGLESEL_NUM_ACQUE; i++)
		{
			pageSingleSelection_hideIfDosageIsZero (win, "pageSingleSelection_W_t" +i, "pageSingleSelection_W_" +i);
			pageSingleSelection_hideIfDosageIsZero (win, "pageSingleSelection_W_t" +i, "pageSingleSelection_M_" +i);
		}
	}
	else
	{
		for (var i=0; i<SINGLESEL_NUM_PRODOTTI; i++)
		{
			var rowID = "pageSingleSelection_P_" +i;
			rheaSetDisplayMode(rheaGetElemByID(rowID), "table-row");
		}
		
		rheaSetDisplayMode(rheaGetElemByID("pageSingleSelection_P_LM"), "table-row");
		
		for (var i=0; i<SINGLESEL_NUM_ACQUE; i++)
		{
			var rowID = "pageSingleSelection_W_" +i;
			rheaSetDisplayMode(rheaGetElemByID(rowID), "table-row");
			
			rowID = "pageSingleSelection_M_" +i;
			rheaSetDisplayMode(rheaGetElemByID(rowID), "table-row");
		}		
	}
}

function pageSingleSelection_onStatus()
{
	pageSingleSelection_onProgramming();
	pageSingleSelection_onSelector();

	var win = ui.getWindowByID("pageSingleSelection");
	switch (parseInt(win.getChildByID("pageSingleSelection_status").getSelectedOptionValue()))
	{
		case 0: //selection
			rheaShowElem(rheaGetElemByID("pageSingleSelection_selector"));
			rheaShowElem(rheaGetElemByID("pageSingleSelection_pageSel")); 
			break;
			
		case 1: //inhibit
			rheaHideElem(rheaGetElemByID("pageSingleSelection_pageSel")); 
			rheaHideElem(rheaGetElemByID("pageSingleSelection_selector"));
			break;
		
		case 2: //presel
			rheaHideElem(rheaGetElemByID("pageSingleSelection_pageSel")); 
			rheaHideElem(rheaGetElemByID("pageSingleSelection_selector"));
			break;
		
	}
}

function pageSingleSelection_onSelector()
{
	var elemG = rheaGetElemByID("pageSingleSelection_pageG");
	var elemE = rheaGetElemByID("pageSingleSelection_pageE");
	var elemP = rheaGetElemByID("pageSingleSelection_pageP");
	var elemW = rheaGetElemByID("pageSingleSelection_pageW");
	var elemM = rheaGetElemByID("pageSingleSelection_pageM");
	rheaHideElem(elemG);
	rheaHideElem(elemE);
	rheaHideElem(elemP);
	rheaHideElem(elemW);
	rheaHideElem(elemM);
	
	var win = ui.getWindowByID("pageSingleSelection");
	switch (parseInt(win.getChildByID("pageSingleSelection_selector").getSelectedOptionValue()))
	{
		case 0: rheaShowElem(elemG); break;
		case 1: rheaShowElem(elemE); break;
		case 2: rheaShowElem(elemP); break;
		case 3: rheaShowElem(elemW); break;
		case 4: rheaShowElem(elemM); break;
		
	}
}


/***************************************************************************
 *
 * pageTemperature
 *
 */
function pageTemperature_show()
{
	if (showPage("pageTemperature"))
	{
		//è la prima volta che visualizziamo la pagina
	}
	header_setText("TEMPERATURE");
	btnBack_show();
}



/***************************************************************************
 *
 * pageClock
 *
 */
function pageClock_show()
{
	if (showPage("pageClock"))
	{
		//è la prima volta che visualizziamo la pagina
	}
	header_setText("CLOCK");
	pageClock_onSelector();
	btnBack_show();
}

function pageClock_onSelector()
{
	var elemHH = rheaGetElemByID("pageClock_happyHour");
	var elemES = rheaGetElemByID("pageClock_energySave");
	var win = ui.getWindowByID("pageClock");
	switch (parseInt(win.getChildByID("pageClock_selector").getSelectedOptionValue()))
	{
		default: rheaShowElem(elemHH); rheaHideElem(elemES); break;
		case 1:  rheaShowElem(elemES); rheaHideElem(elemHH); break;
	}
}


/***************************************************************************
 *
 * pageCalibration
 *
 */
function pageCalibration_show()
{
	if (showPage("pageCalibration"))
	{
		//è la prima volta che visualizziamo la pagina
		if (da3.isInstant())
		{
			rheaHideElem (rheaGetElemByID("pageCalibration_rowGrinder1"));
			rheaHideElem (rheaGetElemByID("pageCalibration_rowGrinder2"));
		}
		else
		{
			rheaHideElem (rheaGetElemByID("pageCalibration_rowMotor1"));
			if (da3.getNumMacine() == 1)
				rheaHideElem (rheaGetElemByID("pageCalibration_rowGrinder2"));
		}
	}

	if (da3.isInstant())
	{
		for (var i=1; i<=6; i++)
		{
			var v = helper_intToFixedOnePointDecimale( da3.getCalibFactorGSec(i) );
			rheaSetDivHTMLByName("pageCalibration_m" +i, v +"&nbsp;gr/sec");
		}
	}
	else
	{
		var v = helper_intToFixedOnePointDecimale( da3.getCalibFactorGSec(11) );
		rheaSetDivHTMLByName("pageCalibration_m11", v +"&nbsp;gr/sec");
		
		for (var i=2; i<=6; i++)
		{
			v = helper_intToFixedOnePointDecimale( da3.getCalibFactorGSec(i) );
			rheaSetDivHTMLByName("pageCalibration_m" +i, v +"&nbsp;gr/sec");
		}
		
		v = helper_intToFixedOnePointDecimale( da3.getCalibFactorGSec(12) );
		rheaSetDivHTMLByName("pageCalibration_m12", v +"&nbsp;gr/sec");
	}	
	
	header_setText("CALIBRATION");
	btnBack_show();
	rheaHideElem(rheaGetElemByID("bntSave"));
	currentTask = taskCalibMotor;
}

function pageCalibration_reset(motor)
{
	pleaseWait_show();
	rhea.ajax ("setFattoreCalib", { "m":motor, "v":0}).then( function(result)
	{
		rheaSetDivHTMLByName("pageCalibration_m" +motor, "0&nbsp;gr/sec");
		da3.setCalibFactorGSec(motor, 0);
		pleaseWait_hide();
	})
	.catch( function(result)
	{
		pleaseWait_hide();
	});
}


function pageCalibration_start (motor)
{
	taskCalibMotor.startMotorCalib(motor);
}


</script>
</html>
