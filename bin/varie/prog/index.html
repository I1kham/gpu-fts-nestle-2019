<html>
<head>
	<title>PROGRAMMING MENU</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link href="style.css" rel="stylesheet" type="text/css">
</head>

<body onLoad="rheaBootstrap()">
<div class="wrapper1024x600">
	<div id="pagePleaseWait">
		<div id="pagePleaseWait_header_left"></div>
		<div id="pagePleaseWait_header_right"></div>
		<div class="clear"></div>
		
		<div class="page">
			<div id="pagePleaseWait_wait" style="position:absolute; top:150px; left:462px"><img draggable='false' src="img/animationRound.gif"></div>
			
			<div id="pagePleaseWait_freeText" style="position:absolute; top:40px; left:10px; width:984px; height:500px; background-color:rgba(40,40,40,0.7); color:#fff; display:none; padding:10px; border:solid 1px #fff; border-radius:10px;">aa</div>
			<div id="pagePleaseWait_freeBtn1" style="position:absolute; top:400px; left:20px; display:none">
				<div id="bntFree1" class="UIButton bigButton3x4"><p id="bntFree1Text">testo bottone 1</p></div>
			</div>
			<div id="pagePleaseWait_freeBtn2" style="position:absolute; top:400px; left:680px; display:none">
				<div id="bntFree2" class="UIButton bigButton3x4"><p id="bntFree2Text">testo bottone 2 bottone 2</p></div>
			</div>
		</div>
	</div>
			
	<!-- page Main menu -->
	<div class="header">
		<div id="divHeaderC" class="header_C"></div>
		<div class="header_R colorGrey">
			<div id="divHeaderR_data" style="float:left; margin-right:10px"></div>
			<div id="divHeaderR_ora" style="float:left;"></div>
			<div class="clear"></div>
		</div>
		<div class="clear"></div>
	</div>		

	<div id="divPage" class="page">
		<!--- page Main Menu -->
		<div id="pageMainMenu" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' cellspacing='0' cellpadding='0' width='99%' align='center'>
					<tr valign="middle">
						<td width="33%" align="center"><div class="UIButton bigButton3x4 " data-caption="MAINTENANCE" data-onclick="pageMaintenance_show()"></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="CLEANING/<br>RINSING" data-onclick="pageCleaning_show()"></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4 UIdisabled" data-caption="DATA AUDIT" data-onclick=""></div></td>
					</tr>
					<tr valign="middle">
						<td width="33%" align="center"><div class="UIButton bigButton3x4 UIdisabled" data-caption="SELECTIONS<br>(max 48)"></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4 UIdisabled" data-caption="CALIBRATION"></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4 UIdisabled" data-caption="DEVICES"></div></td>
					</tr>
					<tr valign="middle">
						<td width="33%" align="center"><div class="UIButton bigButton3x4 UIdisabled" data-caption="TEMPERATURE"></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="PRODUCT<br>QUANTITY" data-onclick="pageProductQty_show()"></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4 UIdisabled" data-caption="PAYMENT<br>SYSTEMS"></div></td>
					</tr>
					<tr valign="middle">
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="MISCELLANEOUS" data-onclick="pageMiscellaneous_show()"></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4 UIdisabled" data-caption="CLOCK"></div></td>
						<td width="33%" align="center"><div id="pageMainMenu_btnMilker" class="UIButton bigButton3x4 UIdisabled" data-caption="MILKER" data-onclick="pageMilker_show()"></div></td>
					</tr>
					<tr valign="middle">
						<td width="33%" align="center"><div class="UIButton bigButton3x4 UIdisabled" data-caption="ACCOUNT"></div></td>
						<td></td>
						<td></td>
					</tr>					
				</table>
			</div>
		</div><!--- page Main Menu -->
		
		<!-- page Maintenance -->
		<div id="pageMaintenance" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' class='elenco'>
					<tr>
						<td class='description'>Machine Voltage</td>
						<td>todo...</td>
					</tr>
					
					<tr>
						<td>ACTIVATE H<sub>2</sub>0 FILTER RESET</td>
						<td colspan="2"><div class="UIOption" data-option="1|YES|0|NO" data-da3="7090"></div></td>
					</tr>
					
					<tr>
						<td>
							WATER FILTER DECOUNTER<br>
							<div style="float:left; margin-right:10px">current value:</div>
							<div id="pageMaintenance_11" style="float:left" class="bigCaption15">00000</div>
							<div class="clear"></div>
						</td>
						<td><div class="UINumber" id="pageMaintenance_11_cap" data-numfigures="5" data-da3="7394" data-max="60000"></div></td>
						<td><div class='UIButton bigButton60' data-caption='RESET' data-onclick="pageMaintenance_resetDec(11)"></div></div></td>
					</tr>
					<tr>
						<td>
							DECOUNTER COFFEE BREWER<br>
							<div style="float:left; margin-right:10px">current value:</div>
							<div id="pageMaintenance_12" style="float:left" class="bigCaption15">0000</div>
							<div class="clear"></div>
						</td>
						<td><div class="UINumber" id="pageMaintenance_12_cap" data-numfigures="4" data-da3="7396" data-max="1000"></div></td>
						<td><div class='UIButton bigButton60' data-caption='RESET' data-onclick="pageMaintenance_resetDec(12)"></div></div></td>
					</tr>
					<tr>
						<td>
							DECOUNTER COFFEE GROUND<br>
							<div style="float:left; margin-right:10px">current value:</div>
							<div id="pageMaintenance_13" style="float:left" class="bigCaption15">0000</div>
							<div class="clear"></div>
						</td>
						<td><div class="UINumber" id="pageMaintenance_13_cap" data-numfigures="4" data-da3="7398" data-max="1000"></div></td>
						<td><div class='UIButton bigButton60' data-caption='RESET' data-onclick="pageMaintenance_resetDec(13)"></div></div></td>
					</tr>
					
					<tr>
						<td>OUT of service (last 20 OFF)</td>
						<td>todo...</td>
					</tr>						
				</table>
			</div>
		</div><!-- page Maintenance -->
		
		<!-- page Cleaning -->
		<div id="pageCleaning" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' cellspacing='0' cellpadding='0' width='99%' align='center'>
					<tr valign="middle">
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="START RINSING" data-onclick="pageCleaning_action(160)"></div></td>
						<td width="33%" align="center"><div id="pageCleaning_btnClean1" class="UIButton bigButton3x4" data-caption="START RINSING<br>BREWER" data-onclick="pageCleaning_action(1)"></div></td>
						<td width="33%" align="center"><div id="pageCleaning_btnCleanHC" class="UIButton bigButton3x4" data-caption="START RINSING HC" data-onclick="pageCleaning_action(8)"></div></td>
					</tr>
					<tr valign="middle">
						<td></td>
						<td width="33%" align="center"><div id="pageCleaning_btnClean2" class="UIButton bigButton3x4" data-caption="START RINSING<br>MIXER 1" data-onclick="pageCleaning_action(2)"></div></td>
						<td></td>
					</tr>
					<tr valign="middle">
						<td></td>
						<td width="33%" align="center"><div id="pageCleaning_btnClean3" class="UIButton bigButton3x4" data-caption="START RINSING<br>MIXER 2" data-onclick="pageCleaning_action(3)"></div></td>
						</td>
					</tr>
					<tr valign="middle">
						<td></td>
						<td width="33%" align="center"><div id="pageCleaning_btnClean4" class="UIButton bigButton3x4" data-caption="START RINSING<br>MIXER 3" data-onclick="pageCleaning_action(4)"></div></td>
						<td width="33%" align="center"><div id="pageCleaning_btnCleanMilker" class="UIButton bigButton3x4 UIdisabled" data-caption="START RINSING<br>MILK MODULE" data-onclick="pageCleaning_action(5)"></div></td>
					</tr>					
				</table>
			</div>
		</div>
	
		<!-- page pageMiscellaneous -->
		<div id="pageMiscellaneous" class="UIWindow">
			<div class="UIWindowContent">
				<div class="UIButton bigButton3x4" data-caption="OLD PROG MENU<br>(legacy)" data-onclick="pageMiscellaneous_oldProgMenu()"></div>
			</div>
		</div>	<!-- page pageMiscellaneous -->
		
		<!-- page productQty -->
		<div id="pageProductQty" class="UIWindow">
			<div class="UIWindowContent" id="pageProductQty_content">
				<!-- il contenuto di questa pagina lo credo dinamicamente perchÃ¨ dipende da INSTANT o ESPRESSO (vedi pageProductQty_build) -->
			</div>
		</div><!-- page productQty -->
		
		
		<!-- page Milker -->
		<div id="pageMilker" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' class='elenco'>
					<tr>
						<td>STEAM TEMPERATURE<br><span class="tip">max 140</span></td>
						<td><div class="UINumber" data-numfigures="3" data-da3="7618" data-max="140"></div></td>
					</tr>
					<tr>
						<td>RINSING PERIOD<br><span class="tip">max 900</span></td></td>
						<td><div class="UINumber" data-numfigures="3" data-da3="7620" data-max="900" data-um="min."></div></td>
					</tr>
					<tr>
						<td>ENABLE RINSING</td>
						<td><div class="UIOption" data-option="1|YES|0|NO" data-da3="7622"></div></td>
					</tr>
					<tr>
						<td>RINSE DELAY<br><span class="tip">max 10.0</span></td></td>
						<td><div class="UINumber" data-numfigures="3" data-decimal='1' data-da3="7624" data-max="100" data-um="sec."></div></td>
					</tr>
					<tr>
						<td>ENABLE MILK SENSOR</td>
						<td><div class="UIOption" data-option="0|0|1|1|2|2|3|3" data-da3="7626"></div></td>
					</tr>
					<tr>
						<td>SHOW MILKER-RINSING<br>BUTTON AT STARTUP</td>
						<td><div class="UIOption" data-option="1|YES|0|NO" data-da3="7628"></div></td>
					</tr>
				</table>
			</div>
		</div><!-- page Milker -->
		
	</div> <!-- divPage -->

	<div id="divFooter" class="footer">
		<div id="footer_L">
			<div style="float:left; margin-right:10px"><div id="bntBack" class="UIButton" data-caption="&nbsp&nbsp&nbsp&nbsp;BACK&nbsp;&nbsp&nbsp&nbsp" data-onclick="btnBack_onClick(0)"></div></div>
			<div style="float:left"><div id="bntSave" class="UIButton" data-caption="&nbsp&nbsp&nbsp&nbsp;S&nbsp&nbspA&nbsp&nbspV&nbsp&nbspE&nbsp;&nbsp&nbsp&nbsp" data-onclick="btnBack_onClick(1)"></div></div>
			<div class="clear"></div>
		</div>
		<div id="footer_C">
		</div>
		<div id="footer_R"></div>
		<div class="clear"></div>
	</div>
		
			
	
</div> <!-- wrapper -->


<script src="js/DA3.js"></script>
<script src="js/UI.js"></script>
<script src="js/UINumberArrow.js"></script>
<script src="js/Task.js"></script>
<script id="rheaBootstrapTag" src="js/rheaBootstrap.js" data-ses-clear="1"></script>
<script language="javascript">
var da3 = null;
var ui = null;
var voidTask = new TaskVoid();
var currentTask = voidTask;
var currentPageID="";
var timeNowMSec = 0;

function onRheaBootstrapFinished()
{
	document.getElementById("pagePleaseWait_freeBtn1").addEventListener("mousedown", function(ev) { currentTask.onFreeBtn1Clicked(ev); } , true);
	document.getElementById("pagePleaseWait_freeBtn2").addEventListener("mousedown", function(ev) { currentTask.onFreeBtn2Clicked(ev); } , true);
		
	
	rhea.onEvent_cpuStatus = function(statusID, statusStr) 			{ currentTask.onEvent_cpuStatus(statusID, statusStr); }
	rhea.onEvent_cpuMessage = function(msg, importanceLevel)	 	{ currentTask.onEvent_cpuMessage(msg, importanceLevel); }
	dataOra_setup();
	
	ui = new UI ("divPage");
	ui.setupStandaloneButton("bntBack");
	ui.setupStandaloneButton("bntSave");
	
	//di default mostro la pagina pageMainMenu. Se perÃ² in GET c'Ã¨ specificata un'altra pagina..
	switch (rheaGetURLParamOrDefault("page", "pageMainMenu"))
	{
		case "pageMainMenu": pageMainMenu_show(); break;
		case "pageCleaning": pageCleaning_show(); break;
		case "pageCleaningSanitario": pageCleaning_show(); pageCleaning_startLavSanitario(0); break;
		case "pageMaintenance": pageMaintenance_show(); break;
		case "pageMiscellaneous": pageMiscellaneous_show(); break;
		case "pageProductQty": pageProductQty_show(); break;
		case "pageMilker": pageMilker_show(); break;
	}
	
	pleaseWait_show();
	pleaseWait_setTextLeft("loading da3");

	//richiedo machine type & model
	rhea.ajax ("getMachineTypeAndModel", "").then( function(result)
	{
		var obj = JSON.parse(result);
		
		//carico il da3
		da3 = new DA3(obj.mType, obj.mModel);
		da3.load();
	})
	.catch( function(result)
	{
		pleaseWait_hide();
	});	
}

//***************** chiamata al termine del caricamento del da3
function onDA3Loaded()
{
	pageProductQty_build();
	pleaseWait_hide();

	//abilito il menu milker se macchine==espresso
	if (da3.isEspresso())
	{
		rheaRemoveClassToElem(rheaGetElemByID("pageMainMenu_btnMilker"), "UIdisabled");
		rheaRemoveClassToElem(rheaGetElemByID("pageCleaning_btnCleanMilker"), "UIdisabled");
	}
	
	setInterval (function() { timeNowMSec+=1000; currentTask.onTimer(timeNowMSec); }, 1000)
}


function header_setText(s)				{ rheaSetDivHTMLByName("divHeaderC", s) }
function showPage(pageID)				{ currentPageID=pageID; var win=ui.getWindowByID(currentPageID); var ret=win.firstTimeShow; ui.hideAllExcept(currentPageID); win.loadFromDA3(da3); rhea.requestGPUEvent(RHEA_EVENT_CPU_STATUS); return ret;}
function btnBack_show() 				{ rheaSetDisplayMode(rheaGetElemByID("bntBack"), "table"); rheaSetDisplayMode(rheaGetElemByID("bntSave"), "table"); }
function btnBack_hide() 				{ rheaHideElem(rheaGetElemByID("bntBack")); rheaHideElem(rheaGetElemByID("bntSave")); }
function btnBack_onClick(bSave)				
{ 
	if (bSave == 0)
		backToMainMenu();
	else
		save( function() { backToMainMenu();} );
}

function backToMainMenu()
{
	pleaseWait_hide();
	pageMainMenu_show();
}

var save_fnToCallWhenFinished = "";
function save (fnToCallWhenFinished)
{
	save_fnToCallWhenFinished = fnToCallWhenFinished;
	
	ui.getWindowByID(currentPageID).saveToDA3(da3); 
	var blockList = da3.compare();
	var nBlocchi = blockList.length;
	if (nBlocchi > 0)
	{
		//ci sono dei blocchi da3 che sono stati modificati
		pleaseWait_show();
		pleaseWait_freeText_setText("Saving datafile, please wait...<br>");
		pleaseWait_freeText_show();
		storeDA3Block_step (1, nBlocchi, blockList);
	}
	else
		onSaveFinished();
}

function onSaveFinished() { save_fnToCallWhenFinished.call(); }

function storeDA3Block_step (uno_di, nBlocchi, blockList)
{
	var blockNum = blockList[uno_di-1];
	pleaseWait_freeText_appendText (uno_di +"/" +nBlocchi +"&nbsp;&nbsp;&nbsp;block " +blockNum +"... ");
			
	da3.storeBlock (uno_di, nBlocchi, blockNum).then (function(result)
	{
		pleaseWait_freeText_appendText (result +"<br>");
		da3.copyBlockToOriginal(blockNum);
		
		if (uno_di >= nBlocchi)
		{
			setTimeout ( function() { onSaveFinished(); }, 100);
			return;
		}
		
		uno_di++;
		setTimeout ( function() { storeDA3Block_step (uno_di, nBlocchi, blockList); }, 100);
	});
}


/***************************************************************************
 *
 * please wait
 *
 */
function pleaseWait_show()				
{ 
	pleaseWait_setTextLeft(""); 
	pleaseWait_setTextRight(""); 
	pleaseWait_freeText_setText("");
	
	pleaseWait_btn1_hide();
	pleaseWait_btn2_hide();
	pleaseWait_freeText_hide();
	
	pleaseWait_wait_show();
	rheaShowElem(rheaGetElemByID("pagePleaseWait")); 
}
function pleaseWait_hide()				{ rheaHideElem(rheaGetElemByID("pagePleaseWait")); }
function pleaseWait_setTextLeft(s)		{ rheaSetDivHTMLByName("pagePleaseWait_header_left", s); }
function pleaseWait_setTextRight(s)		{ rheaSetDivHTMLByName("pagePleaseWait_header_right", s); }

function pleaseWait_wait_show()			{ rheaShowElem(rheaGetElemByID("pagePleaseWait_wait")); }
function pleaseWait_wait_hide()			{ rheaHideElem(rheaGetElemByID("pagePleaseWait_wait")); }

function pleaseWait_freeText_show()			{ rheaShowElem(rheaGetElemByID("pagePleaseWait_freeText")); }
function pleaseWait_freeText_hide()			{ rheaHideElem(rheaGetElemByID("pagePleaseWait_freeText")); }
function pleaseWait_freeText_setText(s)		{ rheaSetDivHTMLByName("pagePleaseWait_freeText", s); }
function pleaseWait_freeText_appendText(s)	{ var d=rheaGetElemByID("pagePleaseWait_freeText"); d.innerHTML += s; }

function pleaseWait_btn1_show()			{ rheaShowElem(rheaGetElemByID("pagePleaseWait_freeBtn1")); }
function pleaseWait_btn1_hide()			{ rheaHideElem(rheaGetElemByID("pagePleaseWait_freeBtn1")); }
function pleaseWait_btn1_setText(s)		{ rheaSetDivHTMLByName("bntFree1Text", s); }


function pleaseWait_btn2_show()			{ rheaShowElem(rheaGetElemByID("pagePleaseWait_freeBtn2")); }
function pleaseWait_btn2_hide()			{ rheaHideElem(rheaGetElemByID("pagePleaseWait_freeBtn2")); }
function pleaseWait_btn2_setText(s)		{ rheaSetDivHTMLByName("bntFree2Text", s); }


/***************************************************************************
 *
 * data & ora
 *
 */
var dataora_hh = 0;
var dataora_min = 0;
var dataora_sec = 0;
function dataOra_setup ()
{
	var d = new Date();
	var dataora_sec = parseInt(d.getSeconds());
	var dataora_min = parseInt(d.getMinutes());
	var dataora_hh = parseInt(d.getHours());
  
	var mm = (d.getUTCMonth() + 1).toString(); if (mm.length<2) mm="0"+mm;
	var gg = d.getUTCDate().toString(); if (gg.length<2) gg="0"+gg;
	var aaaa = d.getUTCFullYear();  
	rheaSetDivHTMLByName("divHeaderR_data", aaaa +"/" +mm +"/" +gg);
	

	setInterval (function() 
					{ 
						dataora_sec++;
						if (dataora_sec >= 60)
						{
							dataora_sec = 0;
							dataora_min++;
							if (dataora_min >= 60)
							{
								dataora_min = 0;
								dataora_hh++;
							}
						}
						
						var hh = dataora_hh.toString();		if (hh.length<2) hh = "0"+hh;
						var mm = dataora_min.toString();	if (mm.length<2) mm = "0"+mm;
						var sep = ":";
						if (dataora_sec % 2 == 0)
							sep = "&nbsp;"
						rheaSetDivHTMLByName("divHeaderR_ora", hh +sep +mm);
					}, 
					1000);
}


/***************************************************************************
 *
 * pageMainMenu
 *
 */
function pageMainMenu_show()
{
	showPage("pageMainMenu");
	header_setText("<div style='margin-left:140px'><center><img draggable='false' src='img/iconHome.png'> Programming Menu</center></div>");
	btnBack_hide();
}


/***************************************************************************
 *
 * pageMaintenance
 *
 */
function pageMaintenance_show()
{
	if (showPage('pageMaintenance'))
	{
		//Ã¨ la prima volta che visualizziamo la pagina
		pageMaintenance_getDecountersValues();
	}
		
	header_setText("MAINTENANCE");
	btnBack_show();
}
function pageMaintenance_resetDec(iDecounter)
{
	//per prima cosa devo salvare eventuali modifiche
	save( function(){ pageMaintenance_reset_afterSave(iDecounter); } );
}
function pageMaintenance_reset_afterSave(iDecounter)
{
	var currentCapacityID = "pageMaintenance_" +iDecounter +"_cap";
	var decValue = parseInt(ui.getWindowByID("pageMaintenance").getChildByID(currentCapacityID).getValue());
		
	//invio il comando di set alla SMU
	pleaseWait_show();
	rhea.ajax ("setDecounter", { "d":iDecounter, "v":decValue}).then( function(result)
	{
		//chiedo i decontatori alla SMU
		pageMaintenance_getDecountersValues();
	})
	.catch( function(result)
	{
		pleaseWait_hide();
	});
}

function pageMaintenance_getDecountersValues()
{
	rhea.ajax ("getAllDecounters", "").then( function(result)
	{
		pageMaintenance_updateDecounterCurrentValueFromString(result);
		pleaseWait_hide();
	})
	.catch( function(result)
	{
		pleaseWait_hide();
	});		
}

function pageMaintenance_updateDecounterCurrentValueFromString(s)
{
	var e = s.split(",");
	for (var i=10; i<13; i++)
	{
		var iDecounter = i+1;
		var currentValueID = "pageMaintenance_" +iDecounter;
		var v = e[i];
		
		var len = 4;
		if (i == 10)
			len = 5;
		while (v.length < len)
			v = "0" +v;
		rheaSetDivHTMLByName(currentValueID, v);
	}
}

/***************************************************************************
 *
 * pageCleaning
 *
 */
function pageCleaning_show()
{
	if (showPage("pageCleaning"))
	{
		//Ã¨ la prima volta che visualizziamo la pagina
		if (da3.isInstant())
		{
			var w = ui.getWindowByID("pageCleaning");
			w.getChildByID("pageCleaning_btnClean1").setCaption ("START CLEANING<br>MIXER 1");
			w.getChildByID("pageCleaning_btnClean2").setCaption ("START CLEANING<br>MIXER 2");
			w.getChildByID("pageCleaning_btnClean3").setCaption ("START CLEANING<br>MIXER 3");
			w.getChildByID("pageCleaning_btnClean4").hide();
			w.getChildByID("pageCleaning_btnCleanHC").hide();
		}
	}
	header_setText("CLEANING");

	btnBack_show();
	rheaHideElem(rheaGetElemByID("bntSave"));
}

function pageCleaning_action (what)
{
	pleaseWait_show();
	
	if (what == 8)
		pageCleaning_startLavSanitario(1);
	else
	{
		currentTask = new TaskCleaning(0);
		rhea.requestGPUCleaning(parseInt(what));
	}
}
	
function pageCleaning_startLavSanitario (bSendRequestToGPU)
{
	pleaseWait_show();
	currentTask = new TaskCleaning(1);
	if (bSendRequestToGPU)
		rhea.requestGPUCleaning(parseInt(8));
}

function pageCleaning_onFinished()
{
	pleaseWait_hide();
	currentTask = voidTask;
}

	
	
/***************************************************************************
 *
 * pageMiscellaneous
 *
 */
 function pageMiscellaneous_show()
{
	showPage("pageMiscellaneous");
	header_setText("MISCELLANEOUS");
	btnBack_show();
	rheaHideElem(rheaGetElemByID("bntSave"));
}

function pageMiscellaneous_oldProgMenu()
{
	window.location = "gotoLegacyMenu.html";
}




/***************************************************************************
 *
 * pageProductQty
 *
 */
function pageProductQty_show()
{
	if (showPage("pageProductQty"))
	{
		//Ã¨ la prima volta che visualizziamo la pagina
		pageProductQty_getDecounterValues();
		pageProductQty_showDecounter();
	}
	header_setText("PRODUCT QUANTITY");
	btnBack_show();
	
	//chiedo il valore attuale dei decontatori alla SMU
	pleaseWait_show();
	rhea.ajax ("getAllDecounters", "").then( function(result)
	{
		pageProductQty_updateDecounterCurrentValueFromString(result);
		pleaseWait_hide();
	})
	.catch( function(result)
	{
		pleaseWait_hide();
	});	
}

function pageProductQty_build()
{
	var nProdotti = da3.getNumProdotti();
	var da3Loc_decounter = 7334;
	var da3Loc_warning = da3Loc_decounter +2*nProdotti;
	var da3Loc_enable = da3Loc_warning +2*nProdotti;
	var html = "";
	
	var dataOption = "1|1";
	for (var i=2; i<=nProdotti; i++)
		dataOption += "|" +i +"|" +i;
		
	html = 	"<table border='0' width='100%'><tr valign='middle'>"
			+"	<td style='width:160px'><b>SELECT A<br>DECOUNTER</b></td>"
			+"	<td><div class='UIOption buttonCorto' id='pageProductQty_decSelector' data-option='" +dataOption +"' data-onclick='pageProductQty_showDecounter()'></div></td>"
			+"</tr></table><br>";
	
	for (var i=0; i<nProdotti; i++)
	{
		var num = (i+1);
		if (i<9) num = "0" +num;
		num = "#" +num;
		
		var pageID = "pageProductQty_page_" +(i+1);
		var currentValueID = "pageProductQty_decCurVal_" +(i+1);
		var currentCapacityID = "pageProductQty_decCurCap_" +(i+1);
		
		var currentDecountValue = "00000";
		
		html +=  "<div id='" +pageID +"' style='display:none'>"
				+"<table border='0' class='elenco'>"
				+"	<tr style='height:70px'>"
				+"		<td style='width:300px'>DECOUNTER #" +(i+1) +"<br>CURRENT VALUE</td>"
				+"		<td style='width:400px'><span id='" +currentValueID +"' class='bigCaption25'>" +currentDecountValue +"</span></td>"
				+"		<td align='center'><div class='UIButton bigButton60' data-caption='RESET' data-onclick='pageProductQty_reset(" +(i+1) +")'></div></td>"
				+"	</tr>"
				+"	<tr><td>CANNISTER<br>CAPACITY</td><td colspan='2'><div id='" +currentCapacityID +"' class='UINumber' data-numfigures='5' data-decimal='1' data-da3='" +da3Loc_decounter +"' data-max='99999'></div></td></tr>"
				+"	<tr><td>WARNING AT</td><td colspan='2'><div class='UINumber' data-numfigures='5' data-decimal='1' data-da3='" +da3Loc_warning +"' data-max='99999'></div></td></tr>"
				+"	<tr style='border:0'><td>ENABLE STOP</td><td colspan='2'><div class='UIOption' data-option='1|YES|0|NO' data-da3='" +da3Loc_enable +"'></div></td></tr>"
				+"</table></div>";
		da3Loc_decounter+=2;
		da3Loc_warning+=2;
		da3Loc_enable+=2;
	}
	
	rheaSetDivHTMLByName("pageProductQty_content", html);
}

function pageProductQty_showDecounter()
{
	var opt = ui.getWindowByID("pageProductQty").getChildByID("pageProductQty_decSelector");
	var decSelected = opt.getSelectedOptionValue();
	
	var nProdotti = da3.getNumProdotti();
	for (var i=1; i<=nProdotti; i++)
	{
		var pageID = "pageProductQty_page_" +i;
		if (i == decSelected)
			rheaShowElem(rheaGetElemByID(pageID));
		else
			rheaHideElem(rheaGetElemByID(pageID));
	}
}

function pageProductQty_updateDecounterCurrentValueFromString(s)
{
	var e = s.split(",");
	for (var i=0; i<e.length; i++)
	{
		var iDecounter_1_10 = i+1;
		var currentValueID = "pageProductQty_decCurVal_" +iDecounter_1_10;
		var v = e[i];
		while (v.length < 5)
			v = "0" +v;
		var s = v.substr(0,4) +"." +v.substr(4);
		
		rheaSetDivHTMLByName(currentValueID, s);
	}
}

function pageProductQty_reset (iDecounter_1_10)
{
	//per prima cosa devo salvare eventuali modifiche
	save( function(){ pageProductQty_reset_afterSave(iDecounter_1_10); } );
}
function pageProductQty_reset_afterSave(iDecounter_1_10)
{
	var currentCapacityID = "pageProductQty_decCurCap_" +iDecounter_1_10;
	var decValue = parseInt(ui.getWindowByID("pageProductQty").getChildByID(currentCapacityID).getValue());
		
	//invio il comando di set alla SMU
	pleaseWait_show();
	rhea.ajax ("setDecounter", { "d":iDecounter_1_10, "v":decValue}).then( function(result)
	{
		//chiedo i decontatori alla SMU
		pageProductQty_getDecounterValues();
	})
	.catch( function(result)
	{
		pleaseWait_hide();
	});
}

function pageProductQty_getDecounterValues()
{
	rhea.ajax ("getAllDecounters", "").then( function(result)
	{
		pageProductQty_updateDecounterCurrentValueFromString(result);
		pleaseWait_hide();
	})
	.catch( function(result)
	{
		pleaseWait_hide();
	});		
}



/***************************************************************************
 *
 * pageMilker
 *
 */
function pageMilker_show()
{
	if (showPage("pageMilker"))
	{
		//Ã¨ la prima volta che visualizziamo la pagina
	}
	header_setText("MILKER");
	btnBack_show();
}
</script>
</html>
