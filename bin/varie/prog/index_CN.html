<html>
<head>
	<title>PROGRAMMING MENU</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link href="style.css" rel="stylesheet" type="text/css">
</head>

<body onLoad="rheaBootstrap()">
<div class="wrapper1024x600">
	<div id="pagePleaseWait">
		<div id="pagePleaseWait_header_left"></div>
		<div id="pagePleaseWait_header_right"></div>
		<div class="clear"></div>
		
		<div class="page">
			<div id="pagePleaseWait_wait" style="position:absolute; top:150px; left:462px"><img draggable='false' src="img/animationRound.gif"></div>
			
			<div id="pagePleaseWait_freeText"></div>
			
			<div id="pagePleaseWait_calibration" style="position:absolute; top:40px; left:10px; width:984px; height:500px; background-color:rgba(40,40,40,0.7); color:#fff; display:none; padding:10px; border:solid 1px #fff; border-radius:10px;">
				<div id="pagePleaseWait_calibration_1">
					<table border='0' cellspacing='0' cellpadding='0'>
						<tr valign="middle">
							<td>如果需要，可选按再次研磨</td>
							<td>&nbsp;&nbsp;</td>
							<td><div id='pagePleaseWait_calibration_1_grind' class='UIButton bigButton60 actionButton' data-caption='GRIND AGAIN' data-onclick="pageCalibration_grindAgain()"></div></td>
						</tr>
					</table>
					<hr>

					<div id="pagePleaseWait_calibration_1_varigrind">
						如果需要，可选择使用以下控件来调整打开研磨器
						<table border='0' class='elenco'>
							<tr>
								<td style="width:33%" align="center">
									位置<br>
									<div style="float:left; margin-right:10px">当前值:</div>
									<div id="pagePleaseWait_calibration_1_vg" style="float:left" class="bigCaption15">000</div>
									<div class="clear"></div>
								</td>
								<td style="width:34%" align="center">
									<div style="float:left; margin-right:10px"><br>期望值</div>
									<div style="float:left;"><div class="UINumber" id="pagePleaseWait_calibration_1_vg_target" data-numfigures="3" data-max="500"></div></div>
									<div class="clear"></div>
								</td>
								<td style="width:33%" align="center"><div id='pagePleaseWait_calibration_1_vg_set' class='UIButton bigButton60 actionButton' data-caption='SET' data-onclick="pageCalibration_setVGrind()"></div></td>
							</tr>
						</table>
						<br>
					</div>
				</div>
				
				<div id="pagePleaseWait_calibration_2">
					<table border='0' cellspacing='0' cellpadding='0'>
						<tr valign="middle">
							<td>如果需要，可选按再次研磨</td>
							<td>&nbsp;&nbsp;</td>
							<td><div id='pagePleaseWait_calibration_2_runMotor' class='UIButton bigButton60 actionButton' data-caption='RUN MOTOR AGAIN' data-onclick="pageCalibration_runMotorAgain()"></div></td>
						</tr>
					</table>
					<hr>
				</div>
				<div id="pagePleaseWait_calibration_text"></div>
				<div class="UINumber" id="pagePleaseWait_calibration_num" data-numfigures="4" data-decimal="1" data-max="9999" data-um="gr"></div>
			</div>
			
			<div id="pagePleaseWait_freeBtn1" style="position:absolute; top:400px; left:680px; display:none">
				<div id="bntFree1" class="UIButton bigButton3x4"><p id="bntFree1Text">testo bottone 1</p></div>
			</div>
			<div id="pagePleaseWait_freeBtn2" style="position:absolute; top:400px; left:20px; display:none">
				<div id="bntFree2" class="UIButton bigButton3x4"><p id="bntFree2Text">testo bottone 2 bottone 2</p></div>
			</div>

			<div id="pagePleaseWait_freeBtnTrick" style="position:absolute; right:10px; top:50px; width:100px; height:80px; background-color:rgba(40,40,40,0.7);">&nbsp;&nbsp;&nbsp;&nbsp;</div>
			
		</div>
	</div>
	
	<div id="UISelectFullPage">
		<div id="UISelectFullPage_cnt" style="padding:10px"></div>
		<div style="position:absolute; top:5px; right:5px"><img src="img/close32x32.png" style="width:48px" draggable='false' onmousedown="javascript:UISelect_hideFullPage()"></div>
	</div>
			
	<!-- header -->
	<div class="header">
		<div id="divHeaderC" class="header_C"></div>
		<div class="header_R colorGrey">
			<div id="divHeaderR_data" style="float:left; margin-right:10px"></div>
			<div id="divHeaderR_ora" style="float:left;"></div>
			<div class="clear"></div>
		</div>
		<div class="clear"></div>
		
		<div id="divCurLang" style="position:absolute; top:0; left:0; width:150px; height:46px; z-index:50;" onclick="menuLang_show(1)">
			<div style="padding-left:15px"><img src="img/flags/CN.png"></div>
		</div>
	</div> <!-- header -->
	
	<div id="divMenuLang">
		<div style="padding:10px">
			<ul>
				<li onmousedown="menuLang_onUserSelected('GB')"><img src="img/flags/GB.png"> ENGLISH</li>
				<li onmousedown="menuLang_onUserSelected('IT')"><img src="img/flags/IT.png"> ITALIANO</li>
				<li onmousedown="menuLang_onUserSelected('FR')"><img src="img/flags/FR.png"> FRANÇAIS</li>
				<!--<li onmousedown="menuLang_onUserSelected('DE')"><img src="img/flags/DE.png"> DEUTSCH</li>-->
				<li onmousedown="menuLang_onUserSelected('ES')"><img src="img/flags/ES.png"> ESPAÑOL</li>
				<li onmousedown="menuLang_onUserSelected('PT')"><img src="img/flags/PT.png"> PORTUGUÉS</li>
				<li onmousedown="menuLang_onUserSelected('CN')"><img src="img/flags/CN.png"> 中文</li>
			</ul>
		</div>
		<div style="position:absolute; top:5px; right:5px"><img src="img/close32x32.png" style="width:48px" draggable='false' onmousedown="menuLang_show(0)"></div>
	</div>
	

	<div id="divPage" class="page">
		<!--- page Main Menu -->
		<div id="pageMainMenu" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' cellspacing='0' cellpadding='0' width='99%' align='center'>
					<tr valign="middle">
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="保养维护" data-onclick="pageMaintenance_show()"></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="清洗/<br>冲洗" data-onclick="pageCleaning_show()"></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="数据审核" data-onclick="pageDataAudit_show()"></div></td>
					</tr>
					<tr valign="middle">
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="选项" data-onclick="pageSelections_show()"></div></td>
						<td width="33%" align="center"><div id="pageMainMenu_btnEspressoCalib" class="UIButton bigButton3x4 UIdisabled" data-caption="浓缩咖啡校准" data-onclick="pageExpCalib_show()"></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="速溶饮品<br>校准" data-onclick="pageCalibration_show()"></div></td>
					</tr>
					<tr valign="middle">
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="温度" data-onclick="pageTemperature_show()"></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="支付<br>系统" data-onclick="pagePayment_show()"></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="饮品<br>数量" data-onclick="pageProductQty_show()"></div></td>
					</tr>
					<tr valign="middle">
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="设备" data-onclick="pageDevices_show()"></div></td>						
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="时钟" data-onclick="pageClock_show()"></div></td>
						<td width="33%" align="center"><div id="pageMainMenu_btnMilker" class="UIButton bigButton3x4 UIdisabled" data-caption="鲜奶参数" data-onclick="pageMilker_show()"></div></td>
					</tr>
					<tr valign="middle">
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="其他" data-onclick="pageMiscellaneous_show()"></div></td>

						<td width="33%" align="center"><div id="divBtnManual" style="display:none"><div class="UIButton bigButton3x4" data-caption="手册" data-onclick="manualViewBox_show()"></div></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="旧程序菜单" data-onclick="pageMiscellaneous_oldProgMenu()"></div></td>
					</tr>
				</table>
			</div>
		</div><!--- page Main Menu -->
		
		<!-- page Maintenance -->
		<div id="pageMaintenance" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' width='100%'>
					<tr valign='middle'>
						<td><div class='UIOptionSmall' id='pageMaintenance_selector' data-option='0|常规选项|1|安装|2|关闭列表' data-onclick='pageMaintenance_onSelector()'></div></td>
					</tr>
				</table>
				<br>

				<div id="pageMaintenance_gs" style="display:none">
					<table border='0' class='elenco'>
						<tr>
							<td style="width:380px">激活 H<sub>2</sub>0 过滤器重置</td>
							<td colspan="2"><div class="UIOption" data-option="1|确认|0|没有" data-da3="7090"></div></td>
						</tr>
						
						<tr>
							<td>
								水过滤器计数器<br>
								<div style="float:left; margin-right:10px">当前值:</div>
								<div id="pageMaintenance_11" style="float:left" class="bigCaption15">00000</div>
								<div class="clear"></div>
							</td>
							<td><div class="UINumber" id="pageMaintenance_11_cap" data-numfigures="5" data-da3="7394" data-max="60000" data-forbidden="1"></div></td>
							<td align="right"><div class='UIButton bigButton60 actionButton' data-caption='重置' data-onclick="pageMaintenance_resetDec(11)"></div></td>
						</tr>
						<tr id="pageMaintenance_decCofBrew">
							<td>
								咖啡冲泡器计数器<br>
								<div style="float:left; margin-right:10px">当前值:</div>
								<div id="pageMaintenance_12" style="float:left" class="bigCaption15">0000</div>
								<div class="clear"></div>
							</td>
							<td><div class="UINumber" id="pageMaintenance_12_cap" data-numfigures="4" data-da3="7396" data-max="1000"></div></td>
							<td align="right"><div class='UIButton bigButton60 actionButton' data-caption='重置' data-onclick="pageMaintenance_resetDec(12)"></div></td>
						</tr>
						<tr id="pageMaintenance_decCofGround">
							<td>
								咖啡渣计数器<br>
								<div style="float:left; margin-right:10px">当前值:</div>
								<div id="pageMaintenance_13" style="float:left" class="bigCaption15">0000</div>
								<div class="clear"></div>
							</td>
							<td><div class="UINumber" id="pageMaintenance_13_cap" data-numfigures="4" data-da3="7398" data-max="1000"></div></td>
							<td align="right"><div class='UIButton bigButton60 actionButton' data-caption='重置' data-onclick="pageMaintenance_resetDec(13)"></div></td>
						</tr>
						
						<tr style="border:none">
							<td>显示温度<br><span class="tip">作为CPU 信息</span></td>
							<td colspan="2"><div class="UIOption" data-option="1|确认|0|没有" data-da3="7112"></div></td>
						</tr>
						<tr style="height:30px;">
							<td></td>
							<td colspan="2">
								<div id="pageMaintenance_temperature" class="tip"></div>
							</td>
						</tr>

						<tr>
							<td>电压</td>
							<td colspan="2"><div id="pageMaintenance_volt" class="bigCaption15"></div></td>
						</tr>						
					</table>
				</div>
				
				<div id="pageMaintenance_inst" style="display:none">
					<table border='0' class='elenco'>
						<tr id="pageMaintenance_rowDis">
							<td>卸载</td>
							<td colspan="2" align="center"><div class='UIButton bigButton60 actionButton' style='width:450px' data-caption='开始卸载' data-onclick="pageMaintenance_disinstall()"></div></td>
						</tr>					
						<tr>
							<td>首次安装</td>
							<td colspan="2"><div class="UIOption" data-option="0|确认|1|没有" data-da3="7074"></div></td>
						</tr>
					</table>
				</div>
				
				<div id="pageMaintenance_off" style="display:none">
					<div id="pageMaintenance_off_content"></div>
				</div>
			</div>
		</div><!-- page Maintenance -->
		
		<!-- page Cleaning -->
		<div id="pageCleaning" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' cellspacing='0' cellpadding='0' width='99%' align='center'>
					<tr valign="middle">
						<td width="25%" align="center"><div class="UIButton bigButton4x4 actionButton" data-caption="开始<br>冲洗" data-onclick="pageCleaning_action(160)"></div></td>
						<td width="50%" align="center"><div id="pageCleaning_btnCleanHC" class="UIButton bigButton4x4 actionButton" data-caption="开始<br>冲洗 HC" data-onclick="pageCleaning_action(8)"></div></td>
						<td width="25%" align="center"><div id="pageCleaning_btnCleanMilker" class="UIButton bigButton4x4 actionButton UIdisabled" data-caption="开始冲洗<br>鲜奶套件" data-onclick="pageCleaning_action(5)"></div></td>
					</tr>
				</table>
				
				<br>
				<table border='0' cellspacing='0' cellpadding='0' width='99%' align='center'>
					<tr valign="middle">
						<td width="25%" align="center"><div id="pageCleaning_btnClean1" class="UIButton bigButton4x4 actionButton" data-caption="清洗 1" data-onclick="pageCleaning_action(1)"></div></td>
						<td width="25%" align="center"><div id="pageCleaning_btnClean2" class="UIButton bigButton4x4 actionButton" data-caption="清洗 2" data-onclick="pageCleaning_action(2)"></div></td>
						<td width="25%" align="center"><div id="pageCleaning_btnClean3" class="UIButton bigButton4x4 actionButton" data-caption="清洗 3" data-onclick="pageCleaning_action(3)"></div></td>
						<td width="25%" align="center"><div id="pageCleaning_btnClean4" class="UIButton bigButton4x4 actionButton" data-caption="清洗 4" data-onclick="pageCleaning_action(4)"></div></td>
					</tr>
				</table>
				
				<br>
				<table border='0' class='elenco'>
					<tr style="border:0">
						<td style="width:300px">定时自动清洗<br><span class="tip">00:00 表示已禁用</span></td>
						<td><div class="UITime24" data-da3="7466"></div></td>
					</tr>	
				</table>
				
				<!--
				<table border='0' class='elenco' id='pageCleaning_tabDissolveTable'>
					<tr style="border:0">
						<td style="width:690px">TAB DISSOLVE PAUSE<br>
							<span class="tip">Set the time needed to &quot;dissolve tab&quot; during the sanitary washing cycle (HC).<br>Set &quot;000&quot; to use machine default time</span>
						</td>
						<td><div class="UINumber" data-numfigures="3" data-max="999" data-da3="7562" data-da3bit="16" data-um="sec"></div></td>
					</tr>	
				</table>
				-->
			</div>
		</div> <!-- page Cleaning -->
	
		<!-- page pageMiscellaneous -->
		<div id="pageMiscellaneous" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' width='100%'>
					<tr valign='middle'>
						<td><div class='UIOptionSmall' style='font-size:0.9em' id='pageMiscellaneous_selector' data-option='0|常规选项|1|机器识别码|2|拿铁玛奇朵|3|FREEVEND|4|BLOCKING COUNTER' data-onclick='pageMiscellaneous_onSelector()'></div></td>
					</tr>
				</table>
				<br>
				
				<div id="pageMiscellaneous_gs" style="display:none">
					<table border='0' class='elenco'>
						<tr>
							<td style="width:380px">信息编号</td>
							<td><div class="UINumber" data-numfigures="1" data-max="7" data-da3="7056" data-da3bit="8"></div></td>
						</tr>					
						<tr>
							<td>风扇时间</td>
							<td><div class="UINumber" data-numfigures="3" data-max="180" data-da3="7062" data-da3bit="8" data-um="min"></div></td>
						</tr>
						<tr>
							<td>蜂鸣时间</td>
							<td><div class="UINumber" data-numfigures="2" data-decimal='1' data-max="13" data-da3="7064" data-da3bit="8" data-um="sec"></div></td>
						</tr>
						<tr>
							<td>CPU 语言</td>
							<td><div id='pageMiscellaneous_cpuLang' class='UISelect' data-option='0|lang 1|1|lang 2' data-da3='7068' data-da3bit='8'></div></td>
						</tr>
						<tr id="pageMiscellaneous_r1">
							<td>侧面水泵</td>
							<td><div class="UINumber" data-numfigures="1" data-max="6" data-da3="8370" data-da3bit="8"></div></td>
						</tr>
						<tr id="pageMiscellaneous_r2">
							<td>糖罐</td>
							<td><div class="UINumber" data-numfigures="1" data-max="6" data-da3="7086" data-da3bit="8"></div></td>
						</tr>			
						<tr id="pageMiscellaneous_fmilkTopping"><td>鲜奶/奶粉切换</td><td><div class='UIOption' data-option='1|确认|0|没有' data-da3='7096' data-da3bit='8'></div></td></tr>
						<tr>
							<td>数据启用-审核之前</td>
							<td><div id="pageMiscellaneous_gs_auditBefore" class='UIOption' data-option='1|确认|0|没有' data-da3='7106' data-da3bit='8'></div></td>
						</tr>
 					</table>
				</div>
				
				<div id="pageMiscellaneous_mid" style="display:none">
					<table border='0' class='elenco'>
						<tr>
							<td style="width:380px">机器编码 A</td>
							<td><div class="UINumber" data-numfigures="5" data-max="65535" data-da3="7052" data-da3bit="16"></div></td>
						</tr>
						<tr>
							<td>机器编码 B</td>
							<td><div class="UINumber" data-numfigures="5" data-max="65535" data-da3="7054" data-da3bit="16"></div></td>
						</tr>
					</table>
				</div>
					
				<div id="pageMiscellaneous_lm" style="display:none">
					<table border='0' class='elenco'>
						<tr>
							<td style="width:380px">产品 牛奶拿铁玛奇朵</td>
							<td><div class="UINumber" data-numfigures="1" data-max="6" data-da3="7082" data-da3bit="8"></div></td>
						</tr>
						<tr>
							<td>拿铁玛奇朵 水编号</td>
							<td><div class="UINumber" data-numfigures="1" data-max="3" data-da3="7084" data-da3bit="8"></div></td>
						</tr>
					</table>
				</div>
				
				<div id="pageMiscellaneous_fv" style="display:none">
					<table border='0' class='elenco'>
						<tr>
							<td style="width:380px">免费售货硬件按键<br>模式</td>
							<td colspan="2"><div id="pageMiscellaneous_fvHwKey" class='UIOption' data-option='0|已禁用|1|已启用 1|2|已启用 ++' data-da3="7104" data-da3bit="8"></div></td>
						</tr>
						<tr id="pageMiscellaneous_fv_r1">
							<td>开始免费售货<br><span class="tip">持续显示的小时数</span></td>
							<td align="center"><div id="pageMiscellaneous_fvH" class="UINumber" data-numfigures="3" data-max="255" data-um="小时"></div></td>
							<td align="right"><div class='UIButton actionButton' data-caption='现在开始' data-onclick="pageMiscellaneous_startFVNow()"></div></td>
						</tr>
						
						<tr id="pageMiscellaneous_fv_r2">
							<td>免费售货开始<b style='color:#fff'>运行</b></td>
							<td align="center"><div id="pageMiscellaneous_fvDateEnd"></div></td>
							<td align="right"><div class='UIButton actionButton' data-caption='STOP IT NOW' data-onclick="pageMiscellaneous_stopFVNow()"></div></td>
						</tr>
						
					</table>
				</div>

				<div id="pageMiscellaneous_blockingCt" style="display:none">
					<div id="pageMiscellaneous_blockingCt_pwd">
						<table border='0' class='elenco'>
							<tr>
								<td>INSERT PIN CODE</td>
								<td><div class="UINumber" id='pageMiscellaneous_pincode' data-numfigures="3" data-max="999"></div></td>
								<td><div class='UIButton actionButton' data-caption='&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;O&nbspK&nbsp;&nbsp;&nbsp;&nbsp&nbsp&nbsp' data-onclick="pageMiscellaneous_onPINCodeInserted()"></div></td>
							</tr>
						</table>
					</div>
					<div id="pageMiscellaneous_blockingCt_unblocked" style="display:none">
						<table border='0' class='elenco' style="table-layout: fixed">
							<tr>
								<td style="width:414px">COUNTER<br>
									<div style="float:left; margin-right:10px">当前值:</div>
									<div id="pageMiscellaneous_blockingCt_unblocked_curct" style="float:left" class="bigCaption15">00000</div>
									<div class="clear"></div>
								</td>
								<td style="width:335px"><div class="UINumber" id="pageMiscellaneous_blockingCt_newValue" data-numfigures="5" data-max="10000" data-da3="7400" data-da3bit="16"></div></td>
								<td style="width:255px" align="right"><div class='UIButton bigButton60 actionButton' data-caption='重置' data-onclick="pageMiscellaneous_blockingCounter_set()"></div></td>
							</tr>

							<tr>
								<td>WARN AFTER<br><span class="tip">When the indicated % of selections (with respect to the number inserted in the row before) has been reached, the machine will display a warning to let you know that it's going to be blocked soon</span></td>
								<td colspan="2"><div class="UINumber" data-numfigures="2" data-max="50" data-da3="7402" data-da3bit="16" data-um="%"></div></td>
							</tr>

							<tr>
								<td>PIN CODE<br><span class="tip">Here you can change the current PIN code if you wish</span></td>
								<td colspan="2"><div class="UINumber" id='pageMiscellaneous_newpincode' data-numfigures="3" data-min="111" data-max="999" data-da3="7404" data-da3bit="16"></div></td>
							</tr>
						</table>
					</div>
				</div>				
			</div>
		</div>	<!-- page pageMiscellaneous -->
		
		<!-- page pageClock -->
		<div id="pageClock" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' width='100%'>
					<tr valign='middle'>
						<td><div class='UIOptionSmall' id='pageClock_selector' data-option='0|时钟|1|HAPPY HOUR|2|ENERGY SAVING' data-onclick='pageClock_onSelector()'></div></td>
					</tr>
				</table>
				<br>

				<div id="pageClock_clock" style="display:none">
					<table border='0' class='elenco'>
						<tr>
							<td>时间</td>
							<td colspan="3"><div class="UITime24" id="pageClock_time"></div></td>
							<td><div class='UIButton actionButton' data-caption='SET' data-onclick="pageClock_setTime()"></div></td>
						</tr>
						
						<tr>
							<td>日期</td>
							<td><div id="pageClock_dd" class="UINumber" data-numfigures="2" data-max="31" data-min="1" data-um='天'></div></td>
							<td><div id="pageClock_mm" class="UINumber" data-numfigures="2" data-max="12" data-min="1" data-um='月'></div></td>
							<td><div id="pageClock_yy" class="UINumber" data-numfigures="4" data-max="2050" data-min="2017" data-um='年'></div></td>
							<td><div class='UIButton actionButton' data-caption='SET' data-onclick="pageClock_setDate()"></div></td>
						</tr>
						
						
						<tr style="border:0">
							<td>夏令时</td>
							<td colspan="2"><div class="UIOption" data-option="1|确认|0|没有" data-da3="7080"></div></td>
							<td colspan="2"></td>
						</tr>
					</table>
				</div>

				<div id="pageClock_happyHour" style="display:none">
					<table border='0' class='elenco'>
						<tr style="height:50px; vertical-align:bottom">
							<th style="width:232px; text-align:left">HAPPY HOUR</th>
							<th>开始</th>
							<th>结束</th>
						</tr>
						<tr>
							<td>HAPPY HOUR 1</td>
							<td align="center"><div class="UITime24" data-da3="7424"></div></td>
							<td align="center"><div class="UITime24" data-da3="7426"></div></td>
						</tr>
						<tr>
							<td>HAPPY HOUR 2</td>
							<td align="center"><div class="UITime24" data-da3="7428"></div></td>
							<td align="center"><div class="UITime24" data-da3="7430"></div></td>
						</tr>
						<tr style="border:0">
							<td>HAPPY HOUR 3</td>
							<td align="center"><div class="UITime24" data-da3="7432"></div></td>
							<td align="center"><div class="UITime24" data-da3="7434"></div></td>
						</tr>
					</table>
				</div>
				
				<div id="pageClock_energySave">
					<table border='0' class='elenco'>
						<tr style="height:50px; vertical-align:bottom">
							<th style="width:232px; text-align:left">ENERGY SAVING</th>
							<th>开机</th>
							<th>关机</th>
						</tr>				
						<tr><td>星期一</td><td align="center"><div class="UITime24" data-da3="7436"></div></td><td align="center"><div class="UITime24" data-da3="7438"></div></td></tr>					
						<tr><td>星期二</td><td align="center"><div class="UITime24" 	data-da3="7440"></div></td><td align="center"><div class="UITime24" data-da3="7442"></div></td></tr>					
						<tr><td>星期三</td><td align="center"><div class="UITime24" 	data-da3="7444"></div></td><td align="center"><div class="UITime24" data-da3="7446"></div></td></tr>					
						<tr><td>星期四</td><td align="center"><div class="UITime24" 	data-da3="7448"></div></td><td align="center"><div class="UITime24" data-da3="7450"></div></td></tr>					
						<tr><td>星期五</td><td align="center"><div class="UITime24" 	data-da3="7452"></div></td><td align="center"><div class="UITime24" data-da3="7454"></div></td></tr>					
						<tr><td>星期六</td><td align="center"><div class="UITime24" 	data-da3="7456"></div></td><td align="center"><div class="UITime24" data-da3="7458"></div></td></tr>					
						<tr><td>星期日</td><td align="center"><div class="UITime24" 	data-da3="7460"></div></td><td align="center"><div class="UITime24" data-da3="7462"></div></td></tr>					
					</table>
				</div>
			</div>
		</div>	<!-- page pageClock -->
		
		<!-- page productQty -->
		<div id="pageProductQty" class="UIWindow">
			<div class="UIWindowContent" id="pageProductQty_content">
				<!-- il contenuto di questa pagina lo credo dinamicamente perchè dipende da INSTANT o ESPRESSO (vedi pageProductQty_build) -->
			</div>
		</div><!-- page productQty -->
		
		
		<!-- page Milker -->
		<div id="pageMilker" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' class='elenco'>
					<tr style='height:30px; border-bottom:none'>
						<td style="width:424px">VERSION</td>
						<td style="width:150px">STATUS</td>
					</tr>
					<tr style='height:50px;'>
						<td><div id="pageMilker_ver" class="bigCaption15"></div></td>
						<td><div id="pageMilker_status" class="bigCaption15">NOT CONNECTED or DISABLED</div></td>
					</tr>
				</table>

				<table border='0' class='elenco'>
					<tr>
						<td>已启用</td>
						<td><div id='pageMilker_enabled' class='UIOption' data-option='1|确认|0|没有' data-onclick="pageMilker_onEnabledYesNo()"></div></td>
					</tr>
				</table>
				
				<div id="pageMilker_params" style="display:none">
					<table border='0' class='elenco'>
						<tr>
							<td style="width:400px">蒸汽温度<br><span class="tip">max 128</span></td>
							<td><div class="UINumber" id="pageMilker_temperature" data-numfigures="3" data-max="128" data-da3="7618" data-da3bit="8"></div></td>
						</tr>
						<tr>
							<td>冲洗期间<br><span class="tip">max 900</span></td>
							<td><div class="UINumber" data-numfigures="3" data-da3="7620" data-da3bit="16" data-max="900" data-um="min."></div></td>
						</tr>
						<tr>
							<td>启用冲洗</td>
							<td><div class="UIOption" data-option="1|确认|0|没有" data-da3="7622"></div></td>
						</tr>
						<tr>
							<td>冲洗延迟<br><span class="tip">max 10.0</span></td>
							<td><div class="UINumber" data-numfigures="3" data-decimal='1' data-da3="7624"  data-da3bit="16" data-max="100" data-um="sec."></div></td>
						</tr>
						<tr>
							<td>启用鲜奶传感器</td>
							<td><div class="UIOption" data-option="0|0|1|1|2|2|3|3" data-da3="7626"></div></td>
						</tr>
						<tr>
							<td>在启动时显示<br>鲜奶套件冲洗按钮</td>
							<td><div class="UIOption" data-option="1|确认|0|没有" data-da3="7628"></div></td>
						</tr>
						<tr>
							<td>定时自动冲洗</td>
							<td colspan="3"><div id="pageMilker_time1" class="UITime24" data-da3="7468"></div></td>
						</tr>
						<tr>
							<td>自动更新冲洗时间</td>
							<td><div class="UIOption" data-option="1|确认|0|没有" data-da3="7630"></div></td>
						</tr>
					</table>
				</div>
			</div>
		</div><!-- page Milker -->
		
		
		<!-- pageSelections -->
		<div id="pageSelections" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' width='100%'>
					<tr valign='middle'>
						<td style="width:140px"><b>选项:</b></td>
						<td><div class='UIOptionSmall' id='pageSelections_selector' data-option='1|1-12|2|13-24|3|25-36|4|37-48' data-onclick='pageSelections_onSelector()'></div></td>
					</tr>
				</table>		
			
				<div id="pageSelections_c2">
					<!-- il contenuto di questa pagina lo credo dinamicamente (vedi pageSelections_build) -->
				</div>
			</div>
		</div><!-- pageSelections -->
		
		<!-- pageSingleSelection -->
		<div id="pageSingleSelection" class="UIWindow">
			<div class="UIWindowContent">
				<div id="pageSingleSelection_selectorAtTop"></div>
				<br>
				<div id="pageSingleSelection_pageG">
					<table border='0' class='elenco'>
						<tr>
							<td>状态</td>
							<td><div id='pageSingleSelection_status' class="UIOption" data-option="0|选择|1|被禁用|2|预选" data-da3="100" data-onclick='pageSingleSelection_onStatus()'></div></td>
						</tr>
					</table>
					<div id="pageSingleSelection_pageSel">
						<table border='0' class='elenco'>
							<tr>
								<td>价格 1</td>
								<td><div id='pageSingleSelection_prc1' class="UINumber" data-numfigures="5" data-decimal='0' data-max="65000"></div></td>
							</tr>
							<tr>
								<td>价格 2<br><span class="tip">特价优惠</span></td>
								<td><div id='pageSingleSelection_prc2' class="UINumber" data-numfigures="5" data-decimal='0' data-max="65000"></div></td>
							</tr>
							<tr>
								<td>编程</td>
								<td><div class="UIOption" id='pageSingleSelection_programming' data-option="1|部分|0|全部" data-da3="101" data-onclick="pageSingleSelection_onProgramming()"></div></td>
							</tr>							
							<tr id="pageSingleSelection_pageSel_rowJug">
								<td>JUG<br><span class="tip">重复次数</span></td>
								<td><div class="UINumber" data-numfigures="2" data-max="10" data-da3="177" data-da3bit='8'></div></td>
							</tr>
							<tr>
								<td>比例因子 ？<br></td>
								<td><div class='UINumber' id='pageSingleSelection_sfactor' data-numfigures='3' data-da3='180' data-da3bit='8' data-min='80' data-max='120' data-um='%'></div></td>
							</tr>						
						</table>
					</div>
				</div> <!--pageSingleSelection_pagegs-->
				
				<div id="pageSingleSelection_pageE"></div>
				<div id="pageSingleSelection_pageP"></div>
				<div id="pageSingleSelection_pageW"></div>
				<div id="pageSingleSelection_pageM"></div>
				
			</div>
		</div><!-- pageSingleSelection -->
		
		<!-- pageTemperature -->
		<div id="pageTemperature" class="UIWindow">
			<div class="UIWindowContent" id="pageTemperature_content">
				<!-- creato dinamicamente, vedi pageTemperature_build -->
			</div>
		</div> <!-- pageTemperature -->
		
		
		<!-- pageCalibration -->
		<div id="pageCalibration" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' class='elenco'>
					<tr id="pageCalibration_rowGrinder1">
						<td>研磨机 1</td>
						<td><div id="pageCalibration_m11" class="bigCaption15"></div></td>
						<td><div class='UIButton bigButton60 actionButton' data-caption='重置' data-onclick="pageCalibration_reset(11)"></div></td>
						<td><div class='UIButton bigButton60 actionButton' data-caption='校准' data-onclick="pageCalibration_start(11)"></div></td>
					</tr>
					<tr id="pageCalibration_rowGrinder2">
						<td>研磨机 2</td>
						<td><div id="pageCalibration_m12" class="bigCaption15"></div></td>
						<td><div class='UIButton bigButton60 actionButton' data-caption='重置' data-onclick="pageCalibration_reset(12)"></div></td>
						<td><div class='UIButton bigButton60 actionButton' data-caption='校准' data-onclick="pageCalibration_start(12)"></div></td>
					</tr>
					
					<tr id="pageCalibration_rowMotor1">
						<td style="width:150px">马达 1</td>
						<td style="width:274px"><div id="pageCalibration_m1" class="bigCaption15"></div></td>
						<td style="width:300px"><div class='UIButton bigButton60 actionButton' data-caption='重置' data-onclick="pageCalibration_reset(1)"></div></td>
						<td style="width:300px"><div class='UIButton bigButton60 actionButton' data-caption='校准' data-onclick="pageCalibration_start(1)"></div></td>
					</tr>
					
					<tr id="pageCalibration_rowMotor2">
						<td>马达 2</td>
						<td><div id="pageCalibration_m2" class="bigCaption15"></div></td>
						<td><div class='UIButton bigButton60 actionButton' data-caption='重置' data-onclick="pageCalibration_reset(2)"></div></td>
						<td><div class='UIButton bigButton60 actionButton' data-caption='校准' data-onclick="pageCalibration_start(2)"></div></td>
					</tr>

					<tr>
						<td>马达 3</td>
						<td><div id="pageCalibration_m3" class="bigCaption15"></div></td>
						<td><div class='UIButton bigButton60 actionButton' data-caption='重置' data-onclick="pageCalibration_reset(3)"></div></td>
						<td><div class='UIButton bigButton60 actionButton' data-caption='校准' data-onclick="pageCalibration_start(3)"></div></td>
					</tr>
					
					<tr>
						<td>马达 4</td>
						<td><div id="pageCalibration_m4" class="bigCaption15"></div></td>
						<td><div class='UIButton bigButton60 actionButton' data-caption='重置' data-onclick="pageCalibration_reset(4)"></div></td>
						<td><div class='UIButton bigButton60 actionButton' data-caption='校准' data-onclick="pageCalibration_start(4)"></div></td>
					</tr>

					<tr>
						<td>马达 5</td>
						<td><div id="pageCalibration_m5" class="bigCaption15"></div></td>
						<td><div class='UIButton bigButton60 actionButton' data-caption='重置' data-onclick="pageCalibration_reset(5)"></div></td>
						<td><div class='UIButton bigButton60 actionButton' data-caption='校准' data-onclick="pageCalibration_start(5)"></div></td>
					</tr>
					<tr>
						<td>马达 6</td>
						<td><div id="pageCalibration_m6" class="bigCaption15"></div></td>
						<td><div class='UIButton bigButton60 actionButton' data-caption='重置' data-onclick="pageCalibration_reset(6)"></div></td>
						<td><div class='UIButton bigButton60 actionButton' data-caption='校准' data-onclick="pageCalibration_start(6)"></div></td>
					</tr>
					<tr id="pageCalibration_rowEncoder1">
						<td>讯息 1</td>
						<td colspan="3"><div id="pageCalibration_encoder1" class="bigCaption15"></div></td>
					</tr>
					<tr id="pageCalibration_rowEncoder2">
						<td>讯息 2</td>
						<td colspan="3"><div id="pageCalibration_encoder2" class="bigCaption15"></div></td>
					</tr>										
				</table>
			</div>
		</div> <!-- pageCalibration -->
		
		<!-- page Payment -->
		<div id="pagePayment" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' width='100%'>
					<tr valign='middle'>
						<td id="pagePayment_selector">
							<!-- il selector viene creato da pagePayment_build() -->
						</td>
					</tr>
				</table>
				<br>
			
				<div id="pagePayment_general" style="display:none">
					<table border='0' class='elenco'>
						<tr>
							<td>币种类型</td>
							<td><div class='UISelect' data-option='0|单次购买|1|多次购买|2|EXECUTIVE|3|价格持有|4|MDB' data-da3='7058' data-da3bit='8'></div></td>
						</tr>
						<tr>
							<td>货币 (价格)<br>小数位数</td>
							<td><div class='UIOption' data-option='0|0|1|1|2|2|3|3' data-da3='7066' data-da3bit='8'></div></td>
						</tr>
						<tr>
							<td>现金价目表</td>
							<td><div class='UIOption' data-option='0|1|1|2' data-da3='8374' data-da3bit='8'></div></td>
						</tr>
						<tr>
							<td>非现金价目表</td>
							<td><div class='UIOption' data-option='0|1|1|2' data-da3='8376' data-da3bit='8'></div></td>
						</tr>
						
					</table>				
				</div>

				<div id="pagePayment_mdb">
					<table border='0' class='elenco'>
						<tr>
							<td>托管已启用</td>
							<td><div class='UIOption' data-option='0|确认|1|没有' data-da3='7236' data-da3bit='8'></div></td>
						</tr>
						<tr><td>最大信用额度</td><td><div id="pagePayment_creditMax" class="UINumber" data-numfigures="5" data-max="65000" data-da3="7238" data-da3bit="16"></div></td></tr>
						<tr><td>剩余最大值</td><td><div  id="pagePayment_restMax"class="UINumber" data-numfigures="5" data-max="65000" data-da3="7240" data-da3bit="16"></div></td></tr>
						<tr>
							<td>销售类型</td>
							<td><div class='UIOption' data-option='0|SINGLE|1|MULTI' data-da3='7242' data-da3bit='8'></div></td>
						</tr>
						<tr><td>代币值</td><td><div id="pagePayment_tokenV" class="UINumber" data-numfigures="5" data-max="10000" data-da3="7244" data-da3bit="16"></div></td></tr>
						<tr><td>账单验证人</td><td><div class='UIOption' data-option='0|0|1|1|2|2' data-da3='7310' data-da3bit='8'></div></td></tr>
						
						<tr><td>硬币余量 A</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7246' data-da3bit='16'></div></td></tr>						
						<tr><td>硬币余量 B</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7248' data-da3bit='16'></div></td></tr>						
						<tr><td>硬币余量 C</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7250' data-da3bit='16'></div></td></tr>						
						<tr><td>硬币余量 D</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7252' data-da3bit='16'></div></td></tr>						
						<tr><td>硬币余量 E</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7254' data-da3bit='16'></div></td></tr>						
						<tr><td>硬币余量 F</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7256' data-da3bit='16'></div></td></tr>						
						<tr><td>硬币余量 G</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7258' data-da3bit='16'></div></td></tr>						
						<tr><td>硬币余量 H</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7260' data-da3bit='16'></div></td></tr>						
						<tr><td>硬币余量 I</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7262' data-da3bit='16'></div></td></tr>						
						<tr><td>硬币余量 J</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7264' data-da3bit='16'></div></td></tr>						
						<tr><td>硬币余量 K</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7266' data-da3bit='16'></div></td></tr>						
						<tr><td>硬币余量 L</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7268' data-da3bit='16'></div></td></tr>						
						<tr><td>硬币余量 M</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7270' data-da3bit='16'></div></td></tr>						
						<tr><td>硬币余量 N</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7272' data-da3bit='16'></div></td></tr>						
						<tr><td>硬币余量 O</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7274' data-da3bit='16'></div></td></tr>						
						<tr><td>硬币余量 P</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7276' data-da3bit='16'></div></td></tr>

						<tr><td>无硬币 A</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7278' data-da3bit='16'></div></td></tr>						
						<tr><td>无硬币 B</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7280' data-da3bit='16'></div></td></tr>						
						<tr><td>无硬币 C</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7282' data-da3bit='16'></div></td></tr>						
						<tr><td>无硬币 D</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7284' data-da3bit='16'></div></td></tr>						
						<tr><td>无硬币 E</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7286' data-da3bit='16'></div></td></tr>						
						<tr><td>无硬币 F</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7288' data-da3bit='16'></div></td></tr>						
						<tr><td>无硬币 G</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7290' data-da3bit='16'></div></td></tr>						
						<tr><td>无硬币 H</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7292' data-da3bit='16'></div></td></tr>						
						<tr><td>无硬币 I</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7294' data-da3bit='16'></div></td></tr>						
						<tr><td>无硬币 J</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7296' data-da3bit='16'></div></td></tr>						
						<tr><td>无硬币 K</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7298' data-da3bit='16'></div></td></tr>						
						<tr><td>无硬币 L</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7300' data-da3bit='16'></div></td></tr>						
						<tr><td>无硬币 M</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7302' data-da3bit='16'></div></td></tr>						
						<tr><td>无硬币 N</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7304' data-da3bit='16'></div></td></tr>						
						<tr><td>无硬币 O</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7306' data-da3bit='16'></div></td></tr>						
						<tr><td>无硬币 P</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7308' data-da3bit='16'></div></td></tr>
					</table>				
				</div>			
				
				<div id="pagePayment_mid" style="display:none">
					<table border='0' class='elenco'>
						<tr>
							<td>通讯协议</td>
							<td><div class='UISelect' data-option='0|TM-ON|1|DDCMP 2400++|2|DEX|3|DEX reset|4|DDCMP 9600|5|DDCMP 1200|6|TEST FUN|7|IRDA' data-da3='7330'></div></td>
						</tr>						
						<tr>
							<td>CODE ID 101</td>
							<td><div class="UINumber" data-numfigures="8" data-max="99999999" data-da3="7314" data-da3bit="32"></div></td>
						</tr>
						<tr>
							<td>CODE ID 104</td>
							<td><div class="UINumber" data-numfigures="8" data-max="99999999" data-da3="7318" data-da3bit="32"></div></td>
						</tr>
						<tr>
							<td>CODE ID 106</td>
							<td><div class="UINumber" data-numfigures="8" data-max="99999999" data-da3="7322" data-da3bit="32"></div></td>
						</tr>
						<tr>
							<td>地址 VIDTS</td>
							<td><div class="UINumber" data-numfigures="3" data-max="999" data-da3="7326" data-da3bit="16"></div></td>
						</tr>
					</table>
				</div>
				
				<div id="pagePayment_rfid">
					<table border='0' class='elenco'>
						<tr>
							<td>最高级别信用卡</td>
							<td><div id="pagePayment_maxCC" class="UINumber" data-numfigures="5" data-max="60000" data-da3="7136" data-da3bit="16"></div></td>
						</tr>
						<tr>
							<td>折扣</td>
							<td><div class="UINumber" data-numfigures="2" data-max="80" data-da3="7196" data-da3bit="16" data-um="%"></div></td>
						</tr>
						<tr><td>COIN A CARD</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7144'></div></td></tr>
						<tr><td>COIN B CARD</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7146'></div></td></tr>
						<tr><td>COIN C CARD</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7148'></div></td></tr>
						<tr><td>COIN D CARD</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7150'></div></td></tr>
						<tr><td>COIN E CARD</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7152'></div></td></tr>
						<tr><td>COIN F CARD</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7154'></div></td></tr>
						<tr><td>COIN G CARD</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7156'></div></td></tr>
						<tr><td>COIN H CARD</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7158'></div></td></tr>
						<tr><td>COIN I CARD</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7160'></div></td></tr>
						<tr><td>COIN J CARD</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7162'></div></td></tr>
						
						<tr><td>COIN A NO CARD</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7176'></div></td></tr>
						<tr><td>COIN B NO CARD</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7178'></div></td></tr>
						<tr><td>COIN C NO CARD</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7180'></div></td></tr>
						<tr><td>COIN D NO CARD</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7182'></div></td></tr>
						<tr><td>COIN E NO CARD</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7184'></div></td></tr>
						<tr><td>COIN F NO CARD</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7186'></div></td></tr>
						<tr><td>COIN G NO CARD</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7188'></div></td></tr>
						<tr><td>COIN H NO CARD</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7190'></div></td></tr>
						<tr><td>COIN I NO CARD</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7192'></div></td></tr>
						<tr><td>COIN J NO CARD</td><td><div class='UIOption' data-option='1|没有|0|接受' data-da3='7194'></div></td></tr>
					</table>
				</div>	

				<div id="pagePayment_alipayChina">
					<table border='0' class='elenco'>
						<tr>
							<td style="width:200px">IP</td>
							<td><div  id="pagePayment_alichina_ip" class="bigCaption15"></div></td>
						</tr>
						<tr>
							<td>PORT</td>
							<td><div  id="pagePayment_alichina_port" class="bigCaption15"></div></td>
						</tr>
						<tr>
							<td>MACHINE NAME</td>
							<td><div  id="pagePayment_alichina_mid" class="bigCaption15"></div></td>
						</tr>
						<tr>
							<td>KEY</td>
							<td><div  id="pagePayment_alichina_key" class="bigCaption15"></div></td>
						</tr>
						
					</table>
				</div>
				
			</div>
		</div><!-- page Payment -->		
		
		
		<!-- page Devices -->
		<div id="pageDevices" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' width='100%' id="pageDevices_selectorTable">
					<tr valign='middle'>
						<td><div class='UIOptionSmall' id='pageDevices_selectorVFlex' data-option='1|VARIFLEX|2|VARIGRIND 1|3|VARIGRIND 2|0|其他' data-onclick='pageDevices_onSelector()'></div></td>
					</tr>
				</table>
				<table border='0' width='100%' id="pageDevices_selectorTableMicro" style="display:none">
					<tr valign='middle'>
						<td><div class='UIOptionSmall' id='pageDevices_selectorMicro' data-option='1|MICRO|0|其他' data-onclick='pageDevices_onSelector()'></div></td>
					</tr>
				</table>
				<div style='height:5px'></div>
			
				<!--DEVICES OTHER-->
				<div id="pageDevices_general" style="display:none">
					<table border='0' class='elenco'>
						<tr><td>滴水检测</td><td><div class='UIOption' data-option='0|没有|1|确认' data-da3='7092' data-da3bit='8'></div></td></tr>
						<tr id="pageDevices_cofSensor"><td>咖啡传感器</td><td><div class='UIOption' data-option='1|已启用|0|已禁用' data-da3='7094' data-da3bit='8'></div></td></tr>
						<tr id="pageDevices_cupSensor"><td>杯型传感器阈值</td><td><div class="UINumber" data-numfigures="3" data-max="180" data-da3="7108" data-da3bit="8"></div></td></tr>
						<tr id="pageDevices_boilerSize"><td>BOILER</td><td><div class='UIOption' data-option='0|400 cc|1|800 cc' data-da3='7072' data-da3bit='8'></div></td></tr>
						
						<tr><td>调制解调器测试</td><td><div class='UIButton bigButton60 actionButton' data-caption='启动' data-onclick="pageDevices_startModemTest()"></div></td></tr>
						<tr id="pageDevices_grpTest"><td>组测试</td><td><div class='UIButton bigButton60 actionButton' data-caption='启动' data-onclick="pageDevices_startTestAssorbGruppo()"></div></td></tr>
						<tr id="pageDevices_motorTest"><td>电机马达测试</td><td><div class='UIButton bigButton60 actionButton' data-caption='启动' data-onclick="pageDevices_startTestAssorbMotoriduttore()"></div></td></tr>
					</table>
				</div>

				<!--DEVICES VARIFLEX / MICRO-->
				<div id="pageDevices_vflex" style="display:none">
					<table border='0' class='elenco'>
						<tr><td>冲泡器直径</td><td><div id="pageDevices_vflex_brewerDiam" class='UIOption' data-option='0|36mm|1|45mm' data-da3='7554' data-da3bit='8'></div></td></tr>
						<tr><td>待机位置</td><td><div class='UIOption' data-option='0|关闭|1|打开' data-da3='7556' data-da3bit='8'></div></td></tr>
						<tr id="pageDevices_vflex_autoAdjust"><td>自动<br>调整</td><td><div id="pageDevices_vflex_v1AutoAdjust" class='UIOption' data-option='0|没有|1|确认' data-da3='7558' data-da3bit='8'></div></td></tr>
						<tr id="pageDevices_vflex_deliveryPhase"><td>交付阶段</td><td><div class='UIOption' data-option='0|正常|1|快速' data-da3='7570' data-da3bit='8'></div></td></tr>
						<tr id="pageDevices_grinderSpeedTest">
							<td>GRINDER SPEED FOR OFF09</td>
							<td>
								<table style="width:100%">
									<tr>
										<td><div id="pageDevices_vflex_grnSpeedOff9" class="UINumber" data-numfigures="4" data-max="9999" data-da3="7558" data-da3bit="16"></div></td>
										<td><div class='UIButton bigButton60 actionButton' data-caption='测试' data-onclick="pageDevices_startGrinderSpeedTest()"></div></td>
									</tr>
								</table>
							</td>
						</tr>
					</table>				
				</div>
				
				<div id="pageDevices_vgrind1" style="display:none">
					<table border='0' class='elenco'>
						<tr>
							<td style="width:260px">
								位置<br>
								<div style="float:left; margin-right:10px">当前值:</div>
								<div id="pageDevices_vg1" style="float:left" class="bigCaption15">000</div>
								<div class="clear"></div>
							</td>
							<td style="width:440px">
								<div style="display:none">
									<!-- le nascondo perchè ho messo tutto in nel nuovo menu ESPRESSO calibration -->
									<div style="float:left; margin-right:10px"><br>期望值</div>
									<div style="float:left;"><div class="UINumber" id="pageDevices_vg1_target" data-numfigures="3" data-max="500"></div></div>
									<div class="clear"></div>
								</div>
							</td>
							<td align="right">
								<!--<div class='UIButton bigButton60 actionButton' data-caption='SET' data-onclick="pageDevices_setVGrind(1)"></div>-->
							</td>
						</tr>
						<tr>
							<td>启用自动<br>调节</td>
							<td colspan="2"><div id='pageDevices_vgrind1_selector' class='UIOption' data-option='0|没有|1|确认' data-da3='7590' data-da3bit='8' data-onclick='pageDevices_onEnableAuto(1)'></div></td>
						</tr>
					</table>
					<table border='0' class='elenco' id='pageDevices_vgrind1_params'>
						<tr>
							<td>
								<!-- varigrind 1-->
								<table class='elenco' border='0'>
									<tr valign="middle" style='border:none'>
										<td style='width:155px;'>样本<br>数量</td>
										<td style='width:210px; border-right:solid 1px #999'><div class="UINumber" data-numfigures="3" data-min="10" data-max="100" data-da3="7594" data-da3bit="16"></div></td>
										<td style='width:180px; padding-left:15px;'>参考<br>选项</td>
										<td style='width:160px; border-right:solid 1px #999'><div id='pageDevices_vgrind1_selNum' class="UINumber" data-numfigures="2" data-min="1" data-max="48" data-da3="7588" data-da3bit="8"></div></td>
										<td align="right"><div class='UIButton bigButton60 actionButton' data-caption='运行选项' data-onclick="pageDevices_vgrind_runSelection(1)"></div></td>
									</tr>
								</table>
							</td>
						</tr>

						<tr>
							<td>
								<table class='elenco' border='0'>
									<tr valign="middle" style='border:none'>
										<td style='width:145px;'>参考<br>流量</td>
										<td style='width:320px; border-right:solid 1px #999'>
											<div class="UINumber" id='pageDevices_vgrind1_refFlux' data-numfigures="3" data-max="900" data-decimal="2" data-da3="7592" data-da3bit="16" data-um="cc/sec"></div>
										</td>
										<td style='width:175px; padding-left:10px'>参考<br>位置</td>
										<td style='width:70px; border-right:solid 1px #999'><div id='pageDevices_vgrind1_lastPos_caption' style='color:#fff; font-size:1.5em'>000</div></td>
										<td align="right">
											<div id='pageDevices_vgrind1_lastFlux_caption' class="tip" style="color:#fff">最后的流量/位置：<br>请点击<b>运行选择</ b></div>
											<div id='pageDevices_vgrind1_lastFlux_btnUse' class='UIButton bigButton60 actionButton' style='font-size:1.0em' data-caption='保存数值' data-onclick="pageDevices_vgrind_useLastFluxAndPos(1)"></div>
										</td>
									</tr>
								</table>
							</td>
						</tr>
					</table>
				</div>
				
				<!--- vgrind 2-->
				<div id="pageDevices_vgrind2" style="display:none">
					<table border='0' class='elenco'>
						<tr>
							<td style="width:260px">
								位置<br>
								<div style="float:left; margin-right:10px">当前值:</div>
								<div id="pageDevices_vg2" style="float:left" class="bigCaption15">000</div>
								<div class="clear"></div>
							</td>
							<td style="width:440px">
								<div style="display:none">
									<!-- le nascondo perchè ho messo tutto in nel nuovo menu ESPRESSO calibration -->
									<div style="float:left; margin-right:10px"><br>期望值</div>
									<div style="float:left;"><div class="UINumber" id="pageDevices_vg2_target" data-numfigures="3" data-max="500"></div></dv>
									<div class="clear"></div>
								</div>
							</td>
							<td align="right">
								<!--<div class='UIButton bigButton60 actionButton' data-caption='SET' data-onclick="pageDevices_setVGrind(2)"></div>-->
							</td>
						</tr>
						<tr><td>启用自动<br>调节</td><td colspan="2"><div id='pageDevices_vgrind2_selector' class='UIOption' data-option='0|没有|1|确认' data-da3='7654' data-da3bit='8' data-onclick='pageDevices_onEnableAuto(2)'></div></td></tr>
					</table>
					<table border='0' class='elenco' id='pageDevices_vgrind2_params'>
						<tr>
							<td>
								<!-- varigrind 2-->
								<table class='elenco' border='0'>
									<tr valign="middle" style='border:none'>
										<td style='width:155px;'>样本<br>数量</td>
										<td style='width:210px; border-right:solid 1px #999'><div class="UINumber" data-numfigures="3" data-min="10" data-max="100" data-da3="7658" data-da3bit="16"></div></td>
										<td style='width:180px; padding-left:15px;'>参考<br>选项</td>
										<td style='width:160px; border-right:solid 1px #999'><div id='pageDevices_vgrind2_selNum' class="UINumber" data-numfigures="2" data-min="1" data-max="48" data-da3="7652" data-da3bit="8"></div></td>
										<td align="right"><div class='UIButton bigButton60 actionButton' data-caption='运行选项' data-onclick="pageDevices_vgrind_runSelection(2)"></div></td>
									</tr>
								</table>
							</td>
						</tr>
						<tr>
							<td>
								<table class='elenco' border='0'>
									<tr valign="middle" style='border:none'>
										<td style='width:145px;'>参考<br>流量</td>
										<td style='width:320px; border-right:solid 1px #999'>
											<div class="UINumber" id='pageDevices_vgrind2_refFlux' data-numfigures="3" data-max="900" data-decimal="2" data-da3="7656" data-da3bit="16" data-um="cc/sec"></div>
										</td>
										<td style='width:175px; padding-left:10px'>参考<br>位置</td>
										<td style='width:70px; border-right:solid 1px #999'><div id='pageDevices_vgrind2_lastPos_caption' style='color:#fff; font-size:1.5em'>000</div></td>
										<td align="right">
											<div id='pageDevices_vgrind2_lastFlux_caption' class="tip" style="color:#fff">最后的流量/位置：<br>请点击<b>运行选择</ b></div>
											<div id='pageDevices_vgrind2_lastFlux_btnUse' class='UIButton bigButton60 actionButton' style='font-size:1.0em' data-caption='保存数值' data-onclick="pageDevices_vgrind_useLastFluxAndPos(2)"></div>
										</td>
									</tr>
								</table>
							</td>
						</tr>
					</table>
				</div>
				
			</div>
		</div><!-- page Devices -->	

		<!-- page DataAudit -->
		<div id="pageDataAudit" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' width='100%'>
					<tr valign='middle'>
						<td><div class='UIOptionSmall' id='pageDataAudit_selector' data-option='0|常规选项|1|部分|2|总计|3|刷新数据' data-onclick='pageDataAudit_onSelector()'></div></td>
					</tr>
				</table>
				
				<div id="pageDataAudit_o" style="display:none"></div>
				<div id="pageDataAudit_p" style="display:none"></div>
				<div id="pageDataAudit_t" style="display:none"></div>
				<div id="pageDataAudit_r" style="display:none">
					<div id="pageDataAudit_lastDownload">EVA-DTS, downloaded on 2019-11-26 11:42</div>
					<br>
					<table border='0' align="center">
						<tr valign='middle'>
							<td><div class='UIButton actionButton' data-caption='再次刷新数据' data-onclick="pageDataAudit_downloadEVA()"></div></td>
							<td style="width:100px">&nbsp;</td>
							<td><div class='UIButton actionButton' data-caption='重置部分数据' data-onclick="pageDataAudit_resetPartialData()"></div></td>
						</tr>
					</table>
					
					<!-- bottone segreto per fare il reset dei totali dei dati audit. Va cliccato 5/6 volte ripetutamente -->
					<div id="divSecretDAResetButton" style="position:absolute; top:410px; left:910px; width:110px; height:90px;">&nbsp;</div>
				</div>
			</div>
		</div> <!-- page DataAudit -->

		<!-- page page Espresso Calibration -->
		<div id="pageExpCalib" class="UIWindow">
			<div class="UIWindowContent">
				
				<table border='0' class='elenco'>
					<tr style='border-bottom:none'>
						<td style="width:10%"><b style='color:#fff'>选择</b></td>
						<td style="width:30%" align="center"><div id='pageExpCalib_selNum' class="UINumber" data-numfigures="2" data-min="1" data-max="48"></td>
						<td style="width:30%" align="center"><div class='UIButton bigButton60 actionButton' data-caption='运行选项' data-onclick="pageExpCalib_runSelection()"></div></td>
						<td style="width:30%" align="center"><div class='UIButton bigButton60 actionButton' data-caption='编辑选择' data-onclick="pageExpCalib_editSelection()"></div></td>
					</tr>

					<tr style='height:50px;'>
						<td>LAST FLUX</td>
						<td align="center"><div id='pageExpCalib_lastFlux'>0.00 cc/sec</div></td>
						<td colspan="2"><span class="tip">每次&quot;运行选择&quot;时，饮品用量信息均会更新</span></td>
					</tr>					

					<tr>
						<td><b style='color:#fff'>研磨机</b></td>
						<td align="center">当前校准系数<div id="pageExpCalib_grSec" class="bigCaption15">0 gr/sec</div></td>
						<td align="center"><div class='UIButton bigButton60 actionButton' data-caption='开始校准' data-onclick="pageExpCalib_startMacinaCalib()"></div></td>
						<td align="center"><div class='UIButton bigButton60 actionButton' data-caption='重置校准' data-onclick="pageExpCalib_resetMacinaCalib()"></div></td>
					</tr>					


					<tr style='height:125px;' id="pageExpCalib_rowvarigrind">
						<td>
							<b style='color:#fff'>VARIGRIND</b><br>
							<div class="tip" id="pageExpCalib_vgAutoAjustEnabled"></div>
						</td>
						<td align="center">当前位置<div id="pageExpCalib_vgCurPos" class="bigCaption15">000</div></td>
						<td align="center">所需位置<div class="UINumber" id="pageExpCalib_vg_target" data-numfigures="3" data-max="500"></div></td>
						<td align="center"><div class='UIButton bigButton60 actionButton' id="pageExpCalib_vgBtnSet" data-caption='SET' data-onclick="pageExpCalib_regolaVG()"></div></td>
					</tr>
					
					<tr style='border-bottom:none' id="pageExpCalib_rowimpulsi">
						<td><b style='color:#fff'>讯息</b></td>
						<td align="center">当前<div id="pageExpCalib_imp" class="bigCaption15">0.00 imp/gr</div></td>
						<td colspan="2" align="right">
							<div style="widt:420px; max-width:420px">
								<div class='UIOption' id='pageExpCalib_macina1o2' data-option='1|研磨机 1|2|研磨机 2' data-onclick='pageExpCalib_onChangeGrinder()'></div>
							</div>
						</td>
					</tr>
				</table>
			</div>
		</div> <!-- page pageExpCalib -->		
				
	</div> <!-- divPage -->

	<div id="divFooter" class="footer">
		<div id="footer_L">
			<div style="float:left; margin-right:10px"><div id="bntBack" class="UIButton" data-caption="返回" data-onclick="btnBack_onClick()"></div></div>
			<div style="float:left"><div id="btnSave" class="UIButton" data-caption="保存" data-onclick="btnSave_onClick()"></div></div>
			<div class="clear"></div>
		</div>
		
		<div id="footer_C"></div>
		
		<div id="footer_R">
			<div style="float:right"><div id="bntTestSelection" class="UIButton" data-caption="&nbsp&nbsp&nbsp&nbsp;测试选项 &nbsp&nbsp&nbsp;" data-onclick="pageSingleSelection_test(0)"></div></div>
			<div class="clear"></div>
		</div>
		<div class="clear"></div>
	</div>
</div> <!-- wrapper -->


<div id="manualViewBox" style="position:absolute; top:0; left:0; background-color:rgba(80,80,80,0.9); width:100%; height:100%; text-align:center; display:none; z-index:100;">
	<iframe id='manualViewBoxFrame' class='manualViewBox_frame' src='' border='0'></iframe>
	<div class='manualViewBox_close' onclick='manualViewBox_close()'><img src='img/close32x32.png'></div>
</div>

<script src="js/Helper.js"></script>
<script src="js/PleaseWait.js"></script>
<script src="js/DataOra.js"></script>
<script src="js/DA3.js"></script>
<script src="js/GUIInfo.js"></script>
<script src="js/UI.js"></script>
<script src="js/UIOption.js"></script>
<script src="js/UINumberArrow.js"></script>
<script src="js/UIButtonSel.js"></script>
<script src="js/UITime24.js"></script>
<script src="js/UISelect.js"></script>
<script src="js/StartupOperation.js"></script>
<script src="js/Task_CN.js"></script>






<script id="rheaBootstrapTag" src="js/rheaBootstrap.js" data-ses-clear="1"></script>
<script language="javascript">
var da3 = null;
var guiInfo = null;
var currentPageID="";
var currentCPUStatusID = -1;
var isMilkerAlive = 0;
var timeNowMSec = 0;

var manualFolderName = "";

var ui = null;
var uiStandAloneNum = null;
var uiStandAloneVarigringTargetPos = null;

var voidTask = new TaskVoid();
var taskCalibMotor = new TaskCalibMotor();
var currentTask = voidTask;


function onRheaBootstrapFinished()
{
	pleaseWait_setup();
	
	rhea.onEvent_cpuMessage = 	function(msg, importanceLevel)	 	{ currentTask.onEvent_cpuMessage(msg, importanceLevel); }
	rhea.onEvent_cpuStatus  = 	function(statusID, statusStr, flag16)
								{					
									//se il milker è collegato, abilito i suoi menu, e viceversa
									if (isMilkerAlive)
									{
										if ((flag16 & 0x04) == 0)
										{
											isMilkerAlive = 0;
											rheaAddClassToElem(rheaGetElemByID("pageCleaning_btnCleanMilker"), "UIdisabled");
											rheaSetDivHTMLByName("pageMilker_status", "NOT CONNECTED or DISABLED");
											rheaSetDivHTMLByName("pageMilker_ver", "??");
										}
									}
									else
									{
										if ((flag16 & 0x04) != 0)
										{
											isMilkerAlive = 1;
											rheaRemoveClassToElem(rheaGetElemByID("pageCleaning_btnCleanMilker"), "UIdisabled");
											rheaSetDivHTMLByName("pageMilker_status", "CONNECTED");

											//chiedo versione del milker
											rhea.ajax ("milkver", "").then( function(result)
											{
												rheaSetDivHTMLByName("pageMilker_ver", result);
											})
											.catch( function(result)
											{
												rheaSetDivHTMLByName("pageMilker_ver", "??");
											});		
											
										}
									}
									
									
									currentCPUStatusID=statusID; 
									currentTask.onEvent_cpuStatus(statusID, statusStr, flag16); 
								}
	
	dataOra_setup();
	
	ui = new UI ("divPage");
	ui.setupStandaloneButton("bntBack");
	ui.setupStandaloneButton("btnSave");
	ui.setupStandaloneButton("bntTestSelection");
	uiStandAloneNum = ui.setupStandaloneNumber("pagePleaseWait_calibration_num");
	uiStandAloneVarigringTargetPos = ui.setupStandaloneNumber("pagePleaseWait_calibration_1_vg_target");
	ui.setupStandaloneButton("pagePleaseWait_calibration_1_vg_set");
	ui.setupStandaloneButton("pagePleaseWait_calibration_1_grind");
	ui.setupStandaloneButton("pagePleaseWait_calibration_2_runMotor");
	
	pleaseWait_show();
	pleaseWait_header_setTextL("请稍候 ...");
	pleaseWait_freeText_show();

	//scarica il da3, carica guiInfo... in generale fa tutte quelle operazioni che sono necessarie prima di poter visualizzare il main menu
	startupOperation();
}

function header_setText(s)				{ s=s.replace(/<br>/, "&nbsp;"); rheaSetDivHTMLByName("divHeaderC", s); }
function gotoHMI()						{ window.location = "gotoHMI.html"; }

/***************************************************************************
 *
 * show page
 *	ritorna != 0 se è la prima volta che questa finestra viene visualizzata
 */
function showPage  (pageID, pageTitle, bShowBtnBack, bShowBtnSave)				{ return showPageEx(pageID, pageTitle, bShowBtnBack, bShowBtnSave,0); }
function showPageEx(pageID, pageTitle, bShowBtnBack, bShowBtnSave, da3Offset)	
{ 
	currentPageID = pageID; 
	var win = ui.getWindowByID(currentPageID); 
	var ret = win.firstTimeShow; 
	ui.hideAllExcept(currentPageID); 
	rheaHideElem(rheaGetElemByID("divCurLang"));
	win.loadFromDA3(da3, da3Offset);
	rhea.requestGPUEvent(RHEA_EVENT_CPU_STATUS);
	
	pleaseWait_hide();
	header_setText (pageTitle);
	btnBack_setCallback("btnBack_defaultCallback();");
	btnSave_setCallback("btnSave_defaultCallback();");
	if (bShowBtnBack!=0) btnBack_show(); else btnBack_hide();
	if (bShowBtnSave!=0) btnSave_show(); else btnSave_hide();
	return ret;
}


/***************************************************************************
 *
 * bottoni back / save
 */
var btn_save_callback = null;
var btn_back_callback = null;
function btnSave_show()								{ rheaSetDisplayMode(rheaGetElemByID("btnSave"), "table"); }
function btnSave_hide()								{ rheaHideElem(rheaGetElemByID("btnSave")); }
function btnSave_setCallback (fnToCallWhenFinished)	{ btn_save_callback=fnToCallWhenFinished; }
function btnSave_onClick()							{ eval(btn_save_callback); }
function btnSave_defaultCallback()					{ save( function() { btnBack_onClick();} ); }

function btnBack_show() 							{ rheaSetDisplayMode(rheaGetElemByID("bntBack"), "table"); }
function btnBack_hide() 							{ rheaHideElem(rheaGetElemByID("bntBack")); rheaHideElem(rheaGetElemByID("bntTestSelection")); }
function btnBack_setCallback (fnToCallWhenFinished)	{ btn_back_callback=fnToCallWhenFinished; }
function btnBack_onClick ()							{ eval(btn_back_callback); }
function btnBack_defaultCallback()					{ if (currentTask != voidTask) currentTask = voidTask; pageMainMenu_show(); }

function btnTestSelection_show()					{ rheaShowElem(rheaGetElemByID("bntTestSelection")); }
function btnTestSelection_hide()					{ rheaHideElem(rheaGetElemByID("bntTestSelection")); }


/***************************************************************************
 *
 * save
 * se ci sono state modifiche al da3, le salva e le trasmette a CPU. Al termine, chiama la fn [fnToCallWhenFinished]
 */
var save_fnToCallWhenFinished = "";
function save (fnToCallWhenFinished)
{
	save_fnToCallWhenFinished = fnToCallWhenFinished;
	
	ui.getWindowByID(currentPageID).saveToDA3(da3); 
	var blockList = da3.compare();
	var nBlocchi = blockList.length;
	if (nBlocchi > 0)
	{
		//ci sono dei blocchi da3 che sono stati modificati
		pleaseWait_show();
		pleaseWait_freeText_setText("正在保存数据文件，请稍候...<br>");
		pleaseWait_freeText_show();
		save_storeDA3Block_step (1, nBlocchi, blockList);
	}
	else
		save_onFinished();
}

function save_storeDA3Block_step (uno_di, nBlocchi, blockList)
{
	console.log ("DA3 save " +uno_di +" di " +nBlocchi);
	var blockNum = blockList[uno_di-1];
	pleaseWait_freeText_appendText (uno_di +"/" +nBlocchi +"&nbsp;&nbsp;&nbsp;block " +blockNum +"... ");
			
	da3.storeBlock (uno_di, nBlocchi, blockNum).then (function(result)
	{
		pleaseWait_freeText_appendText (result +"<br>");
		
		if (result != "OK")
		{
			setTimeout ( function() { save_storeDA3Block_step (uno_di, nBlocchi, blockList); }, 400 );
			return;
		}
		
		
		da3.copyBlockToOriginal(blockNum);
		if (uno_di >= nBlocchi)
		{
			setTimeout ( function() { save_onFinished(); }, 100);
			return;
		}
		
		uno_di++;
		setTimeout ( function() { save_storeDA3Block_step (uno_di, nBlocchi, blockList); }, 100);
	})
	.catch( function(result)
	{
		setTimeout ( function() { save_storeDA3Block_step (uno_di, nBlocchi, blockList); }, 400 );
	});		
}

function save_onFinished() 	{  save_fnToCallWhenFinished.call(); }


/***************************************************************************
 *
 * menu linguaggio
 * 
 */
function menuLang_show(bShow)
{
	var e = rheaGetElemByID("divMenuLang");
	if (bShow)
		rheaShowElem(e);
	else
		rheaHideElem(e);
}

function menuLang_onUserSelected(iso)
{
	rhea.ajax ("setLastUsedLangPrgMenu", { "lang":iso}).then( function(result)
	{
		window.location = "index_" +iso +".html";
	})
	.catch( function(result)
	{
		window.location = "index_" +iso +".html";
	});	
}



/***************************************************************************
 *
 * manuale
 *
 */
function manualViewBox_show()
{
	rheaShowElem(rheaGetElemByID("manualViewBox"));
	var f = document.getElementById("manualViewBoxFrame");
	f.src = "../../last_installed/manual/" +manualFolderName +"/index.html";
}
function manualViewBox_close()		{ rheaHideElem(rheaGetElemByID("manualViewBox")); }



/***************************************************************************
 *
 * pageMainMenu
 *
 */
function pageMainMenu_show()
{
	var title = "<div style='margin-left:140px'><center><img  src='img/iconHome.png'> 编程菜单</center></div>";
	showPage("pageMainMenu", title, 0, 0);
	rheaShowElem(rheaGetElemByID("divCurLang"));
}


/***************************************************************************
 *
 * pageMaintenance
 *
 */
function pageMaintenance_show()
{
	if (showPage("pageMaintenance", "保养维护", 1, 1))
	{
		//è la prima volta che visualizziamo la pagina
		if (da3.isInstant())
		{
			rheaHideElem(rheaGetElemByID("pageMaintenance_rowDis"));
			rheaHideElem(rheaGetElemByID("pageMaintenance_decCofBrew"));
			rheaHideElem(rheaGetElemByID("pageMaintenance_decCofGround"));
		}
	}

	pageMaintenance_getDecountersValues();		
	pageMaintenance_refreshOFFList(0);
	pageMaintenance_onSelector();
	currentTask = new TaskMaintenance();
}

function pageMaintenance_onSelector()
{
	var elemGS = rheaGetElemByID("pageMaintenance_gs");
	var elemINST = rheaGetElemByID("pageMaintenance_inst");
	var elemOFF = rheaGetElemByID("pageMaintenance_off");
	rheaHideElem(elemGS);
	rheaHideElem(elemINST);
	rheaHideElem(elemOFF);
	
	var win = ui.getWindowByID("pageMaintenance");
	switch (parseInt(win.getChildByID("pageMaintenance_selector").getSelectedOptionValue()))
	{
		case 0: rheaShowElem(elemGS); break;
		case 1: rheaShowElem(elemINST); break;
		case 2: rheaShowElem(elemOFF); break;
	}
	win.showHideScrollBar();
}


var pageMaintenance_offListHTML="";
function pageMaintenance_refreshOFFList(startIndex)
{
	if (startIndex == 0)
	{
		pageMaintenance_offListHTML="";
		rheaSetDivHTMLByName("pageMaintenance_off_content", "<center><img src='img/animationRound.gif'></center>");
	}

	rhea.ajax ("getOFFList", { "startIndex":startIndex}).then( function(result)
	{
		var data = JSON.parse(result);
		
		if (startIndex == 0)
		{
			pageMaintenance_offListHTML = "<table class='dataAudit' align='center' width='80%'>"
					+"<tr valign='middle'>"
					+"	<th>DATE yyyy/mm/dd</td>"
					+"	<th>TIME</td>"
					+"	<th>OFF CODE</td>"
					+"</tr>";
		}
			
		var numOffs = data.yyyy.length;
		for (var i=0; i<numOffs; i++)
		{
			//la CPU per errore potrebbe mandare degli OFF con data 2001/01/01 alle 01:01 codice:1
			//Questi OFF li filtro e non li mostro
			if (data.yyyy[i]==2001 && data.mm[i]==1 && data.dd[i]==1 && data.hh[i]==1 && data.min[i]==1)
				continue;
			var rowCss="";
			pageMaintenance_offListHTML += "<tr valign='middle'" +rowCss +">"
					+"<td>" +data.yyyy[i] +"/" +data.mm[i] +"/" +data.dd[i] +"</td>"
					+"<td>" +data.hh[i] +":" +data.min[i] +"</td>"
					+"<td>" +data.codice[i] +data.tipo[i] +"</td>"
					"+</tr>";
		}
		
		if (data.nextIndex == 0)
		{
			pageMaintenance_offListHTML += "</table>";
			var d = rheaGetElemByID("pageMaintenance_off_content");
			rheaSetElemHTML(d, pageMaintenance_offListHTML);
			
			win = ui.getWindowByID("pageMaintenance");
			win.showHideScrollBar();
		}
		else
			setTimeout (function(){ pageMaintenance_refreshOFFList(data.nextIndex); }, 200);
	})
	.catch( function(result)
	{
		//console.log ("ERROR");
		console.log (result);
	});
}

function pageMaintenance_formatHTMLForTemperature(jsonObj)
{
	var html = "当前温度: ";
	if (da3.isInstant())
	{
		html += "boiler=[" +jsonObj.tbol +"&deg;] ";
	}
	else
	{
		if (da3.isInduzione())
		{
			html += "heater=[" +jsonObj.tcam +"&deg;] &nbsp;&nbsp;&nbsp;&nbsp;";
			html += "milker=[" +jsonObj.tcap +"&deg;]";
		}
		else
		{
			html += "espresso=[" +jsonObj.tbol +"&deg;] &nbsp;&nbsp;&nbsp;&nbsp;";
			html += "heater=[" +jsonObj.tcam +"&deg;] &nbsp;&nbsp;&nbsp;&nbsp;";
			html += "milker=[" +jsonObj.tcap +"&deg;]";
		}
	}	
	return html;	
}

function pageMaintenance_resetDec(iDecounter)
{
	//per prima cosa devo salvare eventuali modifiche
	save( function(){ pageMaintenance_reset_afterSave(iDecounter); } );
}
function pageMaintenance_reset_afterSave(iDecounter)
{
	var currentCapacityID = "pageMaintenance_" +iDecounter +"_cap";
	var decValue = parseInt(ui.getWindowByID("pageMaintenance").getChildByID(currentCapacityID).getValue());
		
	//invio il comando di set alla SMU
	pleaseWait_show();
	rhea.ajax ("setDecounter", { "d":iDecounter, "v":decValue}).then( function(result)
	{
		//chiedo i decontatori alla SMU
		pageMaintenance_getDecountersValues();
	})
	.catch( function(result)
	{
		pleaseWait_hide();
	});
}

function pageMaintenance_getDecountersValues()
{
	rhea.ajax ("getAllDecounters", "").then( function(result)
	{
		pageMaintenance_updateDecounterCurrentValueFromString(result);
		pleaseWait_hide();
	})
	.catch( function(result)
	{
		pleaseWait_hide();
	});		
}

function pageMaintenance_updateDecounterCurrentValueFromString(s)
{
	var e = s.split(",");
	for (var i=10; i<13; i++)
	{
		var iDecounter = i+1;
		var currentValueID = "pageMaintenance_" +iDecounter;
		var v = e[i];
		
		var len = 4;
		if (i == 10)
			len = 5;
		while (v.length < len)
			v = "0" +v;
		rheaSetDivHTMLByName(currentValueID, v);
	}
}

function pageMaintenance_disinstall()
{
	pleaseWait_show();
	currentTask = new TaskDisintall();
}

function pageMaintenance_disinstall_onAbort()
{
	currentTask = voidTask;
}

/***************************************************************************
 *
 * pageCleaning
 *
 */
function pageCleaning_show()
{
	if (showPage("pageCleaning", "清洗/<br>冲洗", 1 ,1))
	{
		//è la prima volta che visualizziamo la pagina
		if (da3.isInstant())
		{
			var w = ui.getWindowByID("pageCleaning");
			w.getChildByID("pageCleaning_btnCleanHC").hide();
			//rheaHideElem (rheaGetElemByID("pageCleaning_tabDissolveTable"));
		}
	}
}

function pageCleaning_action (what)
{
	pleaseWait_show();
	
	if (what == 8) //cleaning HC
		save( function(){ pageCleaning_startLavSanitario(8,1); } );
	else if (what==5) //milker
		pageCleaning_startLavSanitario(what,1);
	else
	{
		currentTask = new TaskCleaning(what, da3.isEspresso());
		rhea.requestGPUCleaning(parseInt(what));
	}
}

function pageCleaning_startLavSanitario (what, bSendRequestToGPU)
{
	pleaseWait_show();
	rhea.requestGPUEvent(RHEA_EVENT_CPU_MESSAGE);
	currentTask = new TaskCleaning(what, da3.isEspresso());
	if (bSendRequestToGPU)
		rhea.requestGPUCleaning(parseInt(what));
}

function pageCleaning_onFinished()
{
	if (currentTask.whichWash == 5)
	{
		//se ho terminato il lav san del cappuccinatore, chiedo alla CPU
		//il nuovo orario del prossimo lavaggio
		rhea.ajax ("getTimeLavSanCapp", "").then( function(result)
		{
			var win = ui.getWindowByID("pageMilker");
			var obj = win.getChildByID("pageMilker_time1");
			var data = JSON.parse(result);
			console.log ("obj:" +obj);
			if (null != obj)
			{
				obj.setValueHH(data.h);
				obj.setValueMM(data.m);
			}
			var v = parseInt(data.h) * 100 + parseInt(data.m);
			da3.write16(7468, v);			
		})
		.catch( function(result)
		{
		});		
	}

	currentTask = voidTask;
	
	if (bGotoHMIAfterLavaggio)
	{
		gotoHMI();
		return;
	}
		
	pleaseWait_hide();
}

	
	
/***************************************************************************
 *
 * pageMiscellaneous
 *
 */
var pageMiscellaneous_fvhBefore = 0;
function pageMiscellaneous_show()
{
	var win = ui.getWindowByID("pageMiscellaneous");
	if (showPage("pageMiscellaneous", "其他", 1, 1))
	{
		//è la prima volta che visualizziamo la pagina
		var opt = win.getChildByID("pageMiscellaneous_cpuLang");
		opt.changeOptions ("0|" +cpuLangName1 +"|1|" +cpuLangName2);
		
		if (da3.isEspresso())
		{
			rheaHideElem (rheaGetElemByID("pageMiscellaneous_r1"));
			rheaHideElem (rheaGetElemByID("pageMiscellaneous_r2"));
		}
		else
		{
			rheaHideElem (rheaGetElemByID("pageMiscellaneous_fmilkTopping"));
		}
		if (da3.isGruppoMicro())
			rheaHideElem (rheaGetElemByID("pageMiscellaneous_fmilkTopping"));
		
		if (da3.isMachine_MultibonaInstant() || da3.isMachine_MinibonaInstant())
			rheaHideElem (rheaGetElemByID("pageMiscellaneous_r1"));
		
		var objDataAuditBefore = win.getChildByID("pageMiscellaneous_gs_auditBefore");
		var objFvHWKey = win.getChildByID("pageMiscellaneous_fvHwKey");
		if (da3.isInduzione())
		{
			//versione induzione
			objDataAuditBefore.da3Pos=7106;
			objFvHWKey.da3Pos=7104;
		}
		else
		{
			//versione bollitore
			objDataAuditBefore.da3Pos=7088
			objFvHWKey.da3Pos=7106;
		}

		objDataAuditBefore.loadFromDA3(da3);
		objFvHWKey.loadFromDA3(da3);
		
		win.showHideScrollBar();
	}
	
	pageMiscellaneous_fv_refresh();
	pageMiscellaneous_blockingCounter_refresh();
	pageMiscellaneous_onSelector();
}

function pageMiscellaneous_blockingCounter_refresh()
{
	//valore attuale del blocking counter
	pleaseWait_show();
	rhea.ajax ("getAllDecounters", "").then( function(result)
	{
		var e = result.split(",");
		var v = e[13];
		while (v.length < 5)
			v = "0" +v;
		rheaSetDivHTMLByName("pageMiscellaneous_blockingCt_unblocked_curct", v);
		pleaseWait_hide();
	})
	.catch( function(result)
	{
		rheaSetDivHTMLByName("pageMiscellaneous_blockingCt_unblocked_curct", "?????");
		pleaseWait_hide();
	});	
}

function pageMiscellaneous_blockingCounter_set()
{
	//per prima cosa devo salvare eventuali modifiche
	save( function(){ pageMiscellaneous_blockingCounter_set_afterSave(); } );
}
function pageMiscellaneous_blockingCounter_set_afterSave()
{
	var counter = parseInt(ui.getWindowByID("pageMiscellaneous").getChildByID("pageMiscellaneous_blockingCt_newValue").getValue());
		
	//invio il comando di set alla SMU
	pleaseWait_show();
	rhea.ajax ("setDecounter", { "d":14, "v":counter}).then( function(result)
	{
		pageMiscellaneous_blockingCounter_refresh();
		
	})
	.catch( function(result)
	{
		console.log ("ERR: pageMiscellaneous_blockingCounter_set_afterSave()");
		pleaseWait_hide();
	});
}

function pageMiscellaneous_fv_refresh()
{
	var win = ui.getWindowByID("pageMiscellaneous");

	//data e ora di fine freevend
	var enddate_minute = da3.read8(8435);
	var enddate_hh = da3.read8(8436);
	var enddate_gg = da3.read8(8437);
	var enddate_mm = da3.read8(8438);
	var enddate_yy = 2000 + da3.read8(8439);
	var dataScadenza = new Date(enddate_yy, enddate_mm-1, enddate_gg, enddate_hh, enddate_minute, 0, 0);

	var dataNow = new Date(dataora_yy, dataora_mm-1, dataora_dd, dataora_hh, dataora_min, 0, 0);
	var minuteLeft = Math.floor ((dataScadenza - dataNow) / 60000);
	if (minuteLeft < 0 || minuteLeft >= 255*60)
	{
		//freevend non in corso
		rheaSetDisplayMode(rheaGetElemByID("pageMiscellaneous_fv_r1"), "table-row");
		rheaHideElem(rheaGetElemByID("pageMiscellaneous_fv_r2"));
		da3.freevendFasciaOraria_stopItNow();
	}
	else
	{
		//freevend in corso
		rheaHideElem(rheaGetElemByID("pageMiscellaneous_fv_r1"));
		rheaSetDisplayMode(rheaGetElemByID("pageMiscellaneous_fv_r2"), "table-row");

		if (enddate_mm <10) enddate_mm = "0" +enddate_mm;
		if (enddate_gg <10) enddate_gg = "0" +enddate_gg;
		if (enddate_hh <10) enddate_hh = "0" +enddate_hh;
		if (enddate_minute <10) enddate_minute = "0" +enddate_minute;
		rheaSetDivHTMLByName("pageMiscellaneous_fvDateEnd", "<i>免费销售将结束<br>" + enddate_yy +"/" +enddate_mm +"/" +enddate_gg +" " +enddate_hh +":" +enddate_minute);
	}
}

function pageMiscellaneous_startFVNow()
{
	var win = ui.getWindowByID("pageMiscellaneous");
	var h = parseInt(win.getChildByID("pageMiscellaneous_fvH").getValue());
	if (h < 1)
		return;
	
	pleaseWait_show();
	var dataNow = new Date(dataora_yy, dataora_mm-1, dataora_dd, dataora_hh, dataora_min, 0, 0);
	da3.freevendFasciaOraria_startNowAndLastForNHours(dataNow, h);
	save( function(){ pageMiscellaneous_stopFVNow_onFinish(); } );
}


function pageMiscellaneous_stopFVNow()
{
	pleaseWait_show();
	da3.freevendFasciaOraria_stopItNow();
	save( function(){ pageMiscellaneous_stopFVNow_onFinish(); } );
}

function pageMiscellaneous_stopFVNow_onFinish()
{
	//notifica la CPU di aggiornare il suo stato di freevend
	setTimeout ( function() { pageMiscellaneous_sendP15(); }, 1000);
}

function pageMiscellaneous_sendP15()
{
	var buffer = new Uint8Array(1);
	buffer[0] = 66;
	rhea.sendGPUCommand ("E", buffer, 0, 0);
	pageMiscellaneous_fv_refresh();
	pleaseWait_hide();
}

function pageMiscellaneous_oldProgMenu()		{ window.location = "gotoLegacyMenu.html"; }

function  pageMiscellaneous_onSelector()
{
	var elemGS = rheaGetElemByID("pageMiscellaneous_gs");
	var elemMID = rheaGetElemByID("pageMiscellaneous_mid");
	var elemLM = rheaGetElemByID("pageMiscellaneous_lm");
	var elemFV = rheaGetElemByID("pageMiscellaneous_fv");
	var elemBCT = rheaGetElemByID("pageMiscellaneous_blockingCt");
	
	rheaHideElem(elemGS);
	rheaHideElem(elemMID);
	rheaHideElem(elemLM);
	rheaHideElem(elemFV);
	rheaHideElem(elemBCT);
	
	var win = ui.getWindowByID("pageMiscellaneous");
	switch (parseInt(win.getChildByID("pageMiscellaneous_selector").getSelectedOptionValue()))
	{
		case 0: rheaShowElem(elemGS); break;
		case 1: rheaShowElem(elemMID); break;
		case 2: rheaShowElem(elemLM); break;
		case 3: rheaShowElem(elemFV); break;
		case 4: rheaShowElem(elemBCT); break;
	}
	win.showHideScrollBar();
}

function pageMiscellaneous_onPINCodeInserted()
{
	var win = ui.getWindowByID("pageMiscellaneous");

	var pinCode = parseInt(da3.read16(7404));
	if (pinCode==0)	
	{
		//la CPU impone il codice "123" nel caso in cui nel da3 sia memorizzato "000"
		pinCode=123;
		win.getChildByID("pageMiscellaneous_newpincode").setValue("123");
	}
		
		
	var pinCodeObj = win.getChildByID("pageMiscellaneous_pincode");
	if (parseInt(pinCodeObj.getValue()) != pinCode)
	{
		pinCodeObj.setValue("000");
		return;
	}


	rheaHideElem (rheaGetElemByID("pageMiscellaneous_blockingCt_pwd"));
	rheaShowElem (rheaGetElemByID("pageMiscellaneous_blockingCt_unblocked"));
	win.showHideScrollBar();
}


/***************************************************************************
 *
 * pageProductQty
 *
 */
function pageProductQty_show()
{
	if (showPage("pageProductQty", "饮品<br>数量", 1,1))
	{
		//è la prima volta che visualizziamo la pagina
		pageProductQty_getDecounterValues();
	}
	pageProductQty_showDecounter();
	
	//aggiorno le unità di misura
	var win = ui.getWindowByID("pageProductQty");
	for (var i=0; i<da3.getNumProdotti(); i++)
	{
		var um = "sec";
		if (da3.isMotorCalibrated(i+1)) 
			um = "gr"; 

		win.getChildByID("pageProductQty_decCurCap_" +(i+1)).changeUM(um);
		win.getChildByID("pageProductQty_decCurWarn_" +(i+1)).changeUM(um);
	}	
	
	
	//chiedo il valore attuale dei decontatori alla SMU
	pleaseWait_show();
	rhea.ajax ("getAllDecounters", "").then( function(result)
	{
		pageProductQty_updateDecounterCurrentValueFromString(result);
		pleaseWait_hide();
	})
	.catch( function(result)
	{
		pleaseWait_hide();
	});	
}

function pageProductQty_build()
{
	var nProdotti = da3.getNumProdotti();
	var da3Loc_decounter = 7334;
	var da3Loc_warning = da3Loc_decounter +2*nProdotti;
	var da3Loc_enable = da3Loc_warning +2*nProdotti;
	var html = "";
	
	var dataOption = "1|1";
	for (var i=2; i<=nProdotti; i++)
		dataOption += "|" +i +"|" +i;
		
	html = 	"<table border='0' width='100%'><tr valign='middle'>"
			+"	<td style='width:160px'><b>选择 A<br>计数器</b></td>"
			+"	<td><div class='UIOptionSmall' id='pageProductQty_decSelector' data-option='" +dataOption +"' data-onclick='pageProductQty_showDecounter()'></div></td>"
			+"</tr></table><br>";
	
	for (var i=0; i<nProdotti; i++)
	{
		var num = (i+1);
		if (i<9) num = "0" +num;
		num = "#" +num;
		
		var pageID = "pageProductQty_page_" +(i+1);
		var currentValueID = "pageProductQty_decCurVal_" +(i+1);
		var currentCapacityID = "pageProductQty_decCurCap_" +(i+1);
		var currentWarningID = "pageProductQty_decCurWarn_" +(i+1);
		
		var currentDecountValue = "00000";
		
		html +=  "<div id='" +pageID +"' style='display:none'>"
				+"<table border='0' class='elenco'>"
				+"	<tr style='height:70px'>"
				+"		<td style='width:300px'>DECOUNTER #" +(i+1) +"<br>当前值</td>"
				+"		<td style='width:400px'><span id='" +currentValueID +"' class='bigCaption25'>" +currentDecountValue +"</span></td>"
				+"		<td align='center'><div class='UIButton bigButton60 actionButton' data-caption='重置' data-onclick='pageProductQty_reset(" +(i+1) +")'></div></td>"
				+"	</tr>"
				+"	<tr><td>罐<br>容量</td><td colspan='2'><div id='" +currentCapacityID +"' class='UINumber' data-numfigures='5' data-decimal='1' data-da3='" +da3Loc_decounter +"' data-max='60000' data-um='sec'></div></td></tr>"
				+"	<tr><td>警告于</td><td colspan='2'><div id='" +currentWarningID +"' class='UINumber' data-numfigures='5' data-decimal='1' data-da3='" +da3Loc_warning +"' data-max='60000' data-um='sec'></div></td></tr>"
				+"	<tr style='border:0'><td>启用产品停止</td><td colspan='2'><div class='UIOption' data-option='1|确认|0|没有' data-da3='" +da3Loc_enable +"'></div></td></tr>"
				+"</table></div>";
		da3Loc_decounter+=2;
		da3Loc_warning+=2;
		da3Loc_enable+=2;
	}
	
	rheaSetDivHTMLByName("pageProductQty_content", html);
}

function pageProductQty_showDecounter()
{
	var opt = ui.getWindowByID("pageProductQty").getChildByID("pageProductQty_decSelector");
	var decSelected = opt.getSelectedOptionValue();
	
	var nProdotti = da3.getNumProdotti();
	for (var i=1; i<=nProdotti; i++)
	{
		var pageID = "pageProductQty_page_" +i;
		if (i == decSelected)
			rheaShowElem(rheaGetElemByID(pageID));
		else
			rheaHideElem(rheaGetElemByID(pageID));
	}
}

function pageProductQty_updateDecounterCurrentValueFromString(s)
{
	var e = s.split(",");
	for (var i=0; i<e.length; i++)
	{
		var iDecounter_1_10 = i+1;
		var currentValueID = "pageProductQty_decCurVal_" +iDecounter_1_10;
		
		var um = "sec";
		if (da3.isMotorCalibrated(iDecounter_1_10)) 
			um = "gr"; 		
		
		var v = e[i];
		while (v.length < 5)
			v = "0" +v;
		var s = v.substr(0,4) +"." +v.substr(4) +"<span style='font-size:0.4em'> " +um +"</span>";
		
		rheaSetDivHTMLByName(currentValueID, s);
	}
}

function pageProductQty_reset (iDecounter_1_10)
{
	//per prima cosa devo salvare eventuali modifiche
	save( function(){ pageProductQty_reset_afterSave(iDecounter_1_10); } );
}
function pageProductQty_reset_afterSave(iDecounter_1_10)
{
	var currentCapacityID = "pageProductQty_decCurCap_" +iDecounter_1_10;
	var decValue = parseInt(ui.getWindowByID("pageProductQty").getChildByID(currentCapacityID).getValue());
		
	//invio il comando di set alla SMU
	pleaseWait_show();
	rhea.ajax ("setDecounter", { "d":iDecounter_1_10, "v":decValue}).then( function(result)
	{
		//chiedo i decontatori alla SMU
		pageProductQty_getDecounterValues();
	})
	.catch( function(result)
	{
		pleaseWait_hide();
	});
}

function pageProductQty_getDecounterValues()
{
	rhea.ajax ("getAllDecounters", "").then( function(result)
	{
		pageProductQty_updateDecounterCurrentValueFromString(result);
		pleaseWait_hide();
	})
	.catch( function(result)
	{
		pleaseWait_hide();
	});		
}



/***************************************************************************
 *
 * pageMilker
 *
 */
function pageMilker_show()
{
	if (showPage("pageMilker", "鲜奶参数", 1,1))
	{
		//è la prima volta che visualizziamo la pagina
	}
	
	btnSave_setCallback ("pageMilker_onBtnSave()");
	
	//se la temperatura del milker riportata nel DA3 è zero, allora il milker è disabled
	var win = ui.getWindowByID("pageMilker");
	var yesNo = win.getChildByID("pageMilker_enabled");
	
	var temperatureOnDA3 = da3.read8(7618);
	console.log ("milker temperatura on DA3=[" +temperatureOnDA3 +"]");
	if (temperatureOnDA3 == 0)
		yesNo.selectOptionByValue(0);
	else
		yesNo.selectOptionByValue(1);
	pageMilker_onEnabledYesNo();
}

function pageMilker_onEnabledYesNo()
{
	var win = ui.getWindowByID("pageMilker");
	var yesNo = win.getChildByID("pageMilker_enabled");
	var temperature = win.getChildByID("pageMilker_temperature");
	
	if (yesNo.getSelectedOptionValue() == 0)
	{
		rheaHideElem(rheaGetElemByID("pageMilker_params"));
	}
	else
	{
		if (da3.read8(7618) == 0)
			temperature.setValue("125");
		rheaShowElem(rheaGetElemByID("pageMilker_params"));
	}
	win.showHideScrollBar();
}

function pageMilker_onBtnSave()
{
	var win = ui.getWindowByID("pageMilker");
	var yesNo = win.getChildByID("pageMilker_enabled");
	var temperature = win.getChildByID("pageMilker_temperature");

	if (yesNo.getSelectedOptionValue() == 0)
		temperature.setValue("000");
	
	btnSave_defaultCallback();
}


/***************************************************************************
 *
 * pageSelections
 *
 */
function pageSelections_show()
{
	if (showPage("pageSelections", "选项", 1,0))
	{
		//è la prima volta che visualizziamo la pagina
	}
	btnTestSelection_hide();
	pageSelections_onSelector();
}

function pageSelections_build()
{
	var html = "";
	
	var iSel = 1;
	
	for (var page=1; page<=4; page++)
	{
		html += "<div id='pageSelections_page" +page +"' style='display:none'><table border='0'><tr>";
		for (var r=0; r<4; r++)
		{
			for (var c=0; c<3; c++)
			{
				var caption = "选择 " +rheaLeftPad(iSel,2,'0');
				html += "<td width='33%' align='center'><div class='UIButtonSel' "
						+"data-caption='" +caption +"' "
						+"data-caption2='" +guiInfo.selInfo[iSel].name +"' "
						+"data-caption3='" +guiInfo.selInfo[iSel].short +"' "
						+"data-onclick='pageSelections_onClick(" +iSel +")'></div></td>";
				iSel++;
			}
			html += "</tr>";
		}
		html += "</table></div>";
	}
	rheaSetDivHTMLByName("pageSelections_c2", html);
}


function pageSelections_onSelector()
{
	var win = ui.getWindowByID("pageSelections");
	var option = parseInt(win.getChildByID("pageSelections_selector").getSelectedOptionValue());
	for (var page=1; page<=4; page++)
	{
		var elem = rheaGetElemByID("pageSelections_page" +page);
		if (option == page)
			rheaShowElem(elem);
		else
			rheaHideElem(elem);
	}
}

function pageSelections_onClick(iSel)
{
	pleaseWait_show();
	setTimeout (function(){ pageSingleSelection_show(iSel); }, 100);
}

/***************************************************************************
 *
 * pageSingleSelection
 *
 */
var pageSingleSelection_curSel = 0;
function pageSingleSelection_show(iSel)
{
	pageSingleSelection_curSel = iSel;
	
	var title = "选择 " +rheaLeftPad(iSel,2,'0') +"&nbsp;-&nbsp;" +guiInfo.selInfo[iSel].name +"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='font-size:0.7em;color:#888'>" +guiInfo.selInfo[iSel].short +"</span>";
	if (showPageEx("pageSingleSelection", title, 1, 1, 100 * (iSel-1)))
	{
		//è la prima volta che visualizziamo la pagina
		if (da3.isGruppoMicro())
			rheaHideElem(rheaGetElemByID("pageSingleSelection_pageSel_rowJug"));
	}
	btnBack_setCallback("pageSelections_show()");
	btnTestSelection_show();
	
	var win = ui.getWindowByID("pageSingleSelection");
	
	//lo scaling factor delle selezioni potrebbe valere 0 nel qual caso significa 100%
	var da3Loc = 180 + 100 * (iSel-1);
	if (da3.read8(da3Loc) == 0)
		win.getChildByID("pageSingleSelection_sfactor").setValue(100);
	
	//Setto i prezzi
	var obj = win.getChildByID("pageSingleSelection_prc1");
	obj.setDecimals(da3.getDecimalsForPrices());
	obj.da3offset = 0;
	obj.da3Pos = da3.getPriceLocation(1,iSel);
	obj.loadFromDA3(da3);
	
	obj = win.getChildByID("pageSingleSelection_prc2");
	obj.setDecimals(da3.getDecimalsForPrices());
	obj.da3offset = 0;
	obj.da3Pos = da3.getPriceLocation(2,iSel);
	obj.loadFromDA3(da3);	
	
	//unita misura prodotti
	for (var i=0; i<SINGLESEL_NUM_PRODOTTI; i++)
	{
		if (da3.isMotorCalibrated(i+1)) 
			um = "gr"; 
		else
			um = "sec";
		win.getChildByID("pageSingleSelection_P_d"+i).changeUM(um);
	}	
	
	//unita' misura macina
	pageSingleSelection_onChangeGrinder();

	rheaSetElemTop(rheaGetElemByID("pageSingleSelection_content"), 0);
	rheaHideElem(rheaGetElemByID("pageSingleSelection_arrowUp"));
	
	//seleziono "general option"
	win.getChildByID("pageSingleSelection_selector").selectOptionByValue(0);
	pageSingleSelection_showPartialFull (win, 0);
	pageSingleSelection_onStatus();
	
	pleaseWait_hide();
}

function pageSingleSelection_onChangeGrinder()
{
	var win = ui.getWindowByID("pageSingleSelection");

	var macina = 11;
	if (da3.isEspresso())
	{
		//macina2 esiste solo se gruppo==variflex
		if (da3.isGruppoVariflex())
		{
			if (parseInt(win.getChildByID("pageSingleSelection_cofGrnderChoice").getSelectedOptionValue()) > 0)
				macina = 12	;
		}

		if (da3.isMotorCalibrated(macina)) 
			um = "gr"; 
		else
			um="sec";
		win.getChildByID("pageSingleSelection_coffeeGrinder").changeUM(um);
	}	
}

var SINGLESEL_NUM_PRODOTTI = 0;
var SINGLESEL_NUM_ACQUE = 0;
function pageSingleSelection_build()
{
	var da3LocProd;
	var da3LocWater;
	var da3LocEVTemperature = 0;
	var WATER_COLONNA_FLOW_TYPE = 0;
	var WATER_COLONNA_FLOW_TITLE = "";
	
	if (da3.isInstant())
	{
		SINGLESEL_NUM_PRODOTTI = 9;
		SINGLESEL_NUM_ACQUE = 5;
		da3LocProd = 102;
		da3ProductLM = da3LocProd +3*SINGLESEL_NUM_PRODOTTI;
		da3LocWater = da3ProductLM +3;
		
		WATER_COLONNA_FLOW_TYPE = 1;
		WATER_COLONNA_FLOW_TITLE = "流量";
	}
	else
	{
		SINGLESEL_NUM_PRODOTTI = 7;
		SINGLESEL_NUM_ACQUE = 5;
		da3LocProd = 105;
		da3ProductLM = 129;
		da3LocWater = da3ProductLM +3;

		if (da3.isInduzione())
		{
			WATER_COLONNA_FLOW_TYPE=2;
			WATER_COLONNA_FLOW_TITLE = "EV 温度";
			da3LocEVTemperature = 169;
		}
		else
			WATER_COLONNA_FLOW_TITLE = "";
	}

	
	var s = "";
	if (da3.isInstant())
		s = "0|常规选项|2|饮品|3|水|4|MIXERS";
	else
		s = "0|常规选项|1|ESPRESSO|2|饮品|3|水|4|MIXERS";
	rheaSetDivHTMLByName("pageSingleSelection_selectorAtTop", "<div class='UIOptionSmall' id='pageSingleSelection_selector' data-option='" +s +"' data-onclick='pageSingleSelection_onSelector()'></div>");
	
	
	var htmlE="";
	if (da3.isEspresso())
	{
		htmlE = "<table border='0' class='elenco'>"
				+"<tr><td>咖啡顺序</td><td><div class='UIOption' data-option='0|之后|1|之前' data-da3='103' data-da3bit='8'></div></td></tr>"
				+"<tr><td>咖啡水量<br><div class='UIButton actionButton' data-caption='&nbsp; 测试 &nbsp;' data-onclick='pageSingleSelection_test(11)'></div></td><td><div class='UINumber' data-numfigures='3' data-da3='102' data-da3bit='9' data-da3bit9='2,4' data-max='500' data-um='cc'></div></td></tr>"
				+"<tr><td>咖啡研磨机<br><div class='UIButton actionButton' data-caption='&nbsp; 测试 &nbsp;' data-onclick='pageSingleSelection_test(12)'></div></td><td><div class='UINumber' id='pageSingleSelection_coffeeGrinder' data-numfigures='3' data-decimal='1' data-da3='126' data-da3bit='8' data-max='200' data-um='sec'></div></td></tr>"
				+"<tr><td>预浸泡</td><td><div class='UINumber' data-numfigures='2' data-da3='128' data-da3bit='4' data-max='15' data-um='sec'></div></td></tr>";

		if (da3.isGruppoVariflex())
				htmlE += "<tr><td>冲泡压力</td><td><div class='UINumber' data-numfigures='2' data-da3='104' data-da3bit='4' data-max='10'></div></td></tr>";
		
		if (da3.isInduzione())
			htmlE += "<tr><td>浓缩咖啡温度</td><td><div class='UINumber' data-numfigures='3' data-da3='168' data-da3bit='8' data-max='110'></div></td></tr>";
			
		if (da3.isGruppoVariflex())
			htmlE  +="<tr><td>研磨度</td><td><div class='UIOption' style='font-size:0.9em' data-option='0|禁用|1|较细|2|参考|3|标准' data-da3='175' data-da3bit='8'></div></td></tr>";
			
		htmlE  +="<tr><td>拿铁玛奇朵<br>开始冲泡</td><td><div class='UINumber' data-numfigures='3' data-decimal='1' data-da3='127' data-da3bit='9' data-da3bit9='1,5' data-max='500' data-um=''></div></td></tr>";
		
		if (da3.isGruppoVariflex())
		{
			htmlE  += "<tr><td>EV 鲜奶<br>数量</td><td><div class='UINumber' data-numfigures='3' data-decimal='1' data-da3='162' data-da3bit='9' data-da3bit9='2,4' data-max='500'></div></td></tr>"
					 +"<tr><td>EV 鲜奶<br>延迟</td><td><div class='UINumber' data-numfigures='3' data-decimal='1' data-da3='163' data-da3bit='9' data-da3bit9='1,5' data-max='500' data-um='sec'></div></td></tr>"
				     +"<tr><td>EV 鲜奶泡</td><td><div class='UINumber' data-numfigures='3' data-decimal='1' data-da3='165' data-da3bit='9' data-da3bit9='2,4' data-max='500'></div></td></tr>"
				     +"<tr><td>EV 鲜奶泡<br>延迟</td><td><div class='UINumber' data-numfigures='3' data-decimal='1' data-da3='166' data-da3bit='9' data-da3bit9='1,5' data-max='500' data-um='sec'></div></td></tr>"
				     +"<tr><td>选择研磨机 2</td><td><div id='pageSingleSelection_cofGrnderChoice' class='UIOption' data-option='0|没有|1|确认' data-da3='179' data-da3bit='8' data-onclick='pageSingleSelection_onChangeGrinder()'></div></td></tr>";
		}

		htmlE += "<tr><td>咖啡重复</td><td><div class='UIOption' data-option='0|0|1|1|2|2' data-da3='181' data-da3bit='8'></div></td></tr>"
				+"</table>";
	}

	var htmlP = "<table border='0' class='elenco'>"
				+"<tr>"
				+"	<th style='width:184px; text-align:left;'>饮品 #</th>"
				+"	<th style='width:290px; text-align:left;'>剂量</th>"
				+"	<th style='width:290px; text-align:left;'>延迟启动</th>"
				+"	<th style='width:260px; text-align:center;'>数字中断</th>"
				+"</tr>";
	
	for (var i=0; i<SINGLESEL_NUM_PRODOTTI; i++)
	{
		var prodNum;
		prodNum = rheaLeftPad(i+1, 2, '0');
			
		var rowID = "pageSingleSelection_P_" +i;
		var dosageID = "pageSingleSelection_P_d" +i;
		htmlP +="<tr id='" +rowID +"'>"
				+"<td>#" +prodNum +"<br><div class='UIButton actionButton' data-caption='&nbsp; 测试 &nbsp;' data-onclick='pageSingleSelection_test(" +(i+1) +")'></div></td>"
				+"<td align='left'><div id='" +dosageID +"' class='UINumber' data-numfigures='3' data-decimal='1' data-da3='" +da3LocProd +"' data-da3bit='9' data-da3bit9='2,4' data-max='500' data-um='sec'></div></td>"
				+"<td align='left'><div class='UINumber' data-numfigures='3' data-decimal='1' data-da3='" +(da3LocProd+1) +"' data-da3bit='9' data-da3bit9='1,5' data-max='500' data-um='sec'></div></td>"
				+"<td align='center'><div class='UIOption' data-option='0|0|1|1|2|2' data-da3='" +(da3LocProd+2) +"' data-da3bit='4'></div></td>"
			+"</tr>";
		da3LocProd+= 3;
	}
	
	//product LM
	var rowID = "pageSingleSelection_P_LM";
	var dosageID = "pageSingleSelection_P_dLM";
	htmlP +="<tr id='" +rowID +"'>"
			+"<td>#饮品 LM<br><div class='UIButton actionButton' data-caption='&nbsp; 测试 &nbsp;' data-onclick='pageSingleSelection_test(" +(i+1) +")'></div></td>"
			+"<td align='left'><div id='" +dosageID +"' class='UINumber' data-numfigures='3' data-decimal='1' data-da3='" +da3ProductLM +"' data-da3bit='9' data-da3bit9='2,4' data-max='500'></div></td>"
			+"<td align='left'><div class='UINumber' data-numfigures='3' data-decimal='1' data-da3='" +(da3ProductLM+1) +"' data-da3bit='9' data-da3bit9='1,5' data-max='500' data-um='sec'></div></td>"
			+"<td align='center'><div class='UIOption' data-option='0|0|1|1|2|2' data-da3='" +(da3ProductLM+2) +"' data-da3bit='4'></div></td>"
		+"</tr>";
	
	if (da3.isGruppoVariflex() || da3.isInstant())
		htmlP += "<tr><td>茶包</td><td colspan='3'><div class='UIOption' data-option='0|0|1|1|2|2|3|3' data-da3='176' data-da3bit='8'></div></td></tr>"
	htmlP += "</table>";


	//waters & mixers
	var htmlW = "<table border='0' class='elenco'>"
				+"<tr>"
				+"	<th style='width:184px; text-align:left;'>水 #</th>"
				+"	<th style='width:290px; text-align:left;'>时间</th>"
				+"	<th style='width:290px; text-align:left;'>延迟启动</th>"
				+"	<th style='width:260px; text-align:center;'>" +WATER_COLONNA_FLOW_TITLE +"</th>"
				+"</tr>";
				
	var htmlM = "<table border='0' class='elenco'>"
				+"<tr>"
				+"	<th style='width:184px; text-align:left;'>MIXER #</th>"
				+"	<th style='width:290px; text-align:left;'>时间</th>"
				+"	<th style='width:290px; text-align:left;'>延迟启动</th>"
				+"	<th style='width:260px; text-align:center;'>速率</th>"
				+"</tr>";		
	for (var i=0; i<SINGLESEL_NUM_ACQUE; i++)
	{
		var prodNum;
		if (i==4)
			prodNum = "LM";
		else 
			prodNum = rheaLeftPad(i+1, 2, '0');
	
		var rowID = "pageSingleSelection_W_" +i;
		var timeID = "pageSingleSelection_W_t" +i;
		htmlW +="<tr id='" +rowID +"'>"
				+"<td>#" +prodNum +"<br><div class='UIButton actionButton' data-caption='&nbsp; 测试 &nbsp;' data-onclick='pageSingleSelection_test(" +(i+21) +")'></div></td>"
				+"<td align='left'><div id='" +timeID +"' class='UINumber' data-numfigures='3' data-decimal='1' data-da3='" +da3LocWater +"' data-da3bit='9' data-da3bit9='2,4' data-max='500' data-um='sec'></div></td>"
				+"<td align='left'><div class='UINumber' data-numfigures='3' data-decimal='1' data-da3='" +(da3LocWater+1) +"' data-da3bit='9' data-da3bit9='1,5' data-max='500' data-um='sec'></div></td>";

				
		//la colonna 3, può essere FLOW, EV-TEMP o vuota, seconda di induzione/bollitore e espresso/instant
		switch (WATER_COLONNA_FLOW_TYPE)
		{
		default:
			htmlW +="<td></td>"; 
			break;
		case 1:
			htmlW += "<td align='center'><div class='UIOption bigCaption10' data-option='0|低|1|中|2|高' data-da3='" +(da3LocWater+2) +"' data-da3bit='4'></div></td>";
			break;
		case 2:
				htmlW += "<td align='center'><div class='UINumber' data-numfigures='2' data-da3='" +da3LocEVTemperature +"' data-da3bit='8' data-max='98' data-um='&deg;C'></div></td></tr>";
				da3LocEVTemperature++;
				break;
		}
		htmlW += "</tr>";
		da3LocWater+= 3;	


		rowID = "pageSingleSelection_M_" +i;
		timeID = "pageSingleSelection_M_t" +i;
		htmlM +="<tr id='" +rowID +"'>"
				+"<td>#" +prodNum +"<br><div class='UIButton actionButton' data-caption='&nbsp; 测试 &nbsp;' data-onclick='pageSingleSelection_test(" +(i+31) +")'></div></td>"
				+"<td align='left'><div id='" +timeID +"' class='UINumber' data-numfigures='3' data-decimal='1' data-da3='" +da3LocWater +"' data-da3bit='9' data-da3bit9='2,4' data-max='500' data-um='sec'></div></td>"
				+"<td align='left'><div class='UINumber' data-numfigures='3' data-decimal='1' data-da3='" +(da3LocWater+1) +"' data-da3bit='9' data-da3bit9='1,5' data-max='500' data-um='sec'></div></td>"
				+"<td align='center'><div class='UIOption bigCaption10' data-option='1|低|2|中|3|高' data-da3='" +(da3LocWater+2) +"' data-da3bit='4'></div></td>"
			+"</tr>";		
		da3LocWater+= 3;
	}
	htmlW += "</table>";
	htmlM += "</table>";
	
	
	rheaSetDivHTMLByName("pageSingleSelection_pageE", htmlE);
	rheaSetDivHTMLByName("pageSingleSelection_pageP", htmlP);
	rheaSetDivHTMLByName("pageSingleSelection_pageW", htmlW);
	rheaSetDivHTMLByName("pageSingleSelection_pageM", htmlM);
}

function pageSingleSelection_hideIfDosageIsZero (win, dosageID, rowID)
{
	if (parseInt(win.getChildByID(dosageID).getValue()) == 0)
		rheaHideElem(rheaGetElemByID(rowID));
}

function pageSingleSelection_onProgramming()
{
	var win = ui.getWindowByID("pageSingleSelection");
	var partial = parseInt(win.getChildByID("pageSingleSelection_programming").getSelectedOptionValue());
	pageSingleSelection_showPartialFull (win, partial);
}

function pageSingleSelection_showPartialFull (win, bPartial)
{
	if (bPartial==1)
	{
		for (var i=0; i<SINGLESEL_NUM_PRODOTTI; i++)
			pageSingleSelection_hideIfDosageIsZero (win, "pageSingleSelection_P_d" +i, "pageSingleSelection_P_" +i);
		pageSingleSelection_hideIfDosageIsZero (win, "pageSingleSelection_P_dLM", "pageSingleSelection_P_LM");
		
		for (var i=0; i<SINGLESEL_NUM_ACQUE; i++)
		{
			pageSingleSelection_hideIfDosageIsZero (win, "pageSingleSelection_W_t" +i, "pageSingleSelection_W_" +i);
			pageSingleSelection_hideIfDosageIsZero (win, "pageSingleSelection_M_t" +i, "pageSingleSelection_M_" +i);
		}
	}
	else
	{
		for (var i=0; i<SINGLESEL_NUM_PRODOTTI; i++)
		{
			var rowID = "pageSingleSelection_P_" +i;
			rheaSetDisplayMode(rheaGetElemByID(rowID), "table-row");
		}
		
		rheaSetDisplayMode(rheaGetElemByID("pageSingleSelection_P_LM"), "table-row");
		
		for (var i=0; i<SINGLESEL_NUM_ACQUE; i++)
		{
			var rowID = "pageSingleSelection_W_" +i;
			rheaSetDisplayMode(rheaGetElemByID(rowID), "table-row");
			
			rowID = "pageSingleSelection_M_" +i;
			rheaSetDisplayMode(rheaGetElemByID(rowID), "table-row");
		}		
	}
	
	win.showHideScrollBar();
}

function pageSingleSelection_onStatus()
{
	pageSingleSelection_onProgramming();
	pageSingleSelection_onSelector();

	var win = ui.getWindowByID("pageSingleSelection");
	switch (parseInt(win.getChildByID("pageSingleSelection_status").getSelectedOptionValue()))
	{
		case 0: //selection
			rheaShowElem(rheaGetElemByID("pageSingleSelection_selector"));
			rheaShowElem(rheaGetElemByID("pageSingleSelection_pageSel")); 
			break;
			
		case 1: //inhibit
			rheaHideElem(rheaGetElemByID("pageSingleSelection_pageSel")); 
			rheaHideElem(rheaGetElemByID("pageSingleSelection_selector"));
			break;
		
		case 2: //presel
			rheaHideElem(rheaGetElemByID("pageSingleSelection_pageSel")); 
			rheaHideElem(rheaGetElemByID("pageSingleSelection_selector"));
			break;
		
	}
}

function pageSingleSelection_onSelector()
{
	var elemG = rheaGetElemByID("pageSingleSelection_pageG");
	var elemE = rheaGetElemByID("pageSingleSelection_pageE");
	var elemP = rheaGetElemByID("pageSingleSelection_pageP");
	var elemW = rheaGetElemByID("pageSingleSelection_pageW");
	var elemM = rheaGetElemByID("pageSingleSelection_pageM");
	rheaHideElem(elemG);
	rheaHideElem(elemE);
	rheaHideElem(elemP);
	rheaHideElem(elemW);
	rheaHideElem(elemM);
	
	var win = ui.getWindowByID("pageSingleSelection");
	switch (parseInt(win.getChildByID("pageSingleSelection_selector").getSelectedOptionValue()))
	{
		case 0: rheaShowElem(elemG); break;
		case 1: rheaShowElem(elemE); break;
		case 2: rheaShowElem(elemP); break;
		case 3: rheaShowElem(elemW); break;
		case 4: rheaShowElem(elemM); break;
		
	}
	win.showHideScrollBar();
}


var ajax_testSelection_nRetry = 0;
function pageSingleSelection_test (iAttuatore)
{
	//console.log ("pageSingleSelection_test:: selnum[" +pageSingleSelection_curSel +"] attuatore[" +iAttuatore +"]");
	//prima di tutto salvo e spedisco la ricetta alla CPU
	ajax_testSelection_nRetry = 3;
	save( function(){ pageSingleSelection_test_afterSave(iAttuatore); } );
}

function pageSingleSelection_test_afterSave(iAttuatore)
{
	//invio il comando alla CPU e aspetto che la CPU finisca
	pleaseWait_show();
	currentTask = new TaskTestSelezione(pageSingleSelection_curSel, iAttuatore);
}

function pageSingleSelection_test_onFinish()
{
	//console.log ("pageSingleSelection_test_onFinish");
	currentTask = voidTask;
	pleaseWait_hide();
}


/***************************************************************************
 *
 * pageTemperature
 *
 */
function pageTemperature_show()
{
	if (showPage("pageTemperature", "温度", 1,1))
	{
		//è la prima volta che visualizziamo la pagina
	}
	currentTask = new TaskTemperature();
}

function pageTemperature_build()
{
	var html = "<table border='0' class='elenco'>"
			   +"	<tr style='height:30px;'><td colspan='3' align='center'><div id='pageTemperature_live'  class='tip'></div></td></tr>";

	if (da3.isInstant())
	{
		//boiler & delta
		html += "<tr><td>锅炉</td><td><div class='UINumber' data-numfigures='2' data-decimal='0' data-max='92' data-da3='7032' data-da3bit='8' data-um='&deg;C'></div></td></tr>"
			   +"<tr><td>DELTA</td><td><div class='UINumber' data-numfigures='2' data-decimal='0' data-max='16' data-da3='7042' data-da3bit='8' data-um='&deg;C'></div></td></tr>";
	}
	else
	{
		var hasHeaterTemp = 1;
		if (da3.isGruppoMicro())
			hasHeaterTemp = 0;
	
		if (da3.isInduzione())
		{
			//solo temp heater (aka camera caffe')
			if (hasHeaterTemp)
				html += "<tr><td>加热器</td><td><div class='UINumber' data-numfigures='2' data-decimal='0' data-max='40' data-da3='7032' data-da3bit='8' data-um='&deg;C'></div></td></tr>";
		}
		else
		{
			//(espresso qui significa bollitore, heater significa camera caffe')
			html += "<tr><td>ESPRESSO</td><td><div class='UINumber' data-numfigures='3' data-decimal='0' data-max='120' data-da3='7032' data-da3bit='8' data-um='&deg;C'></div></td></tr>"
					+"<tr><td>DELTA</td><td><div class='UINumber' data-numfigures='2' data-decimal='0' data-max='25' data-da3='7042' data-da3bit='8' data-um='&deg;C'></div></td></tr>"
					+"<tr><td>首选咖啡</td><td><div class='UINumber' data-numfigures='2' data-decimal='0' data-max='30' data-da3='7034' data-da3bit='8' data-um=''></div></td></tr>"
					+"<tr><td>加热时间</td><td><div class='UINumber' data-numfigures='3' data-decimal='1' data-max='100' data-da3='7036' data-da3bit='8' data-um='sec'></div></td></tr>";
				   
			if (hasHeaterTemp)
				html += "<tr><td>加热器</td><td><div class='UINumber' data-numfigures='2' data-decimal='0' data-max='40' data-da3='7040' data-da3bit='8' data-um='&deg;C'></div></td></tr>";
		}
	}	
	html += "</table>";
	rheaSetDivHTMLByName("pageTemperature_content", html);
}

/***************************************************************************
 *
 * pageClock
 *
 */
function pageClock_show()
{
	if (showPage("pageClock", "时钟", 1,1))
	{
		//è la prima volta che visualizziamo la pagina
	}
	pageClock_onSelector();
	
	//sincronizzo data e ora
	pageClock_syncTime();
	pageClock_syncDate();
}
	
function pageClock_syncTime()
{	
	//console.log ("ajax::getTime");
	rhea.ajax ("getTime", "").then( function(result)
	{
		var win = ui.getWindowByID("pageClock");
		var obj = win.getChildByID("pageClock_time");
		
		var data = JSON.parse(result);
		obj.setValueHH(data.h);
		obj.setValueMM(data.m);
		dataOra_setup();
	})
	.catch( function(result)
	{
		setTimeout ( function() {pageClock_syncTime();}, 200);
	});
}

function pageClock_syncDate()
{
	//console.log ("ajax::getDate");
	rhea.ajax ("getDate", "").then( function(result)
	{
		var data = JSON.parse(result);

		var win = ui.getWindowByID("pageClock");
		win.getChildByID("pageClock_dd").setValue(data.d);
		win.getChildByID("pageClock_mm").setValue(data.m);
		win.getChildByID("pageClock_yy").setValue(data.y);
		dataOra_setup();
	})
	.catch( function(result)
	{
		setTimeout ( function() {pageClock_syncDate();}, 200);
	});	
}

function pageClock_onSelector()
{
	var elemClock = rheaGetElemByID("pageClock_clock");
	var elemHH = rheaGetElemByID("pageClock_happyHour");
	var elemES = rheaGetElemByID("pageClock_energySave");
	
	rheaHideElem(elemClock);
	rheaHideElem(elemHH);
	rheaHideElem(elemES);
	
	var win = ui.getWindowByID("pageClock");
	switch (parseInt(win.getChildByID("pageClock_selector").getSelectedOptionValue()))
	{
		default: rheaShowElem(elemClock); break;
		case 1:  rheaShowElem(elemHH); break;
		case 2:  rheaShowElem(elemES); break;
	}
	
	ui.getWindowByID("pageClock").showHideScrollBar();
}

function pageClock_setTime()
{
	var win = ui.getWindowByID("pageClock");
	var obj = win.getChildByID("pageClock_time");
	
	pleaseWait_show();
	//console.log ("ajax::setTime");
	rhea.ajax ("setTime", { "h":obj.getValueHH(), "m":obj.getValueMM(), "s":0}).then( function(result)
	{
		pleaseWait_hide();
		pageClock_syncTime();
	})
	.catch( function(result)
	{
		setTimeout ( function() { pageClock_setTime(); }, 200);
	});
}

function pageClock_setDate()
{
	var win = ui.getWindowByID("pageClock");
	var yy = win.getChildByID("pageClock_yy").getValue();
	var mm = win.getChildByID("pageClock_mm").getValue();
	var dd = win.getChildByID("pageClock_dd").getValue();
	
	pleaseWait_show();
	//console.log ("ajax::setDate");
	rhea.ajax ("setDate", { "y":yy, "m":mm, "d":dd}).then( function(result)
	{
		pleaseWait_hide();
		pageClock_syncDate();
	})
	.catch( function(result)
	{
		setTimeout ( function() { pageClock_setDate(); }, 200);
	});
}

/***************************************************************************
 *
 * pageCalibration (instant)
 *
 */
function pageCalibration_show()
{
	if (showPage("pageCalibration", "速溶饮品<br>校准", 1,0))
	{
		//è la prima volta che visualizziamo la pagina
		if (da3.isInstant())
		{
			rheaHideElem (rheaGetElemByID("pageCalibration_rowGrinder1"));
			rheaHideElem (rheaGetElemByID("pageCalibration_rowGrinder2"));
		}
		else
		{
			//nascondo motor 1 e motor 2
			rheaHideElem (rheaGetElemByID("pageCalibration_rowMotor1"));
			rheaHideElem (rheaGetElemByID("pageCalibration_rowMotor2"));
			if (da3.getNumMacine() == 1)
				rheaHideElem (rheaGetElemByID("pageCalibration_rowGrinder2"));
				
			//nascondo la calibrazione di macina1&2 anche qui perchè ho spostto tuto nel menu ESPRESSO calibration
			rheaHideElem (rheaGetElemByID("pageCalibration_rowGrinder1"));
			rheaHideElem (rheaGetElemByID("pageCalibration_rowGrinder2"));		
			rheaHideElem(rheaGetElemByID("pageCalibration_rowEncoder1"));
			rheaHideElem(rheaGetElemByID("pageCalibration_rowEncoder2"));
		}
	}

	pageCalibration_refreshCalibValueOnScreen();
	currentTask = taskCalibMotor;
}

function pageCalibration_refreshCalibValueOnScreen()
{
	if (da3.isInstant())
	{
		for (var i=1; i<=6; i++)
		{
			var v = helper_intToFixedOnePointDecimal( da3.getCalibFactorGSec(i) );
			rheaSetDivHTMLByName("pageCalibration_m" +i, v +"&nbsp;gr/sec");
		}
		rheaHideElem(rheaGetElemByID("pageCalibration_rowEncoder1"));
		rheaHideElem(rheaGetElemByID("pageCalibration_rowEncoder2"));
	}
	else
	{
		//macina 1
		var v = helper_intToFixedOnePointDecimal( da3.getCalibFactorGSec(11) );
		rheaSetDivHTMLByName("pageCalibration_m11", v +"&nbsp;gr/sec");
		v = helper_decodeImpulsi(da3.getImpulsi(11));
		rheaSetDivHTMLByName("pageCalibration_encoder1", v +"&nbsp;imp/gr");
		
		//motori
		for (var i=2; i<=6; i++)
		{
			v = helper_intToFixedOnePointDecimal( da3.getCalibFactorGSec(i) );
			rheaSetDivHTMLByName("pageCalibration_m" +i, v +"&nbsp;gr/sec");
		}
		
		//macina 2
		if (da3.getNumMacine() == 1)
			rheaHideElem(rheaGetElemByID("pageCalibration_rowEncoder2"));
		else
		{
			v = helper_intToFixedOnePointDecimal( da3.getCalibFactorGSec(12) );
			rheaSetDivHTMLByName("pageCalibration_m12", v +"&nbsp;gr/sec");
			v = helper_decodeImpulsi(da3.getImpulsi(12));
			rheaSetDivHTMLByName("pageCalibration_encoder2", v +"&nbsp;imp/gr");
		}
	}	
	ui.getWindowByID("pageCalibration").showHideScrollBar();
}

function pageCalibration_reset(motor)
{
	pleaseWait_show();
	rhea.ajax ("setFattoreCalib", { "m":motor, "v":0}).then( function(result)
	{
		rheaSetDivHTMLByName("pageCalibration_m" +motor, "0&nbsp;gr/sec");
		da3.setCalibFactorGSec(motor, 0);

		if (motor==11) 
		{
			da3.setImpulsi(11,0);
			rheaSetDivHTMLByName("pageCalibration_encoder1", "0");
		}

		if (motor==12)
		{
			da3.setImpulsi(12,0);
			rheaSetDivHTMLByName("pageCalibration_encoder2", "0");
		}
		
		setTimeout (
			function()
			{
				save (function() { pleaseWait_hide();});
			},
			1000);
	})
	.catch( function(result)
	{
		pleaseWait_hide();
	});
}

function pageCalibration_start (motor)
{
	pleaseWait_show();
	
	var bAlsoCalcImpulses = 1;
	if (da3.isGruppoMicro())
		bAlsoCalcImpulses = 0;
	if (motor == 11)
		taskCalibMotor.startCalibrazioneMacina(1, bAlsoCalcImpulses);
	else if (motor == 12)
		taskCalibMotor.startCalibrazioneMacina(2, bAlsoCalcImpulses);
	else
		taskCalibMotor.startMotorCalib(motor);
}

function pageCalibration_onFinish ()
{
	if (currentPageID == "pageExpCalib")
		pageExpCalib_onFinish();
	else
		save (function() { pageCalibration_refreshCalibValueOnScreen(); pleaseWait_hide();});
}

function pageCalibration_grindAgain()
{
	pleaseWait_calibration_varigrind_hide();
	pleaseWait_calibration_num_hide();
	pleaseWait_btn1_hide();
	pleaseWait_calibration_setText("");
	taskCalibMotor.fase = 10;
}

function pageCalibration_setVGrind()
{
	pleaseWait_calibration_varigrind_hide();
	pleaseWait_calibration_num_hide();
	pleaseWait_btn1_hide();
	pleaseWait_calibration_setText("");
	taskCalibMotor.fase = 25;
}

function pageCalibration_runMotorAgain()
{
	pleaseWait_calibration_motor_hide();
	pleaseWait_calibration_num_hide();
	pleaseWait_btn1_hide();
	pleaseWait_calibration_setText("");
	taskCalibMotor.fase = 0;
}

/***************************************************************************
 *
 * pagePayment
 *
 */
function pagePayment_show()
{
	if (showPage("pagePayment", "支付<br>系统", 1,1))
	{
	}

	pagePayment_onSelector();
	
	var win = ui.getWindowByID("pagePayment");
	win.getChildByID("pagePayment_creditMax").setDecimals(da3.getDecimalsForPrices());
	win.getChildByID("pagePayment_restMax").setDecimals(da3.getDecimalsForPrices());
	win.getChildByID("pagePayment_tokenV").setDecimals(da3.getDecimalsForPrices());
	win.getChildByID("pagePayment_maxCC").setDecimals(da3.getDecimalsForPrices());
}

function pagePayment_build()
{
	var options = "0|常规选项|1|MDB|2|机器识别码|3|RFID 卡";
	if (da3.isAlipayChinaActive())
		options += "|4|ALIPAY";
	var html = "<div class='UIOptionSmall' id='pagePayment_selector' data-option='" +options +"' data-onclick='pagePayment_onSelector()'></div>";
	rheaSetElemHTML (rheaGetElemByID("pagePayment_selector"), html);
}

function pagePayment_onSelector()
{
	var elem0 = rheaGetElemByID("pagePayment_general");
	var elem1 = rheaGetElemByID("pagePayment_mdb");
	var elem2 = rheaGetElemByID("pagePayment_mid");
	var elem3 = rheaGetElemByID("pagePayment_rfid");
	var elem4 = rheaGetElemByID("pagePayment_alipayChina");

	rheaHideElem(elem0);
	rheaHideElem(elem1);
	rheaHideElem(elem2);
	rheaHideElem(elem3);
	rheaHideElem(elem4);
	
	var win = ui.getWindowByID("pagePayment");
	switch (parseInt(win.getChildByID("pagePayment_selector").getSelectedOptionValue()))
	{
		default: rheaShowElem(elem0); break;
		case 1:  rheaShowElem(elem1); break;
		case 2:  rheaShowElem(elem2); break;
		case 3:  rheaShowElem(elem3); break;
		case 4:  
			rheaShowElem(elem4); 
			rhea.ajax ("AliChinaGetConnDetail", "").then( function(result)
			{
				var data = JSON.parse(result);
				rheaSetElemHTML(rheaGetElemByID("pagePayment_alichina_ip"), data.ip1 +"." +data.ip2 +"." +data.ip3 +"." +data.ip4);
				rheaSetElemHTML(rheaGetElemByID("pagePayment_alichina_port"), data.port);
				rheaSetElemHTML(rheaGetElemByID("pagePayment_alichina_mid"), data.mid);
				rheaSetElemHTML(rheaGetElemByID("pagePayment_alichina_key"), data.key);
				
			})
			.catch( function(result)
			{
				console.log ("ERROR[" +result +"]");
			});	

			break;
	}
	
	ui.getWindowByID("pagePayment").showHideScrollBar();
}


/***************************************************************************
 *
 * pageDevices
 *
 */
var pageDevices_selector = null;
function pageDevices_show()
{
	if (showPage("pageDevices", "设备", 1,1))
	{
		//è la prima volta che visualizziamo la pagina
		var win = ui.getWindowByID("pageDevices");
		if (da3.isGruppoMicro())
			pageDevices_selector = win.getChildByID("pageDevices_selectorMicro");
		else
			pageDevices_selector = win.getChildByID("pageDevices_selectorVFlex");
	
		if (da3.isInstant())
		{
			pageDevices_selector.selectOptionByValue(0);
			rheaHideElem(rheaGetElemByID("pageDevices_selectorTable"));
			rheaHideElem(rheaGetElemByID("pageDevices_cofSensor"));
			rheaHideElem(rheaGetElemByID("pageDevices_grpTest"));
			rheaHideElem(rheaGetElemByID("pageDevices_motorTest"));
			rheaHideElem(rheaGetElemByID("pageDevices_boilerSize"));
		}
		
		if (da3.isGruppoMicro())
		{
			rheaHideElem(rheaGetElemByID("pageDevices_selectorTable"));
			rheaSetDisplayMode(rheaGetElemByID("pageDevices_selectorTableMicro"), "table");
			rheaHideElem(rheaGetElemByID("pageDevices_cofSensor"));
			rheaHideElem(rheaGetElemByID("pageDevices_cupSensor"));
			rheaHideElem(rheaGetElemByID("pageDevices_vflex_autoAdjust"));
			rheaHideElem(rheaGetElemByID("pageDevices_vflex_deliveryPhase"));
			rheaHideElem(rheaGetElemByID("pageDevices_motorTest"));
			rheaHideElem(rheaGetElemByID("pageDevices_grpTest"));
			win.getChildByID("pageDevices_vflex_brewerDiam").changeCaptionByIndex(1,"40mm");
		}

		//grinder speed test, valido solo per "multibona espresso"
		//Il valore viene memorizzato nella loc 7558 del da3
		//La locazione 7558 è usata sia per indicare se l'auto adjustment su varifilex 1 è attivo, sia per memorizzare lo speed dell'oFF09
		//Se il gruppo è micro, si usa il secondo caso, se il gruppo è vflex, si usa il primo
		if (da3.isGruppoMicro() && da3.isMachine_MultibonaEspresso())
		{
			rheaSetDisplayMode(rheaGetElemByID("pageDevices_grinderSpeedTest", "table-row"));
			rheaHideElem(rheaGetElemByID("pageDevices_vflex_v1AutoAdjust"));
			win.getChildByID("pageDevices_vflex_v1AutoAdjust").dontSaveToDa3();
		}
		else
		{
			rheaHideElem(rheaGetElemByID("pageDevices_grinderSpeedTest"));
			win.getChildByID("pageDevices_vflex_grnSpeedOff9").dontSaveToDa3();
		}
		
		if (da3.isInduzione())
			rheaHideElem(rheaGetElemByID("pageDevices_boilerSize"));
		
		rheaSetDivHTMLByName("pageDevices_vgrind1_lastPos_caption", da3.read16(7596));
		rheaSetDivHTMLByName("pageDevices_vgrind2_lastPos_caption", da3.read16(7660));
		pageDevices_vgrind_setLastFluxAndPos(pageDevices_vgrind_lastFlux, pageDevices_vgrind_lastPos);
	}

	currentTask = new TaskDevices();
	pageDevices_onSelector();
	pageDevices_onEnableAuto(1);
	pageDevices_onEnableAuto(2);
}


var pageDevices_whichPage = 0;
function pageDevices_onSelector()
{
	var elem0 = rheaGetElemByID("pageDevices_general");
	var elem1 = rheaGetElemByID("pageDevices_vflex");
	var elem2 = rheaGetElemByID("pageDevices_vgrind1");
	var elem3 = rheaGetElemByID("pageDevices_vgrind2");

	rheaHideElem(elem0);
	rheaHideElem(elem1);
	rheaHideElem(elem2);
	rheaHideElem(elem3);
	
	var win = ui.getWindowByID("pageDevices");
	pageDevices_whichPage = parseInt(pageDevices_selector.getSelectedOptionValue());
	switch (pageDevices_whichPage)
	{
		default: rheaShowElem(elem0); break;
		case 1:  rheaShowElem(elem1); break;
		case 2:  
			currentTask.enterQueryMacinePos(1);
			rheaShowElem(elem2); 
			break;
			
		case 3:  
			currentTask.enterQueryMacinePos(2);
			rheaShowElem(elem3); 
			break;
	}
	
	win.showHideScrollBar();
}



function pageDevices_vgrind_runSelection(whichVG)
{
	var win = ui.getWindowByID("pageDevices");
	var selNum = parseInt(win.getChildByID("pageDevices_vgrind" +whichVG +"_selNum").getValue())
	//vogliamo far partire la selezione [selNum].
	//Devo verificare che la granulometria di questa selezione sia DISABLED o REFERRING, altrimenti non
	//la si può utilizzare per calibrare la macchina dato che con granulemtria FINE o ROUGHLY la CPU apre/chiude di suo la macina
	var da3Loc = 175 + 100 * (selNum-1);
	var gran = da3.read8(da3Loc);
	if (gran == 0 || gran == 2)	
		currentTask.runSelection(selNum);
	else
	{
		currentTask.messageBox ("警告：您不能使用此选项，因为其研磨度为&quot;偏细&quot;或&quot;标准&quot;。<br><br><br>请选择研磨度为&quot;禁用&quot;或&quot;参考&quot;的选项（或编辑当前选择并更改研磨度参数）。"); //you can't use this selection..please choose another one
	}
}

function pageDevices_vgrind_runSelection_onFinish()
{
	//chiedo le info relativamente all'ultimo flusso e posizione
	rhea.ajax ("getLastFluxInfo", "").then( function(result)
	{
		var data = JSON.parse(result);
		pageDevices_vgrind_setLastFluxAndPos(data.flux, data.grinderPos);
		pageDevices_vgrind_runSelection_onFinish2();
	})
	.catch( function(result)
	{
		pageDevices_vgrind_runSelection_onFinish2();
	});	
}

function pageDevices_vgrind_runSelection_onFinish2()
{
	pleaseWait_hide();
	if (pageDevices_whichPage == 3)
		currentTask.enterQueryMacinePos(2);
	else
		currentTask.enterQueryMacinePos(1);
}

var pageDevices_vgrind_lastFlux = -1;
var pageDevices_vgrind_lastPos = -1
function pageDevices_vgrind_setLastFluxAndPos(flux, pos)
{
	pageDevices_vgrind_lastFlux = flux;
	pageDevices_vgrind_lastPos = pos;
	
	var elemBtnUse1 = rheaGetElemByID ("pageDevices_vgrind1_lastFlux_btnUse");
	var elemBtnUse2 = rheaGetElemByID ("pageDevices_vgrind2_lastFlux_btnUse");
	if (flux < 0)
	{
		var msg = "最后的流量/位置：<br>请点击<b>运行选择</ b>";
		rheaSetDivHTMLByName ("pageDevices_vgrind1_lastFlux_caption", msg);
		rheaSetDivHTMLByName ("pageDevices_vgrind2_lastFlux_caption", msg);
		rheaHideElem (elemBtnUse1);
		rheaHideElem (elemBtnUse2);
	}
	else
	{
		//flux è di 3 cifre, con due decimali
		var s = flux.toString();
		while (s.length < 3) s = "0" +s;
		s = s.substr(0,1) +"." +s.substr(1,2);
		var msg = "Last flux: " +s +"<br>Last pos: " +pos;
		rheaSetDivHTMLByName ("pageDevices_vgrind1_lastFlux_caption", msg);
		rheaSetDivHTMLByName ("pageDevices_vgrind2_lastFlux_caption", msg);
		rheaSetDisplayMode (elemBtnUse1, "table");
		rheaSetDisplayMode (elemBtnUse2, "table");
		
		rheaSetDivHTMLByName("pageExpCalib_lastFlux", s +" cc/sec");
	}
}

function pageDevices_vgrind_useLastFluxAndPos(whichVG)
{
	var win = ui.getWindowByID("pageDevices");

	win.getChildByID("pageDevices_vgrind" +whichVG +"_refFlux").setValue(pageDevices_vgrind_lastFlux);
	
	if (whichVG==1)
		da3.write16 (7596, pageDevices_vgrind_lastPos);
	else
		da3.write16 (7660, pageDevices_vgrind_lastPos);
	rheaSetDivHTMLByName("pageDevices_vgrind" +whichVG +"_lastPos_caption", pageDevices_vgrind_lastPos);
	
	//forzo un salvataggio dei dati
	save ( function() { pleaseWait_hide(); } );
}

function pageDevices_onEnableAuto(whichVG)
{
	if (da3.isGruppoMicro())
		return;
	var win = ui.getWindowByID("pageDevices");
	
	var tableName = "pageDevices_vgrind" +whichVG +"_params";
	var elemTable = rheaGetElemByID(tableName);
	
	var selectorName = "pageDevices_vgrind" +whichVG +"_selector";
	switch (parseInt(win.getChildByID(selectorName).getSelectedOptionValue()))
	{
		default: rheaHideElem(elemTable); break;
		case 1:  rheaSetDisplayMode(elemTable, "table"); break;
	}
	
	win.showHideScrollBar();
}

function pageDevices_setVGrind (macina1o2)
{
	var win = ui.getWindowByID("pageDevices");
	var target = 0;
	
	if (macina1o2 == 1)
		target = parseInt(win.getChildByID("pageDevices_vg1_target").getValue());
	else
		target = parseInt(win.getChildByID("pageDevices_vg2_target").getValue());
		
	//console.log ("pageDevices_setVGrind:: macina[" +macina1o2 +"] target[" +target +"]");
	
	currentTask.enterSetMacinaPos(macina1o2, target);
}

function pageDevices_startModemTest()					{ currentTask.runModemTest(); }
function pageDevices_startTestAssorbGruppo()			{ currentTask.runTestAssorbGruppo(); }
function pageDevices_startTestAssorbMotoriduttore()		{ currentTask.runTestAssorbMotoriduttore(); }
function pageDevices_startGrinderSpeedTest()			{ currentTask.runGrinderSpeedTest(1); }
/***************************************************************************
 *
 * pageDataAudit
 *
 */
var taskResetEVA = new TaskResetEVA();
var pageDA_secretBtnCounter = 0;
var pageDA_secretBtnLastTimeClickedMSec=0;
function pageDataAudit_show()
{
	if (showPage("pageDataAudit", "数据审核", 1,0))
	{
		pageDataAudit_downloadEVA();
		
		var node = document.getElementById("divSecretDAResetButton");		
		node.addEventListener("mousedown", function (ev)
		{
			var timeNowMSec = ev.timeStamp;
			if (timeNowMSec - pageDA_secretBtnLastTimeClickedMSec > 1000)
				pageDA_secretBtnCounter = 0;
			pageDA_secretBtnLastTimeClickedMSec = timeNowMSec;
			pageDA_secretBtnCounter++;
			console.log ("pageDA_secretBtnCounter[" +pageDA_secretBtnCounter +"]");
			if (pageDA_secretBtnCounter >= 6)
			{
				pageDA_secretBtnCounter=0;
				setTimeout (function(){pageDataAudit_showSecretDaResetButtonWindow();}, 100);
			}
		}, 
		true);
	}
	
	pageDataAudit_onSelector();
}

function pageDataAudit_showSecretDaResetButtonWindow()
{
	pleaseWait_show();
	currentTask = new TaskDAResetTotals();
}

function pageDataAudit_showSecretDaResetButtonWindow_finished()
{
	pleaseWait_hide();
	currentTask = voidTask;
}

function toCurrency (numberIN, numDecimali)
{
	var s = numberIN.toString();
	if (numDecimali == 0)
		return s;
		
	while (s.length < numDecimali)
		s = "0" +s;

	var n = s.length;
	if (n == numDecimali)
		return "0." +s;
		
	return s.substr(0, n-numDecimali) +"." +s.substr(n-numDecimali, numDecimali);
}

function formatInteger(x) { return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " "); }

function pageDataAudit_build_overview(numSelezioni, numDecimali, buffer, offset)
{
	var col = [];
	var html = "<table class='dataAudit' align='center'><tr valign='bottom'>"
				+"<th>&nbsp;</th>"
				+"<th colspan='2' align='center'>NUM PAID (VA1)</th>"
				+"<th colspan='2' align='center'>NUM FREEVEND (VA3)</th>"
				+"<th colspan='2' align='center'>NUM TESTVEND (VA2)</th>"
			+"</tr><tr valign='bottom'>"
				+"<th style='width:100px'>&nbsp;</th>"
				+"<th style='width:130px'>TOT</th>"
				+"<th style='width:130px'>PAR</th>"
				+"<th style='width:130px'>TOT</th>"
				+"<th style='width:130px'>PAR</th>"
				+"<th style='width:130px'>TOT</th>"
				+"<th style='width:130px'>PAR</th>"
			+"</tr>";

	//VA101/2/3
	var va101 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
	var va102 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
	var va103 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
	var va104 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;

	var va201 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
	var va202 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
	var va203 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
	var va204 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
	
	var va301 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
	var va302 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
	var va303 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
	var va304 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;

	html += "<tr>"
				+"<td>TOTALS</td>"
				+"<td>" +formatInteger(va102) +"</td>"
				+"<td>" +formatInteger(va104) +"</td>"
				+"<td>" +formatInteger(va302) +"</td>"
				+"<td>" +formatInteger(va304) +"</td>"
				+"<td>" +formatInteger(va202) +"</td>"
				+"<td>" +formatInteger(va204) +"</td>"
			+"</tr></table><br>";
				
				
				
	html += "<table class='dataAudit' align='center'><tr valign='bottom'>"
				+"<th>&nbsp;</th>"
				+"<th colspan='2' align='center'>NUM PAID (PA2)</th>"
				+"<th colspan='2' align='center'>NUM FREEVEND (PA4)</th>"
				+"<th colspan='2' align='center'>NUM TESTVEND (PA3)</th>"
			+"</tr><tr valign='bottom'>"
				+"<th style='width:100px'>SEL NUM</th>"
				+"<th style='width:130px'>TOT</th>"
				+"<th style='width:130px'>PAR</th>"
				+"<th style='width:130px'>TOT</th>"
				+"<th style='width:130px'>PAR</th>"
				+"<th style='width:130px'>TOT</th>"
				+"<th style='width:130px'>PAR</th>"
			+"</tr>";
			
	for (var i=0; i<numSelezioni; i++)
	{
		var selNum = (i+1).toString();
		if (selNum.length<2) selNum = "0"+selNum;
		
		var pa201 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		var pa202 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		var pa203 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		var pa204 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;		
		
		var pa301 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		var pa302 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		var pa303 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		var pa304 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;		

		var pa401 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		var pa402 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		var pa403 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		var pa404 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;		
		
		var rowCss="";
		if (pa201+pa203+ pa301+pa303 +pa401+pa403==0)
			rowCss = " class='rowAllZero'";		
		html += "<tr" +rowCss +">"
				+"<td>#" +selNum +"</td>"
				+"<td>" +formatInteger(pa201) +"</td>"
				+"<td>" +formatInteger(pa203) +"</td>"
				+"<td>" +formatInteger(pa401) +"</td>"
				+"<td>" +formatInteger(pa403) +"</td>"
				+"<td>" +formatInteger(pa301) +"</td>"
				+"<td>" +formatInteger(pa303) +"</td>"
			+"</tr>";
	}
	html += "</table>";
	
	rheaSetDivHTMLByName("pageDataAudit_o", html);
}

function pageDataAudit_build_fromBuffer(numSelezioni, numDecimali, buffer, offset)
{
	var htmlTable = "<table class='dataAudit' align='center'><tr valign='bottom'>"
				+"<th>SEL<br>NUM</th>"
				+"<th>NUM PAID<br>PRICE1</th>"
				+"<th>NUM PAID<br>HAPPY</th>"
				+"<th>NUM<br>FREEVEND</th>"
				+"<th>NUM<br>TESTVEND</th>"
				+"<th>NUM TOTAL</th>"
				+"<td style='width:100px'>&nbsp;</td>"
				+"<th>MONEY<br>PRICE1</th>"
				+"<th>MONEY<br>PRICE2</th>"
				+"<th>MONEY TOTAL</th>"
				+"</tr>";
	
	var html = "";	
	var rowSum = [0,0,0,0,0,0,0,0,0,0,0,0];
	for (var i=0; i<numSelezioni; i++)
	{
		var selNum = (i+1).toString();
		if (selNum.length<2) selNum = "0"+selNum;
		
		var col = [];
		col[0] = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		col[1] = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		col[2] = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		col[3] = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		col[4] = col[0] +col[1] +col[2] +col[3];
		col[5] = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		col[6] = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		col[7] = col[5] +col[6];
		
		for (var i2=0; i2<=7;i2++)
			rowSum[i2] += col[i2];
			
		var rowCss="";
		if (parseFloat(col[4]) == 0 && parseFloat(col[7]) == 0)
			rowCss = " class='rowAllZero'";
		html += "<tr" +rowCss +">"
					+"<td>#" +selNum +"</td>"
					+"<td>" +formatInteger(col[0]) +"</td>"
					+"<td>" +formatInteger(col[1]) +"</td>"
					+"<td>" +formatInteger(col[2]) +"</td>"
					+"<td>" +formatInteger(col[3]) +"</td>"
					+"<td><b>" +formatInteger(col[4]) +"</b></td>"
					+"<td></td>"
					+"<td>" +toCurrency(col[5], numDecimali) +"</td>"
					+"<td>" +toCurrency(col[6], numDecimali) +"</td>"
					+"<td><b>" +toCurrency(col[7], numDecimali) +"</b></td>"
				+"</tr>";
	}

	//totali di riga
	var htmlTotali = "<tr class='rowTot'>"
				+"<td>TOTALS</td>"
				+"<td>" +formatInteger(rowSum[0]) +"</td>"
				+"<td>" +formatInteger(rowSum[1]) +"</td>"
				+"<td>" +formatInteger(rowSum[2]) +"</td>"
				+"<td>" +formatInteger(rowSum[3]) +"</td>"
				+"<td><b>" +formatInteger(rowSum[4]) +"</b></td>"
				+"<td></td>"
				+"<td>" +toCurrency(rowSum[5], numDecimali) +"</td>"
				+"<td>" +toCurrency(rowSum[6], numDecimali) +"</td>"
				+"<td><b>" +toCurrency(rowSum[7], numDecimali) +"</b></td>"
			+"</tr>";
	
	return htmlTable + htmlTotali +html +"</table>";
}

function pageDataAudit_build_partial(numSelezioni, numDecimali, buffer, offset)		{ rheaSetDivHTMLByName("pageDataAudit_p", pageDataAudit_build_fromBuffer(numSelezioni, numDecimali, buffer, offset)); }
function pageDataAudit_build_total(numSelezioni, numDecimali, buffer, offset)		{ rheaSetDivHTMLByName("pageDataAudit_t", pageDataAudit_build_fromBuffer(numSelezioni, numDecimali, buffer, offset)); }
function  pageDataAudit_onSelector()
{
	var elemO = rheaGetElemByID("pageDataAudit_o");
	var elemP = rheaGetElemByID("pageDataAudit_p");
	var elemT = rheaGetElemByID("pageDataAudit_t");
	var elemR = rheaGetElemByID("pageDataAudit_r");
	
	rheaHideElem(elemO);
	rheaHideElem(elemP);
	rheaHideElem(elemT);
	rheaHideElem(elemR);
	
	var win = ui.getWindowByID("pageDataAudit");
	switch (parseInt(win.getChildByID("pageDataAudit_selector").getSelectedOptionValue()))
	{
		case 0: rheaShowElem(elemO); break;
		case 1: rheaShowElem(elemP); break;
		case 2: rheaShowElem(elemT); break;
		case 3: rheaShowElem(elemR); break;
	}
	win.showHideScrollBar();
}

function pageDataAudit_resetPartialData()
{
	pleaseWait_show();
	pleaseWait_btn1_setText("YES, do reset partial data");
	pleaseWait_btn1_show();

	pleaseWait_btn2_setText("NO, do NOT reset partial data");
	pleaseWait_btn2_show();

	pleaseWait_freeText_setText ("You're about to reset partial EVA-DTS data.<br><br>Do you confirm?");
	pleaseWait_freeText_show();
	currentTask = taskResetEVA;
}


function pageDataAudit_downloadEVA()
{
	pleaseWait_show();
	rheaSetDivHTMLByName("pageDataAudit_o", "");
	rheaSetDivHTMLByName("pageDataAudit_t", "");
	rheaSetDivHTMLByName("pageDataAudit_p", "");

	currentTask = new TaskDataAudit();
}

function pageDataAudit_downloadEVA_onFinish()
{
	if (currentTask.bufferSize != 0)
	{
		//download riuscito
		//console.log (currentTask.buffer);
		
		rheaSetDivHTMLByName("pageDataAudit_lastDownload", "EVA-DTS, last downloaded on " +dataOra_getYYYYMMDD() +" " +dataOra_getHHMM(":"));
		
		var numSelezioni = parseInt(currentTask.buffer[1]);
		var numDecimali  = parseInt(currentTask.buffer[2]);
		var addrBloccoGeneral = rheaReadU32FromUint8Buffer(currentTask.buffer, 4);
		var addrBloccoPartial = rheaReadU32FromUint8Buffer(currentTask.buffer, 8);
		var addrBloccoTotal = rheaReadU32FromUint8Buffer(currentTask.buffer, 12);
		
		
		pageDataAudit_build_overview(numSelezioni, numDecimali, currentTask.buffer, addrBloccoGeneral);;
		pageDataAudit_build_partial (numSelezioni, numDecimali, currentTask.buffer, addrBloccoPartial);
		pageDataAudit_build_total (numSelezioni, numDecimali, currentTask.buffer, addrBloccoTotal);

		var win = ui.getWindowByID("pageDataAudit");
		win.getChildByID("pageDataAudit_selector").selectOptionByValue(0);
		pageDataAudit_onSelector();
	}
	
	pleaseWait_hide();
	currentTask = voidTask;
}

/***************************************************************************
 *
 * pageExpCalib
 *
 */
var taskEspressoCalib = null;
var pageExpCalib_macina1o2 = 1;
function pageExpCalib_show()
{
	if (showPage("pageExpCalib", "浓缩咖啡校准", 1,0))
	{
		//è la prima volta che visualizziamo la pagina
		if (da3.isGruppoMicro())
		{
			rheaHideElem(rheaGetElemByID("pageExpCalib_rowvarigrind"));
			rheaHideElem(rheaGetElemByID("pageExpCalib_rowimpulsi"));
			rheaHideElem(rheaGetElemByID("pagePleaseWait_calibration_1_varigrind"));
		}
	}
	btnTestSelection_hide();

	if (null == taskEspressoCalib)
		taskEspressoCalib = new TaskEspressoCalib();
	currentTask = taskEspressoCalib;
	currentTask.setMacina(pageExpCalib_macina1o2);
	pageExpCalib_refreshCalibValueOnScreen();
}

function pageExpCalib_regolaVG()
{
	var win = ui.getWindowByID("pageExpCalib");
	var target = parseInt(win.getChildByID("pageExpCalib_vg_target").getValue());
	
	if (da3.isVarigrindAutoRegolationEnabled(currentTask.macina1o2))
	{
		currentTask.messageBox("您无法更改当前研磨器位置，因为已启用研磨器自动调节功能。<br>请转到“设备&quot;>&quot;研磨器&quot;并将其禁用");
	}
	else
		currentTask.enterSetMacinaPos(target);
}

function pageExpCalib_editSelection()
{
	currentTask = voidTask;
	pleaseWait_show();
	var win = ui.getWindowByID("pageExpCalib");
	var selNum = parseInt(win.getChildByID("pageExpCalib_selNum").getValue())
	pageSingleSelection_show(selNum);
	btnBack_setCallback("pageExpCalib_show()");
}

function pageExpCalib_runSelection()
{
	var win = ui.getWindowByID("pageExpCalib");
	var selNum = parseInt(win.getChildByID("pageExpCalib_selNum").getValue());
	
	//vogliamo far partire la selezione [selNum].
	//Devo verificare che la granulometria di questa selezione sia DISABLED o REFERRING, altrimenti non
	//la si può utilizzare per calibrare la macchina dato che con granulemtria FINE o ROUGHLY la CPU apre/chiude di suo la macina
	var da3Loc = 175 + 100 * (selNum-1);
	var gran = da3.read8(da3Loc);
	if (gran == 0 || gran == 2)	
		currentTask.runSelection(selNum);
	else
	{
		currentTask.messageBox ("警告：您不能使用此选项，因为其研磨度为&quot;偏细&quot;或&quot;标准&quot;。<br><br><br>请选择研磨度为&quot;禁用&quot;或&quot;参考&quot;的选项（或编辑当前选择并更改研磨度参数）。"); //you can't use this selection..please choose another one
	}
}

function pageExpCalib_runSelection_onFinish()
{
	//chiedo le info relativamente all'ultimo flusso e posizione
	rhea.ajax ("getLastFluxInfo", "").then( function(result)
	{
		var data = JSON.parse(result);
		pageDevices_vgrind_setLastFluxAndPos(data.flux, data.grinderPos);
		pageExpCalib_runSelection_onFinish2();
	})
	.catch( function(result)
	{
		pageExpCalib_runSelection_onFinish2();
	});	
}

function pageExpCalib_runSelection_onFinish2()
{
	pleaseWait_hide();
	currentTask.enterQueryMacinePos();
}

function pageExpCalib_resetMacinaCalib()
{
	pleaseWait_show();
	var motor = 10 + currentTask.macina1o2;
	rhea.ajax ("setFattoreCalib", { "m":motor, "v":0}).then( function(result)
	{
		rheaSetDivHTMLByName("pageExpCalib_grSec", "0&nbsp;gr/sec");
		da3.setCalibFactorGSec(motor, 0);
		da3.setImpulsi(motor,0);
		rheaSetDivHTMLByName("pageExpCalib_imp", "0.00 imp/gr");
		
		setTimeout ( function() { save (function() { pleaseWait_hide();}); }, 1000);
	})
	.catch( function(result)
	{
		pleaseWait_hide();
	});
}

function pageExpCalib_startMacinaCalib ()
{
	pleaseWait_show();
	var macina = currentTask.macina1o2;
	currentTask = taskCalibMotor;
	
	var bAlsoCalcImpulses = 1;
	if (da3.isGruppoMicro())
		bAlsoCalcImpulses = 0;
	taskCalibMotor.startCalibrazioneMacina(macina, bAlsoCalcImpulses);
}

function pageExpCalib_onFinish ()
{
	save (function() { currentTask = taskEspressoCalib; pageExpCalib_refreshCalibValueOnScreen(); pleaseWait_hide();});
}

function pageExpCalib_refreshCalibValueOnScreen()
{
	//macina 1
	var motor = 10 + currentTask.macina1o2;
	
	var v = helper_intToFixedOnePointDecimal( da3.getCalibFactorGSec(motor) );
	rheaSetDivHTMLByName("pageExpCalib_grSec", v +"&nbsp;gr/sec");
	
	v = helper_decodeImpulsi(da3.getImpulsi(motor));
	rheaSetDivHTMLByName("pageExpCalib_imp", v +"&nbsp;imp/gr");
	
	if (da3.isVarigrindAutoRegolationEnabled(currentTask.macina1o2))
		rheaSetDivHTMLByName("pageExpCalib_vgAutoAjustEnabled", "自动调节已&quot;启用&quot;");
	else
		rheaSetDivHTMLByName("pageExpCalib_vgAutoAjustEnabled", "自动调节已&quot;禁用&quot;");
	
}

function pageExpCalib_onChangeGrinder()
{
	pleaseWait_show();
	var win = ui.getWindowByID("pageExpCalib");
	switch (parseInt(win.getChildByID("pageExpCalib_macina1o2").getSelectedOptionValue()))
	{
		case 2: pageExpCalib_macina1o2=2; break;
		default: pageExpCalib_macina1o2=1; break;
	}
	rheaSetDivHTMLByName("pageExpCalib_vgCurPos", "");
	win.getChildByID("pageExpCalib_vg_target").setValue(0);
	
	setTimeout ( function() {pageExpCalib_show();}, 200);
}
</script>
</html>
