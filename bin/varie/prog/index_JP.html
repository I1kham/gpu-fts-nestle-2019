<html>
<head>
	<title>PROGRAMMING MENU</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link href="style.css" rel="stylesheet" type="text/css">
</head>

<body onLoad="rheaBootstrap()">
<div class="wrapper1024x600">
	<div id="pagePinCode">
		<div style="margin:10px auto 0 auto; display:inline-block">
			<div id="pagePinCodeDisplay"></div>
			<div class="pagePinCodeButton" onclick="pagePinCode_onBtnPress(1)">1</div>
			<div class="pagePinCodeButton" onclick="pagePinCode_onBtnPress(2)">2</div>
			<div class="pagePinCodeButton" onclick="pagePinCode_onBtnPress(3)">3</div>
			<div class="clear"></div>
			<div class="pagePinCodeButton" onclick="pagePinCode_onBtnPress(4)">4</div>
			<div class="pagePinCodeButton" onclick="pagePinCode_onBtnPress(5)">5</div>
			<div class="pagePinCodeButton" onclick="pagePinCode_onBtnPress(6)">6</div>
			<div class="clear"></div>
			<div class="pagePinCodeButton" onclick="pagePinCode_onBtnPress(7)">7</div>
			<div class="pagePinCodeButton" onclick="pagePinCode_onBtnPress(8)">8</div>
			<div class="pagePinCodeButton" onclick="pagePinCode_onBtnPress(9)">9</div>
			<div class="clear"></div>
		</div>
	</div>
	
	
	<!-- modal "are you sure" -->
	<div id="divAreYouSure" class="pagePleaseWait" style="background-color:rgba(0,0,0,0.95)">
		<div class="page">
			<br><br><center>選択した操作を起動してよろしいですか？</center>

			<div style="position:absolute; top:450px; left:680px;"><div class="UIButton bigButton3x4" onclick="areYouSure_onBtnYES()"><p>はい</p></div></div>
			<div style="position:absolute; top:450px; left:20px;"><div class="UIButton bigButton3x4" onclick="areYouSure_onBtnNO()"><p>ナンバー</p></div></div>
		</div>
	</div> <!-- modal "are you sure" -->
	
	<div id="pagePleaseWait" class="pagePleaseWait">
		<div id="pagePleaseWait_header_left" class="pagePleaseWait_header_left"></div>
		<div id="pagePleaseWait_header_right" class="pagePleaseWait_header_right"></div>
		<div class="clear"></div>

		<!-- pagina dedicata al lavaggio capp induzione. E' un riepilogo delle operazioni da fare prima di far partire il lavaggio -->
		<div id="pagePleaseWait_milkerInduxWashing" style="display:none; position:absolute; top:0; left:0; width:100%; height:100%; background-color:rgb(58,29,12); overflow:hidden;">
			<div style="width:94%; margin:20px auto auto auto; position:relative">
				<table border='0' cellspacing='0' align="center" style="width:930px">
					<tr valign="top">
						<td>
							<h2>ミルカーワンタッチクリーニング</h2>
							清掃を開始する前に確認してください。<OL> <LI>給水が利用可能です</ LI> <LI>廃棄物タンクは空</ LI> <Li>ミルクチューブがクリーニングジャグ内にあります</ li> < Li>洗剤は容器に充填されています</ li> </ OL>
						</td>
						<td style="width:310px; text-align:center;:center"><img src="img/milkerInduxClean01.jpg" style="width:260px"></td>
					</tr>
				</table>
				<table border='0' cellspacing='0' align="center" style="width:930px">
					<tr valign="top">
						<td style="width:310px; text-align:center;:center"><img src="img/milkerInduxClean02.jpg" style="width:260px"></td>
						<td style="width:310px; text-align:center;:center"><img src="img/milkerInduxClean03.jpg" style="width:260px"></td>
						<td style="width:310px; text-align:center;:center"><img src="img/milkerInduxClean04.jpg" style="width:260px"></td>
					</tr>
				</table>
			</div>
		</div>				
		
		<!-- page please wait -->
		<div class="page">
			<div id="pagePleaseWait_wait" style="position:absolute; top:150px; left:462px"><img draggable='false' src="img/animationRound.gif"></div>
			
			<div id="pagePleaseWait_freeText" class="pagePleaseWait_freeText"></div>
			
			<div id="pagePleaseWait_calibration" style="position:absolute; top:40px; left:10px; width:984px; height:500px; background-color:rgba(40,40,40,0.7); color:#fff; display:none; padding:10px; border:solid 1px #fff; border-radius:10px;">
				<div id="pagePleaseWait_calibration_1">
					<table border='0' cellspacing='0' cellpadding='0'>
						<tr valign="middle">
							<td>もう一度押すと挽けます</td>
							<td>&nbsp;&nbsp;</td>
							<td><div id='pagePleaseWait_calibration_1_grind' class='UIButton bigButton60 actionButton' data-caption='GRIND AGAIN' data-onclick="pageCalibration_grindAgain()"></div></td>
						</tr>
					</table>
					<hr>

					<div id="pagePleaseWait_calibration_1_varigrind">
						Varigrindの挽き目調整
						<table border='0' class='elenco'>
							<tr>
								<td style="width:33%" align="center">
									ポジション<br>
									<div style="float:left; margin-right:10px">現在の価値:</div>
									<div id="pagePleaseWait_calibration_1_vg" style="float:left" class="bigCaption15">000</div>
									<div class="clear"></div>
								</td>
								<td style="width:34%" align="center">
									<div style="float:left; margin-right:10px"><br>希望する値</div>
									<div style="float:left;"><div class="UINumber" id="pagePleaseWait_calibration_1_vg_target" data-numfigures="3" data-max="500"></div></div>
									<div class="clear"></div>
								</td>
								<td style="width:33%" align="center"><div id='pagePleaseWait_calibration_1_vg_set' class='UIButton bigButton60 actionButton' data-caption='SET' data-onclick="pageCalibration_setVGrind()"></div></td>
							</tr>
						</table>
						<br>
					</div>
				</div>
				
				<div id="pagePleaseWait_calibration_2">
					<table border='0' cellspacing='0' cellpadding='0'>
						<tr valign="middle">
							<td>もう一度押すと挽けます</td>
							<td>&nbsp;&nbsp;</td>
							<td><div id='pagePleaseWait_calibration_2_runMotor' class='UIButton bigButton60 actionButton' data-caption='RUN MOTOR AGAIN' data-onclick="pageCalibration_runMotorAgain()"></div></td>
						</tr>
					</table>
					<hr>
				</div>
				<div id="pagePleaseWait_calibration_text"></div>
				<div class="UINumber" id="pagePleaseWait_calibration_num" data-numfigures="4" data-decimal="1" data-max="9999" data-um="gr"></div>
			</div>
			
			<div id="pagePleaseWait_grinderCleaning" style="display:none; position:absolute; top:80px; left:20px; width:1006;">
			   クリーニングするグラインダーを選択し、[続行]or[キャンセル]を押してください.<br>
				<div id="pagePleaseWait_grinderCleaning_1or2" class="UIOption" data-option="1|グラインダー 1|2|グラインダー 2"></div></td>
			</div>
			
			<div id="pagePleaseWait_freeBtn1" style="position:absolute; top:450px; left:680px; display:none">
				<div id="bntFree1" class="UIButton bigButton3x4"><p id="bntFree1Text">testo bottone 1</p></div>
			</div>
			<div id="pagePleaseWait_freeBtn2" style="position:absolute; top:450px; left:20px; display:none">
				<div id="bntFree2" class="UIButton bigButton3x4"><p id="bntFree2Text">testo bottone 2 bottone 2</p></div>
			</div>

			<div id="pagePleaseWait_freeBtnTrick" style="position:absolute; right:10px; top:50px; width:100px; height:80px; background-color:rgba(40,40,40,0.7);">&nbsp;&nbsp;&nbsp;&nbsp;</div>
			
		</div>
	</div>
	
	<div id="UISelectFullPage">
		<div id="UISelectFullPage_cnt" style="padding:10px"></div>
		<div style="position:absolute; top:5px; right:5px"><img src="img/close32x32.png" style="width:48px" draggable='false' onmousedown="javascript:UISelect_hideFullPage()"></div>
	</div>
			
	<!-- header -->
	<div class="header">
		<div id="divHeaderC" class="header_C"></div>
		<div class="header_R colorGrey">
			<div id="divHeaderR_data" style="float:left; margin-right:10px"></div>
			<div id="divHeaderR_ora" style="float:left;"></div>
			<div class="clear"></div>
		</div>
		<div class="clear"></div>
		
		<div id="divCurLang" style="position:absolute; top:0; left:0; width:150px; height:46px; z-index:50;" onclick="menuLang_show(1)">
			<div style="padding-left:15px"><img src="img/flags/JP.png"></div>
		</div>
	</div> <!-- header -->
	
	<div id="divMenuLang">
		<div style="padding:10px">
			<div style="float:left; width:49%">
				<ul>
					<li onmousedown="menuLang_onUserSelected('GB')"><img src="img/flags/GB.png"> ENGLISH</li>
					<li onmousedown="menuLang_onUserSelected('IT')"><img src="img/flags/IT.png"> ITALIANO</li>
					<li onmousedown="menuLang_onUserSelected('FR')"><img src="img/flags/FR.png"> FRANÇAIS</li>
					<li onmousedown="menuLang_onUserSelected('DE')"><img src="img/flags/DE.png"> DEUTSCH</li>
					<li onmousedown="menuLang_onUserSelected('ES')"><img src="img/flags/ES.png"> ESPAÑOL</li>
					<li onmousedown="menuLang_onUserSelected('PT')"><img src="img/flags/PT.png"> PORTUGUÉS</li>
					
				</ul>
			</div>
			<div style="float:right; width:49%">
				<ul>
					<li onmousedown="menuLang_onUserSelected('CN')"><img src="img/flags/CN.png"> 中文</li>
					<li onmousedown="menuLang_onUserSelected('RU')"><img src="img/flags/RU.png"> РУССКИЙ</li>
					<li onmousedown="menuLang_onUserSelected('RO')"><img src="img/flags/RO.png"> ROMÂNĂ</li>

					<li onmousedown="menuLang_onUserSelected('NL')"><img src="img/flags/NL.png"> NEDERLANDS</li>
					<li onmousedown="menuLang_onUserSelected('PL')"><img src="img/flags/PL.png"> POLSKIE</li>
					<li onmousedown="menuLang_onUserSelected('JP')"><img src="img/flags/JP.png"> 日本</li>
				</ul>
			</div>
			<div class="clear"></div>
		</div>
		<div style="position:absolute; top:5px; right:5px"><img src="img/close32x32.png" style="width:48px" draggable='false' onmousedown="menuLang_show(0)"></div>
	</div>
	

	<div id="divPage" class="page">
		<!--- page Main Menu -->
		<div id="pageMainMenu" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' cellspacing='0' cellpadding='0' width='99%' align='center'>
					<tr valign="middle">
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="メンテナンス" data-onclick="pageMaintenance_show()"></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="クリーニング/ <br>リンス" data-onclick="pageCleaning_show()"></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="データー　オーデット" data-onclick="pageDataAudit_show(1)"></div></td>
					</tr>
					<tr valign="middle">
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="メニューボタン設定" data-onclick="pageSelections_show()"></div></td>
						<td width="33%" align="center"><div id="pageMainMenu_btnEspressoCalib" class="UIButton bigButton3x4 UIdisabled" data-caption="コーヒーキャリブレーション" data-onclick="pageExpCalib_show()"></div></td>
						<td width="33%" align="center"><div id="pageMainMenu_btnInstantCalib" class="UIButton bigButton3x4" data-caption="パウダー<br>キャリブレーション" data-onclick="pageCalibration_show()"></div></td>
					</tr>
					<tr valign="middle">
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="温度" data-onclick="pageTemperature_show()"></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="ペイメントシステム" data-onclick="pagePayment_show()"></div></td>
						<td width="33%" align="center"><div id="pageMainMenu_btnProdQty" class="UIButton bigButton3x4" data-caption="製品数量設定" data-onclick="pageProductQty_show()"></div></td>
					</tr>
					<tr valign="middle">
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="デバイス" data-onclick="pageDevices_show()"></div></td>						
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="時計" data-onclick="pageClock_show()"></div></td>
						<td width="33%" align="center"><div id="pageMainMenu_btnMilker" class="UIButton bigButton3x4 UIdisabled" data-caption="ミルカー" data-onclick="pageMilker_show()"></div></td>
					</tr>
					<tr valign="middle">
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="その他" data-onclick="pageMiscellaneous_show()"></div></td>

						<td width="33%" align="center"><div id="divBtnManual" style="display:none"><div class="UIButton bigButton3x4" data-caption="マニュアル" data-onclick="manualViewBox_show()"></div></div></td>
						<td width="33%" align="center"><div class="UIButton bigButton3x4" data-caption="旧Progメニュー" data-onclick="pageMiscellaneous_oldProgMenu()"></div></td>
					</tr>
				</table>
			</div>
		</div><!--- page Main Menu -->
		
		<!-- page Maintenance -->
		<div id="pageMaintenance" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' width='100%'>
					<tr valign='middle'>
						<td><div class='UIOptionSmall' id='pageMaintenance_selector' data-option='0|ゼネラルオプション|1|インストール|2|エラーリスト' data-onclick='pageMaintenance_onSelector()'></div></td>
					</tr>
				</table>
				<br>

				<div id="pageMaintenance_gs" style="display:none">
					<table border='0' class='elenco'>
						<tr>
							<td style="width:380px">アクティベートH <sub> 2 </ sub> 0フィルターリセット</td>
							<td colspan="2"><div class="UIOption" data-option="1|はい|0|ナンバー" data-da3="7090"></div></td>
						</tr>
						
						<tr>
							<td>
								ウォーターフィルターカウンター<br>
								<div style="float:left; margin-right:10px">現在の価値:</div>
								<div id="pageMaintenance_11" style="float:left" class="bigCaption15">00000</div>
								<div class="clear"></div>
							</td>
							<td><div class="UINumber" id="pageMaintenance_11_cap" data-numfigures="5" data-da3="7394" data-max="60000" data-forbidden="1"></div></td>
							<td align="right"><div class='UIButton bigButton60 actionButton' data-caption='リセット' data-onclick="pageMaintenance_resetDec(11)"></div></td>
						</tr>
						<tr id="pageMaintenance_decCofBrew">
							<td>
								抽出ユニット カウンター<br>
								<div style="float:left; margin-right:10px">現在の価値:</div>
								<div id="pageMaintenance_12" style="float:left" class="bigCaption15">0000</div>
								<div class="clear"></div>
							</td>
							<td><div class="UINumber" id="pageMaintenance_12_cap" data-numfigures="4" data-da3="7396" data-max="1000"></div></td>
							<td align="right"><div class='UIButton bigButton60 actionButton' data-caption='リセット' data-onclick="pageMaintenance_resetDec(12)"></div></td>
						</tr>
						<tr id="pageMaintenance_decCofGround">
							<td>
								グラインダー カウンター<br>
								<div style="float:left; margin-right:10px">現在の価値:</div>
								<div id="pageMaintenance_13" style="float:left" class="bigCaption15">0000</div>
								<div class="clear"></div>
							</td>
							<td><div class="UINumber" id="pageMaintenance_13_cap" data-numfigures="4" data-da3="7398" data-max="1000"></div></td>
							<td align="right"><div class='UIButton bigButton60 actionButton' data-caption='リセット' data-onclick="pageMaintenance_resetDec(13)"></div></td>
						</tr>
						<tr>
							<td>
								メンテナンスリセット<br>
								<div style="float:left; margin-right:10px">現在の価値:</div>
								<div id="pageMaintenance_15" style="float:left" class="bigCaption15">0000</div>
								<div class="clear"></div>
							</td>
							<td>
								<div style="float:left">
									<div class="UINumber" id="pageMaintenance_15_cap" data-numfigures="3" data-da3="7406" data-da3Scale="100" data-max="650" data-um=""></div>
								</div>
								<div style="float:left; font-size:2.9em; color:#fff; letter-spacing:7px">000</div>
								<div class="clear"></div>
							</td>
							<td align="right"><div class='UIButton bigButton60 actionButton' data-caption='リセット' data-onclick="pageMaintenance_resetDec(15)"></div></td>
						</tr>						

						<tr>
							<td>
								メンテナンスリセット<br>閾値<br>
							</td>
							<td colspan="2">
								<div style="float:left">
									<div class="UINumber" data-numfigures="3" data-da3="7408" data-da3Scale="100" data-max="650"></div>
								</div>
								<div style="float:left; font-size:2.9em; color:#fff; letter-spacing:7px">000</div>
								<div class="clear"></div>
							</td>
						</tr>						
						
						<tr style="border:none">
							<td>表示温度<br><span class="tip">CPUメッセージ</span></td>
							<td colspan="2"><div class="UIOption" data-option="1|はい|0|ナンバー" data-da3="7112"></div></td>
						</tr>
						<tr style="height:30px;">
							<td></td>
							<td colspan="2">
								<div id="pageMaintenance_temperature" class="tip"></div>
							</td>
						</tr>

						<tr>
							<td>電圧</td>
							<td colspan="2"><div id="pageMaintenance_volt" class="bigCaption15"></div></td>
						</tr>						
					</table>
				</div>
				
				<div id="pageMaintenance_inst" style="display:none">
					<table border='0' class='elenco'>
						<tr id="pageMaintenance_rowDis">
							<td>アンインストール</td>
							<td colspan="2" align="center"><div class='UIButton bigButton60 actionButton' style='width:450px' data-caption='アンインストール開始' data-onclick="pageMaintenance_disinstall()"></div></td>
						</tr>					
						<tr>
							<td>初期インストール</td>
							<td colspan="2"><div class="UIOption" data-option="0|はい|1|ナンバー" data-da3="7074"></div></td>
						</tr>
					</table>
				</div>
				
				<div id="pageMaintenance_off" style="display:none">
					<div id="pageMaintenance_off_content"></div>
				</div>
			</div>
		</div><!-- page Maintenance -->
		
		<!-- page Cleaning -->
		<div id="pageCleaning" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' cellspacing='0' cellpadding='0' width='99%' align='center'>
					<tr valign="middle">
                        <td width="33%" align="center"><div class="UIButton bigButton4x4 actionButton" data-caption="リンス開始" data-onclick="pageCleaning_action(160)"></div></td>
                        <td width="33%" align="center"><div id="pageCleaning_btnCleanHC" class="UIButton bigButton4x4 actionButton" data-caption="抽出ユニットの洗浄開始" data-onclick="pageCleaning_action(8)"></div></td>
                        <td width="33%" align="center"><div id="pageCleaning_btnCleanMilker" class="UIButton bigButton4x4 actionButton UIdisabled" data-caption="ミルクモジュールのクリーニングを開始します" data-onclick="pageCleaning_action(5)"></div></td>					
					</tr>
					<tr valign="middle">
						<td align="center"><div id="pageCleaning_btnCleanGrinder" class="UIButton bigButton4x4 actionButton" data-caption="クリーニングを開始する<br>グラインダー" data-onclick="pageGrinderCleaning_show()"></div></td>
						<td align="center"><div id="pageCleaning_btnDescaling" class="UIButton bigButton4x4 actionButton" data-caption="スケール除去開始" data-onclick="pageCleaning_action(161)"></div></td>
						<td></td>
					</tr>
				</table>
				<table border='0' cellspacing='0' cellpadding='0' width='99%' align='center'>
					<tr valign="middle">
						<td width="25%" align="center"><div id="pageCleaning_btnClean1" class="UIButton bigButton4x4 actionButton" data-caption="リンス1" data-onclick="pageCleaning_action(1)"></div></td>
						<td width="25%" align="center"><div id="pageCleaning_btnClean2" class="UIButton bigButton4x4 actionButton" data-caption="リンス2" data-onclick="pageCleaning_action(2)"></div></td>
						<td width="25%" align="center"><div id="pageCleaning_btnClean3" class="UIButton bigButton4x4 actionButton" data-caption="リンス3" data-onclick="pageCleaning_action(3)"></div></td>
						<td width="25%" align="center"><div id="pageCleaning_btnClean4" class="UIButton bigButton4x4 actionButton" data-caption="リンス4" data-onclick="pageCleaning_action(4)"></div></td>
					</tr>
				</table>
				
				<table border='0' class='elenco'>
					<tr style="border:0">
						<td style="width:300px">自動リンス時間<br><span class="tip">00:00は無効</span></td>
						<td><div class="UITime24" data-da3="7466"></div></td>
					</tr>	
				</table>
				
				<!--
				<table border='0' class='elenco' id='pageCleaning_tabDissolveTable'>
					<tr style="border:0">
						<td style="width:690px">タブレット熔解設定<br>
							<span class="tip">オートリンス（HC）中に「タブレット溶解」する時間を設定します。<br>デフォルト時間：000</span>
						</td>
						<td><div class="UINumber" data-numfigures="3" data-max="999" data-da3="7562" data-da3bit="16" data-um="sec"></div></td>
					</tr>	
				</table>
				-->
			</div>
		</div> <!-- page Cleaning -->
	
		<!-- page pageMiscellaneous -->
		<div id="pageMiscellaneous" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' width='100%'>
					<tr valign='middle'>
						<td><div class='UIOptionSmall' style='font-size:0.9em' id='pageMiscellaneous_selector' data-option='' data-onclick='pageMiscellaneous_onSelector()'></div></td>
					</tr>
				</table>
				<br>
				
				<div id="pageMiscellaneous_gs" style="display:none">
					<table border='0' class='elenco'>
						<tr>
							<td style="width:380px">メッセージナンバー</td>
							<td><div class="UINumber" data-numfigures="1" data-max="7" data-da3="7056" data-da3bit="8"></div></td>
						</tr>					
						<tr>
							<td>ファン時間</td>
							<td><div class="UINumber" data-numfigures="3" data-max="180" data-da3="7062" data-da3bit="8" data-um="min"></div></td>
						</tr>
						<tr>
							<td>ビープ時間</td>
							<td><div class="UINumber" data-numfigures="2" data-decimal='1' data-max="13" data-da3="7064" data-da3bit="8" data-um="sec"></div></td>
						</tr>
						<tr>
							<td>CPU言語</td>
							<td><div id='pageMiscellaneous_cpuLang' class='UISelect' data-option='0|lang 1|1|lang 2' data-da3='7068' data-da3bit='8'></div></td>
						</tr>
						<tr id="pageMiscellaneous_r1">
							<td>サイドウォーターポンプ</td>
							<td><div class="UINumber" data-numfigures="1" data-max="4" data-da3="8370" data-da3bit="8"></div></td>
						</tr>
						<tr id="pageMiscellaneous_r2">
							<td>シュガーキャニスター</td>
							<td><div class="UINumber" data-numfigures="1" data-max="6" data-da3="7086" data-da3bit="8"></div></td>
						</tr>			
						<tr id="pageMiscellaneous_fmilkTopping"><td>フォームミルクトッピングスイッチ</td><td><div class='UIOption' data-option='1|はい|0|ナンバー' data-da3='7096' data-da3bit='8'></div></td></tr>
						<tr>
							<td>前にデータ監査を有効にします</td>
							<td><div id="pageMiscellaneous_gs_auditBefore" class='UIOption' data-option='1|はい|0|ナンバー' data-da3='7106' data-da3bit='8'></div></td>
						</tr>
						<tr>
							<td>
								PROGメニューPINコード<br>
								<div style="float:left">current&nbsp;</div>
								<div id="pageMiscellaneous_curPIN" class="bigCaption25" style="float:left">000</div>
								<div class="clear"></div>
							</td>
							<td>
								<div style="float:left;">
									<div class='UIButton bigButton60 actionButton' data-caption='ピンコード　セット' data-onclick="pageMiscellaneous_askForNewPINCode()"></div>
								</div>
								<div style="float:right;">
									<div class='UIButton bigButton60 actionButton' data-caption='ピンコード　リセット' data-onclick="pageMiscellaneous_setPINCode('000')"></div>
								</div>
								<div class="clear"></div>
							</td>
						</td>
						<tr>
							<td>
								クイックメニューPINコード<br>
								<div style="float:left">current&nbsp;</div>
								<div id="pageMiscellaneous_curQuickPIN" class="bigCaption25" style="float:left">000</div>
								<div class="clear"></div>
							</td>
							<td>
								<div style="float:left;">
									<div class='UIButton bigButton60 actionButton' data-caption='ピンコード　セット' data-onclick="pageMiscellaneous_askForNewQuickPINCode()"></div>
								</div>
								<div style="float:right;">
									<div class='UIButton bigButton60 actionButton' data-caption='ピンコード　リセット' data-onclick="pageMiscellaneous_setQuickPINCode('000')"></div>
								</div>
								<div class="clear"></div>
							</td>						
							<td></td>
						</td>
 					</table>
				</div>
				
				<div id="pageMiscellaneous_mid" style="display:none">
					<table border='0' class='elenco'>
						<tr>
							<td style="width:380px">マシンコード A</td>
							<td><div class="UINumber" data-numfigures="5" data-max="65535" data-da3="7052" data-da3bit="16"></div></td>
						</tr>
						<tr>
							<td>マシンコード B</td>
							<td><div class="UINumber" data-numfigures="5" data-max="65535" data-da3="7054" data-da3bit="16"></div></td>
						</tr>
					</table>
				</div>
					
				<div id="pageMiscellaneous_lm" style="display:none">
					<table border='0' class='elenco'>
						<tr>
							<td style="width:380px">製品ミルクLM</td>
							<td><div class="UINumber" data-numfigures="1" data-max="6" data-da3="7082" data-da3bit="8"></div></td>
						</tr>
						<tr>
							<td>ミルクLMの水番号</td>
							<td><div class="UINumber" data-numfigures="1" data-max="3" data-da3="7084" data-da3bit="8"></div></td>
						</tr>
					</table>
				</div>
				
				<div id="pageMiscellaneous_fv" style="display:none">
					<table border='0' class='elenco'>
						<tr>
							<td style="width:380px">FVハードウェアキー<br>モード</td>
							<td colspan="2"><div id="pageMiscellaneous_fvHwKey" class='UIOption' data-option='0|無効|1|有効 1|2|有効 ++' data-da3="7104" data-da3bit="8"></div></td>
						</tr>
						<tr id="pageMiscellaneous_fv_r1">
							<td>FREEVENDを起動します<br><span class="tip">指定された<br> numを持続します。時間の数</span></td>
							<td align="center"><div id="pageMiscellaneous_fvH" class="UINumber" data-numfigures="3" data-max="255" data-um="時間"></div></td>
							<td align="right"><div class='UIButton actionButton' data-caption='開始' data-onclick="pageMiscellaneous_startFVNow()"></div></td>
						</tr>
						
						<tr id="pageMiscellaneous_fv_r2">
							<td>Freevendは<b style = 'color：#fff'>実行</ b></td>
							<td align="center"><div id="pageMiscellaneous_fvDateEnd"></div></td>
							<td align="right"><div class='UIButton actionButton' data-caption='STOP IT NOW' data-onclick="pageMiscellaneous_stopFVNow()"></div></td>
						</tr>
						
					</table>
				</div>

				<div id="pageMiscellaneous_blockingCt" style="display:none">
					<div id="pageMiscellaneous_blockingCt_pwd">
						<table border='0' class='elenco'>
							<tr>
								<td>ピンコードを挿入します</td>
								<td><div class="UINumber" id='pageMiscellaneous_pincode' data-numfigures="3" data-max="999"></div></td>
								<td><div class='UIButton actionButton' data-caption='&nbsp&nbsp&nbsp&nbsp;&nbsp;&nbsp;O&nbspK&nbsp;&nbsp;&nbsp;&nbsp&nbsp&nbsp' data-onclick="pageMiscellaneous_onPINCodeInserted()"></div></td>
							</tr>
						</table>
					</div>
					<div id="pageMiscellaneous_blockingCt_unblocked" style="display:none">
						<table border='0' class='elenco' style="table-layout: fixed">
							<tr>
								<td style="width:414px">カウンター<br>
									<div style="float:left; margin-right:10px">現在の価値:</div>
									<div id="pageMiscellaneous_blockingCt_unblocked_curct" style="float:left" class="bigCaption15">00000</div>
									<div class="clear"></div>
								</td>
								<td style="width:335px"><div class="UINumber" id="pageMiscellaneous_blockingCt_newValue" data-numfigures="5" data-max="10000" data-da3="7400" data-da3bit="16"></div></td>
								<td style="width:255px" align="right"><div class='UIButton bigButton60 actionButton' data-caption='リセット' data-onclick="pageMiscellaneous_blockingCounter_set()"></div></td>
							</tr>

							<tr>
								<td>後に警告する<br><span class="tip">（前の行に挿入された数に対して）指定された選択に達すると、マシンは警告を表示して、ブロックされます。</span></td>
								<td colspan="2"><div class="UINumber" data-numfigures="2" data-max="50" data-da3="7402" data-da3bit="16" data-um="%"></div></td>
							</tr>

							<tr>
								<td>ピンコード<br><span class="tip">PINコードの変更が可能です</span></td>
								<td colspan="2"><div class="UINumber" id='pageMiscellaneous_newpincode' data-numfigures="3" data-min="111" data-max="999" data-da3="7404" data-da3bit="16"></div></td>
							</tr>
						</table>
					</div>
				</div>
				
				<div id="pageMiscellaneous_advGrinder" style="display:none">
					<table border='0' class='elenco'>
						<tr class="smallHeightNoBorder">
							<th style="text-align:center">グラインダー</th>
							<th style="text-align:center">VIBRATION TIME</th>
							<th style="text-align:center">VIBRATION SPEED</th>
						</tr>
						<tr>
							<td style="text-align:center">1</td>
							<td style="text-align:center"><div class="UINumber" data-numfigures="3" data-max="255" data-da3bit="8" data-da3="8380" data-decimal="1" data-um="sec"></div></td>
							<td style="text-align:center"><div class="UINumber" data-numfigures="3" data-max="100" data-da3bit="8" data-da3="8382" data-um="%"></div></td>
						</tr>
						<tr>
							<td style="text-align:center">2</td>
							<td style="text-align:center"><div class="UINumber" data-numfigures="3" data-max="255" data-da3bit="8" data-da3="8384" data-decimal="1" data-um="sec"></div></td>
							<td style="text-align:center"><div class="UINumber" data-numfigures="3" data-max="100" data-da3bit="8" data-da3="8386" data-um="%"></div></td>
						</tr>
						<tr>
							<td style="text-align:center">3</td>
							<td style="text-align:center"><div class="UINumber" data-numfigures="3" data-max="255" data-da3bit="8" data-da3="8388" data-decimal="1" data-um="sec"></div></td>
							<td style="text-align:center"><div class="UINumber" data-numfigures="3" data-max="100" data-da3bit="8" data-da3="8390" data-um="%"></div></td>
						</tr>
						<tr>
							<td style="text-align:center">4</td>
							<td style="text-align:center"><div class="UINumber" data-numfigures="3" data-max="255" data-da3bit="8" data-da3="8392" data-decimal="1" data-um="sec"></div></td>
							<td style="text-align:center"><div class="UINumber" data-numfigures="3" data-max="100" data-da3bit="8" data-da3="8394" data-um="%"></div></td>
						</tr>						
					</table>						
				</div>
			</div>
		</div>	<!-- page pageMiscellaneous -->
		
		<!-- page pageClock -->
		<div id="pageClock" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' width='100%'>
					<tr valign='middle'>
						<td><div class='UIOptionSmall' id='pageClock_selector' data-option='0|時計|1|HAPPY HOUR|2|ENERGY SAVING' data-onclick='pageClock_onSelector()'></div></td>
					</tr>
				</table>
				<br>

				<div id="pageClock_clock" style="display:none">
					<table border='0' class='elenco'>
						<tr>
							<td>時間</td>
							<td colspan="3"><div class="UITime24" id="pageClock_time"></div></td>
							<td><div class='UIButton actionButton' data-caption='SET' data-onclick="pageClock_setTime()"></div></td>
						</tr>
						
						<tr>
							<td>日にち</td>
							<td><div id="pageClock_dd" class="UINumber" data-numfigures="2" data-max="31" data-min="1" data-um='日'></div></td>
							<td><div id="pageClock_mm" class="UINumber" data-numfigures="2" data-max="12" data-min="1" data-um='月'></div></td>
							<td><div id="pageClock_yy" class="UINumber" data-numfigures="4" data-max="2050" data-min="2017" data-um='年'></div></td>
							<td><div class='UIButton actionButton' data-caption='SET' data-onclick="pageClock_setDate()"></div></td>
						</tr>
						
						
						<tr style="border:0">
							<td>サマータイム</td>
							<td colspan="2"><div class="UIOption" data-option="1|はい|0|ナンバー" data-da3="7080"></div></td>
							<td colspan="2"></td>
						</tr>
					</table>
				</div>

				<div id="pageClock_happyHour" style="display:none">
					<table border='0' class='elenco'>
						<tr style="height:50px; vertical-align:bottom">
							<th style="width:232px; text-align:left">HAPPY HOUR</th>
							<th>START</th>
							<th>END</th>
						</tr>
						<tr>
							<td>HAPPY HOUR 1</td>
							<td align="center"><div class="UITime24" data-da3="7424"></div></td>
							<td align="center"><div class="UITime24" data-da3="7426"></div></td>
						</tr>
						<tr>
							<td>HAPPY HOUR 2</td>
							<td align="center"><div class="UITime24" data-da3="7428"></div></td>
							<td align="center"><div class="UITime24" data-da3="7430"></div></td>
						</tr>
						<tr style="border:0">
							<td>HAPPY HOUR 3</td>
							<td align="center"><div class="UITime24" data-da3="7432"></div></td>
							<td align="center"><div class="UITime24" data-da3="7434"></div></td>
						</tr>
					</table>
				</div>
				
				<div id="pageClock_energySave">
					<table border='0' class='elenco'>
						<tr style="height:50px; vertical-align:bottom">
							<th style="width:232px; text-align:left">ENERGY SAVING</th>
							<th>電源オン</th>
							<th>電源オフ</th>
						</tr>				
						<tr><td>月曜日</td><td align="center"><div class="UITime24" data-da3="7436"></div></td><td align="center"><div class="UITime24" data-da3="7438"></div></td></tr>					
						<tr><td>火曜日</td><td align="center"><div class="UITime24" 	data-da3="7440"></div></td><td align="center"><div class="UITime24" data-da3="7442"></div></td></tr>					
						<tr><td>水曜日</td><td align="center"><div class="UITime24" 	data-da3="7444"></div></td><td align="center"><div class="UITime24" data-da3="7446"></div></td></tr>					
						<tr><td>木曜日</td><td align="center"><div class="UITime24" 	data-da3="7448"></div></td><td align="center"><div class="UITime24" data-da3="7450"></div></td></tr>					
						<tr><td>金曜日</td><td align="center"><div class="UITime24" 	data-da3="7452"></div></td><td align="center"><div class="UITime24" data-da3="7454"></div></td></tr>					
						<tr><td>土曜日</td><td align="center"><div class="UITime24" 	data-da3="7456"></div></td><td align="center"><div class="UITime24" data-da3="7458"></div></td></tr>					
						<tr><td>日曜日</td><td align="center"><div class="UITime24" 	data-da3="7460"></div></td><td align="center"><div class="UITime24" data-da3="7462"></div></td></tr>					
					</table>
				</div>
			</div>
		</div>	<!-- page pageClock -->
		
		<!-- page productQty -->
		<div id="pageProductQty" class="UIWindow">
			<div class="UIWindowContent" id="pageProductQty_content">
				<!-- il contenuto di questa pagina lo credo dinamicamente perchè dipende da INSTANT o ESPRESSO (vedi pageProductQty_build) -->
			</div>
		</div><!-- page productQty -->
		
		
		<!-- page Milker -->
		<div id="pageMilker" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' class='elenco'>
					<tr style='height:30px; border-bottom:none'>
						<td style="width:424px">バージョン</td>
						<td style="width:150px">ステータス</td>
					</tr>
					<tr style='height:50px;'>
						<td><div id="pageMilker_ver" class="bigCaption15"></div></td>
						<td><div id="pageMilker_status" class="bigCaption15">接続されいるか無効になっています</div></td>
					</tr>
				</table>

				<table border='0' class='elenco'>
					<tr>
						<td>有効</td>
						<td><div id='pageMilker_enabled' class='UIOption' data-option='1|はい|0|ナンバー' data-onclick="pageMilker_onEnabledYesNo()"></div></td>
					</tr>
					<tr>
						<td>モデル</td>
						<td><div id='pageMilker_model' class='UISelect' data-option='0|なし|1|負圧|2|索引' data-da3="69" data-onchange="pageMilker_onMilkerTypeChange_fromUser()"></div></td>
					</tr>
				</table>
				
				<div id="pageMilker_params" style="display:none">
					<!-- parametri comuni a tutti i milker -->
					<table border='0' class='elenco'>
						<tr>
							<td style="width:400px">スチーム温度<br><span class="tip">max 128</span></td>
							<td><div class="UINumber" id="pageMilker_temperature" data-numfigures="3" data-max="128" data-da3="7618" data-da3bit="8"></div></td>
						</tr>
						<tr>
							<td>オートクリーニング時間</td>
							<td colspan="3"><div id="pageMilker_autoCleanAtTime" class="UITime24" data-da3="7468"></div></td>
						</tr>
						<tr>
							<td>自動更新時間</td>
							<td><div class="UIOption" data-option="1|はい|0|ナンバー" data-da3="7630"></div></td>
						</tr>
					</table>
				
					<!-- parametri relativi al capp venturi -->
					<div id="pageMilker_capp_venturi" style="margin-top:20px; display:none">
						<table border='0' class='elenco'>
							<tr>
								<td style="width:400px">クリーニング期間<br><span class="tip">max 900</span></td>
								<td><div id="pageMilker_capp_venturi_1" class="UINumber" data-numfigures="3" data-da3="7620" data-da3bit="16" data-max="900" data-um="min."></div></td>
							</tr>
							<tr>
								<td>清掃の有効</td>
								<td><div id="pageMilker_capp_venturi_2" class="UIOption" data-option="1|はい|0|ナンバー" data-da3="7622"></div></td>
							</tr>
							<tr>
								<td>クリーニングディレイ<br><span class="tip">max 10.0</span></td>
								<td><div id="pageMilker_capp_venturi_3" class="UINumber" data-numfigures="3" data-decimal='1' data-da3="7624"  data-da3bit="16" data-max="100" data-um="sec."></div></td>
							</tr>
							<tr>
								<td>ミルクセンサー</td>
								<td><div id="pageMilker_capp_venturi_4" class="UIOption" data-option="0|0|1|1|2|2|3|3" data-da3="7626"></div></td>
							</tr>
							<tr>
								<td>スタートアップで<br> <br>ボタンを表示します</td>
								<td><div id="pageMilker_capp_venturi_5" class="UIOption" data-option="1|はい|0|ナンバー" data-da3="7628"></div></td>
							</tr>
						</table>
					</div>
					
					<!-- parametri relativi al capp induzione -->
					<div id="pageMilker_capp_induzione" style="margin-top:20px; display:none">
						<table border='0' class='elenco'>
							<tr>
								<td style="width:410px">排水タンクがセットされてません<br><span class="tip">max 900</span></td>
								<td><div id="pageMilker_capp_indux_1" class="UINumber" data-numfigures="3" data-da3="7620" data-da3bit="16" data-max="900" data-um="min."></div></td>
							</tr>
							<tr>
								<td>伝導センサーが有効</td>
								<td><div id="pageMilker_capp_indux_2" class="UIOption" data-option="1|はい|0|ナンバー" data-da3="7624"></div></td>
							</tr>
							<tr>
								<td>ミルクセンサー</td>
								<td><div id="pageMilker_capp_indux_3" class="UIOption" data-option="1|はい|0|ナンバー" data-da3="7626"></div></td>
							</tr>
				
							<tr>
								<td>カス箱センサー有効</td>
								<td><div id="pageMilker_capp_indux_4" class="UIOption" id="pageMilker_capp_induzione_enableWasteTankSensor" data-option="1|はい|0|ナンバー" data-da3="7632"></div></td>
							</tr>
							<tr>
								<td>タブレット溶解時間</td>
								<td><div id="pageMilker_capp_indux_5" class="UINumber" data-numfigures="3" data-da3="8358" data-da3bit="16" data-max="240" data-um="sec."></div></td>
							</tr>
						</table>
						
						
						<table border='0' class='elenco'>	
							<tbody>
							<tr style="background-color:#fff">
								<th style="color:#000" align="left">フォーム</th>
								<th style="color:#000" align="left">エア</th>
								<th style="color:#000" align="left">ポンプスピード</th>
								<th style="color:#000" align="left">ミルクプレッシャー</th>
							</tr>
							
							<tr>
								<td style="color:#f99">ホットフォーム 1</td>
								<td><div class="UINumber" data-numfigures="3" data-da3="7634" data-da3bit="16" data-max="100" data-um="%"></div></td>
								<td><div class="UINumber" data-numfigures="3" data-da3="7636" data-da3bit="16" data-max="100" data-um="%"></div></td>
								<td><div class="UINumber" data-numfigures="3" data-da3="7638" data-da3bit="16" data-max="500"></div></td>
							</tr>
							<tr>
								<td style="color:#f99">ホットフォーム 2</td>
								<td><div class="UINumber" data-numfigures="3" data-da3="7640" data-da3bit="16" data-max="100" data-um="%"></div></td>
								<td><div class="UINumber" data-numfigures="3" data-da3="7642" data-da3bit="16" data-max="100" data-um="%"></div></td>
								<td><div class="UINumber" data-numfigures="3" data-da3="7644" data-da3bit="16" data-max="500"></div></td>
							</tr>
							<tr>
								<td style="color:#f99">ホットフォーム 3</td>
								<td><div class="UINumber" data-numfigures="3" data-da3="7646" data-da3bit="16" data-max="100" data-um="%"></div></td>
								<td><div class="UINumber" data-numfigures="3" data-da3="7648" data-da3bit="16" data-max="100" data-um="%"></div></td>
								<td><div class="UINumber" data-numfigures="3" data-da3="8338" data-da3bit="16" data-max="500"></div></td>
							</tr>
							
							<tr>
								<td style="color:#00f">コールドフォーム 1</td>
								<td><div class="UINumber" data-numfigures="3" data-da3="8340" data-da3bit="16" data-max="100" data-um="%"></div></td>
								<td><div class="UINumber" data-numfigures="3" data-da3="8342" data-da3bit="16" data-max="100" data-um="%"></div></td>
								<td><div class="UINumber" data-numfigures="3" data-da3="8344" data-da3bit="16" data-max="500"></div></td>
							</tr>
							<tr>
								<td style="color:#00f">コールドフォーム 2</td>
								<td><div class="UINumber" data-numfigures="3" data-da3="8346" data-da3bit="16" data-max="100" data-um="%"></div></td>
								<td><div class="UINumber" data-numfigures="3" data-da3="8348" data-da3bit="16" data-max="100" data-um="%"></div></td>
								<td><div class="UINumber" data-numfigures="3" data-da3="8350" data-da3bit="16" data-max="500"></div></td>
							</tr>
							<tr>
								<td style="color:#00f">コールドフォーム 3</td>
								<td><div class="UINumber" data-numfigures="3" data-da3="8352" data-da3bit="16" data-max="100" data-um="%"></div></td>
								<td><div class="UINumber" data-numfigures="3" data-da3="8354" data-da3bit="16" data-max="100" data-um="%"></div></td>
								<td><div class="UINumber" data-numfigures="3" data-da3="8356" data-da3bit="16" data-max="500"></div></td>
							</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div><!-- page Milker -->
		
		
		<!-- pageSelections -->
		<div id="pageSelections" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' width='100%'>
					<tr valign='middle'>
						<td style="width:140px"><b>メニューボタン設定:</b></td>
						<td><div class='UIOptionSmall' id='pageSelections_selector' data-option='1|1-12|2|13-24|3|25-36|4|37-48' data-onclick='pageSelections_onSelector()'></div></td>
					</tr>
				</table>		
			
				<div id="pageSelections_c2">
					<!-- il contenuto di questa pagina lo credo dinamicamente (vedi pageSelections_build) -->
				</div>
			</div>
		</div><!-- pageSelections -->
		
		<!-- pageSingleSelection -->
		<div id="pageSingleSelection" class="UIWindow">
			<div class="UIWindowContent">
				<div id="pageSingleSelection_selectorAtTop"></div>
				<br>
				<div id="pageSingleSelection_pageG">
					<table border='0' class='elenco'>
						<tr>
							<td>ステータス</td>
							<td><div id='pageSingleSelection_status' class="UIOption" data-option="0|セレクション|1|機能しない|2|プレセレクション" data-da3="100" data-onclick='pageSingleSelection_onStatus()'></div></td>
						</tr>
					</table>
					<div id="pageSingleSelection_pageSel">
						<table border='0' class='elenco'>
							<tr>
								<td>価格 1</td>
								<td><div id='pageSingleSelection_prc1' class="UINumber" data-numfigures="5" data-decimal='0' data-max="65000"></div></td>
							</tr>
							<tr>
								<td>価格 2<br><span class="tip">ハッピープライス</span></td>
								<td><div id='pageSingleSelection_prc2' class="UINumber" data-numfigures="5" data-decimal='0' data-max="65000"></div></td>
							</tr>
							<tr>
								<td>プログラミング</td>
								<td><div class="UIOption" id='pageSingleSelection_programming' data-option="1|パーシャル|0|トータル" data-da3="101" data-onclick="pageSingleSelection_onProgramming()"></div></td>
							</tr>							
							<tr id="pageSingleSelection_pageSel_rowJug">
								<td>JUG<br><span class="tip">レシピNo.</span></td>
								<td><div class="UINumber" data-numfigures="2" data-max="10" data-da3="177" data-da3bit='8'></div></td>
							</tr>
							<tr id="pageSingleSelection_pageSel_scalingF">
								<td>スケーリング工数<br></td>
								<td><div class='UINumber' id='pageSingleSelection_sfactor' data-numfigures='3' data-da3='180' data-da3bit='8' data-min='80' data-max='120' data-um='%'></div></td>
							</tr>
							<tr id="pageSingleSelection_pageSel_rowCupSizeBrewmatic">
								<td>CUP SIZE<br></td>
								<td><div class='UISelect' data-da3='184' data-option='0|(173+) mm|1|(145-173) mm|2|(116-145) mm|3|(101-116) mm|4|(90-101) mm|5|(65-90) mm'></div></td>
							</tr>							
						</table>
					</div>
				</div> <!--pageSingleSelection_pagegs-->
				
				<div id="pageSingleSelection_pageE"></div>
				<div id="pageSingleSelection_pageP"></div>
				<div id="pageSingleSelection_pageW"></div>
				<div id="pageSingleSelection_pageM"></div>
				
			</div>
		</div><!-- pageSingleSelection -->
		
		<!-- pageTemperature -->
		<div id="pageTemperature" class="UIWindow">
			<div class="UIWindowContent" id="pageTemperature_content">
				<!-- creato dinamicamente, vedi pageTemperature_build -->
			</div>
		</div> <!-- pageTemperature -->
		
		
		<!-- pageCalibration -->
		<div id="pageCalibration" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' class='elenco'>
					<tr id="pageCalibration_rowMotor1">
						<td style="width:150px">モーター 1</td>
						<td style="width:274px"><div id="pageCalibration_m1" class="bigCaption15"></div></td>
						<td style="width:300px"><div class='UIButton bigButton60 actionButton' data-caption='リセット' data-onclick="pageCalibration_reset(1)"></div></td>
						<td style="width:300px"><div class='UIButton bigButton60 actionButton' data-caption='校正' data-onclick="pageCalibration_start(1)"></div></td>
					</tr>
					
					<tr id="pageCalibration_rowMotor2">
						<td>モーター 2</td>
						<td><div id="pageCalibration_m2" class="bigCaption15"></div></td>
						<td><div class='UIButton bigButton60 actionButton' data-caption='リセット' data-onclick="pageCalibration_reset(2)"></div></td>
						<td><div class='UIButton bigButton60 actionButton' data-caption='校正' data-onclick="pageCalibration_start(2)"></div></td>
					</tr>

					<tr>
						<td>モーター 3</td>
						<td><div id="pageCalibration_m3" class="bigCaption15"></div></td>
						<td><div class='UIButton bigButton60 actionButton' data-caption='リセット' data-onclick="pageCalibration_reset(3)"></div></td>
						<td><div class='UIButton bigButton60 actionButton' data-caption='校正' data-onclick="pageCalibration_start(3)"></div></td>
					</tr>
					
					<tr>
						<td>モーター 4</td>
						<td><div id="pageCalibration_m4" class="bigCaption15"></div></td>
						<td><div class='UIButton bigButton60 actionButton' data-caption='リセット' data-onclick="pageCalibration_reset(4)"></div></td>
						<td><div class='UIButton bigButton60 actionButton' data-caption='校正' data-onclick="pageCalibration_start(4)"></div></td>
					</tr>

					<tr>
						<td>モーター 5</td>
						<td><div id="pageCalibration_m5" class="bigCaption15"></div></td>
						<td><div class='UIButton bigButton60 actionButton' data-caption='リセット' data-onclick="pageCalibration_reset(5)"></div></td>
						<td><div class='UIButton bigButton60 actionButton' data-caption='校正' data-onclick="pageCalibration_start(5)"></div></td>
					</tr>
					<tr>
						<td>モーター 6</td>
						<td><div id="pageCalibration_m6" class="bigCaption15"></div></td>
						<td><div class='UIButton bigButton60 actionButton' data-caption='リセット' data-onclick="pageCalibration_reset(6)"></div></td>
						<td><div class='UIButton bigButton60 actionButton' data-caption='校正' data-onclick="pageCalibration_start(6)"></div></td>
					</tr>
				</table>
			</div>
		</div> <!-- pageCalibration -->
		
		<!-- page Payment -->
		<div id="pagePayment" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' width='100%'>
					<tr valign='middle'>
						<td id="pagePayment_selector">
							<!-- il selector viene creato da pagePayment_build() -->
						</td>
					</tr>
				</table>
				<br>
			
				<div id="pagePayment_general" style="display:none">
					<table border='0' class='elenco'>
						<tr>
							<td>コインメックタイプ</td>
							<td><div class='UISelect' data-option='0|シングルベンド|1|マルチベンド|2|EXECUTIVE|3|価格保持|4|MDB' data-da3='7058' data-da3bit='8'></div></td>
						</tr>
						<tr>
							<td>通貨（価格）<br> Decimals Num.</td>
							<td><div class='UIOption' data-option='0|0|1|1|2|2|3|3' data-da3='7066' data-da3bit='8'></div></td>
						</tr>
						<tr>
							<td>現金の価格表</td>
							<td><div class='UIOption' data-option='0|1|1|2' data-da3='8374' data-da3bit='8'></div></td>
						</tr>
						<tr>
							<td>キャッシュレスの価格表</td>
							<td><div class='UIOption' data-option='0|1|1|2' data-da3='8376' data-da3bit='8'></div></td>
						</tr>
					</table>				
				</div>

				<div id="pagePayment_mdb">
					<table border='0' class='elenco'>
						<tr>
							<td>エスクローの有効</td>
							<td><div class='UIOption' data-option='0|はい|1|ナンバー' data-da3='7236' data-da3bit='8'></div></td>
						</tr>
						<tr><td>クレジットMAX</td><td><div id="pagePayment_creditMax" class="UINumber" data-numfigures="5" data-max="60000" data-da3="7238" data-da3bit="16"></div></td></tr>
						<tr><td>休憩</td><td><div  id="pagePayment_restMax"class="UINumber" data-numfigures="5" data-max="60000" data-da3="7240" data-da3bit="16"></div></td></tr>
						<tr>
							<td>販売タイプ</td>
							<td><div class='UIOption' data-option='0|SINGLE|1|MULTI' data-da3='7242' data-da3bit='8'></div></td>
						</tr>
						<tr><td>トークン値</td><td><div id="pagePayment_tokenV" class="UINumber" data-numfigures="5" data-max="10000" data-da3="7244" data-da3bit="16"></div></td></tr>
						<tr><td>valiデーター</td><td><div class='UIOption' data-option='0|0|1|1|2|2' data-da3='7310' data-da3bit='8'></div></td></tr>
						
						<tr><td>コインレッション A</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7246' data-da3bit='16'></div></td></tr>						
						<tr><td>コインレッション B</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7248' data-da3bit='16'></div></td></tr>						
						<tr><td>コインレッション C</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7250' data-da3bit='16'></div></td></tr>						
						<tr><td>コインレッション D</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7252' data-da3bit='16'></div></td></tr>						
						<tr><td>コインレッション E</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7254' data-da3bit='16'></div></td></tr>						
						<tr><td>コインレッション F</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7256' data-da3bit='16'></div></td></tr>						
						<tr><td>コインレッション G</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7258' data-da3bit='16'></div></td></tr>						
						<tr><td>コインレッション H</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7260' data-da3bit='16'></div></td></tr>						
						<tr><td>コインレッション I</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7262' data-da3bit='16'></div></td></tr>						
						<tr><td>コインレッション J</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7264' data-da3bit='16'></div></td></tr>						
						<tr><td>コインレッション K</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7266' data-da3bit='16'></div></td></tr>						
						<tr><td>コインレッション L</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7268' data-da3bit='16'></div></td></tr>						
						<tr><td>コインレッション M</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7270' data-da3bit='16'></div></td></tr>						
						<tr><td>コインレッション N</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7272' data-da3bit='16'></div></td></tr>						
						<tr><td>コインレッション O</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7274' data-da3bit='16'></div></td></tr>						
						<tr><td>コインレッション P</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7276' data-da3bit='16'></div></td></tr>

						<tr><td>コインなし A</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7278' data-da3bit='16'></div></td></tr>						
						<tr><td>コインなし B</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7280' data-da3bit='16'></div></td></tr>						
						<tr><td>コインなし C</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7282' data-da3bit='16'></div></td></tr>						
						<tr><td>コインなし D</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7284' data-da3bit='16'></div></td></tr>						
						<tr><td>コインなし E</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7286' data-da3bit='16'></div></td></tr>						
						<tr><td>コインなし F</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7288' data-da3bit='16'></div></td></tr>						
						<tr><td>コインなし G</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7290' data-da3bit='16'></div></td></tr>						
						<tr><td>コインなし H</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7292' data-da3bit='16'></div></td></tr>						
						<tr><td>コインなし I</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7294' data-da3bit='16'></div></td></tr>						
						<tr><td>コインなし J</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7296' data-da3bit='16'></div></td></tr>						
						<tr><td>コインなし K</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7298' data-da3bit='16'></div></td></tr>						
						<tr><td>コインなし L</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7300' data-da3bit='16'></div></td></tr>						
						<tr><td>コインなし M</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7302' data-da3bit='16'></div></td></tr>						
						<tr><td>コインなし N</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7304' data-da3bit='16'></div></td></tr>						
						<tr><td>コインなし O</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7306' data-da3bit='16'></div></td></tr>						
						<tr><td>コインなし P</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7308' data-da3bit='16'></div></td></tr>
					</table>				
				</div>			
				
				<div id="pagePayment_mid" style="display:none">
					<table border='0' class='elenco'>
						<tr>
							<td>プロトコル</td>
							<td><div class='UISelect' data-option='0|TM-ON|1|DDCMP 2400++|2|DEX|3|DEX reset|4|DDCMP 9600|5|DDCMP 1200|6|TEST FUN|7|IRDA' data-da3='7330'></div></td>
						</tr>						
						<tr>
							<td>CODE ID 101</td>
							<td><div class="UINumber" data-numfigures="9" data-max="999999999" data-da3="7314" data-da3bit="32"></div></td>
						</tr>
						<tr>
							<td>CODE ID 104</td>
							<td><div class="UINumber" data-numfigures="9" data-max="999999999" data-da3="7318" data-da3bit="32"></div></td>
						</tr>
						<tr>
							<td>CODE ID 106</td>
							<td><div class="UINumber" data-numfigures="9" data-max="999999999" data-da3="7322" data-da3bit="32"></div></td>
						</tr>
						<tr>
							<td>アドレスvidts</td>
							<td><div class="UINumber" data-numfigures="3" data-max="999" data-da3="7326" data-da3bit="16"></div></td>
						</tr>
					</table>
				</div>
				
				<div id="pagePayment_rfid">
					<table border='0' class='elenco'>
						<tr>
							<td>最大クレジットカード</td>
							<td><div id="pagePayment_maxCC" class="UINumber" data-numfigures="5" data-max="60000" data-da3="7136" data-da3bit="16"></div></td>
						</tr>
						<tr>
							<td>割引</td>
							<td><div class="UINumber" data-numfigures="2" data-max="80" data-da3="7196" data-da3bit="16" data-um="%"></div></td>
						</tr>
						<tr><td>COIN A CARD</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7144'></div></td></tr>
						<tr><td>COIN B CARD</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7146'></div></td></tr>
						<tr><td>COIN C CARD</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7148'></div></td></tr>
						<tr><td>COIN D CARD</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7150'></div></td></tr>
						<tr><td>COIN E CARD</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7152'></div></td></tr>
						<tr><td>COIN F CARD</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7154'></div></td></tr>
						<tr><td>COIN G CARD</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7156'></div></td></tr>
						<tr><td>COIN H CARD</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7158'></div></td></tr>
						<tr><td>COIN I CARD</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7160'></div></td></tr>
						<tr><td>COIN J CARD</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7162'></div></td></tr>
						
						<tr><td>COIN A NO CARD</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7176'></div></td></tr>
						<tr><td>COIN B NO CARD</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7178'></div></td></tr>
						<tr><td>COIN C NO CARD</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7180'></div></td></tr>
						<tr><td>COIN D NO CARD</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7182'></div></td></tr>
						<tr><td>COIN E NO CARD</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7184'></div></td></tr>
						<tr><td>COIN F NO CARD</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7186'></div></td></tr>
						<tr><td>COIN G NO CARD</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7188'></div></td></tr>
						<tr><td>COIN H NO CARD</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7190'></div></td></tr>
						<tr><td>COIN I NO CARD</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7192'></div></td></tr>
						<tr><td>COIN J NO CARD</td><td><div class='UIOption' data-option='1|ナンバー|0|承認されました' data-da3='7194'></div></td></tr>
					</table>
				</div>	

				<div id="pagePayment_alipayChina">
					<table border='0' class='elenco'>
						<tr>
							<td style="width:200px">IP</td>
							<td><div  id="pagePayment_alichina_ip" class="bigCaption15"></div></td>
						</tr>
						<tr>
							<td>PORT</td>
							<td><div  id="pagePayment_alichina_port" class="bigCaption15"></div></td>
						</tr>
						<tr>
							<td>MACHINE NAME</td>
							<td><div  id="pagePayment_alichina_mid" class="bigCaption15"></div></td>
						</tr>
						<tr>
							<td>KEY</td>
							<td><div  id="pagePayment_alichina_key" class="bigCaption15"></div></td>
						</tr>
						
					</table>
				</div>
				
				<div id="pagePayment_parallel">
					<table border='0' class='elenco'>
						<tr><td>COIN A</td><td><div id="pagePayment_coin0" class="UINumber" data-numfigures="5" data-max="65000" data-da3="7012" data-da3bit="16"></div></td></tr>
						<tr><td>COIN B</td><td><div id="pagePayment_coin1" class="UINumber" data-numfigures="5" data-max="65000" data-da3="7014" data-da3bit="16"></div></td></tr>
						<tr><td>COIN C</td><td><div id="pagePayment_coin2" class="UINumber" data-numfigures="5" data-max="65000" data-da3="7016" data-da3bit="16"></div></td></tr>
						<tr><td>COIN D</td><td><div id="pagePayment_coin3" class="UINumber" data-numfigures="5" data-max="65000" data-da3="7018" data-da3bit="16"></div></td></tr>
						<tr><td>COIN E</td><td><div id="pagePayment_coin4" class="UINumber" data-numfigures="5" data-max="65000" data-da3="7020" data-da3bit="16"></div></td></tr>
						<tr><td>COIN F</td><td><div id="pagePayment_coin5" class="UINumber" data-numfigures="5" data-max="65000" data-da3="7022" data-da3bit="16"></div></td></tr>
						<tr><td>COIN G</td><td><div id="pagePayment_coin6" class="UINumber" data-numfigures="5" data-max="65000" data-da3="7024" data-da3bit="16"></div></td></tr>
						<tr><td>COIN H</td><td><div id="pagePayment_coin7" class="UINumber" data-numfigures="5" data-max="65000" data-da3="7026" data-da3bit="16"></div></td></tr>
						<tr><td>COIN I</td><td><div id="pagePayment_coin8" class="UINumber" data-numfigures="5" data-max="65000" data-da3="7028" data-da3bit="16"></div></td></tr>
						<tr><td>COIN J</td><td><div id="pagePayment_coin9" class="UINumber" data-numfigures="5" data-max="65000" data-da3="7030" data-da3bit="16"></div></td></tr>
					</table>
				</div>				
				
			</div>
		</div><!-- page Payment -->		
		
		
		<!-- page Devices -->
		<div id="pageDevices" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' width='100%' id="pageDevices_selectorTable">
					<tr valign='middle'>
						<td><div class='UIOptionSmall' id='pageDevices_selectorVFlex' data-option='1|VARIFLEX|2|VARIGRIND|0|その他' data-onclick='pageDevices_onSelector()'></div></td>
					</tr>
				</table>
				<table border='0' width='100%' id="pageDevices_selectorTableMicro" style="display:none">
					<tr valign='middle'>
						<td><div class='UIOptionSmall' id='pageDevices_selectorMicro' data-option='1|MICRO|0|その他' data-onclick='pageDevices_onSelector()'></div></td>
					</tr>
				</table>
				<div style='height:5px'></div>
			
				<!--DEVICES OTHER-->
				<div id="pageDevices_general" style="display:none">
					<table border='0' class='elenco'>
						<tr><td>排水トレイの検出</td><td><div class='UIOption' data-option='0|ナンバー|1|はい' data-da3='7092' data-da3bit='8'></div></td></tr>
						<tr id="pageDevices_cofSensor"><td>コーヒーセンサー</td><td><div class='UIOption' data-option='1|有効|0|無効' data-da3='7094' data-da3bit='8'></div></td></tr>
						<tr id="pageDevices_cupSensor">
							<td>カップセンサー閾値</td>
							<td>
								<div style="float:left"><div class="UINumber" data-numfigures="3" data-max="180" data-da3="7108" data-da3bit="8"></div></div>
								<div style="float:left; margin-left:40px">現在の価値:<br><span class="bigCaption15" id="divCupSensorLiveValue"></span></div>
								<div style="clear"></div>								
							</td>
						</tr>
						<tr id="pageDevices_boilerSize"><td>ボイラー</td><td><div class='UIOption' data-option='0|400 cc|1|800 cc' data-da3='7072' data-da3bit='8'></div></td></tr>
						
						<tr><td>モデムテスト</td><td><div class='UIButton bigButton60 actionButton' data-caption='開始' data-onclick="pageDevices_startModemTest()"></div></td></tr>
						<tr id="pageDevices_grpTest"><td>グループテスト</td><td><div class='UIButton bigButton60 actionButton' data-caption='開始' data-onclick="pageDevices_startTestAssorbGruppo()"></div></td></tr>
						<tr id="pageDevices_motorTest"><td>モーターテスト</td><td><div class='UIButton bigButton60 actionButton' data-caption='開始' data-onclick="pageDevices_startTestAssorbMotoriduttore()"></div></td></tr>
						
						<tr id="pageDevices_vibrationTest">
							<td>TEST VIBRATION</td>
							<td>
								<div style="float:left"><div id="pageDevices_vibrationTest_perc" class="UINumber" data-numfigures="3" data-max="100" data-min="1"></div></div>
								<div style="float:left; margin-left:40px">
									<div class='UIButton bigButton60 actionButton' data-caption='開始' data-onclick="pageDevices_startBrewmaticVibrationTest()"></div>
								</div>
								<div style="clear"></div>								
							
							
							</td>
						</tr>
					</table>
				</div>

				<!--DEVICES VARIFLEX / MICRO-->
				<div id="pageDevices_vflex" style="display:none">
					<table border='0' class='elenco'>
						<tr><td>シリンダー径</td><td><div id="pageDevices_vflex_brewerDiam" class='UIOption' data-option='0|36mm|1|45mm' data-da3='7554' data-da3bit='8'></div></td></tr>
						<tr><td>スタート位置</td><td><div class='UIOption' data-option='0|閉じる|1|オープン' data-da3='7556' data-da3bit='8'></div></td></tr>
						<tr id="pageDevices_vflex_autoAdjust"><td>自動補正機能</td><td><div id="pageDevices_vflex_v1AutoAdjust" class='UIOption' data-option='0|ナンバー|1|はい' data-da3='7558' data-da3bit='8'></div></td></tr>
						<tr id="pageDevices_vflex_deliveryPhase"><td>抽出速度</td><td><div class='UIOption' data-option='0|ノーマル|1|速い' data-da3='7570' data-da3bit='8'></div></td></tr>
						<tr id="pageDevices_grinderSpeedTest">
							<td>OFF09になる際のグラインダースピード対策</td>
							<td>
								<table style="width:100%">
									<tr>
										<td><div id="pageDevices_vflex_grnSpeedOff9" class="UINumber" data-numfigures="4" data-max="9999" data-da3="7558" data-da3bit="16"></div></td>
										<td><div class='UIButton bigButton60 actionButton' data-caption='テスト' data-onclick="pageDevices_startGrinderSpeedTest()"></div></td>
									</tr>
								</table>
							</td>
						</tr>
					</table>				
				</div>
				
				<!--- varigrind-->
				<div id="pageDevices_vgrind" style="display:none">
					<div class='UIOptionSmall' id='pageDevices_vgrind_selector' data-option='1|VARIGRIND 1|2|VARIGRIND 2' data-onclick='pageDevices_onVGrindSelector()'></div>
				
					<!--- vgrind 1-->
					<div id="pageDevices_vgrind1" style="display:none">
						<table border='0' class='elenco'>
							<tr>
								<td style="width:260px">
									ポジション<br>
									<div style="float:left; margin-right:10px">現在の価値:</div>
									<div style="float:left" id="pageDevices_vg1" class="bigCaption15">000</div>
									<div class="clear"></div>
								</td>
							</tr>
							<tr>
								<td>自動構成の有効</td>
								<td colspan="2"><div id='pageDevices_vgrind1_selector' class='UIOption' data-option='0|ナンバー|1|はい' data-da3='7590' data-da3bit='8' data-onclick='pageDevices_onEnableAuto(1)'></div></td>
							</tr>
						</table>
						<table border='0' class='elenco' id='pageDevices_vgrind1_params'>
							<tr>
								<td>
									<table class='elenco' border='0'>
										<tr valign="middle" style='border:none'>
											<td style='width:155px;'>サンプルの個数</td>
											<td style='width:210px; border-right:solid 1px #999'><div class="UINumber" data-numfigures="3" data-min="10" data-max="100" data-da3="7594" data-da3bit="16"></div></td>
											<td style='width:180px; padding-left:15px;'>選択</td>
											<td style='width:160px; border-right:solid 1px #999'><div id='pageDevices_vgrind1_selNum' class="UINumber" data-numfigures="2" data-min="1" data-max="48" data-da3="7588" data-da3bit="8"></div></td>
											<td align="right"><div class='UIButton bigButton60 actionButton' data-caption='選択を実行します' data-onclick="pageDevices_vgrind_runSelection(1)"></div></td>
										</tr>
									</table>
								</td>
							</tr>
							<tr>
								<td>
									<table class='elenco' border='0'>
										<tr valign="middle" style='border:none'>
											<td style='width:145px;'>フラックス参照</td>
											<td style='width:320px; border-right:solid 1px #999'>
												<div class="UINumber" id='pageDevices_vgrind1_refFlux' data-numfigures="3" data-max="900" data-decimal="2" data-da3="7592" data-da3bit="16" data-um="cc/sec"></div>
											</td>
											<td style='width:175px; padding-left:10px'>ポジション参照</td>
											<td style='width:70px; border-right:solid 1px #999'><div id='pageDevices_vgrind1_lastPos_caption' style='color:#fff; font-size:1.5em'>000</div></td>
											<td align="right">
												<div id='pageDevices_vgrind1_lastFlux_caption' class="tip" style="color:#fff">最後のフラックス/位置：<br> <b> RUN選択</ b>をクリックしてください</div>
												<div id='pageDevices_vgrind1_lastFlux_btnUse' class='UIButton bigButton60 actionButton' style='font-size:1.0em' data-caption='データ保存' data-onclick="pageDevices_vgrind_useLastFluxAndPos(1)"></div>
											</td>
										</tr>
									</table>
								</td>
							</tr>
						</table>
					</div>
					
					<!--- vgrind 2-->
					<div id="pageDevices_vgrind2" style="display:none">
						<table border='0' class='elenco'>
							<tr>
								<td style="width:260px">
									ポジション<br>
									<div style="float:left; margin-right:10px">現在の価値:</div>
									<div style="float:left" id="pageDevices_vg2" class="bigCaption15">000</div>
									<div class="clear"></div>
								</td>
							</tr>
							<tr><td>自動構成の有効</td><td colspan="2"><div id='pageDevices_vgrind2_selector' class='UIOption' data-option='0|ナンバー|1|はい' data-da3='7654' data-da3bit='8' data-onclick='pageDevices_onEnableAuto(2)'></div></td></tr>
						</table>
						<table border='0' class='elenco' id='pageDevices_vgrind2_params'>
							<tr>
								<td>
									<table class='elenco' border='0'>
										<tr valign="middle" style='border:none'>
											<td style='width:155px;'>サンプルの個数</td>
											<td style='width:210px; border-right:solid 1px #999'><div class="UINumber" data-numfigures="3" data-min="10" data-max="100" data-da3="7658" data-da3bit="16"></div></td>
											<td style='width:180px; padding-left:15px;'>選択</td>
											<td style='width:160px; border-right:solid 1px #999'><div id='pageDevices_vgrind2_selNum' class="UINumber" data-numfigures="2" data-min="1" data-max="48" data-da3="7652" data-da3bit="8"></div></td>
											<td align="right"><div class='UIButton bigButton60 actionButton' data-caption='選択を実行します' data-onclick="pageDevices_vgrind_runSelection(2)"></div></td>
										</tr>
									</table>
								</td>
							</tr>
							<tr>
								<td>
									<table class='elenco' border='0'>
										<tr valign="middle" style='border:none'>
											<td style='width:145px;'>フラックス参照</td>
											<td style='width:320px; border-right:solid 1px #999'>
												<div class="UINumber" id='pageDevices_vgrind2_refFlux' data-numfigures="3" data-max="900" data-decimal="2" data-da3="7656" data-da3bit="16" data-um="cc/sec"></div>
											</td>
											<td style='width:175px; padding-left:10px'>ポジション参照</td>
											<td style='width:70px; border-right:solid 1px #999'><div id='pageDevices_vgrind2_lastPos_caption' style='color:#fff; font-size:1.5em'>000</div></td>
											<td align="right">
												<div id='pageDevices_vgrind2_lastFlux_caption' class="tip" style="color:#fff">最後のフラックス/位置：<br> <b> RUN選択</ b>をクリックしてください</div>
												<div id='pageDevices_vgrind2_lastFlux_btnUse' class='UIButton bigButton60 actionButton' style='font-size:1.0em' data-caption='データ保存' data-onclick="pageDevices_vgrind_useLastFluxAndPos(2)"></div>
											</td>
										</tr>
									</table>
								</td>
							</tr>
						</table>
					</div>
					
					<!--- vgrind 3-->
					<div id="pageDevices_vgrind3" style="display:none">
						<table border='0' class='elenco'>
							<tr>
								<td style="width:260px">
									ポジション<br>
									<div style="float:left; margin-right:10px">現在の価値:</div>
									<div style="float:left" id="pageDevices_vg3" class="bigCaption15">000</div>
									<div class="clear"></div>
								</td>
							</tr>
							<tr>
								<td>自動構成の有効</td>
								<td colspan="2"><div id='pageDevices_vgrind3_selector' class='UIOption' data-option='0|ナンバー|1|はい' data-da3='7686' data-da3bit='8' data-onclick='pageDevices_onEnableAuto(3)'></div></td>
							</tr>
						</table>
						<table border='0' class='elenco' id='pageDevices_vgrind3_params'>
							<tr>
								<td>
									<table class='elenco' border='0'>
										<tr valign="middle" style='border:none'>
											<td style='width:155px;'>サンプルの個数</td>
											<td style='width:210px; border-right:solid 1px #999'><div class="UINumber" data-numfigures="3" data-min="10" data-max="100" data-da3="7690" data-da3bit="16"></div></td>
											<td style='width:180px; padding-left:15px;'>選択</td>
											<td style='width:160px; border-right:solid 1px #999'><div id='pageDevices_vgrind3_selNum' class="UINumber" data-numfigures="2" data-min="1" data-max="48" data-da3="7684" data-da3bit="8"></div></td>
											<td align="right"><div class='UIButton bigButton60 actionButton' data-caption='選択を実行します' data-onclick="pageDevices_vgrind_runSelection(3)"></div></td>
										</tr>
									</table>
								</td>
							</tr>
							<tr>
								<td>
									<table class='elenco' border='0'>
										<tr valign="middle" style='border:none'>
											<td style='width:145px;'>フラックス参照</td>
											<td style='width:320px; border-right:solid 1px #999'>
												<div class="UINumber" id='pageDevices_vgrind3_refFlux' data-numfigures="3" data-max="900" data-decimal="2" data-da3="7688" data-da3bit="16" data-um="cc/sec"></div>
											</td>
											<td style='width:175px; padding-left:10px'>ポジション参照</td>
											<td style='width:70px; border-right:solid 1px #999'><div id='pageDevices_vgrind3_lastPos_caption' style='color:#fff; font-size:1.5em'>000</div></td>
											<td align="right">
												<div id='pageDevices_vgrind3_lastFlux_caption' class="tip" style="color:#fff">最後のフラックス/位置：<br> <b> RUN選択</ b>をクリックしてください</div>
												<div id='pageDevices_vgrind3_lastFlux_btnUse' class='UIButton bigButton60 actionButton' style='font-size:1.0em' data-caption='データ保存' data-onclick="pageDevices_vgrind_useLastFluxAndPos(3)"></div>
											</td>
										</tr>
									</table>
								</td>
							</tr>
						</table>
					</div>

					<!--- vgrind 4-->
					<div id="pageDevices_vgrind4" style="display:none">
						<table border='0' class='elenco'>
							<tr>
								<td style="width:260px">
									ポジション<br>
									<div style="float:left; margin-right:10px">現在の価値:</div>
									<div style="float:left" id="pageDevices_vg4" class="bigCaption15">000</div>
									<div class="clear"></div>
								</td>
							</tr>
							<tr>
								<td>自動構成の有効</td>
								<td colspan="2"><div id='pageDevices_vgrind4_selector' class='UIOption' data-option='0|ナンバー|1|はい' data-da3='7718' data-da3bit='8' data-onclick='pageDevices_onEnableAuto(4)'></div></td>
							</tr>
						</table>
						<table border='0' class='elenco' id='pageDevices_vgrind4_params'>
							<tr>
								<td>
									<table class='elenco' border='0'>
										<tr valign="middle" style='border:none'>
											<td style='width:155px;'>サンプルの個数</td>
											<td style='width:210px; border-right:solid 1px #999'><div class="UINumber" data-numfigures="3" data-min="10" data-max="100" data-da3="7722" data-da3bit="16"></div></td>
											<td style='width:180px; padding-left:15px;'>選択</td>
											<td style='width:160px; border-right:solid 1px #999'><div id='pageDevices_vgrind4_selNum' class="UINumber" data-numfigures="2" data-min="1" data-max="48" data-da3="7716" data-da3bit="8"></div></td>
											<td align="right"><div class='UIButton bigButton60 actionButton' data-caption='選択を実行します' data-onclick="pageDevices_vgrind_runSelection(4)"></div></td>
										</tr>
									</table>
								</td>
							</tr>
							<tr>
								<td>
									<table class='elenco' border='0'>
										<tr valign="middle" style='border:none'>
											<td style='width:145px;'>フラックス参照</td>
											<td style='width:320px; border-right:solid 1px #999'>
												<div class="UINumber" id='pageDevices_vgrind4_refFlux' data-numfigures="3" data-max="900" data-decimal="2" data-da3="7720" data-da3bit="16" data-um="cc/sec"></div>
											</td>
											<td style='width:175px; padding-left:10px'>ポジション参照</td>
											<td style='width:70px; border-right:solid 1px #999'><div id='pageDevices_vgrind4_lastPos_caption' style='color:#fff; font-size:1.5em'>000</div></td>
											<td align="right">
												<div id='pageDevices_vgrind4_lastFlux_caption' class="tip" style="color:#fff">最後のフラックス/位置：<br> <b> RUN選択</ b>をクリックしてください</div>
												<div id='pageDevices_vgrind4_lastFlux_btnUse' class='UIButton bigButton60 actionButton' style='font-size:1.0em' data-caption='データ保存' data-onclick="pageDevices_vgrind_useLastFluxAndPos(4)"></div>
											</td>
										</tr>
									</table>
								</td>
							</tr>
						</table>
					</div>						
				</div>
			</div>
		</div><!-- page Devices -->	

		<!-- page DataAudit -->
		<div id="pageDataAudit" class="UIWindow">
			<div class="UIWindowContent">
				<table border='0' width='100%'>
					<tr valign='middle'>
						<td><div class='UIOptionSmall' id='pageDataAudit_selector' data-option='0|概要|1|区分|2|合計|4|プレセレクション|3|データの更新' data-onclick='pageDataAudit_onSelector()'></div></td>
					</tr>
				</table>
				
				<div id="pageDataAudit_o" style="display:none"></div>
				<div id="pageDataAudit_p" style="display:none"></div>
				<div id="pageDataAudit_t" style="display:none"></div>
				<div id="pageDataAudit_prs" style="display:none"></div>
				<div id="pageDataAudit_r" style="display:none">
					<div id="pageDataAudit_lastDownload">EVA-DTS, downloaded on 2019-11-26 11:42</div>
					<br>
					<table border='0' align="center">
						<tr valign='middle'>
							<td><div class='UIButton actionButton' data-caption='データの再更新' data-onclick="pageDataAudit_downloadEVA()"></div></td>
							<td style="width:100px">&nbsp;</td>
							<td><div class='UIButton actionButton' data-caption='部分的なデータリセット' data-onclick="pageDataAudit_resetPartialData()"></div></td>
						</tr>
					</table>
					
					<!-- bottone segreto per fare il reset dei totali dei dati audit. Va cliccato 5/6 volte ripetutamente -->
					<div id="divSecretDAResetButton" style="position:absolute; top:410px; left:910px; width:110px; height:90px;">&nbsp;</div>
				</div>
			</div>
		</div> <!-- page DataAudit -->

		<!-- page page Espresso Calibration -->
		<div id="pageExpCalib" class="UIWindow">
			<div class="UIWindowContent">
				
				<table border='0' class='elenco'>
					<tr style='border-bottom:none'>
						<td style="width:10%"><b style='color:#fff'>セレクション</b></td>
						<td style="width:30%" align="center"><div id='pageExpCalib_selNum' class="UINumber" data-numfigures="2" data-min="1" data-max="48"></div></td>
						<td style="width:30%" align="center"><div class='UIButton bigButton60 actionButton' data-caption='選択を実行します' data-onclick="pageExpCalib_runSelection()"></div></td>
						<td style="width:30%" align="center"><div class='UIButton bigButton60 actionButton' data-caption='選択を編集します' data-onclick="pageExpCalib_editSelection()"></div></td>
					</tr>

					<tr style='height:50px;'>
						<td>LAST FLUX</td>
						<td align="center"><div id='pageExpCalib_lastFlux'>0.00 cc/sec</div></td>
						<td colspan="2"><span class="tip">フラックス情報は「選択を実行」するたびに更新します</span></td>
					</tr>					

					<tr>
						<td><b style='color:#fff'>グラインダー</b></td>
						<td align="center">現在の校正係数<div id="pageExpCalib_grSec" class="bigCaption15">0 gr/sec</div></td>
						<td align="center"><div class='UIButton bigButton60 actionButton' data-caption='キャリブレーション開始' data-onclick="pageExpCalib_startMacinaCalib()"></div></td>
						<td align="center"><div class='UIButton bigButton60 actionButton' data-caption='キャリブレーションリセット' data-onclick="pageExpCalib_resetMacinaCalib()"></div></td>
					</tr>					


					<tr style='height:125px;' id="pageExpCalib_rowvarigrind">
						<td>
							<b style='color:#fff'>VARIGRIND</b><br>
							<div class="tip" id="pageExpCalib_vgAutoAjustEnabled"></div>
						</td>
						<td align="center">現在位置<div id="pageExpCalib_vgCurPos" class="bigCaption15">000</div></td>
						<td align="center">推奨位置<div class="UINumber" id="pageExpCalib_vg_target" data-numfigures="3" data-max="500"></div></td>
						<td align="center"><div class='UIButton bigButton60 actionButton' id="pageExpCalib_vgBtnSet" data-caption='SET' data-onclick="pageExpCalib_regolaVG()"></div></td>
					</tr>
					
					<tr style='border-bottom:none' id="pageExpCalib_rowimpulsi">
						<td><b style='color:#fff'>インパルス</b></td>
						<td align="center">現在<div id="pageExpCalib_imp" class="bigCaption15">0.00 imp/gr</div></td>
						<td colspan="2" align="right">
							<table style="width:100%">
								<tr>
									<td style="width:30%; text-align:right"><b style='color:#fff'>グラインダー&nbsp;</b></td>
									<td style="width:70%"><div class='UIOption' id='pageExpCalib_macina1o2' data-option='' data-onclick='pageExpCalib_onChangeGrinder()'></div></td>
								</tr>
							</table>
						</td>
					</tr>
				</table>
			</div>
		</div> <!-- page pageExpCalib -->		
			

		<!-- page Grinder cleaning -->
		<div id="pageGrinderCleaning" class="UIWindow">
			<div class="UIWindowContent"></div>
		</div> <!-- page Grinder cleaning -->
		
	</div> <!-- divPage -->

	<div id="divFooter" class="footer">
		<div id="footer_L">
			<div style="float:left; margin-right:10px"><div id="bntBack" class="UIButton" data-caption="&nbsp;&nbsp;&nbsp;戻る&nbsp;&nbsp;&nbsp;" data-onclick="btnBack_onClick()"></div></div>
			<div style="float:left"><div id="btnSave" class="UIButton" data-caption="&nbsp;&nbsp;&nbsp;保存する&nbsp;&nbsp;&nbsp;" data-onclick="btnSave_onClick()"></div></div>
			<div class="clear"></div>
		</div>
		
		<div id="footer_C"></div>
		
		<div id="footer_R">
			<div style="float:right"><div id="bntTestSelection" class="UIButton" style="display:none" data-caption="&nbsp&nbsp&nbsp&nbsp;テスト　セレクション &nbsp&nbsp&nbsp;" data-onclick="pageSingleSelection_test(0)"></div></div>
			<div class="clear"></div>
		</div>
		<div class="clear"></div>
	</div>
</div> <!-- wrapper -->


<div id="manualViewBox" style="position:absolute; top:0; left:0; background-color:rgba(80,80,80,0.9); width:100%; height:100%; text-align:center; display:none; z-index:100;">
	<iframe id='manualViewBoxFrame' class='manualViewBox_frame' src='' border='0'></iframe>
	<div class='manualViewBox_close' onclick='manualViewBox_close()'><img src='img/close32x32.png'></div>
</div>

<script src="js/Helper.js"></script>
<script src="js/PleaseWait.js"></script>
<script src="js/DataOra.js"></script>
<script src="js/DA3.js"></script>
<script src="js/GUIInfo.js"></script>
<script src="js/UI.js"></script>
<script src="js/UIOption.js"></script>
<script src="js/UINumberArrow.js"></script>
<script src="js/UIButtonSel.js"></script>
<script src="js/UITime24.js"></script>
<script src="js/UISelect.js"></script>
<script src="js/StartupOperation.js"></script>
<script src="js/Task_JP.js"></script> <!-- questo viene automaticamente sostituito da Task_CUR_LANG.js quando si lancia il prg di traduzione -->






<script id="rheaBootstrapTag" src="js/rheaBootstrap.js" data-ses-clear="1"></script>
<script language="javascript">
var da3 = null;
var guiInfo = null;
var currentPageID="";
var currentCPUStatusID = -1;
var isMilkerAlive = 0;
var timeNowMSec = 0;
var manualFolderName = "";

var ui = null;
var uiStandAloneNum = null;
var uiStandAloneOptionGrinderCleaning1or2 = null;
var uiStandAloneVarigringTargetPos = null;

var voidTask = new TaskVoid();
var taskCalibMotor = new TaskCalibMotor();
var currentTask = voidTask;


function onRheaBootstrapFinished()
{
	pleaseWait_setup();
	
	rhea.onEvent_cpuMessage = 	function(msg, importanceLevel)	 	{ currentTask.onEvent_cpuMessage(msg, importanceLevel); }
	rhea.onEvent_cpuStatus  = 	function(statusID, statusStr, flag16)
								{		
								
									//se il milker è collegato, abilito i suoi menu, e viceversa
									if (isMilkerAlive)
									{
										if ((flag16 & 0x04) == 0)
										{
											isMilkerAlive = 0;
											rheaAddClassToElem(rheaGetElemByID("pageCleaning_btnCleanMilker"), "UIdisabled");
											rheaSetDivHTMLByName("pageMilker_status", "接続されいるか無効になっています");
											rheaSetDivHTMLByName("pageMilker_ver", "??");
										}
									}
									else
									{
										if ((flag16 & 0x04) != 0)
										{
											isMilkerAlive = 1;
											rheaRemoveClassToElem(rheaGetElemByID("pageCleaning_btnCleanMilker"), "UIdisabled");
											rheaSetDivHTMLByName("pageMilker_status", "有効");

											//chiedo versione del milker
											rhea.ajax ("milkver", "").then( function(result)
											{
												rheaSetDivHTMLByName("pageMilker_ver", result);
											})
											.catch( function(result)
											{
												rheaSetDivHTMLByName("pageMilker_ver", "??");
											});		
											
										}
									}
									
									
									currentCPUStatusID=statusID; 
									currentTask.onEvent_cpuStatus(statusID, statusStr, flag16); 
								}
	
	dataOra_setup();
	
	ui = new UI ("divPage");
	ui.setupStandaloneButton("bntBack");
	ui.setupStandaloneButton("btnSave");
	ui.setupStandaloneButton("bntTestSelection");
	uiStandAloneNum = ui.setupStandaloneNumber("pagePleaseWait_calibration_num");
	uiStandAloneVarigringTargetPos = ui.setupStandaloneNumber("pagePleaseWait_calibration_1_vg_target");
	ui.setupStandaloneButton("pagePleaseWait_calibration_1_vg_set");
	ui.setupStandaloneButton("pagePleaseWait_calibration_1_grind");
	ui.setupStandaloneButton("pagePleaseWait_calibration_2_runMotor");
	uiStandAloneOptionGrinderCleaning1or2 = ui.setupStandaloneUIOption("pagePleaseWait_grinderCleaning_1or2");
	
	pleaseWait_show();
	pleaseWait_header_setTextL("お待ちください ...");
	pleaseWait_freeText_show();

	//scarica il da3, carica guiInfo... in generale fa tutte quelle operazioni che sono necessarie prima di poter visualizzare il main menu
	startupOperation();
}

function header_setText(s)				{ s=s.replace(/<br>/, "&nbsp;"); rheaSetDivHTMLByName("divHeaderC", s); }
function gotoHMI()						{ window.location = "gotoHMI.html"; }

/***************************************************************************
 *
 * show page
 *	ritorna != 0 se è la prima volta che questa finestra viene visualizzata
 */
function showPage  (pageID, pageTitle, bShowBtnBack, bShowBtnSave)				{ return showPageEx(pageID, pageTitle, bShowBtnBack, bShowBtnSave,0); }
function showPageEx(pageID, pageTitle, bShowBtnBack, bShowBtnSave, da3Offset)	
{ 
	currentPageID = pageID; 
	var win = ui.getWindowByID(currentPageID); 
	var ret = win.firstTimeShow; 
	ui.hideAllExcept(currentPageID); 
	rheaHideElem(rheaGetElemByID("divCurLang"));
	win.loadFromDA3(da3, da3Offset);
	rhea.requestGPUEvent(RHEA_EVENT_CPU_STATUS);
	
	pleaseWait_hide();
	header_setText (pageTitle);
	btnBack_setCallback("btnBack_defaultCallback();");
	btnSave_setCallback("btnSave_defaultCallback();");
	if (bShowBtnBack!=0) btnBack_show(); else btnBack_hide();
	if (bShowBtnSave!=0) btnSave_show(); else btnSave_hide();
	return ret;
}


/***************************************************************************
 *
 * bottoni back / save
 */
var btn_save_callback = null;
var btn_back_callback = null;
function btnSave_show()								{ rheaSetDisplayMode(rheaGetElemByID("btnSave"), "table"); }
function btnSave_hide()								{ rheaHideElem(rheaGetElemByID("btnSave")); }
function btnSave_setCallback (fnToCallWhenFinished)	{ btn_save_callback=fnToCallWhenFinished; }
function btnSave_onClick()							{ eval(btn_save_callback); }
function btnSave_defaultCallback()					{ save( function() { btnBack_onClick();} ); }

function btnBack_show() 							{ rheaSetDisplayMode(rheaGetElemByID("bntBack"), "table"); }
function btnBack_hide() 							{ rheaHideElem(rheaGetElemByID("bntBack")); rheaHideElem(rheaGetElemByID("bntTestSelection")); }
function btnBack_setCallback (fnToCallWhenFinished)	{ btn_back_callback=fnToCallWhenFinished; }
function btnBack_onClick ()							{ eval(btn_back_callback); }
function btnBack_defaultCallback()					{ if (currentTask != voidTask) currentTask = voidTask; pageMainMenu_show(); }

function btnTestSelection_show()					{ rheaShowElem(rheaGetElemByID("bntTestSelection")); }
function btnTestSelection_hide()					{ rheaHideElem(rheaGetElemByID("bntTestSelection")); }


/***************************************************************************
 *
 * save
 * se ci sono state modifiche al da3, le salva e le trasmette a CPU. Al termine, chiama la fn [fnToCallWhenFinished]
 */
var save_fnToCallWhenFinished = "";
function save (fnToCallWhenFinished)
{
	save_fnToCallWhenFinished = fnToCallWhenFinished;
	
	ui.getWindowByID(currentPageID).saveToDA3(da3); 
	var blockList = da3.compare();
	var nBlocchi = blockList.length;
	if (nBlocchi > 0)
	{
		//ci sono dei blocchi da3 che sono stati modificati
		pleaseWait_show();
		pleaseWait_freeText_setText("データファイルの保存中、お待ち下さい。...<br>");
		pleaseWait_freeText_show();
		save_storeDA3Block_step (1, nBlocchi, blockList);
	}
	else
		save_onFinished();
}

function save_storeDA3Block_step (uno_di, nBlocchi, blockList)
{
	console.log ("DA3 save " +uno_di +" di " +nBlocchi);
	var blockNum = blockList[uno_di-1];
	pleaseWait_freeText_appendText (uno_di +"/" +nBlocchi +"&nbsp;&nbsp;&nbsp;block " +blockNum +"... ");
			
	da3.storeBlock (uno_di, nBlocchi, blockNum).then (function(result)
	{
		pleaseWait_freeText_appendText (result +"<br>");
		
		if (result != "OK")
		{
			setTimeout ( function() { save_storeDA3Block_step (uno_di, nBlocchi, blockList); }, 400 );
			return;
		}
		
		
		da3.copyBlockToOriginal(blockNum);
		if (uno_di >= nBlocchi)
		{
			setTimeout ( function() { save_onFinished(); }, 100);
			return;
		}
		
		uno_di++;
		setTimeout ( function() { save_storeDA3Block_step (uno_di, nBlocchi, blockList); }, 100);
	})
	.catch( function(result)
	{
		setTimeout ( function() { save_storeDA3Block_step (uno_di, nBlocchi, blockList); }, 400 );
	});		
}

function save_onFinished() 	{  save_fnToCallWhenFinished.call(); }


/***************************************************************************
 *
 * menu linguaggio
 * 
 */
function menuLang_show(bShow)
{
	var e = rheaGetElemByID("divMenuLang");
	if (bShow)
		rheaShowElem(e);
	else
		rheaHideElem(e);
}

function menuLang_onUserSelected(iso)
{
	rhea.ajax ("setLastUsedLangPrgMenu", { "lang":iso}).then( function(result)
	{
		window.location = "index_" +iso +".html";
	})
	.catch( function(result)
	{
		window.location = "index_" +iso +".html";
	});	
}

/***************************************************************************
 *
 * pin code
 *
 */
var pagePinCode_currentPin;
var pagePinCode_callback = null;
function pagePinCode_doShowAndTrapOnEnd (callbackOnEnd)
{
	pagePinCode_currentPin = "";
	pagePinCode_callback = callbackOnEnd;
	rheaSetElemHTML (rheaGetElemByID("pagePinCodeDisplay"), "");
	rheaShowElem(rheaGetElemByID("pagePinCode"));
}

function pagePinCode_hide()						{ rheaHideElem(rheaGetElemByID("pagePinCode")); }

function pagePinCode_onBtnPress (btnPressed)
{
	pagePinCode_currentPin += btnPressed.toString();
	//console.log ("curpin:" +pagePinCode_currentPin);
	
	var d = rheaGetElemByID("pagePinCodeDisplay");
	if (pagePinCode_currentPin.length >= 3)
	{
		rheaSetElemHTML (d, "***");
		pagePinCode_callback (pagePinCode_currentPin);
	}
	else
	{
		var maskedPin = "";
		for (var i=0; i<pagePinCode_currentPin.length; i++)
			maskedPin += "*";
		rheaSetElemHTML (d, maskedPin);
	}
}

var pagePinCode_alreadyAsked = 0; 
var pagePinCode_maxNumTry;
function pagePinCode_askPinCodeForEnteringProgMenu()
{
	if (pagePinCode_alreadyAsked || da3.isProgMenuPinCodeEmpy())
	{
		pagePinCode_alreadyAsked=1;
		return;
	}
	pagePinCode_maxNumTry = 3;
	pagePinCode_doShowAndTrapOnEnd (pagePinCode_askPinCodeForEnteringProgMenu_onEnd);
}

function pagePinCode_askPinCodeForEnteringProgMenu_onEnd(userEnteredPIN)
{
	if (da3.validateProgMenuPinCode(userEnteredPIN))
	{
		pagePinCode_alreadyAsked = 1;
		pagePinCode_hide();
		setTimeout (pageMainMenu_show(), 10);
	}
	else
	{
		pagePinCode_maxNumTry--;
		if (pagePinCode_maxNumTry <= 0)
			gotoHMI();
		else
			pagePinCode_doShowAndTrapOnEnd (pagePinCode_askPinCodeForEnteringProgMenu_onEnd);
	}
}


/***************************************************************************
 *
 * are you sure
 *
 */
var areYouSure_callbackYES = null;
function areYouSureYouWishToLaunchTheChosenOperation (callbackYES)
{
	areYouSure_callbackYES = callbackYES;
	rheaShowElem(rheaGetElemByID("divAreYouSure"));
}

function areYouSure_onBtnYES()
{
	rheaHideElem(rheaGetElemByID("divAreYouSure"));
	setTimeout (areYouSure_callbackYES, 10);
}

function areYouSure_onBtnNO()
{
	rheaHideElem(rheaGetElemByID("divAreYouSure"));
}

/***************************************************************************
 *
 * manuale
 *
 */
function manualViewBox_show()
{
	rheaShowElem(rheaGetElemByID("manualViewBox"));
	var f = document.getElementById("manualViewBoxFrame");
	f.src = "../../last_installed/manual/" +manualFolderName +"/index.html";
}
function manualViewBox_close()		{ rheaHideElem(rheaGetElemByID("manualViewBox")); }



/***************************************************************************
 *
 * pageMainMenu
 *
 */
function pageMainMenu_show()
{
	pagePinCode_askPinCodeForEnteringProgMenu();
	var title = "<div style='margin-left:140px'><center><img  src='img/iconHome.png'> プログラミングメニュー</center></div>";
	showPage("pageMainMenu", title, 0, 0);
	rheaShowElem(rheaGetElemByID("divCurLang"));
}


/***************************************************************************
 *
 * pageGrinderCleaning
 *
 */
function pageGrinderCleaning_show()
{
	if (showPage("pageGrinderCleaning", "グラインダークリーニング", 0, 0))
	{
		//è la prima volta che visualizziamo la pagina
		
		var opzioniPerMacine = "1|グラインダー 1|2|グラインダー 2";
		for (var i=2; i<da3.getNumMacine(); i++)
			opzioniPerMacine += "|" +(i+1) +"|グラインダー " +(i+1);
		uiStandAloneOptionGrinderCleaning1or2.changeOptions (opzioniPerMacine);
		uiStandAloneOptionGrinderCleaning1or2.selectOptionByIndex(0);
	}
	
	currentTask = new TaskGrinderClean();
	currentTask.step1();
}
	
function pageGrinderCleaning_goBack()			
{ 
	rheaHideElem(rheaGetElemByID("pagePleaseWait_grinderCleaning"));
	//btnBack_defaultCallback(); 
	currentTask = voidTask;
	pageCleaning_show();
}



/***************************************************************************
 *
 * pageMaintenance
 *
 */
function pageMaintenance_show()
{
	if (showPage("pageMaintenance", "メンテナンス", 1, 1))
	{
		//è la prima volta che visualizziamo la pagina
		if (da3.isInstant())
		{
			rheaHideElem(rheaGetElemByID("pageMaintenance_rowDis"));
			rheaHideElem(rheaGetElemByID("pageMaintenance_decCofBrew"));
			rheaHideElem(rheaGetElemByID("pageMaintenance_decCofGround"));
		}
	}

	pageMaintenance_getDecountersValues();		
	pageMaintenance_refreshOFFList(0);
	pageMaintenance_onSelector();
	currentTask = new TaskMaintenance();
}

function pageMaintenance_onSelector()
{
	var elemGS = rheaGetElemByID("pageMaintenance_gs");
	var elemINST = rheaGetElemByID("pageMaintenance_inst");
	var elemOFF = rheaGetElemByID("pageMaintenance_off");
	rheaHideElem(elemGS);
	rheaHideElem(elemINST);
	rheaHideElem(elemOFF);
	
	var win = ui.getWindowByID("pageMaintenance");
	switch (parseInt(win.getChildByID("pageMaintenance_selector").getSelectedOptionValue()))
	{
		case 0: rheaShowElem(elemGS); break;
		case 1: rheaShowElem(elemINST); break;
		case 2: rheaShowElem(elemOFF); break;
	}
	win.showHideScrollBar();
}


var pageMaintenance_offListHTML="";
function pageMaintenance_refreshOFFList(startIndex)
{
	if (startIndex == 0)
	{
		pageMaintenance_offListHTML="";
		rheaSetDivHTMLByName("pageMaintenance_off_content", "<center><img src='img/animationRound.gif'></center>");
	}

	rhea.ajax ("getOFFList", { "startIndex":startIndex}).then( function(result)
	{
		var data = JSON.parse(result);
		
		if (startIndex == 0)
		{
			pageMaintenance_offListHTML = "<table class='dataAudit' align='center' width='80%'>"
					+"<tr valign='middle'>"
					+"	<th>DATE yyyy/mm/dd</td>"
					+"	<th>TIME</td>"
					+"	<th>OFF CODE</td>"
					+"</tr>";
		}
			
		var numOffs = data.yyyy.length;
		for (var i=0; i<numOffs; i++)
		{
			//la CPU per errore potrebbe mandare degli OFF con data 2001/01/01 alle 01:01 codice:1
			//Questi OFF li filtro e non li mostro
			if (data.yyyy[i]==2001 && data.mm[i]==1 && data.dd[i]==1 && data.hh[i]==1 && data.min[i]==1)
				continue;
			var rowCss="";
			pageMaintenance_offListHTML += "<tr valign='middle'" +rowCss +">"
					+"<td>" +data.yyyy[i] +"/" +data.mm[i] +"/" +data.dd[i] +"</td>"
					+"<td>" +data.hh[i] +":" +data.min[i] +"</td>"
					+"<td>" +data.codice[i] +data.tipo[i] +"</td>"
					"+</tr>";
		}
		
		if (data.nextIndex == 0)
		{
			pageMaintenance_offListHTML += "</table>";
			var d = rheaGetElemByID("pageMaintenance_off_content");
			rheaSetElemHTML(d, pageMaintenance_offListHTML);
			
			win = ui.getWindowByID("pageMaintenance");
			win.showHideScrollBar();
		}
		else
			setTimeout (function(){ pageMaintenance_refreshOFFList(data.nextIndex); }, 200);
	})
	.catch( function(result)
	{
		//console.log ("ERROR");
		console.log (result);
	});
}

function pageMaintenance_formatHTMLForTemperature(jsonObj)
{
	var html = "今の温度: ";
	if (da3.isInstant())
	{
		html += "boiler=[" +jsonObj.tbol +"&deg;] ";
	}
	else
	{
		if (da3.isInduzione())
		{
			html += "heater=[" +jsonObj.tcam +"&deg;] &nbsp;&nbsp;&nbsp;&nbsp;";
			html += "milker=[" +jsonObj.tcap +"&deg;]";
		}
		else
		{
			html += "espresso=[" +jsonObj.tbol +"&deg;] &nbsp;&nbsp;&nbsp;&nbsp;";
			html += "heater=[" +jsonObj.tcam +"&deg;] &nbsp;&nbsp;&nbsp;&nbsp;";
			html += "milker=[" +jsonObj.tcap +"&deg;]";
		}
	}	
	return html;	
}

function pageMaintenance_resetDec(iDecounter)
{
	//per prima cosa devo salvare eventuali modifiche
	save( function(){ pageMaintenance_reset_afterSave(iDecounter); } );
}
function pageMaintenance_reset_afterSave(iDecounter)
{
	var currentCapacityID = "pageMaintenance_" +iDecounter +"_cap";
	var decValue = parseInt(ui.getWindowByID("pageMaintenance").getChildByID(currentCapacityID).getValue());
		
	if (iDecounter == 15)
	{
		//il valore "vero" sarebbe decValue * 1000, ma CPU non accetta numeri maggiori di 0xffff quindi lo vuole
		//indicato come decValue * 100
		decValue*=100;
	}
	
	//invio il comando di set alla SMU
	pleaseWait_show();
	rhea.ajax ("setDecounter", { "d":iDecounter, "v":decValue}).then( function(result)
	{
		//chiedo i decontatori alla SMU
		pageMaintenance_getDecountersValues();
	})
	.catch( function(result)
	{
		pleaseWait_hide();
	});
}


function pageMaintenance_getDecountersValues()
{
	//recupera il valore attuale dei decounter
	rhea.ajax ("getAllDecounters", "").then( function(result)
	{
		pageMaintenance_updateDecounterCurrentValueFromString(result);
		pleaseWait_hide();
	})
	.catch( function(result)
	{
		pleaseWait_hide();
	});		
}

function pageMaintenance_updateDecounterCurrentValueFromString(s)
{
	//la stringa s include 10 decounter prodotti, decounter water filter, decounter coffee brewer, decounter coffee ground, blocking_counter
	//A partire da 2021-05-10 include anche il decounter maintenance
	var e = s.split(",");
	for (var i=10; i<13; i++)
	{
		var iDecounter = i+1;
		var currentValueID = "pageMaintenance_" +iDecounter;
		var v = e[i];
		
		var len = 4;
		if (i == 10)
			len = 5;
		while (v.length < len)
			v = "0" +v;
		rheaSetDivHTMLByName(currentValueID, v);
	}
	
	//se esiste il dec maintenace...
	if (e.length >= 14)
	{
		var v = e[14];
		var len = 3;
		while (v.length < len)
			v = "0" +v;
		rheaSetDivHTMLByName("pageMaintenance_15", v);
	}
}

function pageMaintenance_disinstall()
{
	pleaseWait_show();
	currentTask = new TaskDisintall();
}

function pageMaintenance_disinstall_onAbort()
{
	currentTask = voidTask;
}

/***************************************************************************
 *
 * pageCleaning
 *
 */
function pageCleaning_show()
{
	if (showPage("pageCleaning", "クリーニング/ <br>リンス", 1 ,1))
	{
		//è la prima volta che visualizziamo la pagina
		var w = ui.getWindowByID("pageCleaning");
		
		if (da3.isInstant())
		{
			w.getChildByID("pageCleaning_btnCleanHC").hide();
			w.getChildByID("pageCleaning_btnCleanGrinder").hide();
			w.getChildByID("pageCleaning_btnDescaling").hide();
		}
		else
		{
			//macchine espresso
			if (!da3.isGruppoVariflex())
				w.getChildByID("pageCleaning_btnDescaling").hide();
				
			if (da3.isMachine_Brewmatic4Macine())
			{
				w.getChildByID("pageCleaning_btnClean1").hide();
				w.getChildByID("pageCleaning_btnClean2").hide();
				w.getChildByID("pageCleaning_btnClean3").hide();
				w.getChildByID("pageCleaning_btnClean4").hide();
			}
		}
	}
}


function pageCleaning_action (what)
{
	areYouSureYouWishToLaunchTheChosenOperation(
		function YES()
		{
			pleaseWait_show();
			
			if (what == 8) //cleaning HC
				save( function(){ pageCleaning_startLavSanitario(8,1); } );
			else if (what==5) //milker
				pageCleaning_startLavSanitario(what,1);
			else
			{
				currentTask = new TaskCleaning(what, da3.isEspresso());
				rhea.requestGPUCleaning(parseInt(what));
			}
		}
	);
}

function pageCleaning_startLavSanitario (what, bSendRequestToGPU)
{
	pleaseWait_show();
	rhea.requestGPUEvent(RHEA_EVENT_CPU_MESSAGE);
	currentTask = new TaskCleaning(what, da3.isEspresso());
	if (bSendRequestToGPU)
		rhea.requestGPUCleaning(parseInt(what));
}

function pageCleaning_onFinished()
{
	if (currentTask.whichWash == 5)
	{
		//se ho terminato il lav san del cappuccinatore, chiedo alla CPU
		//il nuovo orario del prossimo lavaggio
		rhea.ajax ("getTimeLavSanCapp", "").then( function(result)
		{
			var win = ui.getWindowByID("pageMilker");
			var obj = win.getChildByID("pageMilker_autoCleanAtTime"); //auto clean at time
			var data = JSON.parse(result);
			//console.log ("obj:" +obj);
			if (null != obj)
			{
				obj.setValueHH(data.h);
				obj.setValueMM(data.m);
			}
			var v = parseInt(data.h) * 100 + parseInt(data.m);
			da3.write16(7468, v);			
		})
		.catch( function(result)
		{
		});		
	}

	currentTask = voidTask;
	
	if (bGotoHMIAfterLavaggio)
	{
		gotoHMI();
		return;
	}
		
	pleaseWait_hide();
}

	
	
/***************************************************************************
 *
 * pageMiscellaneous
 *
 */
var pageMiscellaneous_fvhBefore = 0;
function pageMiscellaneous_show()
{
	var win = ui.getWindowByID("pageMiscellaneous");
	if (showPage("pageMiscellaneous", "その他", 1, 1))
	{
		//è la prima volta che visualizziamo la pagina
		var selOptions = "0|ゼネラルオプション|1|マシンID|2|ミルクLM|3|FREEVEND|4|ブロッキングカウンター";
		if (da3.isMachine_Brewmatic4Macine())
			selOptions +="|5|VIBRATION";
		var uiSelector = win.getChildByID("pageMiscellaneous_selector");
		uiSelector.changeOptions (selOptions);
		uiSelector.selectOptionByIndex(0);

		var opt = win.getChildByID("pageMiscellaneous_cpuLang");
		opt.changeOptions ("0|" +cpuLangName1 +"|1|" +cpuLangName2);
		
		if (da3.isEspresso())
		{
			rheaHideElem (rheaGetElemByID("pageMiscellaneous_r1"));
			rheaHideElem (rheaGetElemByID("pageMiscellaneous_r2"));
		}
		else
		{
			rheaHideElem (rheaGetElemByID("pageMiscellaneous_fmilkTopping"));
		}
		if (da3.isGruppoMicro())
			rheaHideElem (rheaGetElemByID("pageMiscellaneous_fmilkTopping"));
		
		if (da3.isMachine_MultibonaInstant() || da3.isMachine_MinibonaInstant())
			rheaHideElem (rheaGetElemByID("pageMiscellaneous_r1"));
		
		var objDataAuditBefore = win.getChildByID("pageMiscellaneous_gs_auditBefore");
		var objFvHWKey = win.getChildByID("pageMiscellaneous_fvHwKey");
		if (da3.isInduzione())
		{
			//versione induzione
			objDataAuditBefore.da3Pos=7106;
			objFvHWKey.da3Pos=7104;
		}
		else
		{
			//versione bollitore
			objDataAuditBefore.da3Pos=7088
			objFvHWKey.da3Pos=7106;
		}

		objDataAuditBefore.loadFromDA3(da3);
		objFvHWKey.loadFromDA3(da3);
		
		win.showHideScrollBar();
	}
	btnSave_setCallback ("pageMiscellaneous_onBtnSave()");
	pageMiscellaneous_fv_refresh();
	pageMiscellaneous_blockingCounter_refresh();
	pageMiscellaneous_onSelector();
	pageMiscellaneous_setPINCode (da3.read16(7060));
	pageMiscellaneous_setQuickPINCode (da3.read16(8378));
}

function pageMiscellaneous_onBtnSave()
{
	var menuProgPIN = document.getElementById("pageMiscellaneous_curPIN").innerHTML;
	da3.write16(7060, parseInt(menuProgPIN));
	
	var menuQuickPIN = document.getElementById("pageMiscellaneous_curQuickPIN").innerHTML;
	da3.write16(8378, parseInt(menuQuickPIN));

	btnSave_defaultCallback();
}

function  pageMiscellaneous_setPINCode(pin)
{
	pin = pin.toString();
	while (pin.length < 3)
		pin = "0" + pin;
	rheaSetElemHTML(rheaGetElemByID("pageMiscellaneous_curPIN"), pin);
}
function pageMiscellaneous_askForNewPINCode()							{ pagePinCode_doShowAndTrapOnEnd (pageMiscellaneous_askForNewPINCode_onEnd); }
function pageMiscellaneous_askForNewPINCode_onEnd(userEnteredPIN)		{ pageMiscellaneous_setPINCode (userEnteredPIN); pagePinCode_hide(); }

function  pageMiscellaneous_setQuickPINCode(pin)
{
	pin = pin.toString();
	while (pin.length < 3)
		pin = "0" + pin;
	rheaSetElemHTML(rheaGetElemByID("pageMiscellaneous_curQuickPIN"), pin);
}
function pageMiscellaneous_askForNewQuickPINCode()							{ pagePinCode_doShowAndTrapOnEnd (pageMiscellaneous_askForNewQuickPINCode_onEnd); }
function pageMiscellaneous_askForNewQuickPINCode_onEnd(userEnteredPIN)		{ pageMiscellaneous_setQuickPINCode (userEnteredPIN); pagePinCode_hide(); }



function pageMiscellaneous_blockingCounter_refresh()
{
	//valore attuale del blocking counter
	pleaseWait_show();
	rhea.ajax ("getAllDecounters", "").then( function(result)
	{
		var e = result.split(",");
		var v = e[13];
		while (v.length < 5)
			v = "0" +v;
		rheaSetDivHTMLByName("pageMiscellaneous_blockingCt_unblocked_curct", v);
		pleaseWait_hide();
	})
	.catch( function(result)
	{
		rheaSetDivHTMLByName("pageMiscellaneous_blockingCt_unblocked_curct", "?????");
		pleaseWait_hide();
	});	
}

function pageMiscellaneous_blockingCounter_set()
{
	//per prima cosa devo salvare eventuali modifiche
	save( function(){ pageMiscellaneous_blockingCounter_set_afterSave(); } );
}
function pageMiscellaneous_blockingCounter_set_afterSave()
{
	var counter = parseInt(ui.getWindowByID("pageMiscellaneous").getChildByID("pageMiscellaneous_blockingCt_newValue").getValue());
		
	//invio il comando di set alla SMU
	pleaseWait_show();
	rhea.ajax ("setDecounter", { "d":14, "v":counter}).then( function(result)
	{
		pageMiscellaneous_blockingCounter_refresh();
		
	})
	.catch( function(result)
	{
		console.log ("ERR: pageMiscellaneous_blockingCounter_set_afterSave()");
		pleaseWait_hide();
	});
}

function pageMiscellaneous_fv_refresh()
{
	var win = ui.getWindowByID("pageMiscellaneous");

	//data e ora di fine freevend
	var enddate_minute = da3.read8(8435);
	var enddate_hh = da3.read8(8436);
	var enddate_gg = da3.read8(8437);
	var enddate_mm = da3.read8(8438);
	var enddate_yy = 2000 + da3.read8(8439);
	var dataScadenza = new Date(enddate_yy, enddate_mm-1, enddate_gg, enddate_hh, enddate_minute, 0, 0);

	var dataNow = new Date(dataora_yy, dataora_mm-1, dataora_dd, dataora_hh, dataora_min, 0, 0);
	var minuteLeft = Math.floor ((dataScadenza - dataNow) / 60000);
	if (minuteLeft < 0 || minuteLeft >= 255*60)
	{
		//freevend non in corso
		rheaSetDisplayMode(rheaGetElemByID("pageMiscellaneous_fv_r1"), "table-row");
		rheaHideElem(rheaGetElemByID("pageMiscellaneous_fv_r2"));
		da3.freevendFasciaOraria_stopItNow();
	}
	else
	{
		//freevend in corso
		rheaHideElem(rheaGetElemByID("pageMiscellaneous_fv_r1"));
		rheaSetDisplayMode(rheaGetElemByID("pageMiscellaneous_fv_r2"), "table-row");

		if (enddate_mm <10) enddate_mm = "0" +enddate_mm;
		if (enddate_gg <10) enddate_gg = "0" +enddate_gg;
		if (enddate_hh <10) enddate_hh = "0" +enddate_hh;
		if (enddate_minute <10) enddate_minute = "0" +enddate_minute;
		rheaSetDivHTMLByName("pageMiscellaneous_fvDateEnd", "<i>Freevendはオンになります<br>" + enddate_yy +"/" +enddate_mm +"/" +enddate_gg +" " +enddate_hh +":" +enddate_minute);
	}
}

function pageMiscellaneous_startFVNow()
{
	var win = ui.getWindowByID("pageMiscellaneous");
	var h = parseInt(win.getChildByID("pageMiscellaneous_fvH").getValue());
	if (h < 1)
		return;
	
	pleaseWait_show();
	var dataNow = new Date(dataora_yy, dataora_mm-1, dataora_dd, dataora_hh, dataora_min, 0, 0);
	da3.freevendFasciaOraria_startNowAndLastForNHours(dataNow, h);
	save( function(){ pageMiscellaneous_stopFVNow_onFinish(); } );
}


function pageMiscellaneous_stopFVNow()
{
	pleaseWait_show();
	da3.freevendFasciaOraria_stopItNow();
	save( function(){ pageMiscellaneous_stopFVNow_onFinish(); } );
}

function pageMiscellaneous_stopFVNow_onFinish()
{
	//notifica la CPU di aggiornare il suo stato di freevend
	setTimeout ( function() { pageMiscellaneous_sendP15(); }, 1000);
}

function pageMiscellaneous_sendP15()
{
	var buffer = new Uint8Array(1);
	buffer[0] = 66;
	rhea.sendGPUCommand ("E", buffer, 0, 0);
	pageMiscellaneous_fv_refresh();
	pleaseWait_hide();
}

function pageMiscellaneous_oldProgMenu()		
{ 
	window.location = "gotoLegacyMenu.html"; 
}

function  pageMiscellaneous_onSelector()
{
	var elemGS = rheaGetElemByID("pageMiscellaneous_gs");
	var elemMID = rheaGetElemByID("pageMiscellaneous_mid");
	var elemLM = rheaGetElemByID("pageMiscellaneous_lm");
	var elemFV = rheaGetElemByID("pageMiscellaneous_fv");
	var elemBCT = rheaGetElemByID("pageMiscellaneous_blockingCt");
	var elemAdvGrinder = rheaGetElemByID("pageMiscellaneous_advGrinder");
	
	rheaHideElem(elemGS);
	rheaHideElem(elemMID);
	rheaHideElem(elemLM);
	rheaHideElem(elemFV);
	rheaHideElem(elemBCT);
	rheaHideElem(elemAdvGrinder);
	
	var win = ui.getWindowByID("pageMiscellaneous");
	switch (parseInt(win.getChildByID("pageMiscellaneous_selector").getSelectedOptionValue()))
	{
		case 0: rheaShowElem(elemGS); break;
		case 1: rheaShowElem(elemMID); break;
		case 2: rheaShowElem(elemLM); break;
		case 3: rheaShowElem(elemFV); break;
		case 4: rheaShowElem(elemBCT); break;
		case 5: rheaShowElem(elemAdvGrinder); break;
	}
	win.showHideScrollBar();
}

function pageMiscellaneous_onPINCodeInserted()
{
	var win = ui.getWindowByID("pageMiscellaneous");

	var pinCode = parseInt(da3.read16(7404));
	if (pinCode==0)	
	{
		//la CPU impone il codice "123" nel caso in cui nel da3 sia memorizzato "000"
		pinCode=123;
		win.getChildByID("pageMiscellaneous_newpincode").setValue("123");
	}
		
		
	var pinCodeObj = win.getChildByID("pageMiscellaneous_pincode");
	if (parseInt(pinCodeObj.getValue()) != pinCode)
	{
		pinCodeObj.setValue("000");
		return;
	}


	rheaHideElem (rheaGetElemByID("pageMiscellaneous_blockingCt_pwd"));
	rheaShowElem (rheaGetElemByID("pageMiscellaneous_blockingCt_unblocked"));
	win.showHideScrollBar();
}


/***************************************************************************
 *
 * pageProductQty
 *
 */
function pageProductQty_show()
{
	if (showPage("pageProductQty", "製品数量設定", 1,1))
	{
		//è la prima volta che visualizziamo la pagina
		pageProductQty_getDecounterValues();
	}
	pageProductQty_showDecounter();
	
	//aggiorno le unità di misura
	var win = ui.getWindowByID("pageProductQty");
	for (var i=0; i<da3.getNumProdotti(); i++)
	{
		var um = "sec";
		if (da3.isMotorCalibrated(i+1)) 
			um = "gr"; 

		win.getChildByID("pageProductQty_decCurCap_" +(i+1)).changeUM(um);
		win.getChildByID("pageProductQty_decCurWarn_" +(i+1)).changeUM(um);
	}	
	
	
	//chiedo il valore attuale dei decontatori alla SMU
	pleaseWait_show();
	rhea.ajax ("getAllDecounters", "").then( function(result)
	{
		pageProductQty_updateDecounterCurrentValueFromString(result);
		pleaseWait_hide();
	})
	.catch( function(result)
	{
		pleaseWait_hide();
	});	
}

function pageProductQty_build()
{
	var nProdotti = da3.getNumProdotti();
	var da3Loc_decounter = 7334;
	var da3Loc_warning = da3Loc_decounter +2*nProdotti;
	var da3Loc_enable = da3Loc_warning +2*nProdotti;
	var html = "";
	
	var dataOption = "1|1";
	for (var i=2; i<=nProdotti; i++)
		dataOption += "|" +i +"|" +i;
		
	html = 	"<table border='0' width='100%'><tr valign='middle'>"
			+"	<td style='width:160px'><b>カウンター設定メニューを選択</b></td>"
			+"	<td><div class='UIOptionSmall' id='pageProductQty_decSelector' data-option='" +dataOption +"' data-onclick='pageProductQty_showDecounter()'></div></td>"
			+"</tr></table><br>";
	
	for (var i=0; i<nProdotti; i++)
	{
		var num = (i+1);
		if (i<9) num = "0" +num;
		num = "#" +num;
		
		var pageID = "pageProductQty_page_" +(i+1);
		var currentValueID = "pageProductQty_decCurVal_" +(i+1);
		var currentCapacityID = "pageProductQty_decCurCap_" +(i+1);
		var currentWarningID = "pageProductQty_decCurWarn_" +(i+1);
		
		var currentDecountValue = "00000";
		
		html +=  "<div id='" +pageID +"' style='display:none'>"
				+"<table border='0' class='elenco'>"
				+"	<tr style='height:70px'>"
				+"		<td style='width:300px'>デカウンター #" +(i+1) +"<br>現在の価値</td>"
				+"		<td style='width:400px'><span id='" +currentValueID +"' class='bigCaption25'>" +currentDecountValue +"</span></td>"
				+"		<td align='center'><div class='UIButton bigButton60 actionButton' data-caption='リセット' data-onclick='pageProductQty_reset(" +(i+1) +")'></div></td>"
				+"	</tr>"
				+"	<tr><td>キャニスター容量</td><td colspan='2'><div id='" +currentCapacityID +"' class='UINumber' data-numfigures='5' data-decimal='1' data-da3='" +da3Loc_decounter +"' data-max='60000' data-um='sec'></div></td></tr>"
				+"	<tr><td>警告</td><td colspan='2'><div id='" +currentWarningID +"' class='UINumber' data-numfigures='5' data-decimal='1' data-da3='" +da3Loc_warning +"' data-max='60000' data-um='sec'></div></td></tr>"
				+"	<tr style='border:0'><td>プロダクト停止の有効</td><td colspan='2'><div class='UIOption' data-option='1|はい|0|ナンバー' data-da3='" +da3Loc_enable +"'></div></td></tr>"
				+"</table></div>";
		da3Loc_decounter+=2;
		da3Loc_warning+=2;
		da3Loc_enable+=2;
	}
	
	rheaSetDivHTMLByName("pageProductQty_content", html);
}

function pageProductQty_showDecounter()
{
	var opt = ui.getWindowByID("pageProductQty").getChildByID("pageProductQty_decSelector");
	var decSelected = opt.getSelectedOptionValue();
	
	var nProdotti = da3.getNumProdotti();
	for (var i=1; i<=nProdotti; i++)
	{
		var pageID = "pageProductQty_page_" +i;
		if (i == decSelected)
			rheaShowElem(rheaGetElemByID(pageID));
		else
			rheaHideElem(rheaGetElemByID(pageID));
	}
}

function pageProductQty_updateDecounterCurrentValueFromString(s)
{
	var e = s.split(",");
	for (var i=0; i<e.length; i++)
	{
		var iDecounter_1_10 = i+1;
		var currentValueID = "pageProductQty_decCurVal_" +iDecounter_1_10;
		
		var um = "sec";
		if (da3.isMotorCalibrated(iDecounter_1_10)) 
			um = "gr"; 		
		
		var v = e[i];
		while (v.length < 5)
			v = "0" +v;
		var s = v.substr(0,4) +"." +v.substr(4) +"<span style='font-size:0.4em'> " +um +"</span>";
		
		rheaSetDivHTMLByName(currentValueID, s);
	}
}

function pageProductQty_reset (iDecounter_1_10)
{
	//per prima cosa devo salvare eventuali modifiche
	save( function(){ pageProductQty_reset_afterSave(iDecounter_1_10); } );
}
function pageProductQty_reset_afterSave(iDecounter_1_10)
{
	var currentCapacityID = "pageProductQty_decCurCap_" +iDecounter_1_10;
	var decValue = parseInt(ui.getWindowByID("pageProductQty").getChildByID(currentCapacityID).getValue());
		
	//invio il comando di set alla SMU
	pleaseWait_show();
	rhea.ajax ("setDecounter", { "d":iDecounter_1_10, "v":decValue}).then( function(result)
	{
		//chiedo i decontatori alla SMU
		pageProductQty_getDecounterValues();
	})
	.catch( function(result)
	{
		pleaseWait_hide();
	});
}

function pageProductQty_getDecounterValues()
{
	rhea.ajax ("getAllDecounters", "").then( function(result)
	{
		pageProductQty_updateDecounterCurrentValueFromString(result);
		pleaseWait_hide();
	})
	.catch( function(result)
	{
		pleaseWait_hide();
	});		
}



/***************************************************************************
 *
 * pageMilker
 *
 */
function pageMilker_show()
{
	if (showPage("pageMilker", "ミルカー", 1,1))
	{
		//è la prima volta che visualizziamo la pagina.
	}
	
	btnSave_setCallback ("pageMilker_onBtnSave()");
	
	//se la temperatura del milker riportata nel DA3 è zero, allora il milker è disabled
	var win = ui.getWindowByID("pageMilker");
	var yesNo = win.getChildByID("pageMilker_enabled");
	
	var temperatureOnDA3 = da3.read8(7618);
	console.log ("milker temperatura on DA3=[" +temperatureOnDA3 +"]");
	if (temperatureOnDA3 == 0)
		yesNo.selectOptionByValue(0);
	else
		yesNo.selectOptionByValue(1);
		
	pageMilker_onMilkerTypeChange();
}

function pageMilker_onMilkerTypeChange()
{
	var NUM_PARAM_CAPP_VENTURI=5;
	var NUM_PARAM_CAPP_INDUX = 5;
	var win = ui.getWindowByID("pageMilker");
	var milkerModule = win.getChildByID("pageMilker_model");
	var yesNo = win.getChildByID("pageMilker_enabled");

	switch (parseInt(milkerModule.getSelectedOptionValue()))
	{
	case 0: //se milkerType==none, allora metto yesNo==no
		yesNo.selectOptionByValue(0);
		break;
		
	case 1: //milkerType==venturi
		rheaShowElem(rheaGetElemByID("pageMilker_capp_venturi"));
		rheaHideElem(rheaGetElemByID("pageMilker_capp_induzione"));
		for (var i=1; i<=NUM_PARAM_CAPP_VENTURI; i++)
			win.getChildByID("pageMilker_capp_venturi_" +i).allowSaveToDa3();
		for (var i=1; i<=NUM_PARAM_CAPP_INDUX; i++)
			win.getChildByID("pageMilker_capp_indux_" +i).dontSaveToDa3();
		break;

	case 2: //milkerType==indux
		rheaShowElem(rheaGetElemByID("pageMilker_capp_induzione"));
		rheaHideElem(rheaGetElemByID("pageMilker_capp_venturi"));
		for (var i=1; i<=NUM_PARAM_CAPP_INDUX; i++)
			win.getChildByID("pageMilker_capp_indux_" +i).allowSaveToDa3();
		for (var i=1; i<=NUM_PARAM_CAPP_VENTURI; i++)
			win.getChildByID("pageMilker_capp_venturi_" +i).dontSaveToDa3();
		break;
	}

	pageMilker_onEnabledYesNo();
	win.showHideScrollBar();
}

function pageMilker_onMilkerTypeChange_fromUser()
{
	//utente ha selezionato un nuovo tipo di capp.
	//Se attualmente ero "enabled == NO", sposto a "enabled==YES"
	var win = ui.getWindowByID("pageMilker");
	var milkerModule = win.getChildByID("pageMilker_model");
	var yesNo = win.getChildByID("pageMilker_enabled");

	switch (parseInt(milkerModule.getSelectedOptionValue()))
	{
	case 0: //se milkerType==none, allora metto yesNo==no
		yesNo.selectOptionByValue(0);
		break;
		
	case 1: //milkerType==venturi
	case 2: //milkerType==indux
		yesNo.selectOptionByValue(1);
		break;
	}
	pageMilker_onMilkerTypeChange();
}

function pageMilker_onEnabledYesNo()
{
	var win = ui.getWindowByID("pageMilker");
	var yesNo = win.getChildByID("pageMilker_enabled");
	var temperature = win.getChildByID("pageMilker_temperature");
	
	if (yesNo.getSelectedOptionValue() == 0)
	{
		rheaHideElem(rheaGetElemByID("pageMilker_params"));
	}
	else
	{
		if (da3.read8(7618) == 0)
			temperature.setValue("125");
		rheaShowElem(rheaGetElemByID("pageMilker_params"));
	}
	win.showHideScrollBar();
}

function pageMilker_onBtnSave()
{
	var win = ui.getWindowByID("pageMilker");
	var yesNo = win.getChildByID("pageMilker_enabled");
	var temperature = win.getChildByID("pageMilker_temperature");

	if (yesNo.getSelectedOptionValue() == 0)
		temperature.setValue("000");
	
	btnSave_defaultCallback();
}


/***************************************************************************
 *
 * pageSelections
 *
 */
function pageSelections_show()
{
	if (showPage("pageSelections", "メニューボタン設定", 1,0))
	{
		//è la prima volta che visualizziamo la pagina
	}
	btnTestSelection_hide();
	pageSelections_onSelector();
}

function pageSelections_build()
{
	var html = "";
	
	var iSel = 1;
	
	for (var page=1; page<=4; page++)
	{
		html += "<div id='pageSelections_page" +page +"' style='display:none'><table border='0'><tr>";
		for (var r=0; r<4; r++)
		{
			for (var c=0; c<3; c++)
			{
				var caption = "セレクション " +rheaLeftPad(iSel,2,'0');
				html += "<td width='33%' align='center'><div class='UIButtonSel' "
						+"data-caption='" +caption +"' "
						+"data-caption2='" +guiInfo.selInfo[iSel].name +"' "
						+"data-caption3='" +guiInfo.selInfo[iSel].short +"' "
						+"data-onclick='pageSelections_onClick(" +iSel +")'></div></td>";
				iSel++;
			}
			html += "</tr>";
		}
		html += "</table></div>";
	}
	rheaSetDivHTMLByName("pageSelections_c2", html);
}


function pageSelections_onSelector()
{
	var win = ui.getWindowByID("pageSelections");
	var option = parseInt(win.getChildByID("pageSelections_selector").getSelectedOptionValue());
	for (var page=1; page<=4; page++)
	{
		var elem = rheaGetElemByID("pageSelections_page" +page);
		if (option == page)
			rheaShowElem(elem);
		else
			rheaHideElem(elem);
	}
}

function pageSelections_onClick(iSel)
{
	pleaseWait_show();
	setTimeout (function(){ pageSingleSelection_show(iSel); }, 100);
}

/***************************************************************************
 *
 * pageSingleSelection
 *
 */
var pageSingleSelection_curSel = 0;
function pageSingleSelection_show(iSel)
{
	pageSingleSelection_curSel = iSel;
	
	var title = "セレクション " +rheaLeftPad(iSel,2,'0') +"&nbsp;-&nbsp;" +guiInfo.selInfo[iSel].name +"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style='font-size:0.7em;color:#888'>" +UIUtils_arrangeSelectionOptionDescription2021(guiInfo.selInfo[iSel].short) +"</span>";
	if (showPageEx("pageSingleSelection", title, 1, 1, 100 * (iSel-1)))
	{
		//è la prima volta che visualizziamo la pagina
		if (da3.isGruppoMicro())
			rheaHideElem(rheaGetElemByID("pageSingleSelection_pageSel_rowJug"));
			
		//cup-size vale solo per brewmatic
		if (da3.isMachine_Brewmatic4Macine())
		{
			rheaShowElem_TR(rheaGetElemByID("pageSingleSelection_pageSel_rowCupSizeBrewmatic"));
			rheaHideElem(rheaGetElemByID("pageSingleSelection_pageSel_scalingF"));
			}
		else
		{
			rheaHideElem(rheaGetElemByID("pageSingleSelection_pageSel_rowCupSizeBrewmatic"));
			rheaShowElem_TR(rheaGetElemByID("pageSingleSelection_pageSel_scalingF"));
		}
	}
	btnBack_setCallback("pageSelections_show()");
	btnTestSelection_show();
	
	var win = ui.getWindowByID("pageSingleSelection");
	
	//lo scaling factor delle selezioni potrebbe valere 0 nel qual caso significa 100%
	var da3Loc = 180 + 100 * (iSel-1);
	if (da3.read8(da3Loc) == 0)
		win.getChildByID("pageSingleSelection_sfactor").setValue(100);
	
	//Setto i prezzi
	var obj = win.getChildByID("pageSingleSelection_prc1");
	obj.setDecimals(da3.getDecimalsForPrices());
	obj.da3offset = 0;
	obj.da3Pos = da3.getPriceLocation(1,iSel);
	obj.loadFromDA3(da3);
	
	obj = win.getChildByID("pageSingleSelection_prc2");
	obj.setDecimals(da3.getDecimalsForPrices());
	obj.da3offset = 0;
	obj.da3Pos = da3.getPriceLocation(2,iSel);
	obj.loadFromDA3(da3);	
	
	//unita misura prodotti
	for (var i=0; i<SINGLESEL_NUM_PRODOTTI; i++)
	{
		if (da3.isMotorCalibrated(i+1)) 
			um = "gr"; 
		else
			um = "sec";
		win.getChildByID("pageSingleSelection_P_d"+i).changeUM(um);
	}	
	
	//unita' misura macina
	pageSingleSelection_onChangeGrinder();

	rheaSetElemTop(rheaGetElemByID("pageSingleSelection_content"), 0);
	rheaHideElem(rheaGetElemByID("pageSingleSelection_arrowUp"));
	
	//seleziono "general option"
	win.getChildByID("pageSingleSelection_selector").selectOptionByValue(0);
	pageSingleSelection_showPartialFull (win, 0);
	pageSingleSelection_onStatus();
	
	pleaseWait_hide();
}

function pageSingleSelection_onChangeGrinder()
{
	if (da3.isEspresso())
	{
		var win = ui.getWindowByID("pageSingleSelection");
		var macina = 11 + parseInt(win.getChildByID("pageSingleSelection_cofGrnderChoice").getSelectedOptionValue());
		if (da3.isMotorCalibrated(macina)) 
			um = "gr"; 
		else
			um="sec";
		win.getChildByID("pageSingleSelection_coffeeGrinder").changeUM(um);
	}	
}

var SINGLESEL_NUM_PRODOTTI = 0;
var SINGLESEL_NUM_ACQUE = 0;
function pageSingleSelection_build()
{
	var da3LocProd;
	var da3LocWater;
	var da3LocEVTemperature = 0;
	var WATER_COLONNA_FLOW_TYPE = 0;
	var WATER_COLONNA_FLOW_TITLE = "";
	
	if (da3.isInstant())
	{
		SINGLESEL_NUM_PRODOTTI = 9;
		SINGLESEL_NUM_ACQUE = 5;
		da3LocProd = 102;
		da3ProductLM = da3LocProd +3*SINGLESEL_NUM_PRODOTTI;
		da3LocWater = da3ProductLM +3;
		
		WATER_COLONNA_FLOW_TYPE = 1;
		WATER_COLONNA_FLOW_TITLE = "フロー";
	}
	else
	{
		SINGLESEL_NUM_PRODOTTI = 7;
		SINGLESEL_NUM_ACQUE = 5;
		da3LocProd = 105;
		da3ProductLM = 129;
		da3LocWater = da3ProductLM +3;

		if (da3.isInduzione())
		{
			WATER_COLONNA_FLOW_TYPE=2;
			WATER_COLONNA_FLOW_TITLE = "EV温度";
			da3LocEVTemperature = 169;
		}
		else
			WATER_COLONNA_FLOW_TITLE = "";
	}

	
	var s = "";
	if (da3.isInstant())
		s = "0|概要|2|プロダクツ|3|ウオーター|4|MIXERS";
	else
	{
		//Nelle macchine senza solubili, elimino i menu prodotti e mixer
		if (da3.hasAnyInstant())
			s = "0|概要|1|ESPRESSO|2|プロダクツ|3|ウオーター|4|MIXERS";
		else
			s = "0|概要|1|ESPRESSO|3|ウオーター";
			
	}
	rheaSetDivHTMLByName("pageSingleSelection_selectorAtTop", "<div class='UIOptionSmall' id='pageSingleSelection_selector' data-option='" +s +"' data-onclick='pageSingleSelection_onSelector()'></div>");
	
	
	var htmlE="";
	if (da3.isEspresso())
	{
		htmlE = "<table border='0' class='elenco'>"
				+"<tr><td>コーヒー順番</td><td><div class='UIOption' data-option='0|後|1|前' data-da3='103' data-da3bit='8'></div></td></tr>"
				+"<tr><td>コーヒー湯量<br><div class='UIButton actionButton' data-caption='&nbsp; テスト &nbsp;' data-onclick='pageSingleSelection_test(11)'></div></td><td><div class='UINumber' data-numfigures='3' data-da3='102' data-da3bit='9' data-da3bit9='2,4' data-max='500' data-um='cc'></div></td></tr>"
				+"<tr><td>グラインド時間<br><div class='UIButton actionButton' data-caption='&nbsp; テスト &nbsp;' data-onclick='pageSingleSelection_test(12)'></div></td><td><div class='UINumber' id='pageSingleSelection_coffeeGrinder' data-numfigures='3' data-decimal='1' data-da3='126' data-da3bit='8' data-max='200' data-um='sec'></div></td></tr>"
				+"<tr><td>蒸らし</td><td><div class='UINumber' data-numfigures='2' data-da3='128' data-da3bit='4' data-max='15' data-um='sec'></div></td></tr>";

		if (da3.isGruppoVariflex())
				htmlE += "<tr><td>タンピング圧</td><td><div class='UINumber' data-numfigures='2' data-da3='104' data-da3bit='4' data-max='10'></div></td></tr>";
		
		if (da3.isInduzione())
			htmlE += "<tr><td>コーヒー抽出温度</td><td><div class='UINumber' data-numfigures='3' data-da3='168' data-da3bit='8' data-min='75' data-max='110'></div></td></tr>";
			
		if (da3.isGruppoVariflex())
			htmlE  +="<tr><td>粒度設定</td><td><div class='UIOption' style='font-size:0.9em' data-option='0|無効|1|細かい|2|通常|3|粗い' data-da3='175' data-da3bit='8'></div></td></tr>";
			
		htmlE  +="<tr><td>ラテ・マキアート<br>抽出を始めます</td><td><div class='UINumber' data-numfigures='3' data-decimal='1' data-da3='127' data-da3bit='9' data-da3bit9='1,5' data-max='500' data-um=''></div></td></tr>";
		
		if (da3.isGruppoVariflex())
		{
			htmlE  += "<tr><td>ミルク<br>抽出時間</td><td><div class='UINumber' data-numfigures='3' data-decimal='1' data-da3='162' data-da3bit='9' data-da3bit9='2,4' data-max='500'></div></td></tr>"
					 +"<tr><td>ミルク<br>抽出遅延</td><td><div class='UINumber' data-numfigures='3' data-decimal='1' data-da3='163' data-da3bit='9' data-da3bit9='1,5' data-max='500' data-um='sec'></div></td></tr>";
					
			if (da3.isCappuccinatoreInduzione())
				htmlE  += "<tr><td>ミルク<br>フォームタイプ</td><td><div id='pageSingleSelection_cappInduxFoamType' class='UISelect' data-option='0|ホット(フォーム無)|1|ホットフォーム 1|2|ホットフォーム 2|3|ホットフォーム 3|4|コールド(フォーム無)|5|コールドフォーム 1|6|コールドフォーム 2|7|コールドフォーム 3' data-da3='164' data-da3bit='4'></div></td></tr>";
		
			//minimo 2 macine, ma potrebbero essercene di +
			var optionsForGrinder = "0|1|1|2";
			for (var i=2; i<da3.getNumMacine(); i++)
				optionsForGrinder += "|" +i +"|" +(i+1);
			htmlE  += "<tr><td>ミルク<br>エアー時間</td><td><div class='UINumber' data-numfigures='3' data-decimal='1' data-da3='165' data-da3bit='9' data-da3bit9='2,4' data-max='500' data-um='sec'></div></td></tr>"
				     +"<tr><td>ミルク<br>エアー遅延</td><td><div class='UINumber' data-numfigures='3' data-decimal='1' data-da3='166' data-da3bit='9' data-da3bit9='1,5' data-max='500' data-um='sec'></div></td></tr>"
				     +"<tr><td>グラインダー</td><td><div id='pageSingleSelection_cofGrnderChoice' class='UIOption' data-option='" +optionsForGrinder +"' data-da3='179' data-da3bit='8' data-onclick='pageSingleSelection_onChangeGrinder()'></div></td></tr>";
					 
			//se macchina Brewmatic, allora ci sono le opzioni di time/speed per la macina
			if (da3.isMachine_Brewmatic4Macine())
			{
				htmlE += 	 "<tr><td>VIBRATION TIME</td><td><div class='UINumber'  data-da3bit='8' data-numfigures='3'  data-da3='182' data-max='255' data-um='sec' data-decimal='1'></div></td></tr>"
							+"<tr><td>VIBRATION SPEED</td><td><div class='UINumber' data-da3bit='8' data-numfigures='3' data-da3='183' data-max='100' data-um='%'></div></td></tr>"
			}
		}

		htmlE += "<tr><td>繰り返し抽出</td><td><div class='UIOption' data-option='0|0|1|1|2|2' data-da3='181' data-da3bit='8'></div></td></tr>"
				+"</table>";
	}

	var htmlP = "<table border='0' class='elenco'>"
				+"<tr>"
				+"	<th style='width:184px; text-align:left;'>プロダクト #</th>"
				+"	<th style='width:290px; text-align:left;'>投与量</th>"
				+"	<th style='width:290px; text-align:left;'>スタートディレイ</th>"
				+"	<th style='width:260px; text-align:center;'>区切り</th>"
				+"</tr>";
	
	for (var i=0; i<SINGLESEL_NUM_PRODOTTI; i++)
	{
		var prodNum;
		prodNum = rheaLeftPad(i+1, 2, '0');
			
		var rowID = "pageSingleSelection_P_" +i;
		var dosageID = "pageSingleSelection_P_d" +i;
		
		var label_prodNum = "#" +prodNum;
		var label_prodName = da3.readASCIIString (9483 + i*16, 16);
		if (label_prodName == "" || label_prodName.toUpperCase() == "NOT USED")
			label_prodName = label_prodNum;
		
		htmlP +="<tr id='" +rowID +"'>"
				+"<td>" +label_prodName +"<br><div class='UIButton actionButton' data-caption='&nbsp; テスト &nbsp;' data-onclick='pageSingleSelection_test(" +(i+1) +")'></div></td>"
				+"<td align='left'><div id='" +dosageID +"' class='UINumber' data-numfigures='3' data-decimal='1' data-da3='" +da3LocProd +"' data-da3bit='9' data-da3bit9='2,4' data-max='500' data-um='sec'></div></td>"
				+"<td align='left'><div class='UINumber' data-numfigures='3' data-decimal='1' data-da3='" +(da3LocProd+1) +"' data-da3bit='9' data-da3bit9='1,5' data-max='500' data-um='sec'></div></td>"
				+"<td align='center'><div class='UIOption' data-option='0|0|1|1|2|2' data-da3='" +(da3LocProd+2) +"' data-da3bit='4'></div></td>"
			+"</tr>";
		da3LocProd+= 3;
	}
	
	//product LM
	var rowID = "pageSingleSelection_P_LM";
	var dosageID = "pageSingleSelection_P_dLM";
	htmlP +="<tr id='" +rowID +"'>"
			+"<td>#プロダクト LM<br><div class='UIButton actionButton' data-caption='&nbsp; テスト &nbsp;' data-onclick='pageSingleSelection_test(" +(i+1) +")'></div></td>"
			+"<td align='left'><div id='" +dosageID +"' class='UINumber' data-numfigures='3' data-decimal='1' data-da3='" +da3ProductLM +"' data-da3bit='9' data-da3bit9='2,4' data-max='500'></div></td>"
			+"<td align='left'><div class='UINumber' data-numfigures='3' data-decimal='1' data-da3='" +(da3ProductLM+1) +"' data-da3bit='9' data-da3bit9='1,5' data-max='500' data-um='sec'></div></td>"
			+"<td align='center'><div class='UIOption' data-option='0|0|1|1|2|2' data-da3='" +(da3ProductLM+2) +"' data-da3bit='4'></div></td>"
		+"</tr>";
	
	if (da3.isGruppoVariflex() || da3.isInstant())
		htmlP += "<tr><td>ティーバッグ</td><td colspan='3'><div class='UIOption' data-option='0|0|1|1|2|2|3|3' data-da3='176' data-da3bit='8'></div></td></tr>"
	htmlP += "</table>";


	//waters & mixers
	var htmlW = "<table border='0' class='elenco'>"
				+"<tr>"
				+"	<th style='width:184px; text-align:left;'>ウオーター #</th>"
				+"	<th style='width:290px; text-align:left;'>時間</th>"
				+"	<th style='width:290px; text-align:left;'>スタートディレイ</th>"
				+"	<th style='width:260px; text-align:center;'>" +WATER_COLONNA_FLOW_TITLE +"</th>"
				+"</tr>";
				
	var htmlM = "<table border='0' class='elenco'>"
				+"<tr>"
				+"	<th style='width:184px; text-align:left;'>MIXER #</th>"
				+"	<th style='width:290px; text-align:left;'>時間</th>"
				+"	<th style='width:290px; text-align:left;'>スタートディレイ</th>"
				+"	<th style='width:260px; text-align:center;'>速度</th>"
				+"</tr>";		
	for (var i=0; i<SINGLESEL_NUM_ACQUE; i++)
	{
		var prodNum;
		if (i==4)
			prodNum = "LM";
		else 
			prodNum = rheaLeftPad(i+1, 2, '0');
	
		var rowID = "pageSingleSelection_W_" +i;
		var timeID = "pageSingleSelection_W_t" +i;
		var tempHtmlW ="<tr id='" +rowID +"'>"
				+"<td>#" +prodNum +"<br><div class='UIButton actionButton' data-caption='&nbsp; テスト &nbsp;' data-onclick='pageSingleSelection_test(" +(i+21) +")'></div></td>"
				+"<td align='left'><div id='" +timeID +"' class='UINumber' data-numfigures='3' data-decimal='1' data-da3='" +da3LocWater +"' data-da3bit='9' data-da3bit9='2,4' data-max='500' data-um='sec'></div></td>"
				+"<td align='left'><div class='UINumber' data-numfigures='3' data-decimal='1' data-da3='" +(da3LocWater+1) +"' data-da3bit='9' data-da3bit9='1,5' data-max='500' data-um='sec'></div></td>";

				
		//la colonna 3, può essere FLOW, EV-TEMP o vuota, seconda di induzione/bollitore e espresso/instant
		switch (WATER_COLONNA_FLOW_TYPE)
		{
		default:
			tempHtmlW +="<td></td>"; 
			break;
		case 1:
			tempHtmlW += "<td align='center'><div class='UIOption bigCaption10' data-option='0|低い|1|普通|2|高い' data-da3='" +(da3LocWater+2) +"' data-da3bit='4'></div></td>";
			break;
		case 2:
			tempHtmlW += "<td align='center'><div class='UINumber' data-numfigures='2' data-da3='" +da3LocEVTemperature +"' data-da3bit='8' data-min='75' data-max='98' data-um='&deg;C'></div></td></tr>";
			da3LocEVTemperature++;
			break;
		}
		tempHtmlW += "</tr>";
		da3LocWater+= 3;	
		
		//nelle macchine Brewmatic, solo acqua 3
		if (da3.isMachine_Brewmatic4Macine())
		{
			if (i == 2)
				htmlW += tempHtmlW;
		}
		else
			htmlW += tempHtmlW;


		rowID = "pageSingleSelection_M_" +i;
		timeID = "pageSingleSelection_M_t" +i;
		htmlM +="<tr id='" +rowID +"'>"
				+"<td>#" +prodNum +"<br><div class='UIButton actionButton' data-caption='&nbsp; テスト &nbsp;' data-onclick='pageSingleSelection_test(" +(i+31) +")'></div></td>"
				+"<td align='left'><div id='" +timeID +"' class='UINumber' data-numfigures='3' data-decimal='1' data-da3='" +da3LocWater +"' data-da3bit='9' data-da3bit9='2,4' data-max='500' data-um='sec'></div></td>"
				+"<td align='left'><div class='UINumber' data-numfigures='3' data-decimal='1' data-da3='" +(da3LocWater+1) +"' data-da3bit='9' data-da3bit9='1,5' data-max='500' data-um='sec'></div></td>"
				+"<td align='center'><div class='UIOption bigCaption10' data-option='1|低い|2|普通|3|高い' data-da3='" +(da3LocWater+2) +"' data-da3bit='4'></div></td>"
			+"</tr>";		
		da3LocWater+= 3;
	}
	htmlW += "</table>";
	htmlM += "</table>";
	
	
	rheaSetDivHTMLByName("pageSingleSelection_pageE", htmlE);
	rheaSetDivHTMLByName("pageSingleSelection_pageP", htmlP);
	rheaSetDivHTMLByName("pageSingleSelection_pageW", htmlW);
	rheaSetDivHTMLByName("pageSingleSelection_pageM", htmlM);
}

function pageSingleSelection_hideIfDosageIsZero (win, dosageID, rowID)
{
	var e = rheaGetElemByID(rowID);
	if (e === undefined)
		return;
	if (parseInt(win.getChildByID(dosageID).getValue()) == 0)
		rheaHideElem(e);
}

function pageSingleSelection_onProgramming()
{
	var win = ui.getWindowByID("pageSingleSelection");
	var partial = parseInt(win.getChildByID("pageSingleSelection_programming").getSelectedOptionValue());
	pageSingleSelection_showPartialFull (win, partial);
}

function pageSingleSelection_showPartialFull (win, bPartial)
{
	if (bPartial==1)
	{
		for (var i=0; i<SINGLESEL_NUM_PRODOTTI; i++)
			pageSingleSelection_hideIfDosageIsZero (win, "pageSingleSelection_P_d" +i, "pageSingleSelection_P_" +i);
		pageSingleSelection_hideIfDosageIsZero (win, "pageSingleSelection_P_dLM", "pageSingleSelection_P_LM");
		
		for (var i=0; i<SINGLESEL_NUM_ACQUE; i++)
		{
			pageSingleSelection_hideIfDosageIsZero (win, "pageSingleSelection_W_t" +i, "pageSingleSelection_W_" +i);
			pageSingleSelection_hideIfDosageIsZero (win, "pageSingleSelection_M_t" +i, "pageSingleSelection_M_" +i);
		}
	}
	else
	{
		for (var i=0; i<SINGLESEL_NUM_PRODOTTI; i++)
		{
			var rowID = "pageSingleSelection_P_" +i;
			rheaSetDisplayMode(rheaGetElemByID(rowID), "table-row");
		}
		
		rheaSetDisplayMode(rheaGetElemByID("pageSingleSelection_P_LM"), "table-row");
		
		for (var i=0; i<SINGLESEL_NUM_ACQUE; i++)
		{
			var rowID = "pageSingleSelection_W_" +i;
			var e = rheaGetElemByID(rowID);
			if (e != undefined)
				rheaSetDisplayMode(e, "table-row");
			
			rowID = "pageSingleSelection_M_" +i;
			rheaSetDisplayMode(rheaGetElemByID(rowID), "table-row");
		}		
	}
	
	win.showHideScrollBar();
}

function pageSingleSelection_onStatus()
{
	pageSingleSelection_onProgramming();
	pageSingleSelection_onSelector();

	var win = ui.getWindowByID("pageSingleSelection");
	switch (parseInt(win.getChildByID("pageSingleSelection_status").getSelectedOptionValue()))
	{
		case 0: //selection
			rheaShowElem(rheaGetElemByID("pageSingleSelection_selector"));
			rheaShowElem(rheaGetElemByID("pageSingleSelection_pageSel")); 
			break;
			
		case 1: //inhibit
			rheaHideElem(rheaGetElemByID("pageSingleSelection_pageSel")); 
			rheaHideElem(rheaGetElemByID("pageSingleSelection_selector"));
			break;
		
		case 2: //presel
			rheaHideElem(rheaGetElemByID("pageSingleSelection_pageSel")); 
			rheaHideElem(rheaGetElemByID("pageSingleSelection_selector"));
			break;
		
	}
}

function pageSingleSelection_onSelector()
{
	var elemG = rheaGetElemByID("pageSingleSelection_pageG");
	var elemE = rheaGetElemByID("pageSingleSelection_pageE");
	var elemP = rheaGetElemByID("pageSingleSelection_pageP");
	var elemW = rheaGetElemByID("pageSingleSelection_pageW");
	var elemM = rheaGetElemByID("pageSingleSelection_pageM");
	rheaHideElem(elemG);
	rheaHideElem(elemE);
	rheaHideElem(elemP);
	rheaHideElem(elemW);
	rheaHideElem(elemM);
	
	var win = ui.getWindowByID("pageSingleSelection");
	switch (parseInt(win.getChildByID("pageSingleSelection_selector").getSelectedOptionValue()))
	{
		case 0: rheaShowElem(elemG); break;
		case 1: rheaShowElem(elemE); break;
		case 2: rheaShowElem(elemP); break;
		case 3: rheaShowElem(elemW); break;
		case 4: rheaShowElem(elemM); break;
		
	}
	win.showHideScrollBar();
}


var ajax_testSelection_nRetry = 0;
function pageSingleSelection_test (iAttuatore)
{
	//console.log ("pageSingleSelection_test:: selnum[" +pageSingleSelection_curSel +"] attuatore[" +iAttuatore +"]");
	//prima di tutto salvo e spedisco la ricetta alla CPU
	ajax_testSelection_nRetry = 3;
	save( function(){ pageSingleSelection_test_afterSave(iAttuatore); } );
}

function pageSingleSelection_test_afterSave(iAttuatore)
{
	//invio il comando alla CPU e aspetto che la CPU finisca
	pleaseWait_show();
	currentTask = new TaskTestSelezione(pageSingleSelection_curSel, iAttuatore);
}

function pageSingleSelection_test_onFinish()
{
	//console.log ("pageSingleSelection_test_onFinish");
	currentTask = voidTask;
	pleaseWait_hide();
}


/***************************************************************************
 *
 * pageTemperature
 *
 */
function pageTemperature_show()
{
	if (showPage("pageTemperature", "温度", 1,1))
	{
		//è la prima volta che visualizziamo la pagina
	}
	currentTask = new TaskTemperature();
}

function pageTemperature_build()
{
	var html = "<table border='0' class='elenco'>"
			   +"	<tr style='height:30px;'><td colspan='3' align='center'><div id='pageTemperature_live'  class='tip'></div></td></tr>";

	if (da3.isInstant())
	{
		//boiler & delta
		html += "<tr><td>ボイラー</td><td><div class='UINumber' data-numfigures='2' data-decimal='0' data-min='75' data-max='92' data-da3='7032' data-da3bit='8' data-um='&deg;C'></div></td></tr>"
			   +"<tr><td>DELTA</td><td><div class='UINumber' data-numfigures='2' data-decimal='0' data-max='16' data-da3='7042' data-da3bit='8' data-um='&deg;C'></div></td></tr>";
	}
	else
	{
		var hasHeaterTemp = 1;
		if (da3.isGruppoMicro())
			hasHeaterTemp = 0;
	
		if (da3.isInduzione())
		{
			//solo temp heater (aka camera caffe')
			if (hasHeaterTemp)
				html += "<tr><td>ヒータ</td><td><div class='UINumber' data-numfigures='2' data-decimal='0' data-max='40' data-da3='7032' data-da3bit='8' data-um='&deg;C'></div></td></tr>";
		}
		else
		{
			//(espresso qui significa bollitore, heater significa camera caffe')
			html += "<tr><td>ESPRESSO</td><td><div class='UINumber' data-numfigures='3' data-decimal='0' data-min='75' data-max='120' data-da3='7032' data-da3bit='8' data-um='&deg;C'></div></td></tr>"
					+"<tr><td>DELTA</td><td><div class='UINumber' data-numfigures='2' data-decimal='0' data-max='25' data-da3='7042' data-da3bit='8' data-um='&deg;C'></div></td></tr>"
					+"<tr><td>最初のコーヒー</td><td><div class='UINumber' data-numfigures='2' data-decimal='0' data-max='30' data-da3='7034' data-da3bit='8' data-um=''></div></td></tr>"
					+"<tr><td>加熱時間</td><td><div class='UINumber' data-numfigures='3' data-decimal='1' data-max='100' data-da3='7036' data-da3bit='8' data-um='sec'></div></td></tr>";
				   
			if (hasHeaterTemp)
				html += "<tr><td>ヒータ</td><td><div class='UINumber' data-numfigures='2' data-decimal='0' data-max='40' data-da3='7040' data-da3bit='8' data-um='&deg;C'></div></td></tr>";
		}
	}	
	html += "</table>";
	rheaSetDivHTMLByName("pageTemperature_content", html);
}

/***************************************************************************
 *
 * pageClock
 *
 */
function pageClock_show()
{
	if (showPage("pageClock", "時計", 1,1))
	{
		//è la prima volta che visualizziamo la pagina
	}
	pageClock_onSelector();
	
	//sincronizzo data e ora
	pageClock_syncTime();
	pageClock_syncDate();
}
	
function pageClock_syncTime()
{	
	//console.log ("ajax::getTime");
	rhea.ajax ("getTime", "").then( function(result)
	{
		var win = ui.getWindowByID("pageClock");
		var obj = win.getChildByID("pageClock_time");
		
		var data = JSON.parse(result);
		obj.setValueHH(data.h);
		obj.setValueMM(data.m);
		dataOra_setup();
	})
	.catch( function(result)
	{
		setTimeout ( function() {pageClock_syncTime();}, 200);
	});
}

function pageClock_syncDate()
{
	//console.log ("ajax::getDate");
	rhea.ajax ("getDate", "").then( function(result)
	{
		var data = JSON.parse(result);

		var win = ui.getWindowByID("pageClock");
		win.getChildByID("pageClock_dd").setValue(data.d);
		win.getChildByID("pageClock_mm").setValue(data.m);
		win.getChildByID("pageClock_yy").setValue(data.y);
		dataOra_setup();
	})
	.catch( function(result)
	{
		setTimeout ( function() {pageClock_syncDate();}, 200);
	});	
}

function pageClock_onSelector()
{
	var elemClock = rheaGetElemByID("pageClock_clock");
	var elemHH = rheaGetElemByID("pageClock_happyHour");
	var elemES = rheaGetElemByID("pageClock_energySave");
	
	rheaHideElem(elemClock);
	rheaHideElem(elemHH);
	rheaHideElem(elemES);
	
	var win = ui.getWindowByID("pageClock");
	switch (parseInt(win.getChildByID("pageClock_selector").getSelectedOptionValue()))
	{
		default: rheaShowElem(elemClock); break;
		case 1:  rheaShowElem(elemHH); break;
		case 2:  rheaShowElem(elemES); break;
	}
	
	ui.getWindowByID("pageClock").showHideScrollBar();
}

function pageClock_setTime()
{
	var win = ui.getWindowByID("pageClock");
	var obj = win.getChildByID("pageClock_time");
	
	pleaseWait_show();
	//console.log ("ajax::setTime");
	rhea.ajax ("setTime", { "h":obj.getValueHH(), "m":obj.getValueMM(), "s":0}).then( function(result)
	{
		pleaseWait_hide();
		pageClock_syncTime();
	})
	.catch( function(result)
	{
		setTimeout ( function() { pageClock_setTime(); }, 200);
	});
}

function pageClock_setDate()
{
	var win = ui.getWindowByID("pageClock");
	var yy = win.getChildByID("pageClock_yy").getValue();
	var mm = win.getChildByID("pageClock_mm").getValue();
	var dd = win.getChildByID("pageClock_dd").getValue();
	
	pleaseWait_show();
	//console.log ("ajax::setDate");
	rhea.ajax ("setDate", { "y":yy, "m":mm, "d":dd}).then( function(result)
	{
		pleaseWait_hide();
		pageClock_syncDate();
	})
	.catch( function(result)
	{
		setTimeout ( function() { pageClock_setDate(); }, 200);
	});
}

/***************************************************************************
 *
 * pageCalibration (instant)
 *
 */
function pageCalibration_show()
{
	if (showPage("pageCalibration", "パウダー<br>キャリブレーション", 1,0))
	{
		//è la prima volta che visualizziamo la pagina
		if (da3.isEspresso())
		{
			//nascondo motor 1 e motor 2
			rheaHideElem (rheaGetElemByID("pageCalibration_rowMotor1"));
			rheaHideElem (rheaGetElemByID("pageCalibration_rowMotor2"));
		}
	}

	pageCalibration_refreshCalibValueOnScreen();
	currentTask = taskCalibMotor;
}

function pageCalibration_refreshCalibValueOnScreen()
{
	if (da3.isInstant())
	{
		for (var i=1; i<=6; i++)
		{
			var v = helper_intToFixedOnePointDecimal( da3.getCalibFactorGSec(i) );
			rheaSetDivHTMLByName("pageCalibration_m" +i, v +"&nbsp;gr/sec");
		}
	}
	else
	{
		//motori
		for (var i=1; i<=6; i++)
		{
			v = helper_intToFixedOnePointDecimal( da3.getCalibFactorGSec(i) );
			rheaSetDivHTMLByName("pageCalibration_m" +i, v +"&nbsp;gr/sec");
		}
	}	
	ui.getWindowByID("pageCalibration").showHideScrollBar();
}

function pageCalibration_reset(motor)
{
	pleaseWait_show();
	rhea.ajax ("setFattoreCalib", { "m":motor, "v":0}).then( function(result)
	{
		rheaSetDivHTMLByName("pageCalibration_m" +motor, "0&nbsp;gr/sec");
		da3.setCalibFactorGSec(motor, 0);

		setTimeout (
			function()
			{
				save (function() { pleaseWait_hide();});
			},
			1000);
	})
	.catch( function(result)
	{
		pleaseWait_hide();
	});
}

function pageCalibration_start (motor)
{
	pleaseWait_show();
	
	var bAlsoCalcImpulses = 1;
	if (da3.isGruppoMicro())
		bAlsoCalcImpulses = 0;
	if (motor == 11)
		taskCalibMotor.startCalibrazioneMacina(1, bAlsoCalcImpulses);
	else if (motor == 12)
		taskCalibMotor.startCalibrazioneMacina(2, bAlsoCalcImpulses);
	else
		taskCalibMotor.startMotorCalib(motor);
}

function pageCalibration_onFinish ()
{
	if (currentPageID == "pageExpCalib")
		pageExpCalib_onFinish();
	else
		save (function() { pageCalibration_refreshCalibValueOnScreen(); pleaseWait_hide();});
}

function pageCalibration_grindAgain()
{
	pleaseWait_calibration_varigrind_hide();
	pleaseWait_calibration_num_hide();
	pleaseWait_btn1_hide();
	pleaseWait_calibration_setText("");
	taskCalibMotor.fase = 10;
}

function pageCalibration_setVGrind()
{
	pleaseWait_calibration_varigrind_hide();
	pleaseWait_calibration_num_hide();
	pleaseWait_btn1_hide();
	pleaseWait_calibration_setText("");
	taskCalibMotor.fase = 25;
}

function pageCalibration_runMotorAgain()
{
	pleaseWait_calibration_motor_hide();
	pleaseWait_calibration_num_hide();
	pleaseWait_btn1_hide();
	pleaseWait_calibration_setText("");
	taskCalibMotor.fase = 0;
}

/***************************************************************************
 *
 * pagePayment
 *
 */
function pagePayment_show()
{
	if (showPage("pagePayment", "ペイメントシステム", 1,1))
	{
	}
	
	var win = ui.getWindowByID("pagePayment");

	//imposta i decimali per le "coin" della pagina "parallel"
	for (var i=0; i<10; i++)
	{
		var obj = win.getChildByID("pagePayment_coin" +i);
		obj.setDecimals(da3.getDecimalsForPrices());	
	}

	pagePayment_onSelector();
	
	//imposta i decimali per vari campi "moneta"
	win.getChildByID("pagePayment_creditMax").setDecimals(da3.getDecimalsForPrices());
	win.getChildByID("pagePayment_restMax").setDecimals(da3.getDecimalsForPrices());
	win.getChildByID("pagePayment_tokenV").setDecimals(da3.getDecimalsForPrices());
	win.getChildByID("pagePayment_maxCC").setDecimals(da3.getDecimalsForPrices());
}

function pagePayment_build()
{
	var options = "0|ゼネラルオプション|1|MDB|2|マシンID|3|RFIDカード";
	if (da3.isAlipayChinaActive())
		options += "|4|ALIPAY";
	options += "|5|PARALLEL";
	var html = "<div class='UIOptionSmall' id='pagePayment_selector' data-option='" +options +"' data-onclick='pagePayment_onSelector()'></div>";
	rheaSetElemHTML (rheaGetElemByID("pagePayment_selector"), html);
}

function pagePayment_onSelector()
{
	var elem0 = rheaGetElemByID("pagePayment_general");
	var elem1 = rheaGetElemByID("pagePayment_mdb");
	var elem2 = rheaGetElemByID("pagePayment_mid");
	var elem3 = rheaGetElemByID("pagePayment_rfid");
	var elem4 = rheaGetElemByID("pagePayment_alipayChina");
	var elem5 = rheaGetElemByID("pagePayment_parallel");

	rheaHideElem(elem0);
	rheaHideElem(elem1);
	rheaHideElem(elem2);
	rheaHideElem(elem3);
	rheaHideElem(elem4);
	rheaHideElem(elem5);
	
	var win = ui.getWindowByID("pagePayment");
	switch (parseInt(win.getChildByID("pagePayment_selector").getSelectedOptionValue()))
	{
		default: rheaShowElem(elem0); break;
		case 1:  rheaShowElem(elem1); break;
		case 2:  rheaShowElem(elem2); break;
		case 3:  rheaShowElem(elem3); break;
		case 4:  
			rheaShowElem(elem4); 
			rhea.ajax ("AliChinaGetConnDetail", "").then( function(result)
			{
				var data = JSON.parse(result);
				rheaSetElemHTML(rheaGetElemByID("pagePayment_alichina_ip"), data.ip1 +"." +data.ip2 +"." +data.ip3 +"." +data.ip4);
				rheaSetElemHTML(rheaGetElemByID("pagePayment_alichina_port"), data.port);
				rheaSetElemHTML(rheaGetElemByID("pagePayment_alichina_mid"), data.mid);
				rheaSetElemHTML(rheaGetElemByID("pagePayment_alichina_key"), data.key);
				
			})
			.catch( function(result)
			{
				console.log ("ERROR[" +result +"]");
			});	
			break;
		case 5:  rheaShowElem(elem5); break;
	}
	
	ui.getWindowByID("pagePayment").showHideScrollBar();
}


/***************************************************************************
 *
 * pageDevices
 *
 */
var pageDevices_selector = null;
function pageDevices_show()
{
	if (showPage("pageDevices", "デバイス", 1,1))
	{
		//è la prima volta che visualizziamo la pagina
		var win = ui.getWindowByID("pageDevices");
		if (da3.isGruppoMicro())
			pageDevices_selector = win.getChildByID("pageDevices_selectorMicro");
		else
			pageDevices_selector = win.getChildByID("pageDevices_selectorVFlex");
	
		if (da3.isInstant())
		{
			pageDevices_selector.selectOptionByValue(0);
			rheaHideElem(rheaGetElemByID("pageDevices_selectorTable"));
			rheaHideElem(rheaGetElemByID("pageDevices_cofSensor"));
			rheaHideElem(rheaGetElemByID("pageDevices_grpTest"));
			rheaHideElem(rheaGetElemByID("pageDevices_motorTest"));
			rheaHideElem(rheaGetElemByID("pageDevices_boilerSize"));
		}
		
		if (da3.isGruppoMicro())
		{
			rheaHideElem(rheaGetElemByID("pageDevices_selectorTable"));
			rheaSetDisplayMode(rheaGetElemByID("pageDevices_selectorTableMicro"), "table");
			rheaHideElem(rheaGetElemByID("pageDevices_cofSensor"));
			rheaHideElem(rheaGetElemByID("pageDevices_cupSensor"));
			rheaHideElem(rheaGetElemByID("pageDevices_vflex_autoAdjust"));
			rheaHideElem(rheaGetElemByID("pageDevices_vflex_deliveryPhase"));
			rheaHideElem(rheaGetElemByID("pageDevices_motorTest"));
			rheaHideElem(rheaGetElemByID("pageDevices_grpTest"));
			win.getChildByID("pageDevices_vflex_brewerDiam").changeCaptionByIndex(1,"40mm");
		}

		//grinder speed test, valido solo per "multibona espresso"
		//Il valore viene memorizzato nella loc 7558 del da3
		//La locazione 7558 è usata sia per indicare se l'auto adjustment su varifilex 1 è attivo, sia per memorizzare lo speed dell'oFF09
		//Se il gruppo è micro, si usa il secondo caso, se il gruppo è vflex, si usa il primo
		if (da3.isGruppoMicro() && da3.isMachine_MultibonaEspresso())
		{
			rheaSetDisplayMode(rheaGetElemByID("pageDevices_grinderSpeedTest", "table-row"));
			rheaHideElem(rheaGetElemByID("pageDevices_vflex_v1AutoAdjust"));
			win.getChildByID("pageDevices_vflex_v1AutoAdjust").dontSaveToDa3();
		}
		else
		{
			rheaHideElem(rheaGetElemByID("pageDevices_grinderSpeedTest"));
			win.getChildByID("pageDevices_vflex_grnSpeedOff9").dontSaveToDa3();
		}
		
		if (da3.isInduzione())
			rheaHideElem(rheaGetElemByID("pageDevices_boilerSize"));
		
		if (!da3.isMachine_Brewmatic4Macine())
			rheaHideElem(rheaGetElemByID("pageDevices_vibrationTest"));
			
		var optionsForVGrindSelector = "1|VARIGRIND 1|2|VARIGRIND 2";
		for (var i=3; i<=da3.getNumMacine(); i++)
			optionsForVGrindSelector += "|" +i +"|VARIGRIND " +i;
		var uiVGrindSelector = win.getChildByID("pageDevices_vgrind_selector");
		uiVGrindSelector.changeOptions(optionsForVGrindSelector);
		uiVGrindSelector.selectOptionByIndex(0);
		
		for (var i=1; i<=4; i++)
			rheaSetDivHTMLByName("pageDevices_vgrind" +i +"_lastPos_caption", da3.read16( da3.getVarigrindLastPosDa3Loc(i) ));
		pageDevices_vgrind_setLastFluxAndPos(pageDevices_vgrind_lastFlux, pageDevices_vgrind_lastPos);
	}

	currentTask = new TaskDevices();
	pageDevices_onSelector();
	pageDevices_onEnableAuto(1);
	pageDevices_onEnableAuto(2);
	pageDevices_onEnableAuto(3);
	pageDevices_onEnableAuto(4);
}


var pageDevices_whichPage = 0;
function pageDevices_onSelector()
{
	var elem0 = rheaGetElemByID("pageDevices_general");
	var elem1 = rheaGetElemByID("pageDevices_vflex");
	var elem2 = rheaGetElemByID("pageDevices_vgrind");

	rheaHideElem(elem0);
	rheaHideElem(elem1);
	rheaHideElem(elem2);
	
	var win = ui.getWindowByID("pageDevices");
	pageDevices_whichPage = parseInt(pageDevices_selector.getSelectedOptionValue());
	switch (pageDevices_whichPage)
	{
		default: rheaShowElem(elem0); break;
		case 1:  rheaShowElem(elem1); break;
		case 2:  
			rheaShowElem(elem2); 
			pageDevices_onVGrindSelector();
			break;
	}
	
	win.showHideScrollBar();
}

function pageDevices_onVGrindSelector()
{
	var win = ui.getWindowByID("pageDevices");
	var uiSelector = win.getChildByID ("pageDevices_vgrind_selector");

	var n = uiSelector.getNumOptions();
	for (var i=0; i<n; i++)
		rheaHideElem (rheaGetElemByID("pageDevices_vgrind" +(i+1)));


	var selectedVGrindIndex = uiSelector.getSelectedOptionValue();
	currentTask.enterQueryMacinePos(selectedVGrindIndex);
	rheaShowElem (rheaGetElemByID("pageDevices_vgrind" +selectedVGrindIndex));
	win.showHideScrollBar();
}


function pageDevices_vgrind_runSelection(whichVG)
{
	var win = ui.getWindowByID("pageDevices");
	var selNum = parseInt(win.getChildByID("pageDevices_vgrind" +whichVG +"_selNum").getValue())
	
	//vogliamo far partire la selezione [selNum].
	//Devo verificare che la granulometria di questa selezione sia DISABLED o REFERRING, altrimenti non
	//la si può utilizzare per calibrare la macchina dato che con granulemtria FINE o ROUGHLY la CPU apre/chiude di suo la macina
	var da3Loc = 175 + 100 * (selNum-1);
	var gran = da3.read8(da3Loc);
	if (gran == 0 || gran == 2)	
		currentTask.runSelection(selNum);
	else
	{
		currentTask.messageBox ("警告：その選択は豆が細かすぎるか粗すぎる為、使用出来ない可能性があります。"); //you can't use this selection..please choose another one
	}
}

function pageDevices_vgrind_runSelection_onFinish()
{
	//chiedo le info relativamente all'ultimo flusso e posizione
	rhea.ajax ("getLastFluxInfo", "").then( function(result)
	{
		var data = JSON.parse(result);
		pageDevices_vgrind_setLastFluxAndPos (data.flux, data.grinderPos);
		pageDevices_vgrind_runSelection_onFinish2();
	})
	.catch( function(result)
	{
		pageDevices_vgrind_runSelection_onFinish2();
	});	
}

function pageDevices_vgrind_runSelection_onFinish2()
{
	pleaseWait_hide();
	if (pageDevices_whichPage == 3)
		currentTask.enterQueryMacinePos(2);
	else
		currentTask.enterQueryMacinePos(1);
}

var pageDevices_vgrind_lastFlux = -1;
var pageDevices_vgrind_lastPos = -1
function pageDevices_vgrind_setLastFluxAndPos(flux, pos)
{
	pageDevices_vgrind_lastFlux = flux;
	pageDevices_vgrind_lastPos = pos;
	
	if (flux < 0)
	{
		var msg = "最後のフラックス/位置：<br> <b> RUN選択</ b>をクリックしてください";
		for (var i=1; i<=4; i++)
		{
			rheaSetDivHTMLByName ("pageDevices_vgrind" +i +"_lastFlux_caption", msg);
			rheaHideElem (rheaGetElemByID ("pageDevices_vgrind" +i +"_lastFlux_btnUse"));
		}
	}
	else
	{
		//flux è di 3 cifre, con due decimali
		var s = flux.toString();
		while (s.length < 3) s = "0" +s;
		s = s.substr(0,1) +"." +s.substr(1,2);
		var msg = "Last flux: " +s +"<br>Last pos: " +pos;
		for (var i=1; i<=4; i++)
		{
			rheaSetDivHTMLByName ("pageDevices_vgrind" +i +"_lastFlux_caption", msg);
			rheaSetDisplayMode (rheaGetElemByID ("pageDevices_vgrind" +i +"_lastFlux_btnUse"), "table");
		}
		
		rheaSetDivHTMLByName("pageExpCalib_lastFlux", s +" cc/sec");
	}
}

function pageDevices_vgrind_useLastFluxAndPos(whichVG)
{
	var win = ui.getWindowByID("pageDevices");

	win.getChildByID("pageDevices_vgrind" +whichVG +"_refFlux").setValue(pageDevices_vgrind_lastFlux);
	
	da3.write16 ( da3.getVarigrindLastPosDa3Loc(whichVG), pageDevices_vgrind_lastPos);
	rheaSetDivHTMLByName("pageDevices_vgrind" +whichVG +"_lastPos_caption", pageDevices_vgrind_lastPos);
	
	//forzo un salvataggio dei dati
	save ( function() { pleaseWait_hide(); } );
}

function pageDevices_onEnableAuto(whichVG)
{
	if (da3.isGruppoMicro())
		return;
	var win = ui.getWindowByID("pageDevices");
	
	var tableName = "pageDevices_vgrind" +whichVG +"_params";
	var elemTable = rheaGetElemByID(tableName);
	
	var selectorName = "pageDevices_vgrind" +whichVG +"_selector";
	switch (parseInt(win.getChildByID(selectorName).getSelectedOptionValue()))
	{
		default: rheaHideElem(elemTable); break;
		case 1:  rheaSetDisplayMode(elemTable, "table"); break;
	}
	
	win.showHideScrollBar();
}

function pageDevices_startModemTest()					{ currentTask.runModemTest(); }
function pageDevices_startTestAssorbGruppo()			{ currentTask.runTestAssorbGruppo(); }
function pageDevices_startTestAssorbMotoriduttore()		{ currentTask.runTestAssorbMotoriduttore(); }
function pageDevices_startGrinderSpeedTest()			{ currentTask.runGrinderSpeedTest(1); }
function pageDevices_startBrewmaticVibrationTest()
{ 
	var win = ui.getWindowByID("pageDevices");
	var perc0_100 = win.getChildByID("pageDevices_vibrationTest_perc").getValue();
	currentTask.runScivoloBrewmatic (perc0_100);
}

/***************************************************************************
 *
 * pageDataAudit
 *
 */
var taskResetEVA = new TaskResetEVA();
var pageDA_secretBtnCounter = 0;
var pageDA_secretBtnLastTimeClickedMSec=0;
function pageDataAudit_show (bShowCompleteMenu)
{
	if (showPage("pageDataAudit", "データー　オーデット", 1,0))
	{
		pageDataAudit_downloadEVA();
		
		var node = document.getElementById("divSecretDAResetButton");		
		node.addEventListener("mousedown", function (ev)
		{
			var timeNowMSec = ev.timeStamp;
			if (timeNowMSec - pageDA_secretBtnLastTimeClickedMSec > 1000)
				pageDA_secretBtnCounter = 0;
			pageDA_secretBtnLastTimeClickedMSec = timeNowMSec;
			pageDA_secretBtnCounter++;
			console.log ("pageDA_secretBtnCounter[" +pageDA_secretBtnCounter +"]");
			if (pageDA_secretBtnCounter >= 6)
			{
				pageDA_secretBtnCounter=0;
				setTimeout (function(){pageDataAudit_showSecretDaResetButtonWindow();}, 100);
			}
		}, 
		true);
	}
	
	if (bShowCompleteMenu==0)
		btnBack_setCallback ("gotoHMI()");
	
	var win = ui.getWindowByID("pageDataAudit");
	var selector = win.getChildByID("pageDataAudit_selector");
	if (bShowCompleteMenu)
		selector.changeOptions ("0|概要|1|区分|2|合計|4|プレセレクション|3|データの更新");
	else
		selector.changeOptions ("1|区分|4|プレセレクション");
	selector.selectOptionByIndex(0);
	pageDataAudit_onSelector();
}

function pageDataAudit_showSecretDaResetButtonWindow()
{
	pleaseWait_show();
	currentTask = new TaskDAResetTotals();
}

function pageDataAudit_showSecretDaResetButtonWindow_finished()
{
	pleaseWait_hide();
	currentTask = voidTask;
}

function toCurrency (numberIN, numDecimali)
{
	var s = numberIN.toString();
	if (numDecimali == 0)
		return s;
		
	while (s.length < numDecimali)
		s = "0" +s;

	var n = s.length;
	if (n == numDecimali)
		return "0." +s;
		
	return s.substr(0, n-numDecimali) +"." +s.substr(n-numDecimali, numDecimali);
}

function formatInteger(x) { return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " "); }

function pageDataAudit_build_overview (numSelezioni, numDecimali, buffer, offset)
{
	var col = [];
	var html = "<table class='dataAudit' align='center'><tr valign='bottom'>"
				+"<th>&nbsp;</th>"
				+"<th colspan='2' align='center'>NUM PAID (VA1)</th>"
				+"<th colspan='2' align='center'>NUM FREEVEND (VA3)</th>"
				+"<th colspan='2' align='center'>NUM TESTVEND (VA2)</th>"
			+"</tr><tr valign='bottom'>"
				+"<th style='width:100px'>&nbsp;</th>"
				+"<th style='width:130px'>TOT</th>"
				+"<th style='width:130px'>PAR</th>"
				+"<th style='width:130px'>TOT</th>"
				+"<th style='width:130px'>PAR</th>"
				+"<th style='width:130px'>TOT</th>"
				+"<th style='width:130px'>PAR</th>"
			+"</tr>";

	//VA101/2/3
	var va101 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
	var va102 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
	var va103 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
	var va104 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;

	var va201 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
	var va202 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
	var va203 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
	var va204 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
	
	var va301 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
	var va302 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
	var va303 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
	var va304 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;

	html += "<tr>"
				+"<td>TOTALS</td>"
				+"<td>" +formatInteger(va102) +"</td>"
				+"<td>" +formatInteger(va104) +"</td>"
				+"<td>" +formatInteger(va302) +"</td>"
				+"<td>" +formatInteger(va304) +"</td>"
				+"<td>" +formatInteger(va202) +"</td>"
				+"<td>" +formatInteger(va204) +"</td>"
			+"</tr></table><br>";
				
				
				
	html += "<table class='dataAudit' align='center'><tr valign='bottom'>"
				+"<th>&nbsp;</th>"
				+"<th colspan='2' align='center'>NUM PAID (PA2)</th>"
				+"<th colspan='2' align='center'>NUM FREEVEND (PA4)</th>"
				+"<th colspan='2' align='center'>NUM TESTVEND (PA3)</th>"
			+"</tr><tr valign='bottom'>"
				+"<th style='width:100px'>SEL NUM</th>"
				+"<th style='width:130px'>TOT</th>"
				+"<th style='width:130px'>PAR</th>"
				+"<th style='width:130px'>TOT</th>"
				+"<th style='width:130px'>PAR</th>"
				+"<th style='width:130px'>TOT</th>"
				+"<th style='width:130px'>PAR</th>"
			+"</tr>";
			
	for (var i=0; i<numSelezioni; i++)
	{
		var selNum = (i+1).toString();
		if (selNum.length<2) selNum = "0"+selNum;
		
		var pa201 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		var pa202 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		var pa203 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		var pa204 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;		
		
		var pa301 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		var pa302 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		var pa303 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		var pa304 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;		

		var pa401 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		var pa402 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		var pa403 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		var pa404 = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;		
		
		var rowCss="";
		if (pa201+pa203+ pa301+pa303 +pa401+pa403==0)
			rowCss = " class='rowAllZero'";		
		html += "<tr" +rowCss +">"
				+"<td>#" +selNum +"</td>"
				+"<td>" +formatInteger(pa201) +"</td>"
				+"<td>" +formatInteger(pa203) +"</td>"
				+"<td>" +formatInteger(pa401) +"</td>"
				+"<td>" +formatInteger(pa403) +"</td>"
				+"<td>" +formatInteger(pa301) +"</td>"
				+"<td>" +formatInteger(pa303) +"</td>"
			+"</tr>";
	}
	html += "</table>";
	
	rheaSetDivHTMLByName("pageDataAudit_o", html);
}

function pageDataAudit_build_fromBuffer(numSelezioni, numDecimali, buffer, offset)
{
	var htmlTable = "<table class='dataAudit' align='center'><tr valign='bottom'>"
				+"<th>SEL<br>NUM</th>"
				+"<th>NUM PAID<br>PRICE1</th>"
				+"<th>NUM PAID<br>HAPPY</th>"
				+"<th>NUM<br>FREEVEND</th>"
				+"<th>NUM<br>TESTVEND</th>"
				+"<th>NUM TOTAL</th>"
				+"<td style='width:100px'>&nbsp;</td>"
				+"<th>MONEY<br>PRICE1</th>"
				+"<th>MONEY<br>PRICE2</th>"
				+"<th>MONEY TOTAL</th>"
				+"</tr>";
	
	var html = "";	
	var rowSum = [0,0,0,0,0,0,0,0,0,0,0,0];
	for (var i=0; i<numSelezioni; i++)
	{
		var selNum = (i+1).toString();
		if (selNum.length<2) selNum = "0"+selNum;
		
		var col = [];
		col[0] = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		col[1] = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		col[2] = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		col[3] = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		col[4] = col[0] +col[1] +col[2] +col[3];
		col[5] = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		col[6] = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		col[7] = col[5] +col[6];
		
		for (var i2=0; i2<=7;i2++)
			rowSum[i2] += col[i2];
			
		var rowCss="";
		if (parseFloat(col[4]) == 0 && parseFloat(col[7]) == 0)
			rowCss = " class='rowAllZero'";
		html += "<tr" +rowCss +">"
					+"<td>#" +selNum +"</td>"
					+"<td>" +formatInteger(col[0]) +"</td>"
					+"<td>" +formatInteger(col[1]) +"</td>"
					+"<td>" +formatInteger(col[2]) +"</td>"
					+"<td>" +formatInteger(col[3]) +"</td>"
					+"<td><b>" +formatInteger(col[4]) +"</b></td>"
					+"<td></td>"
					+"<td>" +toCurrency(col[5], numDecimali) +"</td>"
					+"<td>" +toCurrency(col[6], numDecimali) +"</td>"
					+"<td><b>" +toCurrency(col[7], numDecimali) +"</b></td>"
				+"</tr>";
	}

	//totali di riga
	var htmlTotali = "<tr class='rowTot'>"
				+"<td>TOTALS</td>"
				+"<td>" +formatInteger(rowSum[0]) +"</td>"
				+"<td>" +formatInteger(rowSum[1]) +"</td>"
				+"<td>" +formatInteger(rowSum[2]) +"</td>"
				+"<td>" +formatInteger(rowSum[3]) +"</td>"
				+"<td><b>" +formatInteger(rowSum[4]) +"</b></td>"
				+"<td></td>"
				+"<td>" +toCurrency(rowSum[5], numDecimali) +"</td>"
				+"<td>" +toCurrency(rowSum[6], numDecimali) +"</td>"
				+"<td><b>" +toCurrency(rowSum[7], numDecimali) +"</b></td>"
			+"</tr>";
	
	return htmlTable + htmlTotali +html +"</table>";
}

function pageDataAudit_build_partial(numSelezioni, numDecimali, buffer, offset)		{ rheaSetDivHTMLByName("pageDataAudit_p", pageDataAudit_build_fromBuffer(numSelezioni, numDecimali, buffer, offset)); }
function pageDataAudit_build_total(numSelezioni, numDecimali, buffer, offset)		{ rheaSetDivHTMLByName("pageDataAudit_t", pageDataAudit_build_fromBuffer(numSelezioni, numDecimali, buffer, offset)); }
function  pageDataAudit_onSelector()
{
	var elemO = rheaGetElemByID("pageDataAudit_o");
	var elemP = rheaGetElemByID("pageDataAudit_p");
	var elemT = rheaGetElemByID("pageDataAudit_t");
	var elemR = rheaGetElemByID("pageDataAudit_r");
	var elemPRS = rheaGetElemByID("pageDataAudit_prs");
	
	rheaHideElem(elemO);
	rheaHideElem(elemP);
	rheaHideElem(elemT);
	rheaHideElem(elemR);
	rheaHideElem(elemPRS);
	
	var win = ui.getWindowByID("pageDataAudit");
	switch (parseInt(win.getChildByID("pageDataAudit_selector").getSelectedOptionValue()))
	{
		case 0: rheaShowElem(elemO); break;
		case 1: rheaShowElem(elemP); break;
		case 2: rheaShowElem(elemT); break;
		case 3: rheaShowElem(elemR); break;
		case 4: rheaShowElem(elemPRS); break;
	}
	win.showHideScrollBar();
}

function pageDataAudit_build_preselection(numPresel, numDecimali, buffer, offset)
{
	if (0 == numPresel)
	{
		rheaSetElemHTML (rheaGetElemByID("pageDataAudit_prs"), "<br><br><center>表示するものはありません</center>");
		return;
	}
	var htmlTable = "<table class='dataAudit' align='center'><tr valign='bottom'>"
				+"<th>PP101<br>PRESEL NUM</th>"
				+"<th>PP102<br><br>PRICE1</th>"
				+"<th>PP103<br><br>NAME</th>"
				+"<th>PP104<br><br>&nbsp;</th>"
				+"<th>PP105<br>NUM SINCE START</th>"
				+"<th>PP106<br>VALUE SINCE START</th>"
				+"<th>PP107<br>NUM SINCE RESET</th>"
				+"<th>PP108<br>VALUE SINCE RESET</th>"
				+"</tr>";
	
	var html = "";	
	for (var i=0; i<numPresel; i++)
	{
		var col = [];
		col[0] = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		col[1] = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		col[2] = "";
		col[3] = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		col[4] = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		col[5] = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		col[6] = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;
		col[7] = rheaReadU32FromUint8Buffer(buffer, offset); offset+=4;

		var nameLen = buffer[offset++];
		while (nameLen--)
			col[2] += String.fromCharCode (buffer[offset++]);

		if (col[0].length<2) col[0] = "0"+col[0];
		html += "<tr>"
					+"<td>#" +col[0] +"</td>"
					+"<td>" +toCurrency(col[1], numDecimali) +"</td>"
					+"<td>" +col[2] +"</td>"
					+"<td>" +toCurrency(col[3], numDecimali) +"</td>"
					+"<td>" +formatInteger(col[4]) +"</td>"
					+"<td>" +toCurrency(col[5], numDecimali) +"</td>"
					+"<td>" +formatInteger(col[6]) +"</td>"
					+"<td>" +toCurrency(col[7], numDecimali) +"</td>"
				+"</tr>";
	}
	rheaSetElemHTML (rheaGetElemByID("pageDataAudit_prs"), htmlTable + html +"</table>");
}

function pageDataAudit_resetPartialData()
{
	pleaseWait_show();
	pleaseWait_btn1_setText("YES, do reset partial data");
	pleaseWait_btn1_show();

	pleaseWait_btn2_setText("NO, do NOT reset partial data");
	pleaseWait_btn2_show();

	pleaseWait_freeText_setText ("You're about to reset partial EVA-DTS data.<br><br>Do you confirm?");
	pleaseWait_freeText_show();
	currentTask = taskResetEVA;
}


function pageDataAudit_downloadEVA()
{
	pleaseWait_show();
	rheaSetDivHTMLByName("pageDataAudit_o", "");
	rheaSetDivHTMLByName("pageDataAudit_t", "");
	rheaSetDivHTMLByName("pageDataAudit_p", "");

	currentTask = new TaskDataAudit();
}

function pageDataAudit_downloadEVA_onFinish()
{
	if (currentTask.bufferSize != 0)
	{
		//download riuscito
		//console.log (currentTask.buffer);
		
		rheaSetDivHTMLByName("pageDataAudit_lastDownload", "EVA-DTS, last downloaded on " +dataOra_getYYYYMMDD() +" " +dataOra_getHHMM(":"));
		
		var numSelezioni = parseInt(currentTask.buffer[1]);
		var numDecimali  = parseInt(currentTask.buffer[2]);
		var numPresel    = parseInt(currentTask.buffer[3]);
		var addrBloccoGeneral = rheaReadU32FromUint8Buffer(currentTask.buffer, 4);
		var addrBloccoPartial = rheaReadU32FromUint8Buffer(currentTask.buffer, 8);
		var addrBloccoTotal = rheaReadU32FromUint8Buffer(currentTask.buffer, 12);
		var addrBloccoPreselezioni = rheaReadU32FromUint8Buffer(currentTask.buffer, 16);
		
		
		pageDataAudit_build_overview(numSelezioni, numDecimali, currentTask.buffer, addrBloccoGeneral);;
		pageDataAudit_build_partial (numSelezioni, numDecimali, currentTask.buffer, addrBloccoPartial);
		pageDataAudit_build_total (numSelezioni, numDecimali, currentTask.buffer, addrBloccoTotal);
		pageDataAudit_build_preselection(numPresel, numDecimali, currentTask.buffer, addrBloccoPreselezioni);

		var win = ui.getWindowByID("pageDataAudit");
		var selector = win.getChildByID("pageDataAudit_selector");
		if (selector.optionValue.length > 4)
			selector.selectOptionByValue(0);
		else
			selector.selectOptionByValue(1);
		pageDataAudit_onSelector();
	}
	
	pleaseWait_hide();
	currentTask = voidTask;
}

/***************************************************************************
 *
 * pageExpCalib
 *
 */
var taskEspressoCalib = null;
var pageExpCalib_macina1o2 = 1;
function pageExpCalib_show()
{
	var win = ui.getWindowByID("pageExpCalib");
	if (showPage("pageExpCalib", "コーヒーキャリブレーション", 1,0))
	{
		//è la prima volta che visualizziamo la pagina
		if (da3.isGruppoMicro())
		{
			rheaHideElem(rheaGetElemByID("pageExpCalib_rowvarigrind"));
			rheaHideElem(rheaGetElemByID("pageExpCalib_rowimpulsi"));
			rheaHideElem(rheaGetElemByID("pagePleaseWait_calibration_1_varigrind"));
		}
		
		var optionsForGrinder = "1|1|2|2";
		for (var i=2; i<da3.getNumMacine(); i++)
			optionsForGrinder += "|" +(i+1) +"|" +(i+1);			
		var uiOptions = win.getChildByID("pageExpCalib_macina1o2");
		uiOptions.changeOptions (optionsForGrinder);
		uiOptions.selectOptionByIndex(0);
	}
	btnTestSelection_hide();

	if (null == taskEspressoCalib)
		taskEspressoCalib = new TaskEspressoCalib();
	currentTask = taskEspressoCalib;
	currentTask.setMacina(pageExpCalib_macina1o2);
	pageExpCalib_refreshCalibValueOnScreen();
}

function pageExpCalib_regolaVG()
{
	var win = ui.getWindowByID("pageExpCalib");
	var target = parseInt(win.getChildByID("pageExpCalib_vg_target").getValue());
	
	if (da3.isVarigrindAutoRegolationEnabled(currentTask.macina1o2))
	{
		currentTask.messageBox("Varigrind Auto-Regulationが有効になっているため、現在のVARIGRIND位置を変更することはできません。<br>デバイス> Varigrindと無効にしてください");
	}
	else
		currentTask.enterSetMacinaPos(target);
}

function pageExpCalib_editSelection()
{
	currentTask = voidTask;
	pleaseWait_show();
	var win = ui.getWindowByID("pageExpCalib");
	var selNum = parseInt(win.getChildByID("pageExpCalib_selNum").getValue())
	pageSingleSelection_show(selNum);
	btnBack_setCallback("pageExpCalib_show()");
}

function pageExpCalib_runSelection()
{
	var win = ui.getWindowByID("pageExpCalib");
	var selNum = parseInt(win.getChildByID("pageExpCalib_selNum").getValue());
	
	//vogliamo far partire la selezione [selNum].
	//Devo verificare che la granulometria di questa selezione sia DISABLED o REFERRING, altrimenti non
	//la si può utilizzare per calibrare la macchina dato che con granulemtria FINE o ROUGHLY la CPU apre/chiude di suo la macina
	var da3Loc = 175 + 100 * (selNum-1);
	var gran = da3.read8(da3Loc);
	if (gran == 0 || gran == 2)	
		currentTask.runSelection(selNum);
	else
	{
		currentTask.messageBox ("警告：その選択は豆が細かすぎるか粗すぎる為、使用出来ない可能性があります。"); //you can't use this selection..please choose another one
	}
}

function pageExpCalib_runSelection_onFinish()
{
	//chiedo le info relativamente all'ultimo flusso e posizione
	rhea.ajax ("getLastFluxInfo", "").then( function(result)
	{
		var data = JSON.parse(result);
		pageDevices_vgrind_setLastFluxAndPos(data.flux, data.grinderPos);
		pageExpCalib_runSelection_onFinish2();
	})
	.catch( function(result)
	{
		pageExpCalib_runSelection_onFinish2();
	});	
}

function pageExpCalib_runSelection_onFinish2()
{
	pleaseWait_hide();
	currentTask.enterQueryMacinePos();
}

function pageExpCalib_resetMacinaCalib()
{
	pleaseWait_show();
	var motor = 10 + currentTask.macina1o2;
	rhea.ajax ("setFattoreCalib", { "m":motor, "v":0}).then( function(result)
	{
		rheaSetDivHTMLByName("pageExpCalib_grSec", "0");
		da3.setCalibFactorGSec(motor, 0);
		da3.setImpulsi(motor,0);
		rheaSetDivHTMLByName("pageExpCalib_imp", "0.00");
		
		setTimeout ( function() { save (function() { pleaseWait_hide();}); }, 1000);
	})
	.catch( function(result)
	{
		pleaseWait_hide();
	});
}

function pageExpCalib_startMacinaCalib ()
{
	pleaseWait_show();
	var macina = currentTask.macina1o2;
	currentTask = taskCalibMotor;
	
	var bAlsoCalcImpulses = 1;
	if (da3.isGruppoMicro())
		bAlsoCalcImpulses = 0;
	taskCalibMotor.startCalibrazioneMacina(macina, bAlsoCalcImpulses);
}

function pageExpCalib_onFinish ()
{
	save (function() { currentTask = taskEspressoCalib; pageExpCalib_refreshCalibValueOnScreen(); pleaseWait_hide();});
}

function pageExpCalib_refreshCalibValueOnScreen()
{
	//macina num
	var motor = 10 + currentTask.macina1o2;
	
	var v = helper_intToFixedOnePointDecimal( da3.getCalibFactorGSec(motor) );
	if (v == 0)
		rheaSetDivHTMLByName("pageExpCalib_grSec", "0");
	else
		rheaSetDivHTMLByName("pageExpCalib_grSec", v +"&nbsp;gr/sec");
	
	v = helper_decodeImpulsi(da3.getImpulsi(motor));
	if (v == 0)
		rheaSetDivHTMLByName("pageExpCalib_imp", "0");
	else
		rheaSetDivHTMLByName("pageExpCalib_imp", v +"&nbsp;imp/gr");
		
	if (da3.isVarigrindAutoRegolationEnabled(currentTask.macina1o2))
		rheaSetDivHTMLByName("pageExpCalib_vgAutoAjustEnabled", "オートレギュレーション：有効");
	else
		rheaSetDivHTMLByName("pageExpCalib_vgAutoAjustEnabled", "オートレギュレーション：無効");
	
}

function pageExpCalib_onChangeGrinder()
{
	pleaseWait_show();
	var win = ui.getWindowByID("pageExpCalib");

	pageExpCalib_macina1o2 = parseInt(win.getChildByID("pageExpCalib_macina1o2").getSelectedOptionValue());
	if (pageExpCalib_macina1o2 == 0 || pageExpCalib_macina1o2 > da3.getNumMacine())
		pageExpCalib_macina1o2 = 1;

	rheaSetDivHTMLByName("pageExpCalib_vgCurPos", "");
	win.getChildByID("pageExpCalib_vg_target").setValue(0);
	
	setTimeout ( function() {pageExpCalib_show();}, 200);
}
</script>
</html>


