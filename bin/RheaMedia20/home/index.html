<html>
<html>
<head>
	<title>RheaMedia2 - v2.6.0</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<script src="js/jquery-3.4.1.min.js"></script>
	<script src="js/utils.js"></script>
	<link href="style.css" rel="stylesheet" type="text/css">
	<link href="js/fileBrowser.css" rel="stylesheet" type="text/css">
	<style>
		ul.elenco { list-style-type: none; margin: 0; padding: 0; }
		ul.elenco li { float:left; padding:0; margin:20px; }
		
		.boxTemplate { margin:0 0 0 0; cursor:pointer; text-align:center; padding:10px 0 30px 0;}
		.boxTemplate h3 { margin:0 auto;}
		
		.boxTemplate:hover { background-color:#55a0da;}
		.boxTemplate:hover h3 { color:#fff}

		ul.prefabs { margin:0; padding:0; list-style-type:none; font-size:1.4em;}
		ul.prefabs li { margin:10px 0 10px 0; padding: 5px; cursor:pointer; background-color:#fff; }
		ul.prefabs li:hover { background-color:#55a0da; color:#fff}

	</style>	
</head>

<body onLoad="rheaBootstrap()">
<div id="mainWrapper" class="wrapper">
	<div id="main-content">
		<div class="header">
			<h1>RheaMedia2 - v2.6.0</h1>
		</div>

		<div class="page">
			<div id="page-content" style="display:block; overflow:hidden">
			
				<div id="multiBoxContainer" style="width:10000px; position:relative; top:0; left:0">
					<div class="wrapper" style="float:left;">
						<div class="box">
							<div class="box-content" style="min-height:300px">
								<ul class="elenco">
									<li><a class="buttonbig azzurro" href="javascript:scrollToPage(1)">Create a new GUI</a></li>
									<li><a class="buttonbig azzurro" href="javascript:existingGUI_openFileBrowser()">Edit an existing GUI</a></li>
								</ul>
								<div class="clear"></div>
							</div>
						</div>
					</div>
					
					<div class="wrapper" style="float:left;">
						<div class="box " style="float:left;">
							<div class="box-content" style="min-height:300px">
								<div style="float:left; width:12%"><a href="javascript:scrollToPage(0); delete window.imported" class="button giallo"><< BACK</a></div>
								<div style="float:left; margin-top:6px; width:88%"><h2>Please select a template</h2></div>
								<div class="clear"></div>
								<br>
								<div id="page1TemplateList"></div>
							</div>
						</div>
					</div>
					
					<div class="wrapper" style="float:left;">
						<div class="box " style="float:left;">
							<div class="box-content" style="min-height:300px">
								<div style="float:left; width:12%"><a href="javascript:scrollToPage(1)" class="button giallo"><< BACK</a></div>
								<div style="float:left; margin-top:6px; width:88%"><h2>Please choose a starting point...</h2></div>
								<div class="clear"></div>
								<br>
								<div id="page2PrefabsList"></div>
							</div>
						</div>
					</div>

					<div class="clear"></div>
				</div>
			</div>
		</div>
	</div>
	
	<div id="main-content-wait" style="display:none">
		<br><br><br><br><br><br><br><br><br><br>
		<center><img src="img/animationRound.gif"></center>
		<div id="main-content-wait-msg" style="position:absolute; top:20px; left:20px; color:#fff;"></div>
	</div>
	
	<div id="fileBrowser1" class="fileBrowser"></div>
	<div id="fileSaveAs1" class="fileBrowser"></div>
</div>

<script src="js/rheaBootstrap.js"></script>
<script src="js/fileBrowser.js"></script>
<script src="js/fileSaveAs.js"></script>
<script src="js/utils.js"></script>
<script src="js/rheaDB.js"></script>
<script src="js/rhea.migration.js"></script>

<script language="javascript">
var fileBrowser1 = null;
var fileSaveAs1 = null;
async function onRheaBootstrapFinished()
{
	// Clear rhea.data from localstorage
	localStorage.removeItem('rhea.data');

	fileBrowser1 = new FileBrowser("fileBrowser1");
	fileSaveAs1 = new FileSaveAs("fileSaveAs1");
	pleaseWait(1);	
	
	var from = rheaGetURLParamOrDefault("from", "");
	if (from != "")
	{
		var folderToDelete = rheaGetAbsolutePhysicalPath() +"/../temp/" +from;
		//console.log ("delete [" +folderToDelete +"]");
		rhea.ajax ("taskSpawn", { "name" : "deleteFolder", "params":folderToDelete})
					.then( function(result)
					{
					})
					.catch ( function(result)
					{
					});
		
	}
	
	
	
	//elenco dei template
	await templateList_load();
	
	pleaseWait(0);	
}

function scrollToPage (i)
{
	$('html,body').scrollTop(0);
	var dest = -i*1000;
	$("#multiBoxContainer").animate(
		{ left: dest }, 
		400, 
		function() 
		{ 
		} 
	);
}

function getATempFolderName()	{ return dataOra_getYYYYMMDD("") +dataOra_getHHMMSS(""); }



/*****************************************************
 *
 * task copyFolderToFolder
 * 
 */
function copyFolderToFolder (srcPath, dstPath, fnToCallAtEnd)
{
	console.log ("copyFolderToFolder [" +srcPath +"] [" +dstPath +"]");
	rhea.ajax ("taskSpawn", { "name" : "copyFolderToFolder", "params":srcPath+"§"+dstPath})
				.then( function(result)
				{
					var taskID = parseInt(result);
					//console.log ("new task id[" +taskID +"]");
					setTimeout (function(){ copyFolderToFolder_query(taskID, fnToCallAtEnd);}, 400);
						
				});
}

function copyFolderToFolder_query (taskID, fnToCallAtEnd)
{
	rhea.ajax ("taskStatus", { "id" : taskID})
				.then( function(result)
				{
					var obj = JSON.parse(result);
					console.log ("[" +taskID +"] status[" +obj.status +"], msg[" +obj.msg +"]");
					
					pleaseWait_addMessage (obj.msg);
					if (obj.status == "0")
						fnToCallAtEnd(obj.msg);
					else
						setTimeout (function(){ copyFolderToFolder_query(taskID, fnToCallAtEnd);}, 1000);
				});
}



/*****************************************************
 *
 * task importExistingGUI
 * 
 */
function importExistingGUI (templateName, templateVer, templateSrcPath, userGUISrcPath, dstPath, fnToCallAtEnd)
{
	console.log ("importExistingGUI [" +templateName +"][" +templateVer +"] [" +templateSrcPath +"] [" +userGUISrcPath +"] [" +dstPath +"]");
	rhea.ajax ("taskSpawn", { "name" : "importExistingGUI", "params":templateName +"§" +templateVer +"§" +templateSrcPath +"§" +userGUISrcPath +"§" +dstPath})
				.then( function(result)
				{
					var taskID = parseInt(result);
					console.log ("new task id[" +taskID +"]");
					setTimeout (function(){ importExistingGUI_query(taskID, fnToCallAtEnd);}, 400);
						
				});
}

function importExistingGUI_query (taskID, fnToCallAtEnd)
{
	rhea.ajax ("taskStatus", { "id" : taskID})
				.then( function(result)
				{
					var obj = JSON.parse(result);
					console.log ("[" +taskID +"] status[" +obj.status +"], msg[" +obj.msg +"]");
					
					pleaseWait_addMessage (obj.msg);
					if (obj.status == "0")
						fnToCallAtEnd(obj.msg);
					else
						setTimeout (function(){ importExistingGUI_query(taskID, fnToCallAtEnd);}, 1000);
				});
}


/*****************************************************
 *
 * templateList
 * filla la var templateList[] con l'elenco dei template disponibili. Per ogni template, recuper anche i suoi prefabs
 */
var templateList = [];
async function templateList_load()
{
	await templateList_load1();
	for (var i=0; i<templateList.length; i++)
		await templateList_load2(i);
		
	var html = "";	
	for (var i=0; i<templateList.length; i++)
	{
		html += "<div class='boxTemplate' onclick='templateList_showPrefabs(" +i +")'><h3>TEMPLATE: " +templateList[i].name +"</h3>"
					+"<img src='../template/" +templateList[i].name +"/templateImage.jpg'>"
				+"</div>";
	}
	$("#page1TemplateList").html(html);
}		
	
function templateList_load1()
{
	var path = rheaGetAbsolutePhysicalPath() +"/../template";
	return rhea.ajax ("FSList", { "path" : path, "jolly":"*.*"})
				.then( function(result)
				{
					var obj = JSON.parse(result);
					var e = obj.folderList.split("§");
					for (var i=0; i<e.length; i++)
						templateList[i] = { "name":e[i], "prefabs":[] };
						
						
				});
}

function templateList_load2(index)
{
	var path = rheaGetAbsolutePhysicalPath() +"/../template/" +templateList[index].name +"/prefabs";
	return rhea.ajax ("FSList", { "path" : path, "jolly":"*.db3"})
				.then( function(result)
				{
					var obj = JSON.parse(result);
					var e = obj.folderList.split("§");
					for (var i=0; i<e.length; i++)
						templateList[index].prefabs[i] = e[i];
				});
}

function templateList_showPrefabs (index)
{
	if (window.imported && window.imported.oldTemplateConfiguration) {
		createNewGUI(index, 0);
	} else {
		var html = "<ul class='prefabs'>";
		for (var i=0; i<templateList[index].prefabs.length; i++)
		{
			var folderName = templateList[index].prefabs[i];
			html += "<li onclick='createNewGUI(" +index +"," +i +")'>" +folderName +"</li>";
		}
		html += "</ul>";
		$("#page2PrefabsList").html(html);
		scrollToPage(2);
	}
}


/*********************************************************
 *
 * create new
 *
 */
var templateSrcFolder = "";
var prefabsSrcFolder  = "";
var tempFolderName = "";
var absTempFolderPath = "";
function createNewGUI (iTemplate, iPrefabs)
{
	templateSrcFolder = rheaGetAbsolutePhysicalPath() +"/../template/" +templateList[iTemplate].name +"/gui";
	prefabsSrcFolder  = rheaGetAbsolutePhysicalPath() +"/../template/" +templateList[iTemplate].name +"/prefabs/" +templateList[iTemplate].prefabs[iPrefabs];
	tempFolderName = getATempFolderName();
	absTempFolderPath = rheaGetAbsolutePhysicalPath() +"/../temp/" +tempFolderName;
	
	pleaseWait(1);
	copyFolderToFolder (templateSrcFolder, absTempFolderPath, createNewGUI_onFinishTemplateCopy);
}

function createNewGUI_onFinishTemplateCopy(taskFinalMsg)
{
	if (taskFinalMsg != "OK")
	{
		alert (taskFinalMsg);
		pleaseWait(0);
		return;
	}
	
	//copio il prefabs
	copyFolderToFolder (prefabsSrcFolder, absTempFolderPath +"/web", createNewGUI_onFinishPrefabsCopy);
}

async function createNewGUI_onFinishPrefabsCopy(taskFinalMsg)
{
	if (taskFinalMsg != "OK")
	{
		alert (taskFinalMsg);
		pleaseWait(0);
		return;
	}

	if(window.imported && window.imported.oldTemplateConfiguration) {
		var path = rheaGetAbsolutePhysicalPath().split('/');
		path.pop(); path = path.join('/');

		var tempFolder = `${path}/temp/${tempFolderName}/web/backoffice`;
		var pathDB = `${tempFolder}/guidb.db3`;
		var tempDb = new RheaDB(pathDB);

		var rMig = new RheaMigration( 
			tempFolder,
			window.imported.oldTemplateConfiguration.root, 
			window.imported.configurationPath, 
			tempDb );

		await rMig.convert();

		// chiudo il DB
		rhea.ajax ("DBClose", { "path" : pathDB})
			.then( function(result){ })
			.catch ( function(result) { })
			.finally( function() {
				window.location = "../temp/" +tempFolderName +"/web/backoffice/startup.html";
			});
	} else {
		window.location = "../temp/" +tempFolderName +"/web/backoffice/startup.html";
	}

	pleaseWait(0);
}


/*****************************************************
 *
 * load existing
 * 
 */
function existingGUI_openFileBrowser()
{
	fileBrowser1.openFile("c:", "*.rheagui *.rheaRasGuiTP GuiConfig.xml", existingGUI_onFileOpenFinished, "Browse to locate a GUI folder. Look for a file by the name of <b>template.rheagui</b> and click on it. If you want to import a GUI from RheaMedia 1.x, click on the file named <b>GuiConfig.xml</b>");
}

async function existingGUI_onFileOpenFinished(fileName, path)
{
	console.log ("[" +fileName +"][" +path +"]");
	if (fileName == "")
		return;
	
	let rheaData = {
		exportetTpl: path,
		expires: (new Date( new Date().getTime() + (24 * 60 * 60 * 1000))).getTime()
	}

	if (fileName.indexOf(".rheagui") !== -1){
		existingGUI_beginImport_rheagui(fileName, path);
		localStorage.setItem('rhea.data', JSON.stringify( rheaData ));
	} else if (fileName.indexOf(".rheaRasGuiTP") !== -1) {
		existingGUI_beginImport_rheaRasGuiTP(fileName, path);
		localStorage.setItem('rhea.data', JSON.stringify( rheaData ));
	} else if (fileName.indexOf("GuiConfig.xml") !== -1) {				// RheaMedia 1.x
		existingGUI_beginImport_old_rheaMedia(fileName, path);
		localStorage.setItem('rhea.data', JSON.stringify( rheaData ));
	}
	else
		alert ("ERROR: invalid file extension");
}
	
/***************************************************************
 * importazione	di gui con estensione .rheagui
 */
async function existingGUI_beginImport_rheagui(fileName, path)
{
	var userGUISrcPath = path;
		
	pleaseWait(1);
	
	//devo verificare che la GUI selezionata corrisponda ad un template valido
	var pathDB = path +"/web/backoffice/guidb.db3";
	db = new RheaDB (pathDB);
	let rst = await db.q("SELECT Template,TemplateVer FROM history WHERE 1");
	
	//chiudo il DB
	rhea.ajax ("DBClose", { "path" : pathDB}).then( function(result){}).catch ( function(result) {});	
	
	if (rst.hasError() != "")
	{
		alert ("Error opening the GUI. The GUI is invalid or not supported");
		pleaseWait(0);
		return;
	}
	
	var templateName = "";
	var templateVer ="";
	console.log ("num rows[" +rst.getNumRows() +"]");
	if (rst.getNumRows() > 0)
	{
		if (rst.fromColNameToColIndex("Template") >= 0 && rst.fromColNameToColIndex("TemplateVer") >= 0)
		{
			templateName = rst.valByColName(0, "Template");
			templateVer = rst.valByColName(0, "TemplateVer");
		}
	}
	
	if (templateName == "")
	{
		templateName = "nestle-2.0-template-001";
		templateVer = 0;
		/*alert ("WARN: the selected GUI uses a template that it's not supported by this version of rheaMedia");
		pleaseWait(0);
		return;*/
	}
	
	//vediamo se ho il template richiesto
	for (var iTemplate=0; iTemplate<templateList.length; iTemplate++)
	{
		if (templateList[iTemplate].name == templateName)
		{
			//ok, tutto bene. Copio il mio template in una cartella temporanea e poi lo sovrascrivo con parte della GUI selezionata
			var templateSrcPath = rheaGetAbsolutePhysicalPath() +"/../template/" +templateList[iTemplate].name +"/gui";
			tempFolderName = getATempFolderName();
			var dstPath = rheaGetAbsolutePhysicalPath() +"/../temp/" +tempFolderName;
			importExistingGUI (templateName, templateVer, templateSrcPath, userGUISrcPath, dstPath, existingGUI_beginImport_rheagui_onFinished)
			return;
		}
	}
	
	//Errore, il template della GUI non corrisponde a nessuno di quelli installati
	alert ("Error. Your GUI is based on a template named '" +templateName +"' which is not one of the available templates");
	pleaseWait(0);
}

function existingGUI_beginImport_rheagui_onFinished(taskFinalMsg)
{
	if (taskFinalMsg != "OK")
	{
		alert (taskFinalMsg);
		pleaseWait(0);
		return;
	}

	window.location = "../temp/" +tempFolderName +"/web/backoffice/startup.html";
	
	pleaseWait(0);
}

/***************************************************************
 * importazione	di gui con estensione .rheaRasGuiTP
 */
async function existingGUI_beginImport_rheaRasGuiTP(fileName, path)
{
	pleaseWait(1);
	
	//devo unzippare il file
	var destUnzippedFolder = rheaGetAbsolutePhysicalPath() +"/../temp/unzip/" +getATempFolderName();
	let result = await rhea.ajax ("FSUnzip", { "src":path+"/"+fileName, "dst":destUnzippedFolder +"/web", "mkdir":1 }).then( function(result)
	{
		if (result != "OK")
			return 0;
		return 1;
	});
	
	if (result == 0)
	{
		pleaseWait(0);
		alert ("ERROR unzipping src file");
		return;
	}
	
	//a questo punto ho la GUI unzippata in [destUnzippedFolder], procedo come al solito
	existingGUI_beginImport_rheagui("", destUnzippedFolder);
	
}

/***************************************************************
 * importazione	di gui con estensione .xml relativa ad una GUI generata con RheaMedia 1.x
 */
async function existingGUI_beginImport_old_rheaMedia(fileName, path)
{
	pleaseWait(1);
	
	// Read xml FILE

	// READ PROCEDURE -> remember to remove the <?xml version="1.0" encoding="UTF-8"?> line
	var xml = // xml
	`
			<root><info><version>4</version><modelcode>82</modelcode><templatecode>0</templatecode></info><Cino_generalSettings><NumSelections>12</NumSelections><NumTableSelColumns>4</NumTableSelColumns><NumTableSelRows>3</NumTableSelRows><Cino_ShowConfirmPageFlag>1</Cino_ShowConfirmPageFlag><Cino_ConfirmPageTimeout>20</Cino_ConfirmPageTimeout><Cino_MenuPageTimeout>6</Cino_MenuPageTimeout><Cino_MouseMode>0</Cino_MouseMode><Cino_SelEndPageTimeout>4</Cino_SelEndPageTimeout><Cino_ShowPrices>0</Cino_ShowPrices><Cino_NumDecimals>2</Cino_NumDecimals><Cino_Text_Currency>€</Cino_Text_Currency><Cino_Text_MenuAHeader><![CDATA[MENU: MAIN DRINKS]]></Cino_Text_MenuAHeader><Cino_Text_MenuBHeader><![CDATA[MENU: XL DRINKS]]></Cino_Text_MenuBHeader><Cino_Text_MenuCHeader><![CDATA[MENU: C]]></Cino_Text_MenuCHeader><Cino_Text_MenuDHeader><![CDATA[MENU: D]]></Cino_Text_MenuDHeader><Cino_Text_MenuEHeader><![CDATA[MENU: E]]></Cino_Text_MenuEHeader><Cino_Text_MenuFHeader><![CDATA[MENU: F]]></Cino_Text_MenuFHeader><Cino_Text_GoStandby><![CDATA[INFO]]></Cino_Text_GoStandby><Cino_Text_GoMenuB><![CDATA[GO TO XL MENU >]]></Cino_Text_GoMenuB><Cino_Text_GoMenuC><![CDATA[GO TO MENU C >]]></Cino_Text_GoMenuC><Cino_Text_GoMenuD><![CDATA[GO TO MENU D >]]></Cino_Text_GoMenuD><Cino_Text_GoMenuE><![CDATA[GO TO MENU E >]]></Cino_Text_GoMenuE><Cino_Text_GoMenuF><![CDATA[GO TO MENU F >]]></Cino_Text_GoMenuF><Cino_Text_ConfirmHeader><![CDATA[SELECTED DRINK:]]></Cino_Text_ConfirmHeader><Cino_Text_ConfirmQuestion><![CDATA[Do you want to start this drink?]]></Cino_Text_ConfirmQuestion><Cino_Text_NutritionalInfo><![CDATA[Nutritional info:]]></Cino_Text_NutritionalInfo><Cino_Text_Back><![CDATA[< BACK]]></Cino_Text_Back><Cino_Text_Ok><![CDATA[OK]]></Cino_Text_Ok><Cino_Text_SelPreparingHeader><![CDATA[DRINK PREPARATION]]></Cino_Text_SelPreparingHeader><Cino_Text_SelPreparing><![CDATA[Your selection is being prepared...]]></Cino_Text_SelPreparing><Cino_Text_SelEndHeader><![CDATA[DRINK READY]]></Cino_Text_SelEndHeader><Cino_Text_SelEnd><![CDATA[Your selection is ready.\rEnjoy it!]]></Cino_Text_SelEnd><Cino_Text_OutOfOrder><![CDATA[This machine is out of order]]></Cino_Text_OutOfOrder></Cino_generalSettings><Cino_selection><SN><![CDATA[Espresso]]></SN><SD><![CDATA[60ml of hot water, 7gr of grinded coffee beans.\rServed at 75°C.\rA perfect drink for early morning.]]></SD><SI>Drink_espresso.png</SI><ST>0</ST><SN><![CDATA[Long Coffee]]></SN><SD><![CDATA[90ml of hot water, 8gr of grinded coffee beans.\rServed at 75°C.\rA perfect drink for early morning.]]></SD><SI>Drink_blackCoffeeLong.png</SI><ST>0</ST><SN><![CDATA[Short White Coffee]]></SN><SD><![CDATA[70ml of hot water, 7gr of grinded coffee beans, 3gr of milk.\rServed at 75°C.\rA perfect drink for early morning.]]></SD><SI>Drink_espressoMacchiato.png</SI><ST>0</ST><SN><![CDATA[Cappuccino]]></SN><SD><![CDATA[120ml of hot water, 7gr of grinded coffee beans, 3gr of milk, 2gr of chocolate.\rServed at 75°C.\rA perfect drink for early morning.]]></SD><SI>Drink_cappuccino.png</SI><ST>0</ST><SN><![CDATA[Milk]]></SN><SD><![CDATA[90ml of hot water, 8gr of milk.\rServed at 75°C.\rA perfect drink for early morning.]]></SD><SI>Drink_milk.png</SI><ST>0</ST><SN><![CDATA[Latte Macchiato]]></SN><SD><![CDATA[120ml of hot water, 7gr of grinded coffee beans, 4gr of milk.\rServed at 75°C.\rA perfect drink for early morning.]]></SD><SI>Drink_latteMacchiato.png</SI><ST>0</ST><SN><![CDATA[Moccaccino]]></SN><SD><![CDATA[120ml of hot water, 7gr of grinded coffee beans, 3gr of milk, 2gr of chocolate.\rServed at 75°C.\rA perfect drink for early morning.]]></SD><SI>Drink_moccacino.png</SI><ST>0</ST><SN><![CDATA[Chocolate]]></SN><SD><![CDATA[120ml of hot water, 12gr of chocolate.\rServed at 75°C.\rA perfect drink for early morning.]]></SD><SI>Drink_chocolate.png</SI><ST>0</ST><SN><![CDATA[Chocomilk]]></SN><SD><![CDATA[120ml of hot water, 9gr of chocolate, 3gr of milk.\rServed at 75°C.\rA perfect drink for early morning.]]></SD><SI>Drink_chocoMilk.png</SI><ST>0</ST><SN><![CDATA[Instant Coffee]]></SN><SD><![CDATA[90ml of hot water, 7gr of instant coffee.\rServed at 75°C.\rA perfect drink for early morning.]]></SD><SI>Drink_blackCoffee.png</SI><ST>0</ST><SN><![CDATA[White Instant Coffee]]></SN><SD><![CDATA[90ml of hot water, 7gr of instant coffee, 3gr of milk.\rServed at 75°C.\rA perfect drink for early morning.]]></SD><SI>Drink_coffeeWithMilk.png</SI><ST>0</ST><SN><![CDATA[Hot Water]]></SN><SD><![CDATA[120ml of hot water.\rServed at 75°C.\r]]></SD><SI>Drink_hotWater.png</SI><ST>0</ST></Cino_selection><Cino_standby><numP>4</numP><I /><T>0</T><L>0</L><W>0</W><H>0</H><Y /><I /><T>0</T><L>0</L><W>0</W><H>0</H><Y /><I /><T>0</T><L>0</L><W>0</W><H>0</H><Y /><I /><T>0</T><L>0</L><W>0</W><H>0</H><Y /><I /><T>0</T><L>0</L><W>0</W><H>0</H><Y /><BK>standby_01.png</BK><TM1>5</TM1><I /><T>0</T><L>0</L><W>0</W><H>0</H><Y /><I /><T>0</T><L>0</L><W>0</W><H>0</H><Y /><I /><T>0</T><L>0</L><W>0</W><H>0</H><Y /><I /><T>0</T><L>0</L><W>0</W><H>0</H><Y /><I /><T>0</T><L>0</L><W>0</W><H>0</H><Y /><BK>standby_02.png</BK><TM2>5</TM2><I /><T>0</T><L>0</L><W>0</W><H>0</H><Y /><I /><T>0</T><L>0</L><W>0</W><H>0</H><Y /><I /><T>0</T><L>0</L><W>0</W><H>0</H><Y /><I /><T>0</T><L>0</L><W>0</W><H>0</H><Y /><I /><T>0</T><L>0</L><W>0</W><H>0</H><Y /><BK>standby_03.png</BK><TM3>5</TM3><I /><T>0</T><L>0</L><W>0</W><H>0</H><Y /><I /><T>0</T><L>0</L><W>0</W><H>0</H><Y /><I /><T>0</T><L>0</L><W>0</W><H>0</H><Y /><I /><T>0</T><L>0</L><W>0</W><H>0</H><Y /><I /><T>0</T><L>0</L><W>0</W><H>0</H><Y /><BK>standby_04.png</BK><TM4>5</TM4></Cino_standby></root>
	`;
	
	// Convert xml File into JSON Object
	window.imported = new Object();

	window.imported.oldTemplateConfiguration = parseXMLFile(xml);
	window.imported.configurationPath = path;

	scrollToPage(1)

	pleaseWait(0);
}

function parseXMLFile(xml) {
	var parser = new DOMParser();
	var xmlDoc = parser.parseFromString(xml, 'text/xml')

	// Check if xml db is valid
	if (!xmlDoc.querySelector('info')) {
		alert ("ERROR: invalid file");
	}

	// Retrieves the root node
	var rootNode = xmlDoc.querySelector('root');

	return configToJSON(xmlDoc);
}

function configToJSON(xml) {
    try {
        var obj = {};
        
		if (xml.children.length > 0) {
            for (var i = 0; i < xml.children.length; i++) {
                var item = xml.children.item(i);
                var nodeName = item.nodeName;

                if (typeof (obj[nodeName]) == "undefined") {
                    obj[nodeName] = configToJSON(item);
                } else {
                    if (typeof (obj[nodeName].push) == "undefined") {
                        var old = obj[nodeName];

                        obj[nodeName] = [];
                        obj[nodeName].push(old);
                    }

                    obj[nodeName].push(configToJSON(item));
                }
            }
        } else {
            obj = xml.textContent;
        }

        return obj;
    } catch (e) {
        console.log(e.message);
    }
}

</script>
</html>
