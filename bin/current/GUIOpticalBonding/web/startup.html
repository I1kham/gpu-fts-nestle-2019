<html>
<head>
	<title>GUI</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link href="style.css" rel="stylesheet" type="text/css">
</head>

<body onLoad="rheaBootstrap()">
<div id="mainWrapper" class="wrapper1024x600">
</div>

<script id="rheaBootstrapTag" src="js/rheaBootstrap.js" data-ses-clear="1"></script>
<script language="javascript">
var cellW = 64;
var cellH = 40;
var winW = 1024;
var winH = 600;
var numCell = 0;
var values = [];
function onRheaBootstrapFinished()
{
	var bgCol1 = "#444";
	var bgCol2 = "#666";

	var html = "";
	var rownum = 0;
	for (var y=0; y<winH; y+=cellH)
	{
		var bgCol = bgCol1;
		if (rownum % 2 == 0)
			bgCol = bgCol2;
		rownum++;
		for (var x=0; x<winW; x+=cellW)
		{
			if (bgCol == bgCol1)
				bgCol = bgCol2;
			else
				bgCol = bgCol1;

			var id = "block" +numCell;
			values[numCell] = 0;
			html += "<div id='" +id +"' class='block' style='left:" +x +"px; top:" +y +"px; width:" +cellW +"px; height:" +cellH +"px; background-color:" +bgCol +";' onmousedown='onMouseDown(" +numCell +")'></div>";
			numCell++;
		}
	}
	rheaSetElemHTML (rheaGetElemByID("mainWrapper"), html);
	load();
}

function onMouseDown(index)
{
	values[index]++;
	save(index);
	refreshLabel(index);
}

function refreshLabel (index)
{
	var id = "block" +index;
	rheaSetElemHTML (rheaGetElemByID(id), values[index]);
}

function refreshAllLabel()
{
	for (var i=0; i<numCell; i++)
	{
		var id = "block" +i;
		rheaSetElemHTML (rheaGetElemByID(id), values[i]);
	}
}

function load()
{
	for (var i=0; i<numCell; i++)
		values[i] = 0;

	rhea.ajax ("CR90-load", "").then( function(result)
	{
		var v = result.split(",");
		var index = 0;
		for (var index=0; index<v.length; index++)
		{
			if (v[index] != -1)
				values[index] = v[index];
		}
		refreshAllLabel();
	})
	.catch( function(result)
	{
		refreshAllLabel();
	});	
}

function save(index)
{
	rhea.ajax ("CR90-save", {"index":index, "value":values[index]} ).then( function(result)
	{
	})
	.catch( function(result)
	{
	});	
}
</script>
</html>
