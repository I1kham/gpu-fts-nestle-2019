<html>
<head>
	<title>GUI</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">	
	<link href="style.css" rel="stylesheet" type="text/css">
</head>

<body onLoad="rheaBootstrap()">

<div class="wrapper1024x600">
	<div class="header">
		<div class="header_left">
			<div class="header_left_btnHome"><a href="pageMenu.html"><img src="img/btnHome.png"></a></div>
		</div>
		<div class="header_center"><img src="img/logo.png"></div>
		<div class="header_right"></div>
		<div class="clear"></div>
	</div>

	<div class="page">
		<div class="pageMenuLeft">
			<br><br><br><br><br><br><a href="javascript:onLeftArrowClicked()" style="font-size:80px"><b>&lt;</b></a>
		</div>
		
		<div class="pageMenuCenter" style="overflow:hidden;">
			<div id="divIconMenuWindow" style="width:100%; height:100%; position:relative">
				<div id="divIconMenuContainer" style="position:absolute; left:0; top:0"></div>
			</div>
			<div class="clear"></div>
		</div>

		<div class="pageMenuRight">
			<br><br><br><br><br><br><a href="javascript:onRightArrowClicked()" style="font-size:80px"><b>&gt;</b></a>
		</div>
		<div class="clear"></div>
	</div>

	<div class="footer">
		<div class="footer_left">
			<div class="footer_left_btnInfo"><a href="pageInfo.html"><div id="divBtnInfo"></div></a></div>
		</div>
		<div class="footer_center">
			<div id="divCredit"></div>
		</div>
		<div class="footer_right">
			<input type="button" value="GB" onclick="javascript:setLanguage('GB')">
			<input type="button" value="IT" onclick="javascript:setLanguage('IT')">
		</div>
		<div class="clear"></div>
	</div>
</div>

<!-- le opzioni di layout per questa pagina sono qui -->
<script src="config/pageMenu.js"></script>

<script src="js/rheaBootstrap.js"></script>
<script language="javascript">

var timerGotoPageStandby = null;

function onRheaBootstrapFinished()
{
	rhea.onEvent_selectionAvailabilityUpdated = function ()
	{
		alert ("sel avail updated");
	}
		
	rhea.onEvent_selectionPricesUpdated = function ()
	{
		alert ("sel prices update");
	}
		
	rhea.onEvent_creditUpdated = function ()
	{
		doUpdateCredit();
	}

	rheaSetDivHTMLByName("divBtnInfo", rheaLang.BTN_INFO);

	setupIconContainer(rheaPageOptions.icon_numRow, rheaPageOptions.icon_numIconPerRow);
	doUpdateCredit();
	
	resetTimerGotoPageStandby();
}

function resetTimerGotoPageStandby()
{
	if (rheaPageOptions.gotoPageStandbyAfterMSec <= 0)
		return;
		
	if (null != timerGotoPageStandby)
		clearInterval(timerGotoPageStandby);
	
	timerGotoPageStandby = setInterval(gotoPageStandby, rheaPageOptions.gotoPageStandbyAfterMSec);
}

function gotoPageStandby()
{
	window.location = "pageStandby.html";
}

function doUpdateCredit()
{
	var html = rheaLang.LAB_CREDIT +" " +rhea.credit
	rheaSetDivHTMLByName("divCredit", html);	
}


var mainMenuIconW = 0;
var mainMenuIconH = 0;
var mainMenuIconPageW = 0;
var mainMenuIconNumPage = 0;
function setupIconContainer(nRow, nIconPerRow)
{
	var d = rheaGetElemByID("divIconMenuWindow");
	mainMenuIconPageW = rheaGetElemWidth(d);
	var pageH = rheaGetElemHeight(d);
	
	
	mainMenuIconW = parseInt(mainMenuIconPageW / nIconPerRow);
	mainMenuIconH = parseInt(pageH / nRow);
	
	var html = "";
	var nIcon = rhea.MMI_getCount();
	var nIconPerPage = nIconPerRow * nRow;
	var styleForIconPage = "class='pageMenu_iconPage' style='width:" +mainMenuIconPageW +"px'";
	var styleForIconDiv = "class='pageMenu_iconWrapper' style='width:" +mainMenuIconW +"px; height:" +mainMenuIconH +"px;'";
	mainMenuIconNumPage = 0;
	var iconNum = 0;
	while (nIcon > 0)
	{
		var pageID = "mainMenuIconPage" +mainMenuIconNumPage;
		html += "<div id='" +pageID +"' " +styleForIconPage +">";
			
			var n = nIconPerPage;
			if (nIcon < nIconPerPage)
				n = nIcon;
			for (var i=0; i<n; i++)
			{
				var iconDisplayName = rhea.MMI_getDisplayName(iconNum);
				
				var image = "<img src='" + rhea.MMI_getImgForPageMenu(iconNum) +"'>";
				
				var selNum = rhea.MMI_getLinkedSelectionNumber(iconNum);
				
				var smallLargeMedium = "";
				if (rhea.MMI_canUseSmallCup(iconNum)) smallLargeMedium += "S";
				if (rhea.MMI_canUseMediumCup(iconNum)) smallLargeMedium += "M";
				if (rhea.MMI_canUseLargeCup(iconNum)) smallLargeMedium += "L";
				
				var text = 	"selNum: " +selNum +"<br>"
							+"cup: " + smallLargeMedium +"<br>"
							+"price: " +rhea.MMI_getPrice(iconNum) +"<br>";
				if (selNum == 0)
				{
					if (rhea.MMI_hasDoubleShot(iconNum)) text += " opt: dbl shot<br>";
					if (rhea.MMI_hasDblGrinder(iconNum)) text += " opt: dbl grinder<br>";
				}
				
				html += "<div " +styleForIconDiv +">"
							+"<div class='pageMenu_icon' onclick='onIconMenuClicked(" +iconNum +")'>"
								+"<div class='pageMenu_icon_img'>" +image +"</div>"
								+"<div class='pageMenu_icon_text'>" +iconDisplayName +"<br>" +text +"</div>"
							+"</div>"
						+"</div>";
				iconNum++;
			}
		html += "</div>";
		
		mainMenuIconNumPage++;
		nIcon -= nIconPerPage;
	}
	
	html += "<div class='clear'></div>";
	d = rheaGetElemByID("divIconMenuContainer");
	rheaSetElemWidth (d, mainMenuIconNumPage*mainMenuIconPageW);
	rheaSetElemHTML(d,html);
}


function onLeftArrowClicked()
{
	resetTimerGotoPageStandby();
	
	var d = rheaGetElemByID("divIconMenuWindow");
	var x = rheaGetElemLeft(d);
	
	var curPage = parseInt(-x / mainMenuIconPageW);
	curPage--;
	if (curPage < 0)
	{
		curPage = 0;
		return;
	}
		
	x = curPage * mainMenuIconPageW;
	rheaSmoothScrollElemLeft (d, -x, 300);
}

function onRightArrowClicked()
{
	resetTimerGotoPageStandby();
	
	var d = rheaGetElemByID("divIconMenuWindow");
	var x = rheaGetElemLeft(d);
	
	var curPage = parseInt(-x / mainMenuIconPageW);
	curPage++;
	if (curPage >= mainMenuIconNumPage)
	{
		curPage = mainMenuIconNumPage-1;
		return;
	}
		
	x = curPage * mainMenuIconPageW;
	rheaSmoothScrollElemLeft (d, -x, 300);
}

function onIconMenuClicked (iconNum)
{
	resetTimerGotoPageStandby();
	window.location = "pageConfirm.html?iconMenu=" +iconNum;
}

function setLanguage(twoCharISOCode)
{
	resetTimerGotoPageStandby();
	
	rhea.lang_loadLang(twoCharISOCode)
	.then ( function(result)
	{
		window.location = window.location;
	})
	.catch ( function(result)
	{
		rheaLog ("AJAX::error => " +result);
	});
	
}

function onBtnInfoClicked()
{
	resetTimerGotoPageStandby();
}

</script>


</html>
