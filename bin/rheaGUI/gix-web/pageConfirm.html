<html>
<head>
	<title>GUI</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link href="style.css" rel="stylesheet" type="text/css">
</head>

<body onLoad="rheaBootstrap()">

<div class="wrapper1024x600">
	<div class="header">
		<div class="header_left">
			<div class="header_left_btnHome"><a href="pageMenu.html"><img src="img/btnHome.png"></a></div>
		</div>
		<div class="header_center"><img src="img/logo.png"></div>
		<div class="header_right"></div>
		<div class="clear"></div>
	</div>

	<div class="page">
		<div class="pageConfirm_left">
			<div id="divCup0" class="pageConfirmCupContainer" onclick="onCupSelected(0)"></div>
			<div id="divCup1" class="pageConfirmCupContainer" onclick="onCupSelected(1)"></div>
			<div id="divCup2" class="pageConfirmCupContainer" onclick="onCupSelected(2)"></div>
		</div>
		<div class="pageConfirm_center">
			<div id="divContent"></div>
		</div>
		<div class="pageConfirm_right">
			option
		</div>
		<div class="clear"></div>
	</div>

	<div class="footer">
		<div class="footer_left">
			<div class="footer_left_btnInfo"><a href="pageInfo.html"><div id="divBtnInfo"></div></a></div>
		</div>
		<div class="footer_center">
			<div id="divCredit"></div>
		</div>
		<div class="footer_right">
			<input type="button" value="GB" onclick="javascript:setLanguage('GB')">
			<input type="button" value="IT" onclick="javascript:setLanguage('IT')">
		</div>
		<div class="clear"></div>
	</div>
</div>

<script src="js/rheaBootstrap.js"></script>
<script language="javascript">
var iconNum = 0;
var GRINDER = 0;
var CUP_SIZE = 0;
var SHOT_TYPE = 0;

function onRheaBootstrapFinished()
{
	rhea.onEvent_creditUpdated = function ()
	{
		doUpdateCredit();
	}
	
	//in get ci deve essere il parametro che indica quale iconMenu Ã¨ stata selezionata
	iconNum = parseInt(rheaGetURLParamOrDefault("iconMenu", 0));

	setupPageContent();
	doUpdateCredit();
	
	rheaSetDivHTMLByName("divBtnInfo", rheaLang.BTN_INFO);
}


function doUpdateCredit()
{
	rheaSetDivHTMLByName("divCredit", rhea.credit);	
}

function setupPageContent()
{
	var iconDisplayName = rhea.MMI_getDisplayName(iconNum);
	var image = "<img src='" +rhea.MMI_getImgForPageConfirm(iconNum) +"'>";
	var selNum = rhea.MMI_getLinkedSelectionNumber(iconNum);
	var defaultOption = null;
	
	//colonna sx
	while (1)
	{
		if (rhea.MMI_canUseSmallCup(iconNum)) 
		{
			var d = rheaGetElemByID("divCup0");
			rheaSetElemHTML(d, rheaLang.LAB_SMALL_CUP);
			rheaShowElem(d);
			if (selNum != 0)
			{
				onCupSelected(MMI_CUP_SIZE_SMALL);
				break;
			}
		}
		
			
		if (rhea.MMI_canUseMediumCup(iconNum)) 
		{
			var d = rheaGetElemByID("divCup1");
			rheaSetElemHTML(d, rheaLang.LAB_MEDIUM_CUP);
			rheaShowElem(d);
			if (selNum != 0)
			{
				onCupSelected(MMI_CUP_SIZE_MEDIUM);
				break;
			}
		}

		if (rhea.MMI_canUseLargeCup(iconNum)) 
		{
			var d = rheaGetElemByID("divCup2");
			rheaSetElemHTML(d, rheaLang.LAB_LARGE_CUP);
			rheaShowElem(d);
			if (selNum != 0)
			{
				onCupSelected(MMI_CUP_SIZE_LARGE);
				break;
			}
		}
		
		//se arriviamo qui, vuol dire che stiamo gestendo una selezione virtuale
		defaultOption = rhea.MMI_getDefaultLinkedSelectionOptions(iconNum);
		onCupSelected (defaultOption.cupSize);
		onGrinderSelected (defaultOption.grinder);
		onShotTypeSelected (defaultOption.shotType);
		break;
	}
	
	//contenuti centrali
	var html = "";
	html += image +"<br>";
	html += "<h2>" +iconDisplayName +"</h2>";
	html += "<div class='btnStart' style='margin:15px auto 0 auto' onclick='onBtnStartSelection()'>" +rheaLang.BTN_START_SELECTION +"</div>";
	
	var d = rheaGetElemByID("divContent");
	rheaSetElemHTML(d, html);
}

function onCupSelected(whichOne)
{
	CUP_SIZE = whichOne;
	for (var i=0; i<3; i++)
	{
		var d = rheaGetElemByID("divCup" +i);
		rheaRemoveClassToElem(d,"selected");
		
		if (i==whichOne)
			rheaAddClassToElem(d,"selected");
	}
}


function onGrinderSelected (whichOne)
{
	GRINDER = whichOne;
}

function onShotTypeSelected (whichOne)
{
	SHOT_TYPE = whichOne;
}


function onBtnStartSelection()
{
	var selNum = rhea.MMI_getLinkedSelectionNumber(iconNum);
	if (selNum == 0)
		selNum = rhea.MMI_getLinkedSelection(iconNum, GRINDER, CUP_SIZE, SHOT_TYPE);
	
	
//	alert ("Exec selection number " +selNum);
	rhea.selection_start(selNum)
		.then( function(result)
		{
			console.log ("OK:" +result);
		})
		.catch( function(result)
		{
			console.log ("KO:" +result);
		});

}

</script>


</html>
